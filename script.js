/*! For license information please see script.js.LICENSE.txt */
(()=>{var t={659:(t,e,i)=>{"use strict";i.d(e,{Gd:()=>f,cu:()=>d});var s=i(170),r=i(343),n=i(235),a=i(176),o=i(350),h=i(15);const l="00000000000000000000000000000000",c=100;class u{__init(){this._stack=[{}]}constructor(t,e=new o.s,i=4){this._version=i,u.prototype.__init.call(this),this.getStackTop().scope=e,t&&this.bindClient(t)}isOlderThan(t){return this._version<t}bindClient(t){this.getStackTop().client=t,t&&t.setupIntegrations&&t.setupIntegrations()}pushScope(){const t=o.s.clone(this.getScope());return this.getStack().push({client:this.getClient(),scope:t}),t}popScope(){return!(this.getStack().length<=1||!this.getStack().pop())}withScope(t){const e=this.pushScope();try{t(e)}finally{this.popScope()}}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getStack(){return this._stack}getStackTop(){return this._stack[this._stack.length-1]}captureException(t,e){const i=new Error("Sentry syntheticException");return this._lastEventId=this._withClient(((s,r)=>s.captureException(t,{originalException:t,syntheticException:i,...e},r)))||l,this._lastEventId}captureMessage(t,e,i){const s=new Error(t);return this._lastEventId=this._withClient(((r,n)=>r.captureMessage(t,e,{originalException:t,syntheticException:s,...i},n)))||l,this._lastEventId}captureEvent(t,e){const i=this._withClient(((i,s)=>i.captureEvent(t,{...e},s)))||l;return"transaction"!==t.type&&(this._lastEventId=i),i}lastEventId(){return this._lastEventId}addBreadcrumb(t,e){const{scope:i,client:n}=this.getStackTop();if(!i||!n)return;const{beforeBreadcrumb:a=null,maxBreadcrumbs:o=c}=n.getOptions&&n.getOptions()||{};if(o<=0)return;const h={timestamp:(0,s.yW)(),...t},l=a?(0,r.Cf)((()=>a(h,e))):h;null!==l&&i.addBreadcrumb(l,o)}setUser(t){const e=this.getScope();e&&e.setUser(t)}setTags(t){const e=this.getScope();e&&e.setTags(t)}setExtras(t){const e=this.getScope();e&&e.setExtras(t)}setTag(t,e){const i=this.getScope();i&&i.setTag(t,e)}setExtra(t,e){const i=this.getScope();i&&i.setExtra(t,e)}setContext(t,e){const i=this.getScope();i&&i.setContext(t,e)}configureScope(t){const{scope:e,client:i}=this.getStackTop();e&&i&&t(e)}run(t){const e=p(this);try{t(this)}finally{p(e)}}getIntegration(t){const e=this.getClient();if(!e)return null;try{return e.getIntegration(t)}catch(e){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn(`Cannot retrieve integration ${t.id} from the current Hub`),null}}startTransaction(t,e){return this._callExtensionMethod("startTransaction",t,e)}traceHeaders(){return this._callExtensionMethod("traceHeaders")}captureSession(t=!1){if(t)return this.endSession();this._sendSessionUpdate()}endSession(){const t=this.getStackTop(),e=t&&t.scope,i=e&&e.getSession();i&&(0,h.RJ)(i),this._sendSessionUpdate(),e&&e.setSession()}startSession(t){const{scope:e,client:i}=this.getStackTop(),{release:s,environment:r}=i&&i.getOptions()||{},{userAgent:a}=n.n2.navigator||{},o=(0,h.Hv)({release:s,environment:r,...e&&{user:e.getUser()},...a&&{userAgent:a},...t});if(e){const t=e.getSession&&e.getSession();t&&"ok"===t.status&&(0,h.CT)(t,{status:"exited"}),this.endSession(),e.setSession(o)}return o}shouldSendDefaultPii(){const t=this.getClient(),e=t&&t.getOptions();return Boolean(e&&e.sendDefaultPii)}_sendSessionUpdate(){const{scope:t,client:e}=this.getStackTop();if(!t)return;const i=t.getSession();i&&e&&e.captureSession&&e.captureSession(i)}_withClient(t){const{scope:e,client:i}=this.getStackTop();return i&&t(i,e)}_callExtensionMethod(t,...e){const i=d().__SENTRY__;if(i&&i.extensions&&"function"==typeof i.extensions[t])return i.extensions[t].apply(this,e);("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn(`Extension method ${t} couldn't be found, doing nothing.`)}}function d(){return n.n2.__SENTRY__=n.n2.__SENTRY__||{extensions:{},hub:void 0},n.n2}function p(t){const e=d(),i=_(e);return g(e,t),i}function f(){const t=d();return m(t)&&!_(t).isOlderThan(4)||g(t,new u),(0,a.KV)()?function(t){try{const e=d().__SENTRY__,i=e&&e.extensions&&e.extensions.domain&&e.extensions.domain.active;if(!i)return _(t);if(!m(i)||_(i).isOlderThan(4)){const e=_(t).getStackTop();g(i,new u(e.client,o.s.clone(e.scope)))}return _(i)}catch(e){return _(t)}}(t):_(t)}function m(t){return!!(t&&t.__SENTRY__&&t.__SENTRY__.hub)}function _(t){return(0,n.YO)("hub",(()=>new u),t)}function g(t,e){return!!t&&((t.__SENTRY__=t.__SENTRY__||{}).hub=e,!0)}},350:(t,e,i)=>{"use strict";i.d(e,{c:()=>d,s:()=>c});var s=i(597),r=i(170),n=i(893),a=i(343),o=i(844),h=i(235),l=i(15);class c{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={}}static clone(t){const e=new c;return t&&(e._breadcrumbs=[...t._breadcrumbs],e._tags={...t._tags},e._extra={...t._extra},e._contexts={...t._contexts},e._user=t._user,e._level=t._level,e._span=t._span,e._session=t._session,e._transactionName=t._transactionName,e._fingerprint=t._fingerprint,e._eventProcessors=[...t._eventProcessors],e._requestSession=t._requestSession,e._attachments=[...t._attachments],e._sdkProcessingMetadata={...t._sdkProcessingMetadata}),e}addScopeListener(t){this._scopeListeners.push(t)}addEventProcessor(t){return this._eventProcessors.push(t),this}setUser(t){return this._user=t||{},this._session&&(0,l.CT)(this._session,{user:t}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(t){return this._requestSession=t,this}setTags(t){return this._tags={...this._tags,...t},this._notifyScopeListeners(),this}setTag(t,e){return this._tags={...this._tags,[t]:e},this._notifyScopeListeners(),this}setExtras(t){return this._extra={...this._extra,...t},this._notifyScopeListeners(),this}setExtra(t,e){return this._extra={...this._extra,[t]:e},this._notifyScopeListeners(),this}setFingerprint(t){return this._fingerprint=t,this._notifyScopeListeners(),this}setLevel(t){return this._level=t,this._notifyScopeListeners(),this}setTransactionName(t){return this._transactionName=t,this._notifyScopeListeners(),this}setContext(t,e){return null===e?delete this._contexts[t]:this._contexts[t]=e,this._notifyScopeListeners(),this}setSpan(t){return this._span=t,this._notifyScopeListeners(),this}getSpan(){return this._span}getTransaction(){const t=this.getSpan();return t&&t.transaction}setSession(t){return t?this._session=t:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(t){if(!t)return this;if("function"==typeof t){const e=t(this);return e instanceof c?e:this}return t instanceof c?(this._tags={...this._tags,...t._tags},this._extra={...this._extra,...t._extra},this._contexts={...this._contexts,...t._contexts},t._user&&Object.keys(t._user).length&&(this._user=t._user),t._level&&(this._level=t._level),t._fingerprint&&(this._fingerprint=t._fingerprint),t._requestSession&&(this._requestSession=t._requestSession)):(0,s.PO)(t)&&(this._tags={...this._tags,...t.tags},this._extra={...this._extra,...t.extra},this._contexts={...this._contexts,...t.contexts},t.user&&(this._user=t.user),t.level&&(this._level=t.level),t.fingerprint&&(this._fingerprint=t.fingerprint),t.requestSession&&(this._requestSession=t.requestSession)),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._span=void 0,this._session=void 0,this._notifyScopeListeners(),this._attachments=[],this}addBreadcrumb(t,e){const i="number"==typeof e?e:100;if(i<=0)return this;const s={timestamp:(0,r.yW)(),...t};return this._breadcrumbs=[...this._breadcrumbs,s].slice(-i),this._notifyScopeListeners(),this}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(t){return this._attachments.push(t),this}getAttachments(){return this._attachments}clearAttachments(){return this._attachments=[],this}applyToEvent(t,e={}){if(this._extra&&Object.keys(this._extra).length&&(t.extra={...this._extra,...t.extra}),this._tags&&Object.keys(this._tags).length&&(t.tags={...this._tags,...t.tags}),this._user&&Object.keys(this._user).length&&(t.user={...this._user,...t.user}),this._contexts&&Object.keys(this._contexts).length&&(t.contexts={...this._contexts,...t.contexts}),this._level&&(t.level=this._level),this._transactionName&&(t.transaction=this._transactionName),this._span){t.contexts={trace:this._span.getTraceContext(),...t.contexts};const e=this._span.transaction&&this._span.transaction.name;e&&(t.tags={transaction:e,...t.tags})}return this._applyFingerprint(t),t.breadcrumbs=[...t.breadcrumbs||[],...this._breadcrumbs],t.breadcrumbs=t.breadcrumbs.length>0?t.breadcrumbs:void 0,t.sdkProcessingMetadata={...t.sdkProcessingMetadata,...this._sdkProcessingMetadata},this._notifyEventProcessors([...u(),...this._eventProcessors],t,e)}setSDKProcessingMetadata(t){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...t},this}_notifyEventProcessors(t,e,i,r=0){return new n.cW(((n,o)=>{const h=t[r];if(null===e||"function"!=typeof h)n(e);else{const l=h({...e},i);("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&h.id&&null===l&&a.kg.log(`Event processor "${h.id}" dropped event`),(0,s.J8)(l)?l.then((e=>this._notifyEventProcessors(t,e,i,r+1).then(n))).then(null,o):this._notifyEventProcessors(t,l,i,r+1).then(n).then(null,o)}}))}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((t=>{t(this)})),this._notifyingListeners=!1)}_applyFingerprint(t){t.fingerprint=t.fingerprint?(0,o.lE)(t.fingerprint):[],this._fingerprint&&(t.fingerprint=t.fingerprint.concat(this._fingerprint)),t.fingerprint&&!t.fingerprint.length&&delete t.fingerprint}}function u(){return(0,h.YO)("globalEventProcessors",(()=>[]))}function d(t){u().push(t)}},15:(t,e,i)=>{"use strict";i.d(e,{CT:()=>o,Hv:()=>a,RJ:()=>h});var s=i(170),r=i(844),n=i(535);function a(t){const e=(0,s.ph)(),i={sid:(0,r.DM)(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(t){return(0,n.Jr)({sid:`${t.sid}`,init:t.init,started:new Date(1e3*t.started).toISOString(),timestamp:new Date(1e3*t.timestamp).toISOString(),status:t.status,errors:t.errors,did:"number"==typeof t.did||"string"==typeof t.did?`${t.did}`:void 0,duration:t.duration,attrs:{release:t.release,environment:t.environment,ip_address:t.ipAddress,user_agent:t.userAgent}})}(i)};return t&&o(i,t),i}function o(t,e={}){if(e.user&&(!t.ipAddress&&e.user.ip_address&&(t.ipAddress=e.user.ip_address),t.did||e.did||(t.did=e.user.id||e.user.email||e.user.username)),t.timestamp=e.timestamp||(0,s.ph)(),e.ignoreDuration&&(t.ignoreDuration=e.ignoreDuration),e.sid&&(t.sid=32===e.sid.length?e.sid:(0,r.DM)()),void 0!==e.init&&(t.init=e.init),!t.did&&e.did&&(t.did=`${e.did}`),"number"==typeof e.started&&(t.started=e.started),t.ignoreDuration)t.duration=void 0;else if("number"==typeof e.duration)t.duration=e.duration;else{const e=t.timestamp-t.started;t.duration=e>=0?e:0}e.release&&(t.release=e.release),e.environment&&(t.environment=e.environment),!t.ipAddress&&e.ipAddress&&(t.ipAddress=e.ipAddress),!t.userAgent&&e.userAgent&&(t.userAgent=e.userAgent),"number"==typeof e.errors&&(t.errors=e.errors),e.status&&(t.status=e.status)}function h(t,e){let i={};e?i={status:e}:"ok"===t.status&&(i={status:"exited"}),o(t,i)}},790:(t,e,i)=>{"use strict";i.d(e,{ro:()=>_,lb:()=>m});var s=i(659),r=i(343),n=i(597),a=i(176),o=i(732),h=i(233);function l(){const t=(0,h.x1)();if(t){const e="internal_error";("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`[Tracing] Transaction: ${e} -> Global error occured`),t.setStatus(e)}}var c=i(458),u=i(391);function d(){const t=this.getScope();if(t){const e=t.getSpan();if(e)return{"sentry-trace":e.toTraceparent()}}return{}}function p(t,e,i){if(!(0,h.zu)(e))return t.sampled=!1,t;if(void 0!==t.sampled)return t.setMetadata({sampleRate:Number(t.sampled)}),t;let s;return"function"==typeof e.tracesSampler?(s=e.tracesSampler(i),t.setMetadata({sampleRate:Number(s)})):void 0!==i.parentSampled?s=i.parentSampled:(s=e.tracesSampleRate,t.setMetadata({sampleRate:Number(s)})),a=s,((0,n.i2)(a)||"number"!=typeof a&&"boolean"!=typeof a?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(a)} of type ${JSON.stringify(typeof a)}.`),0):!(a<0||a>1)||(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${a}.`),0))?s?(t.sampled=Math.random()<s,t.sampled?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`[Tracing] starting ${t.op} transaction - ${t.name}`),t):(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(s)})`),t)):(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),t.sampled=!1,t):(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn("[Tracing] Discarding transaction because of invalid sample rate."),t.sampled=!1,t);var a}function f(t,e){const i=this.getClient(),s=i&&i.getOptions()||{},n=s.instrumenter||"sentry",a=t.instrumenter||"sentry";n!==a&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.error(`A transaction was started with instrumenter=\`${a}\`, but the SDK is configured with the \`${n}\` instrumenter.\nThe transaction will not be sampled. Please use the ${n} instrumentation to start transactions.`),t.sampled=!1);let o=new u.Y(t,this);return o=p(o,s,{parentSampled:t.parentSampled,transactionContext:t,...e}),o.sampled&&o.initSpanRecorder(s._experiments&&s._experiments.maxSpans),o}function m(t,e,i,s,r,n,a){const o=t.getClient(),h=o&&o.getOptions()||{};let l=new c.io(e,t,i,s,a,r);return l=p(l,h,{parentSampled:e.parentSampled,transactionContext:e,...n}),l.sampled&&l.initSpanRecorder(h._experiments&&h._experiments.maxSpans),l}function _(){!function(){const t=(0,s.cu)();t.__SENTRY__&&(t.__SENTRY__.extensions=t.__SENTRY__.extensions||{},t.__SENTRY__.extensions.startTransaction||(t.__SENTRY__.extensions.startTransaction=f),t.__SENTRY__.extensions.traceHeaders||(t.__SENTRY__.extensions.traceHeaders=d))}(),(0,a.KV)()&&function(){const e=(0,s.cu)();if(!e.__SENTRY__)return;const i={mongodb:()=>new((0,a.l$)(t,"./integrations/node/mongo").Mongo),mongoose:()=>new((0,a.l$)(t,"./integrations/node/mongo").Mongo)({mongoose:!0}),mysql:()=>new((0,a.l$)(t,"./integrations/node/mysql").Mysql),pg:()=>new((0,a.l$)(t,"./integrations/node/postgres").Postgres)},r=Object.keys(i).filter((t=>!!(0,a.$y)(t))).map((t=>{try{return i[t]()}catch(t){return}})).filter((t=>t));r.length>0&&(e.__SENTRY__.integrations=[...e.__SENTRY__.integrations||[],...r])}(),(0,o.o)("error",l),(0,o.o)("unhandledrejection",l)}t=i.hmd(t)},458:(t,e,i)=>{"use strict";i.d(e,{hd:()=>l,io:()=>u,mg:()=>h,nT:()=>o});var s=i(170),r=i(343),n=i(334),a=i(391);const o=1e3,h=3e4,l=5e3;class c extends n.gB{constructor(t,e,i,s){super(s),this._pushActivity=t,this._popActivity=e,this.transactionSpanId=i}add(t){t.spanId!==this.transactionSpanId&&(t.finish=e=>{t.endTimestamp="number"==typeof e?e:(0,s._I)(),this._popActivity(t.spanId)},void 0===t.endTimestamp&&this._pushActivity(t.spanId)),super.add(t)}}class u extends a.Y{__init(){this.activities={}}__init2(){this._heartbeatCounter=0}__init3(){this._finished=!1}__init4(){this._beforeFinishCallbacks=[]}constructor(t,e,i=o,s=h,n=l,a=!1){super(t,e),this._idleHub=e,this._idleTimeout=i,this._finalTimeout=s,this._heartbeatInterval=n,this._onScope=a,u.prototype.__init.call(this),u.prototype.__init2.call(this),u.prototype.__init3.call(this),u.prototype.__init4.call(this),a&&(d(e),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`Setting idle transaction on scope. Span ID: ${this.spanId}`),e.configureScope((t=>t.setSpan(this)))),this._startIdleTimeout(),setTimeout((()=>{this._finished||(this.setStatus("deadline_exceeded"),this.finish())}),this._finalTimeout)}finish(t=(0,s._I)()){if(this._finished=!0,this.activities={},this.spanRecorder){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] finishing IdleTransaction",new Date(1e3*t).toISOString(),this.op);for(const e of this._beforeFinishCallbacks)e(this,t);this.spanRecorder.spans=this.spanRecorder.spans.filter((e=>{if(e.spanId===this.spanId)return!0;e.endTimestamp||(e.endTimestamp=t,e.setStatus("cancelled"),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] cancelling span since transaction ended early",JSON.stringify(e,void 0,2)));const i=e.startTimestamp<t;return i||("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] discarding Span since it happened after Transaction was finished",JSON.stringify(e,void 0,2)),i})),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] flushing IdleTransaction")}else("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] No active IdleTransaction");return this._onScope&&d(this._idleHub),super.finish(t)}registerBeforeFinishCallback(t){this._beforeFinishCallbacks.push(t)}initSpanRecorder(t){if(!this.spanRecorder){const e=t=>{this._finished||this._pushActivity(t)},i=t=>{this._finished||this._popActivity(t)};this.spanRecorder=new c(e,i,this.spanId,t),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("Starting heartbeat"),this._pingHeartbeat()}this.spanRecorder.add(this)}_cancelIdleTimeout(){this._idleTimeoutID&&(clearTimeout(this._idleTimeoutID),this._idleTimeoutID=void 0)}_startIdleTimeout(t){this._cancelIdleTimeout(),this._idleTimeoutID=setTimeout((()=>{this._finished||0!==Object.keys(this.activities).length||this.finish(t)}),this._idleTimeout)}_pushActivity(t){this._cancelIdleTimeout(),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`[Tracing] pushActivity: ${t}`),this.activities[t]=!0,("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] new activities count",Object.keys(this.activities).length)}_popActivity(t){if(this.activities[t]&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`[Tracing] popActivity ${t}`),delete this.activities[t],("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] new activities count",Object.keys(this.activities).length)),0===Object.keys(this.activities).length){const t=(0,s._I)()+this._idleTimeout/1e3;this._startIdleTimeout(t)}}_beat(){if(this._finished)return;const t=Object.keys(this.activities).join("");t===this._prevHeartbeatString?this._heartbeatCounter++:this._heartbeatCounter=1,this._prevHeartbeatString=t,this._heartbeatCounter>=3?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log("[Tracing] Transaction finished because of no change for 3 heart beats"),this.setStatus("deadline_exceeded"),this.finish()):this._pingHeartbeat()}_pingHeartbeat(){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.log(`pinging Heartbeat -> current counter: ${this._heartbeatCounter}`),setTimeout((()=>{this._beat()}),this._heartbeatInterval)}}function d(t){const e=t.getScope();e&&e.getTransaction()&&e.setSpan(void 0)}},334:(t,e,i)=>{"use strict";i.d(e,{Dr:()=>l,gB:()=>h});var s=i(375),r=i(844),n=i(170),a=i(343),o=i(535);class h{__init(){this.spans=[]}constructor(t=1e3){h.prototype.__init.call(this),this._maxlen=t}add(t){this.spans.length>this._maxlen?t.spanRecorder=void 0:this.spans.push(t)}}class l{__init2(){this.traceId=(0,r.DM)()}__init3(){this.spanId=(0,r.DM)().substring(16)}__init4(){this.startTimestamp=(0,n._I)()}__init5(){this.tags={}}__init6(){this.data={}}__init7(){this.instrumenter="sentry"}constructor(t){if(l.prototype.__init2.call(this),l.prototype.__init3.call(this),l.prototype.__init4.call(this),l.prototype.__init5.call(this),l.prototype.__init6.call(this),l.prototype.__init7.call(this),!t)return this;t.traceId&&(this.traceId=t.traceId),t.spanId&&(this.spanId=t.spanId),t.parentSpanId&&(this.parentSpanId=t.parentSpanId),"sampled"in t&&(this.sampled=t.sampled),t.op&&(this.op=t.op),t.description&&(this.description=t.description),t.data&&(this.data=t.data),t.tags&&(this.tags=t.tags),t.status&&(this.status=t.status),t.startTimestamp&&(this.startTimestamp=t.startTimestamp),t.endTimestamp&&(this.endTimestamp=t.endTimestamp),t.instrumenter&&(this.instrumenter=t.instrumenter)}startChild(t){const e=new l({...t,parentSpanId:this.spanId,sampled:this.sampled,traceId:this.traceId});if(e.spanRecorder=this.spanRecorder,e.spanRecorder&&e.spanRecorder.add(e),e.transaction=this.transaction,("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&e.transaction){const i=`[Tracing] Starting '${t&&t.op||"< unknown op >"}' span on transaction '${e.transaction.name||"< unknown name >"}' (${e.transaction.spanId}).`;e.transaction.metadata.spanMetadata[e.spanId]={logMessage:i},a.kg.log(i)}return e}setTag(t,e){return this.tags={...this.tags,[t]:e},this}setData(t,e){return this.data={...this.data,[t]:e},this}setStatus(t){return this.status=t,this}setHttpStatus(t){this.setTag("http.status_code",String(t));const e=function(t){if(t<400&&t>=100)return"ok";if(t>=400&&t<500)switch(t){case 401:return"unauthenticated";case 403:return"permission_denied";case 404:return"not_found";case 409:return"already_exists";case 413:return"failed_precondition";case 429:return"resource_exhausted";default:return"invalid_argument"}if(t>=500&&t<600)switch(t){case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline_exceeded";default:return"internal_error"}return"unknown_error"}(t);return"unknown_error"!==e&&this.setStatus(e),this}isSuccess(){return"ok"===this.status}finish(t){if(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&this.transaction&&this.transaction.spanId!==this.spanId){const{logMessage:t}=this.transaction.metadata.spanMetadata[this.spanId];t&&a.kg.log(t.replace("Starting","Finishing"))}this.endTimestamp="number"==typeof t?t:(0,n._I)()}toTraceparent(){let t="";return void 0!==this.sampled&&(t=this.sampled?"-1":"-0"),`${this.traceId}-${this.spanId}${t}`}toContext(){return(0,o.Jr)({data:this.data,description:this.description,endTimestamp:this.endTimestamp,op:this.op,parentSpanId:this.parentSpanId,sampled:this.sampled,spanId:this.spanId,startTimestamp:this.startTimestamp,status:this.status,tags:this.tags,traceId:this.traceId})}updateWithContext(t){return this.data=(0,s.h)(t.data,(()=>({}))),this.description=t.description,this.endTimestamp=t.endTimestamp,this.op=t.op,this.parentSpanId=t.parentSpanId,this.sampled=t.sampled,this.spanId=(0,s.h)(t.spanId,(()=>this.spanId)),this.startTimestamp=(0,s.h)(t.startTimestamp,(()=>this.startTimestamp)),this.status=t.status,this.tags=(0,s.h)(t.tags,(()=>({}))),this.traceId=(0,s.h)(t.traceId,(()=>this.traceId)),this}getTraceContext(){return(0,o.Jr)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,trace_id:this.traceId})}toJSON(){return(0,o.Jr)({data:Object.keys(this.data).length>0?this.data:void 0,description:this.description,op:this.op,parent_span_id:this.parentSpanId,span_id:this.spanId,start_timestamp:this.startTimestamp,status:this.status,tags:Object.keys(this.tags).length>0?this.tags:void 0,timestamp:this.endTimestamp,trace_id:this.traceId})}}},391:(t,e,i)=>{"use strict";i.d(e,{Y:()=>l});var s=i(375),r=i(659),n=i(170),a=i(343),o=i(535),h=i(334);class l extends h.Dr{__init(){this._measurements={}}__init2(){this._contexts={}}__init3(){this._frozenDynamicSamplingContext=void 0}constructor(t,e){super(t),l.prototype.__init.call(this),l.prototype.__init2.call(this),l.prototype.__init3.call(this),this._hub=e||(0,r.Gd)(),this._name=t.name||"",this.metadata={source:"custom",...t.metadata,spanMetadata:{},changes:[],propagations:0},this._trimEnd=t.trimEnd,this.transaction=this;const i=this.metadata.dynamicSamplingContext;i&&(this._frozenDynamicSamplingContext={...i})}get name(){return this._name}set name(t){this.setName(t)}setName(t,e="custom"){t===this.name&&e===this.metadata.source||this.metadata.changes.push({source:this.metadata.source,timestamp:(0,n.ph)(),propagations:this.metadata.propagations}),this._name=t,this.metadata.source=e}initSpanRecorder(t=1e3){this.spanRecorder||(this.spanRecorder=new h.gB(t)),this.spanRecorder.add(this)}setContext(t,e){null===e?delete this._contexts[t]:this._contexts[t]=e}setMeasurement(t,e,i=""){this._measurements[t]={value:e,unit:i}}setMetadata(t){this.metadata={...this.metadata,...t}}finish(t){if(void 0!==this.endTimestamp)return;if(this.name||(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&a.kg.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this.name="<unlabeled transaction>"),super.finish(t),!0!==this.sampled){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&a.kg.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled.");const t=this._hub.getClient();return void(t&&t.recordDroppedEvent("sample_rate","transaction"))}const e=this.spanRecorder?this.spanRecorder.spans.filter((t=>t!==this&&t.endTimestamp)):[];this._trimEnd&&e.length>0&&(this.endTimestamp=e.reduce(((t,e)=>t.endTimestamp&&e.endTimestamp?t.endTimestamp>e.endTimestamp?t:e:t)).endTimestamp);const i=this.metadata,s={contexts:{...this._contexts,trace:this.getTraceContext()},spans:e,start_timestamp:this.startTimestamp,tags:this.tags,timestamp:this.endTimestamp,transaction:this.name,type:"transaction",sdkProcessingMetadata:{...i,dynamicSamplingContext:this.getDynamicSamplingContext()},...i.source&&{transaction_info:{source:i.source,changes:i.changes,propagations:i.propagations}}};return Object.keys(this._measurements).length>0&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&a.kg.log("[Measurements] Adding measurements to transaction",JSON.stringify(this._measurements,void 0,2)),s.measurements=this._measurements),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&a.kg.log(`[Tracing] Finishing ${this.op} transaction: ${this.name}.`),this._hub.captureEvent(s)}toContext(){const t=super.toContext();return(0,o.Jr)({...t,name:this.name,trimEnd:this._trimEnd})}updateWithContext(t){return super.updateWithContext(t),this.name=(0,s.h)(t.name,(()=>"")),this._trimEnd=t.trimEnd,this}getDynamicSamplingContext(){if(this._frozenDynamicSamplingContext)return this._frozenDynamicSamplingContext;const t=this._hub||(0,r.Gd)(),e=t&&t.getClient();if(!e)return{};const{environment:i,release:s}=e.getOptions()||{},{publicKey:n}=e.getDsn()||{},a=this.metadata.sampleRate,h=void 0!==a?a.toString():void 0,l=t.getScope(),{segment:c}=l&&l.getUser()||{},u=this.metadata.source,d=u&&"url"!==u?this.name:void 0;return(0,o.Jr)({environment:i,release:s,transaction:d,user_segment:c,public_key:n,trace_id:this.traceId,sample_rate:h})}}},233:(t,e,i)=>{"use strict";i.d(e,{XL:()=>a,x1:()=>n,zu:()=>r});var s=i(659);function r(t){const e=(0,s.Gd)().getClient(),i=t||e&&e.getOptions();return!!i&&("tracesSampleRate"in i||"tracesSampler"in i)}function n(t){const e=(t||(0,s.Gd)()).getScope();return e&&e.getTransaction()}function a(t){return t/1e3}},464:(t,e,i)=>{"use strict";i.d(e,{Rt:()=>n,l4:()=>o,qT:()=>h});var s=i(597);const r=(0,i(235).Rf)();function n(t,e){try{let i=t;const s=5,r=80,n=[];let o=0,h=0;const l=" > ",c=l.length;let u;for(;i&&o++<s&&(u=a(i,e),!("html"===u||o>1&&h+n.length*c+u.length>=r));)n.push(u),h+=u.length,i=i.parentNode;return n.reverse().join(l)}catch(t){return"<unknown>"}}function a(t,e){const i=t,r=[];let n,a,o,h,l;if(!i||!i.tagName)return"";r.push(i.tagName.toLowerCase());const c=e&&e.length?e.filter((t=>i.getAttribute(t))).map((t=>[t,i.getAttribute(t)])):null;if(c&&c.length)c.forEach((t=>{r.push(`[${t[0]}="${t[1]}"]`)}));else if(i.id&&r.push(`#${i.id}`),n=i.className,n&&(0,s.HD)(n))for(a=n.split(/\s+/),l=0;l<a.length;l++)r.push(`.${a[l]}`);const u=["type","name","title","alt"];for(l=0;l<u.length;l++)o=u[l],h=i.getAttribute(o),h&&r.push(`[${o}="${h}"]`);return r.join("")}function o(){try{return r.document.location.href}catch(t){return""}}function h(t){return r.document&&r.document.querySelector?r.document.querySelector(t):null}},375:(t,e,i)=>{"use strict";function s(t,e){return null!=t?t:e()}i.d(e,{h:()=>s})},732:(t,e,i)=>{"use strict";i.d(e,{o:()=>u});var s=i(597),r=i(343),n=i(535),a=i(360),o=i(823);const h=(0,i(235).Rf)(),l={},c={};function u(t,e){l[t]=l[t]||[],l[t].push(e),function(t){if(!c[t])switch(c[t]=!0,t){case"console":"console"in h&&r.RU.forEach((function(t){t in h.console&&(0,n.hl)(h.console,t,(function(e){return function(...i){d("console",{args:i,level:t}),e&&e.apply(h.console,i)}}))}));break;case"dom":!function(){if(!("document"in h))return;const t=d.bind(null,"dom"),e=v(t,!0);h.document.addEventListener("click",e,!1),h.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((e=>{const i=h[e]&&h[e].prototype;i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")&&((0,n.hl)(i,"addEventListener",(function(e){return function(i,s,r){if("click"===i||"keypress"==i)try{const s=this,n=s.__sentry_instrumentation_handlers__=s.__sentry_instrumentation_handlers__||{},a=n[i]=n[i]||{refCount:0};if(!a.handler){const s=v(t);a.handler=s,e.call(this,i,s,r)}a.refCount++}catch(t){}return e.call(this,i,s,r)}})),(0,n.hl)(i,"removeEventListener",(function(t){return function(e,i,s){if("click"===e||"keypress"==e)try{const i=this,r=i.__sentry_instrumentation_handlers__||{},n=r[e];n&&(n.refCount--,n.refCount<=0&&(t.call(this,e,n.handler,s),n.handler=void 0,delete r[e]),0===Object.keys(r).length&&delete i.__sentry_instrumentation_handlers__)}catch(t){}return t.call(this,e,i,s)}})))}))}();break;case"xhr":!function(){if(!("XMLHttpRequest"in h))return;const t=XMLHttpRequest.prototype;(0,n.hl)(t,"open",(function(t){return function(...e){const i=this,r=e[1],a=i.__sentry_xhr__={method:(0,s.HD)(e[0])?e[0].toUpperCase():e[0],url:e[1]};(0,s.HD)(r)&&"POST"===a.method&&r.match(/sentry_key/)&&(i.__sentry_own_request__=!0);const o=function(){if(4===i.readyState){try{a.status_code=i.status}catch(t){}d("xhr",{args:e,endTimestamp:Date.now(),startTimestamp:Date.now(),xhr:i})}};return"onreadystatechange"in i&&"function"==typeof i.onreadystatechange?(0,n.hl)(i,"onreadystatechange",(function(t){return function(...e){return o(),t.apply(i,e)}})):i.addEventListener("readystatechange",o),t.apply(i,e)}})),(0,n.hl)(t,"send",(function(t){return function(...e){return this.__sentry_xhr__&&void 0!==e[0]&&(this.__sentry_xhr__.body=e[0]),d("xhr",{args:e,startTimestamp:Date.now(),xhr:this}),t.apply(this,e)}}))}();break;case"fetch":(0,o.t$)()&&(0,n.hl)(h,"fetch",(function(t){return function(...e){const i={args:e,fetchData:{method:p(e),url:f(e)},startTimestamp:Date.now()};return d("fetch",{...i}),t.apply(h,e).then((t=>(d("fetch",{...i,endTimestamp:Date.now(),response:t}),t)),(t=>{throw d("fetch",{...i,endTimestamp:Date.now(),error:t}),t}))}}));break;case"history":!function(){if(!(0,o.Bf)())return;const t=h.onpopstate;function e(t){return function(...e){const i=e.length>2?e[2]:void 0;if(i){const t=m,e=String(i);m=e,d("history",{from:t,to:e})}return t.apply(this,e)}}h.onpopstate=function(...e){const i=h.location.href,s=m;if(m=i,d("history",{from:s,to:i}),t)try{return t.apply(this,e)}catch(t){}},(0,n.hl)(h.history,"pushState",e),(0,n.hl)(h.history,"replaceState",e)}();break;case"error":y=h.onerror,h.onerror=function(t,e,i,s,r){return d("error",{column:s,error:r,line:i,msg:t,url:e}),!!y&&y.apply(this,arguments)};break;case"unhandledrejection":x=h.onunhandledrejection,h.onunhandledrejection=function(t){return d("unhandledrejection",t),!x||x.apply(this,arguments)};break;default:("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.warn("unknown instrumentation type:",t)}}(t)}function d(t,e){if(t&&l[t])for(const i of l[t]||[])try{i(e)}catch(e){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&r.kg.error(`Error while triggering instrumentation handler.\nType: ${t}\nName: ${(0,a.$P)(i)}\nError:`,e)}}function p(t=[]){return"Request"in h&&(0,s.V9)(t[0],Request)&&t[0].method?String(t[0].method).toUpperCase():t[1]&&t[1].method?String(t[1].method).toUpperCase():"GET"}function f(t=[]){return"string"==typeof t[0]?t[0]:"Request"in h&&(0,s.V9)(t[0],Request)?t[0].url:String(t[0])}let m,_,g;function v(t,e=!1){return i=>{if(!i||g===i)return;if(function(t){if("keypress"!==t.type)return!1;try{const e=t.target;if(!e||!e.tagName)return!0;if("INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable)return!1}catch(t){}return!0}(i))return;const s="keypress"===i.type?"input":i.type;(void 0===_||function(t,e){if(!t)return!0;if(t.type!==e.type)return!0;try{if(t.target!==e.target)return!0}catch(t){}return!1}(g,i))&&(t({event:i,name:s,global:e}),g=i),clearTimeout(_),_=h.setTimeout((()=>{_=void 0}),1e3)}}let y=null,x=null},597:(t,e,i)=>{"use strict";i.d(e,{Cy:()=>_,HD:()=>l,J8:()=>m,Kj:()=>f,PO:()=>u,TX:()=>o,V9:()=>v,VW:()=>a,VZ:()=>r,cO:()=>d,fm:()=>h,i2:()=>g,kK:()=>p,pt:()=>c});const s=Object.prototype.toString;function r(t){switch(s.call(t)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return v(t,Error)}}function n(t,e){return s.call(t)===`[object ${e}]`}function a(t){return n(t,"ErrorEvent")}function o(t){return n(t,"DOMError")}function h(t){return n(t,"DOMException")}function l(t){return n(t,"String")}function c(t){return null===t||"object"!=typeof t&&"function"!=typeof t}function u(t){return n(t,"Object")}function d(t){return"undefined"!=typeof Event&&v(t,Event)}function p(t){return"undefined"!=typeof Element&&v(t,Element)}function f(t){return n(t,"RegExp")}function m(t){return Boolean(t&&t.then&&"function"==typeof t.then)}function _(t){return u(t)&&"nativeEvent"in t&&"preventDefault"in t&&"stopPropagation"in t}function g(t){return"number"==typeof t&&t!=t}function v(t,e){try{return t instanceof e}catch(t){return!1}}},343:(t,e,i)=>{"use strict";i.d(e,{Cf:()=>n,RU:()=>r,kg:()=>o});var s=i(235);const r=["debug","info","warn","error","log","assert","trace"];function n(t){if(!("console"in s.n2))return t();const e=s.n2.console,i={};r.forEach((t=>{const s=e[t]&&e[t].__sentry_original__;t in e&&s&&(i[t]=e[t],e[t]=s)}));try{return t()}finally{Object.keys(i).forEach((t=>{e[t]=i[t]}))}}function a(){let t=!1;const e={enable:()=>{t=!0},disable:()=>{t=!1}};return"undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?r.forEach((i=>{e[i]=(...e)=>{t&&n((()=>{s.n2.console[i](`Sentry Logger [${i}]:`,...e)}))}})):r.forEach((t=>{e[t]=()=>{}})),e}let o;o="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?(0,s.YO)("logger",a):a()},844:(t,e,i)=>{"use strict";i.d(e,{DM:()=>n,Db:()=>h,EG:()=>l,YO:()=>c,jH:()=>o,lE:()=>u});var s=i(535),r=i(235);function n(){const t=r.n2,e=t.crypto||t.msCrypto;if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");const i=e&&e.getRandomValues?()=>e.getRandomValues(new Uint8Array(1))[0]:()=>16*Math.random();return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(t=>(t^(15&i())>>t/4).toString(16)))}function a(t){return t.exception&&t.exception.values?t.exception.values[0]:void 0}function o(t){const{message:e,event_id:i}=t;if(e)return e;const s=a(t);return s?s.type&&s.value?`${s.type}: ${s.value}`:s.type||s.value||i||"<unknown>":i||"<unknown>"}function h(t,e,i){const s=t.exception=t.exception||{},r=s.values=s.values||[],n=r[0]=r[0]||{};n.value||(n.value=e||""),n.type||(n.type=i||"Error")}function l(t,e){const i=a(t);if(!i)return;const s=i.mechanism;if(i.mechanism={type:"generic",handled:!0,...s,...e},e&&"data"in e){const t={...s&&s.data,...e.data};i.mechanism.data=t}}function c(t){if(t&&t.__sentry_captured__)return!0;try{(0,s.xp)(t,"__sentry_captured__",!0)}catch(t){}return!1}function u(t){return Array.isArray(t)?t:[t]}},176:(t,e,i)=>{"use strict";function s(){return!("undefined"!=typeof __SENTRY_BROWSER_BUNDLE__&&__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}function r(t,e){return t.require(e)}function n(e){let i;try{i=r(t,e)}catch(t){}try{const{cwd:s}=r(t,"process");i=r(t,`${s()}/node_modules/${e}`)}catch(t){}return i}i.d(e,{l$:()=>r,KV:()=>s,$y:()=>n}),t=i.hmd(t)},535:(t,e,i)=>{"use strict";i.d(e,{$Q:()=>h,HK:()=>l,Jr:()=>m,Sh:()=>u,_j:()=>c,hl:()=>a,xp:()=>o,zf:()=>f});var s=i(464),r=i(597),n=i(321);function a(t,e,i){if(!(e in t))return;const s=t[e],r=i(s);if("function"==typeof r)try{h(r,s)}catch(t){}t[e]=r}function o(t,e,i){Object.defineProperty(t,e,{value:i,writable:!0,configurable:!0})}function h(t,e){const i=e.prototype||{};t.prototype=e.prototype=i,o(t,"__sentry_original__",e)}function l(t){return t.__sentry_original__}function c(t){return Object.keys(t).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(t[e])}`)).join("&")}function u(t){if((0,r.VZ)(t))return{message:t.message,name:t.name,stack:t.stack,...p(t)};if((0,r.cO)(t)){const e={type:t.type,target:d(t.target),currentTarget:d(t.currentTarget),...p(t)};return"undefined"!=typeof CustomEvent&&(0,r.V9)(t,CustomEvent)&&(e.detail=t.detail),e}return t}function d(t){try{return(0,r.kK)(t)?(0,s.Rt)(t):Object.prototype.toString.call(t)}catch(t){return"<unknown>"}}function p(t){if("object"==typeof t&&null!==t){const e={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}return{}}function f(t,e=40){const i=Object.keys(u(t));if(i.sort(),!i.length)return"[object has no keys]";if(i[0].length>=e)return(0,n.$G)(i[0],e);for(let t=i.length;t>0;t--){const s=i.slice(0,t).join(", ");if(!(s.length>e))return t===i.length?s:(0,n.$G)(s,e)}return""}function m(t){return _(t,new Map)}function _(t,e){if((0,r.PO)(t)){const i=e.get(t);if(void 0!==i)return i;const s={};e.set(t,s);for(const i of Object.keys(t))void 0!==t[i]&&(s[i]=_(t[i],e));return s}if(Array.isArray(t)){const i=e.get(t);if(void 0!==i)return i;const s=[];return e.set(t,s),t.forEach((t=>{s.push(_(t,e))})),s}return t}},360:(t,e,i)=>{"use strict";function s(...t){const e=t.sort(((t,e)=>t[0]-e[0])).map((t=>t[1]));return(t,i=0)=>{const s=[];for(const r of t.split("\n").slice(i)){const t=r.replace(/\(error: (.*)\)/,"$1");for(const i of e){const e=i(t);if(e){s.push(e);break}}}return function(t){if(!t.length)return[];let e=t;const i=e[0].function||"",s=e[e.length-1].function||"";return-1===i.indexOf("captureMessage")&&-1===i.indexOf("captureException")||(e=e.slice(1)),-1!==s.indexOf("sentryWrapped")&&(e=e.slice(0,-1)),e.slice(0,50).map((t=>({...t,filename:t.filename||e[0].filename,function:t.function||"?"}))).reverse()}(s)}}function r(t){return Array.isArray(t)?s(...t):t}i.d(e,{$P:()=>a,Sq:()=>r,pE:()=>s});const n="<anonymous>";function a(t){try{return t&&"function"==typeof t&&t.name||n}catch(t){return n}}},321:(t,e,i)=>{"use strict";i.d(e,{$G:()=>r,U0:()=>a,nK:()=>n});var s=i(597);function r(t,e=0){return"string"!=typeof t||0===e||t.length<=e?t:`${t.substr(0,e)}...`}function n(t,e){if(!Array.isArray(t))return"";const i=[];for(let e=0;e<t.length;e++){const s=t[e];try{i.push(String(s))}catch(t){i.push("[value cannot be serialized]")}}return i.join(e)}function a(t,e=[],i=!1){return e.some((e=>function(t,e,i=!1){return!!(0,s.HD)(t)&&((0,s.Kj)(e)?e.test(t):!!(0,s.HD)(e)&&(i?t===e:t.includes(e)))}(t,e,i)))}},823:(t,e,i)=>{"use strict";i.d(e,{Ak:()=>n,Bf:()=>h,Du:()=>a,t$:()=>o});var s=i(343);const r=(0,i(235).Rf)();function n(){if(!("fetch"in r))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch(t){return!1}}function a(t){return t&&/^function fetch\(\)\s+\{\s+\[native code\]\s+\}$/.test(t.toString())}function o(){if(!n())return!1;if(a(r.fetch))return!0;let t=!1;const e=r.document;if(e&&"function"==typeof e.createElement)try{const i=e.createElement("iframe");i.hidden=!0,e.head.appendChild(i),i.contentWindow&&i.contentWindow.fetch&&(t=a(i.contentWindow.fetch)),e.head.removeChild(i)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&s.kg.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return t}function h(){const t=r.chrome,e=t&&t.app&&t.app.runtime,i="history"in r&&!!r.history.pushState&&!!r.history.replaceState;return!e&&i}},893:(t,e,i)=>{"use strict";i.d(e,{$2:()=>a,WD:()=>n,cW:()=>o});var s,r=i(597);function n(t){return new o((e=>{e(t)}))}function a(t){return new o(((e,i)=>{i(t)}))}!function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"}(s||(s={}));class o{__init(){this._state=s.PENDING}__init2(){this._handlers=[]}constructor(t){o.prototype.__init.call(this),o.prototype.__init2.call(this),o.prototype.__init3.call(this),o.prototype.__init4.call(this),o.prototype.__init5.call(this),o.prototype.__init6.call(this);try{t(this._resolve,this._reject)}catch(t){this._reject(t)}}then(t,e){return new o(((i,s)=>{this._handlers.push([!1,e=>{if(t)try{i(t(e))}catch(t){s(t)}else i(e)},t=>{if(e)try{i(e(t))}catch(t){s(t)}else s(t)}]),this._executeHandlers()}))}catch(t){return this.then((t=>t),t)}finally(t){return new o(((e,i)=>{let s,r;return this.then((e=>{r=!1,s=e,t&&t()}),(e=>{r=!0,s=e,t&&t()})).then((()=>{r?i(s):e(s)}))}))}__init3(){this._resolve=t=>{this._setResult(s.RESOLVED,t)}}__init4(){this._reject=t=>{this._setResult(s.REJECTED,t)}}__init5(){this._setResult=(t,e)=>{this._state===s.PENDING&&((0,r.J8)(e)?e.then(this._resolve,this._reject):(this._state=t,this._value=e,this._executeHandlers()))}}__init6(){this._executeHandlers=()=>{if(this._state===s.PENDING)return;const t=this._handlers.slice();this._handlers=[],t.forEach((t=>{t[0]||(this._state===s.RESOLVED&&t[1](this._value),this._state===s.REJECTED&&t[2](this._value),t[0]=!0)}))}}}},170:(t,e,i)=>{"use strict";i.d(e,{Z1:()=>p,_I:()=>u,ph:()=>c,yW:()=>l});var s=i(176),r=i(235);t=i.hmd(t);const n=(0,r.Rf)(),a={nowSeconds:()=>Date.now()/1e3},o=(0,s.KV)()?function(){try{return(0,s.l$)(t,"perf_hooks").performance}catch(t){return}}():function(){const{performance:t}=n;if(t&&t.now)return{now:()=>t.now(),timeOrigin:Date.now()-t.now()}}(),h=void 0===o?a:{nowSeconds:()=>(o.timeOrigin+o.now())/1e3},l=a.nowSeconds.bind(a),c=h.nowSeconds.bind(h),u=c;let d;const p=(()=>{const{performance:t}=n;if(!t||!t.now)return void(d="none");const e=36e5,i=t.now(),s=Date.now(),r=t.timeOrigin?Math.abs(t.timeOrigin+i-s):e,a=r<e,o=t.timing&&t.timing.navigationStart,h="number"==typeof o?Math.abs(o+i-s):e;return a||h<e?r<=h?(d="timeOrigin",t.timeOrigin):(d="navigationStart",o):(d="dateNow",s)})()},235:(t,e,i)=>{"use strict";function s(t){return t&&t.Math==Math?t:void 0}i.d(e,{Rf:()=>n,YO:()=>a,n2:()=>r});const r="object"==typeof globalThis&&s(globalThis)||"object"==typeof window&&s(window)||"object"==typeof self&&s(self)||"object"==typeof i.g&&s(i.g)||function(){return this}()||{};function n(){return r}function a(t,e,i){const s=i||r,n=s.__SENTRY__=s.__SENTRY__||{};return n[t]||(n[t]=e())}},187:t=>{"use strict";function e(t,e,s){s=s||2;var n,a,o,h,u,d,f,m=e&&e.length,_=m?e[0]*s:t.length,g=i(t,0,_,s,!0),v=[];if(!g||g.next===g.prev)return v;if(m&&(g=function(t,e,s,r){var n,a,o,h=[];for(n=0,a=e.length;n<a;n++)(o=i(t,e[n]*r,n<a-1?e[n+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),h.push(p(o));for(h.sort(l),n=0;n<h.length;n++)s=c(h[n],s);return s}(t,e,g,s)),t.length>80*s){n=o=t[0],a=h=t[1];for(var y=s;y<_;y+=s)(u=t[y])<n&&(n=u),(d=t[y+1])<a&&(a=d),u>o&&(o=u),d>h&&(h=d);f=0!==(f=Math.max(o-n,h-a))?32767/f:0}return r(g,v,s,n,a,f,0),v}function i(t,e,i,s,r){var n,a;if(r===A(t,e,i,s)>0)for(n=e;n<i;n+=s)a=E(n,t[n],t[n+1],a);else for(n=i-s;n>=e;n-=s)a=E(n,t[n],t[n+1],a);return a&&g(a,a.next)&&(w(a),a=a.next),a}function s(t,e){if(!t)return t;e||(e=t);var i,s=t;do{if(i=!1,s.steiner||!g(s,s.next)&&0!==_(s.prev,s,s.next))s=s.next;else{if(w(s),(s=e=s.prev)===s.next)break;i=!0}}while(i||s!==e);return e}function r(t,e,i,l,c,u,p){if(t){!p&&u&&function(t,e,i,s){var r=t;do{0===r.z&&(r.z=d(r.x,r.y,e,i,s)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,s,r,n,a,o,h,l=1;do{for(i=t,t=null,n=null,a=0;i;){for(a++,s=i,o=0,e=0;e<l&&(o++,s=s.nextZ);e++);for(h=l;o>0||h>0&&s;)0!==o&&(0===h||!s||i.z<=s.z)?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,h--),n?n.nextZ=r:t=r,r.prevZ=n,n=r;i=s}n.nextZ=null,l*=2}while(a>1)}(r)}(t,l,c,u);for(var f,m,_=t;t.prev!==t.next;)if(f=t.prev,m=t.next,u?a(t,l,c,u):n(t))e.push(f.i/i|0),e.push(t.i/i|0),e.push(m.i/i|0),w(t),t=m.next,_=m.next;else if((t=m)===_){p?1===p?r(t=o(s(t),e,i),e,i,l,c,u,2):2===p&&h(t,e,i,l,c,u):r(s(t),e,i,l,c,u,1);break}}}function n(t){var e=t.prev,i=t,s=t.next;if(_(e,i,s)>=0)return!1;for(var r=e.x,n=i.x,a=s.x,o=e.y,h=i.y,l=s.y,c=r<n?r<a?r:a:n<a?n:a,u=o<h?o<l?o:l:h<l?h:l,d=r>n?r>a?r:a:n>a?n:a,p=o>h?o>l?o:l:h>l?h:l,m=s.next;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=p&&f(r,o,n,h,a,l,m.x,m.y)&&_(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function a(t,e,i,s){var r=t.prev,n=t,a=t.next;if(_(r,n,a)>=0)return!1;for(var o=r.x,h=n.x,l=a.x,c=r.y,u=n.y,p=a.y,m=o<h?o<l?o:l:h<l?h:l,g=c<u?c<p?c:p:u<p?u:p,v=o>h?o>l?o:l:h>l?h:l,y=c>u?c>p?c:p:u>p?u:p,x=d(m,g,e,i,s),b=d(v,y,e,i,s),T=t.prevZ,E=t.nextZ;T&&T.z>=x&&E&&E.z<=b;){if(T.x>=m&&T.x<=v&&T.y>=g&&T.y<=y&&T!==r&&T!==a&&f(o,c,h,u,l,p,T.x,T.y)&&_(T.prev,T,T.next)>=0)return!1;if(T=T.prevZ,E.x>=m&&E.x<=v&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&f(o,c,h,u,l,p,E.x,E.y)&&_(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;T&&T.z>=x;){if(T.x>=m&&T.x<=v&&T.y>=g&&T.y<=y&&T!==r&&T!==a&&f(o,c,h,u,l,p,T.x,T.y)&&_(T.prev,T,T.next)>=0)return!1;T=T.prevZ}for(;E&&E.z<=b;){if(E.x>=m&&E.x<=v&&E.y>=g&&E.y<=y&&E!==r&&E!==a&&f(o,c,h,u,l,p,E.x,E.y)&&_(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function o(t,e,i){var r=t;do{var n=r.prev,a=r.next.next;!g(n,a)&&v(n,r,r.next,a)&&b(n,a)&&b(a,n)&&(e.push(n.i/i|0),e.push(r.i/i|0),e.push(a.i/i|0),w(r),w(r.next),r=t=a),r=r.next}while(r!==t);return s(r)}function h(t,e,i,n,a,o){var h=t;do{for(var l=h.next.next;l!==h.prev;){if(h.i!==l.i&&m(h,l)){var c=T(h,l);return h=s(h,h.next),c=s(c,c.next),r(h,e,i,n,a,o,0),void r(c,e,i,n,a,o,0)}l=l.next}h=h.next}while(h!==t)}function l(t,e){return t.x-e.x}function c(t,e){var i=function(t,e){var i,s=e,r=t.x,n=t.y,a=-1/0;do{if(n<=s.y&&n>=s.next.y&&s.next.y!==s.y){var o=s.x+(n-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=r&&o>a&&(a=o,i=s.x<s.next.x?s:s.next,o===r))return i}s=s.next}while(s!==e);if(!i)return null;var h,l=i,c=i.x,d=i.y,p=1/0;s=i;do{r>=s.x&&s.x>=c&&r!==s.x&&f(n<d?r:a,n,c,d,n<d?a:r,n,s.x,s.y)&&(h=Math.abs(n-s.y)/(r-s.x),b(s,t)&&(h<p||h===p&&(s.x>i.x||s.x===i.x&&u(i,s)))&&(i=s,p=h)),s=s.next}while(s!==l);return i}(t,e);if(!i)return e;var r=T(i,t);return s(r,r.next),s(i,i.next)}function u(t,e){return _(t.prev,t,e.prev)<0&&_(e.next,t,t.next)<0}function d(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function f(t,e,i,s,r,n,a,o){return(r-a)*(e-o)>=(t-a)*(n-o)&&(t-a)*(s-o)>=(i-a)*(e-o)&&(i-a)*(n-o)>=(r-a)*(s-o)}function m(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&v(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(b(t,e)&&b(e,t)&&function(t,e){var i=t,s=!1,r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)&&(_(t.prev,t,e.prev)||_(t,e.prev,e))||g(t,e)&&_(t.prev,t,t.next)>0&&_(e.prev,e,e.next)>0)}function _(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function g(t,e){return t.x===e.x&&t.y===e.y}function v(t,e,i,s){var r=x(_(t,e,i)),n=x(_(t,e,s)),a=x(_(i,s,t)),o=x(_(i,s,e));return r!==n&&a!==o||!(0!==r||!y(t,i,e))||!(0!==n||!y(t,s,e))||!(0!==a||!y(i,t,s))||!(0!==o||!y(i,e,s))}function y(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function x(t){return t>0?1:t<0?-1:0}function b(t,e){return _(t.prev,t,t.next)<0?_(t,e,t.next)>=0&&_(t,t.prev,e)>=0:_(t,e,t.prev)<0||_(t,t.next,e)<0}function T(t,e){var i=new S(t.i,t.x,t.y),s=new S(e.i,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}function E(t,e,i,s){var r=new S(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function w(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,s){for(var r=0,n=e,a=i-s;n<i;n+=s)r+=(t[a]-t[n])*(t[n+1]+t[a+1]),a=n;return r}t.exports=e,t.exports.default=e,e.deviation=function(t,e,i,s){var r=e&&e.length,n=r?e[0]*i:t.length,a=Math.abs(A(t,0,n,i));if(r)for(var o=0,h=e.length;o<h;o++){var l=e[o]*i,c=o<h-1?e[o+1]*i:t.length;a-=Math.abs(A(t,l,c,i))}var u=0;for(o=0;o<s.length;o+=3){var d=s[o]*i,p=s[o+1]*i,f=s[o+2]*i;u+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},e.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},s=0,r=0;r<t.length;r++){for(var n=0;n<t[r].length;n++)for(var a=0;a<e;a++)i.vertices.push(t[r][n][a]);r>0&&(s+=t[r-1].length,i.holes.push(s))}return i}},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function s(){}function r(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,s,n,a){if("function"!=typeof s)throw new TypeError("The listener must be a function");var o=new r(s,n||t,a),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],o]:t._events[h].push(o):(t._events[h]=o,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function o(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),o.prototype.eventNames=function(){var t,s,r=[];if(0===this._eventsCount)return r;for(s in t=this._events)e.call(t,s)&&r.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},o.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var r=0,n=s.length,a=new Array(n);r<n;r++)a[r]=s[r].fn;return a},o.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},o.prototype.emit=function(t,e,s,r,n,a){var o=i?i+t:t;if(!this._events[o])return!1;var h,l,c=this._events[o],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,r),!0;case 5:return c.fn.call(c.context,e,s,r,n),!0;case 6:return c.fn.call(c.context,e,s,r,n,a),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,s);break;case 4:c[l].fn.call(c[l].context,e,s,r);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},o.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},o.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},o.prototype.removeListener=function(t,e,s,r){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return a(this,n),this;var o=this._events[n];if(o.fn)o.fn!==e||r&&!o.once||s&&o.context!==s||a(this,n);else{for(var h=0,l=[],c=o.length;h<c;h++)(o[h].fn!==e||r&&!o[h].once||s&&o[h].context!==s)&&l.push(o[h]);l.length?this._events[n]=1===l.length?l[0]:l:a(this,n)}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&a(this,e)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,t.exports=o},347:t=>{!function(){function e(t,e){document.addEventListener?t.addEventListener("scroll",e,!1):t.attachEvent("scroll",e)}function i(t){this.g=document.createElement("div"),this.g.setAttribute("aria-hidden","true"),this.g.appendChild(document.createTextNode(t)),this.h=document.createElement("span"),this.i=document.createElement("span"),this.m=document.createElement("span"),this.j=document.createElement("span"),this.l=-1,this.h.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.i.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.j.style.cssText="max-width:none;display:inline-block;position:absolute;height:100%;width:100%;overflow:scroll;font-size:16px;",this.m.style.cssText="display:inline-block;width:200%;height:200%;font-size:16px;max-width:none;",this.h.appendChild(this.m),this.i.appendChild(this.j),this.g.appendChild(this.h),this.g.appendChild(this.i)}function s(t,e){t.g.style.cssText="max-width:none;min-width:20px;min-height:20px;display:inline-block;overflow:hidden;position:absolute;width:auto;margin:0;padding:0;top:-999px;white-space:nowrap;font-synthesis:none;font:"+e+";"}function r(t){var e=t.g.offsetWidth,i=e+100;return t.j.style.width=i+"px",t.i.scrollLeft=i,t.h.scrollLeft=t.h.scrollWidth+100,t.l!==e&&(t.l=e,!0)}function n(t,i){function s(){var t=n;r(t)&&null!==t.g.parentNode&&i(t.l)}var n=t;e(t.h,s),e(t.i,s),r(t)}function a(t,e,i){e=e||{},i=i||window,this.family=t,this.style=e.style||"normal",this.weight=e.weight||"normal",this.stretch=e.stretch||"normal",this.context=i}var o=null,h=null,l=null,c=null;function u(t){return null===c&&(c=!!t.document.fonts),c}function d(t,e){var i=t.style,s=t.weight;if(null===l){var r=document.createElement("div");try{r.style.font="condensed 100px sans-serif"}catch(t){}l=""!==r.style.font}return[i,s,l?t.stretch:"","100px",e].join(" ")}a.prototype.load=function(t,e){var r=this,a=t||"BESbswy",l=0,c=e||3e3,p=(new Date).getTime();return new Promise((function(t,e){if(u(r.context)&&!function(t){return null===h&&(u(t)&&/Apple/.test(window.navigator.vendor)?(t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))(?:\.([0-9]+))/.exec(window.navigator.userAgent),h=!!t&&603>parseInt(t[1],10)):h=!1),h}(r.context)){var f=new Promise((function(t,e){!function i(){(new Date).getTime()-p>=c?e(Error(c+"ms timeout exceeded")):r.context.document.fonts.load(d(r,'"'+r.family+'"'),a).then((function(e){1<=e.length?t():setTimeout(i,25)}),e)}()})),m=new Promise((function(t,e){l=setTimeout((function(){e(Error(c+"ms timeout exceeded"))}),c)}));Promise.race([m,f]).then((function(){clearTimeout(l),t(r)}),e)}else!function(t){document.body?t():document.addEventListener?document.addEventListener("DOMContentLoaded",(function e(){document.removeEventListener("DOMContentLoaded",e),t()})):document.attachEvent("onreadystatechange",(function e(){"interactive"!=document.readyState&&"complete"!=document.readyState||(document.detachEvent("onreadystatechange",e),t())}))}((function(){function h(){var e;(e=-1!=_&&-1!=g||-1!=_&&-1!=v||-1!=g&&-1!=v)&&((e=_!=g&&_!=v&&g!=v)||(null===o&&(e=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent),o=!!e&&(536>parseInt(e[1],10)||536===parseInt(e[1],10)&&11>=parseInt(e[2],10))),e=o&&(_==y&&g==y&&v==y||_==x&&g==x&&v==x||_==b&&g==b&&v==b)),e=!e),e&&(null!==T.parentNode&&T.parentNode.removeChild(T),clearTimeout(l),t(r))}var u=new i(a),f=new i(a),m=new i(a),_=-1,g=-1,v=-1,y=-1,x=-1,b=-1,T=document.createElement("div");T.dir="ltr",s(u,d(r,"sans-serif")),s(f,d(r,"serif")),s(m,d(r,"monospace")),T.appendChild(u.g),T.appendChild(f.g),T.appendChild(m.g),r.context.document.body.appendChild(T),y=u.g.offsetWidth,x=f.g.offsetWidth,b=m.g.offsetWidth,function t(){if((new Date).getTime()-p>=c)null!==T.parentNode&&T.parentNode.removeChild(T),e(Error(c+"ms timeout exceeded"));else{var i=r.context.document.hidden;!0!==i&&void 0!==i||(_=u.g.offsetWidth,g=f.g.offsetWidth,v=m.g.offsetWidth,h()),l=setTimeout(t,50)}}(),n(u,(function(t){_=t,h()})),s(u,d(r,'"'+r.family+'",sans-serif')),n(f,(function(t){g=t,h()})),s(f,d(r,'"'+r.family+'",serif')),n(m,(function(t){v=t,h()})),s(m,d(r,'"'+r.family+'",monospace'))}))}))},t.exports=a}()},766:(t,e,i)=>{var s;!function(){"use strict";var r=function(){this.init()};r.prototype={init:function(){var t=this||n;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||n;if(t=parseFloat(t),e.ctx||p(),void 0!==t&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,n.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var s=e._howls[i]._getSoundIds(),r=0;r<s.length;r++){var a=e._howls[i]._soundById(s[r]);a&&a._node&&(a._node.volume=a._volume*t)}return e}return e._volume},mute:function(t){var e=this||n;e.ctx||p(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,n.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var s=e._howls[i]._getSoundIds(),r=0;r<s.length;r++){var a=e._howls[i]._soundById(s[r]);a&&a._node&&(a._node.muted=!!t||a._muted)}return e},stop:function(){for(var t=this||n,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||n,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,p()),t},codecs:function(t){return(this||n)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||n;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||n,e=null;try{e="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!e||"function"!=typeof e.canPlayType)return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),s=t._navigator?t._navigator.userAgent:"",r=s.match(/OPR\/([0-6].)/g),a=r&&parseInt(r[0].split("/")[1],10)<33,o=-1!==s.indexOf("Safari")&&-1===s.indexOf("Chrome"),h=s.match(/Version\/(.*?) /),l=o&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(a||!i&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||n;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var s=new Audio;s._unlocked=!0,t._releaseHtml5Audio(s)}catch(i){t.noAudio=!0;break}for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var n=t._howls[r]._getSoundIds(),a=0;a<n.length;a++){var o=t._howls[r]._soundById(n[a]);o&&o._node&&!o._node._unlocked&&(o._node._unlocked=!0,o._node.load())}t._autoResume();var h=t.ctx.createBufferSource();h.buffer=t._scratchBuffer,h.connect(t.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),h.onended=function(){h.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var i=0;i<t._howls.length;i++)t._howls[i]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||n;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&"undefined"!=typeof Promise&&(e instanceof Promise||"function"==typeof e.then)&&e.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var e=this||n;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&n.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&n.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var n=new r,a=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};a.prototype={init:function(t){var e=this;return n.ctx||p(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=n.usingWebAudio&&!e._html5,void 0!==n.ctx&&n.ctx&&n.autoUnlock&&n._unlockAudio(),n._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(n.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var s,r;if(t._format&&t._format[i])s=t._format[i];else{if("string"!=typeof(r=t._src[i])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(s=/^data:audio\/([^;,]+);/i.exec(r))||(s=/\.([^.]+)$/.exec(r.split("?",1)[0])),s&&(s=s[1].toLowerCase())}if(s||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),s&&n.codecs(s)){e=t._src[i];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new o(t),t._webAudio&&l(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var i=this,s=null;if("number"==typeof t)s=t,t=null;else{if("string"==typeof t&&"loaded"===i._state&&!i._sprite[t])return null;if(void 0===t&&(t="__default",!i._playLock)){for(var r=0,a=0;a<i._sounds.length;a++)i._sounds[a]._paused&&!i._sounds[a]._ended&&(r++,s=i._sounds[a]._id);1===r?t=null:s=null}}var o=s?i._soundById(s):i._inactiveSound();if(!o)return null;if(s&&!t&&(t=o._sprite||"__default"),"loaded"!==i._state){o._sprite=t,o._ended=!1;var h=o._id;return i._queue.push({event:"play",action:function(){i.play(h)}}),h}if(s&&!o._paused)return e||i._loadQueue("play"),o._id;i._webAudio&&n._autoResume();var l=Math.max(0,o._seek>0?o._seek:i._sprite[t][0]/1e3),c=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-l),u=1e3*c/Math.abs(o._rate),d=i._sprite[t][0]/1e3,p=(i._sprite[t][0]+i._sprite[t][1])/1e3;o._sprite=t,o._ended=!1;var f=function(){o._paused=!1,o._seek=l,o._start=d,o._stop=p,o._loop=!(!o._loop&&!i._sprite[t][2])};if(!(l>=p)){var m=o._node;if(i._webAudio){var _=function(){i._playLock=!1,f(),i._refreshBuffer(o);var t=o._muted||i._muted?0:o._volume;m.gain.setValueAtTime(t,n.ctx.currentTime),o._playStart=n.ctx.currentTime,void 0===m.bufferSource.start?o._loop?m.bufferSource.noteGrainOn(0,l,86400):m.bufferSource.noteGrainOn(0,l,c):o._loop?m.bufferSource.start(0,l,86400):m.bufferSource.start(0,l,c),u!==1/0&&(i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),u)),e||setTimeout((function(){i._emit("play",o._id),i._loadQueue()}),0)};"running"===n.state&&"interrupted"!==n.ctx.state?_():(i._playLock=!0,i.once("resume",_),i._clearTimer(o._id))}else{var g=function(){m.currentTime=l,m.muted=o._muted||i._muted||n._muted||m.muted,m.volume=o._volume*n.volume(),m.playbackRate=o._rate;try{var s=m.play();if(s&&"undefined"!=typeof Promise&&(s instanceof Promise||"function"==typeof s.then)?(i._playLock=!0,f(),s.then((function(){i._playLock=!1,m._unlocked=!0,e?i._loadQueue():i._emit("play",o._id)})).catch((function(){i._playLock=!1,i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),o._ended=!0,o._paused=!0}))):e||(i._playLock=!1,f(),i._emit("play",o._id)),m.playbackRate=o._rate,m.paused)return void i._emit("playerror",o._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||o._loop?i._endTimers[o._id]=setTimeout(i._ended.bind(i,o),u):(i._endTimers[o._id]=function(){i._ended(o),m.removeEventListener("ended",i._endTimers[o._id],!1)},m.addEventListener("ended",i._endTimers[o._id],!1))}catch(t){i._emit("playerror",o._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===m.src&&(m.src=i._src,m.load());var v=window&&window.ejecta||!m.readyState&&n._navigator.isCocoonJS;if(m.readyState>=3||v)g();else{i._playLock=!0,i._state="loading";var y=function(){i._state="loaded",g(),m.removeEventListener(n._canPlayEvent,y,!1)};m.addEventListener(n._canPlayEvent,y,!1),i._clearTimer(o._id)}}return o._id}i._ended(o)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),s=0;s<i.length;s++){e._clearTimer(i[s]);var r=e._soundById(i[s]);if(r&&!r._paused&&(r._seek=e.seek(i[s]),r._rateSeek=0,r._paused=!0,e._stopFade(i[s]),r._node))if(e._webAudio){if(!r._node.bufferSource)continue;void 0===r._node.bufferSource.stop?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),e._cleanBuffer(r._node)}else isNaN(r._node.duration)&&r._node.duration!==1/0||r._node.pause();arguments[1]||e._emit("pause",r?r._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var s=i._getSoundIds(t),r=0;r<s.length;r++){i._clearTimer(s[r]);var n=i._soundById(s[r]);n&&(n._seek=n._start||0,n._rateSeek=0,n._paused=!0,n._ended=!0,i._stopFade(s[r]),n._node&&(i._webAudio?n._node.bufferSource&&(void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),i._cleanBuffer(n._node)):isNaN(n._node.duration)&&n._node.duration!==1/0||(n._node.currentTime=n._start||0,n._node.pause(),n._node.duration===1/0&&i._clearSound(n._node))),e||i._emit("stop",n._id))}return i},mute:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(void 0===e){if("boolean"!=typeof t)return i._muted;i._muted=t}for(var s=i._getSoundIds(e),r=0;r<s.length;r++){var a=i._soundById(s[r]);a&&(a._muted=t,a._interval&&i._stopFade(a._id),i._webAudio&&a._node?a._node.gain.setValueAtTime(t?0:a._volume,n.ctx.currentTime):a._node&&(a._node.muted=!!n._muted||t),i._emit("mute",a._id))}return i},volume:function(){var t,e,i,s=this,r=arguments;if(0===r.length)return s._volume;if(1===r.length||2===r.length&&void 0===r[1]){var a=s._getSoundIds(),o=a.indexOf(r[0]);o>=0?e=parseInt(r[0],10):t=parseFloat(r[0])}else r.length>=2&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(i=e?s._soundById(e):s._sounds[0])?i._volume:0;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"volume",action:function(){s.volume.apply(s,r)}}),s;void 0===e&&(s._volume=t),e=s._getSoundIds(e);for(var h=0;h<e.length;h++)(i=s._soundById(e[h]))&&(i._volume=t,r[2]||s._stopFade(e[h]),s._webAudio&&i._node&&!i._muted?i._node.gain.setValueAtTime(t,n.ctx.currentTime):i._node&&!i._muted&&(i._node.volume=t*n.volume()),s._emit("volume",i._id));return s},fade:function(t,e,i,s){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(t,e,i,s)}}),r;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),r.volume(t,s);for(var a=r._getSoundIds(s),o=0;o<a.length;o++){var h=r._soundById(a[o]);if(h){if(s||r._stopFade(a[o]),r._webAudio&&!h._muted){var l=n.ctx.currentTime,c=l+i/1e3;h._volume=t,h._node.gain.setValueAtTime(t,l),h._node.gain.linearRampToValueAtTime(e,c)}r._startFadeInterval(h,t,e,i,a[o],void 0===s)}}return r},_startFadeInterval:function(t,e,i,s,r,n){var a=this,o=e,h=i-e,l=Math.abs(h/.01),c=Math.max(4,l>0?s/l:s),u=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var r=(Date.now()-u)/s;u=Date.now(),o+=h*r,o=Math.round(100*o)/100,o=h<0?Math.max(i,o):Math.min(i,o),a._webAudio?t._volume=o:a.volume(o,t._id,!0),n&&(a._volume=o),(i<e&&o<=i||i>e&&o>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,a.volume(i,t._id),a._emit("fade",t._id))}),c)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(n.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t,e,i,s=this,r=arguments;if(0===r.length)return s._loop;if(1===r.length){if("boolean"!=typeof r[0])return!!(i=s._soundById(parseInt(r[0],10)))&&i._loop;t=r[0],s._loop=t}else 2===r.length&&(t=r[0],e=parseInt(r[1],10));for(var n=s._getSoundIds(e),a=0;a<n.length;a++)(i=s._soundById(n[a]))&&(i._loop=t,s._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,s.playing(n[a])&&(s.pause(n[a],!0),s.play(n[a],!0)))));return s},rate:function(){var t,e,i,s=this,r=arguments;if(0===r.length)e=s._sounds[0]._id;else if(1===r.length){var a=s._getSoundIds(),o=a.indexOf(r[0]);o>=0?e=parseInt(r[0],10):t=parseFloat(r[0])}else 2===r.length&&(t=parseFloat(r[0]),e=parseInt(r[1],10));if("number"!=typeof t)return(i=s._soundById(e))?i._rate:s._rate;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"rate",action:function(){s.rate.apply(s,r)}}),s;void 0===e&&(s._rate=t),e=s._getSoundIds(e);for(var h=0;h<e.length;h++)if(i=s._soundById(e[h])){s.playing(e[h])&&(i._rateSeek=s.seek(e[h]),i._playStart=s._webAudio?n.ctx.currentTime:i._playStart),i._rate=t,s._webAudio&&i._node&&i._node.bufferSource?i._node.bufferSource.playbackRate.setValueAtTime(t,n.ctx.currentTime):i._node&&(i._node.playbackRate=t);var l=s.seek(e[h]),c=(s._sprite[i._sprite][0]+s._sprite[i._sprite][1])/1e3-l,u=1e3*c/Math.abs(i._rate);!s._endTimers[e[h]]&&i._paused||(s._clearTimer(e[h]),s._endTimers[e[h]]=setTimeout(s._ended.bind(s,i),u)),s._emit("rate",i._id)}return s},seek:function(){var t,e,i=this,s=arguments;if(0===s.length)i._sounds.length&&(e=i._sounds[0]._id);else if(1===s.length){var r=i._getSoundIds(),a=r.indexOf(s[0]);a>=0?e=parseInt(s[0],10):i._sounds.length&&(e=i._sounds[0]._id,t=parseFloat(s[0]))}else 2===s.length&&(t=parseFloat(s[0]),e=parseInt(s[1],10));if(void 0===e)return 0;if("number"==typeof t&&("loaded"!==i._state||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,s)}}),i;var o=i._soundById(e);if(o){if(!("number"==typeof t&&t>=0)){if(i._webAudio){var h=i.playing(e)?n.ctx.currentTime-o._playStart:0,l=o._rateSeek?o._rateSeek-o._seek:0;return o._seek+(l+h*Math.abs(o._rate))}return o._node.currentTime}var c=i.playing(e);c&&i.pause(e,!0),o._seek=t,o._ended=!1,i._clearTimer(e),i._webAudio||!o._node||isNaN(o._node.duration)||(o._node.currentTime=t);var u=function(){c&&i.play(e,!0),i._emit("seek",e)};if(c&&!i._webAudio){var d=function(){i._playLock?setTimeout(d,0):u()};setTimeout(d,0)}else u()}return i},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var s=0;s<e._sounds.length;s++)if(!e._sounds[s]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,s=e._soundById(t);return s&&(i=e._sprite[s._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(n._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),n._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var s=n._howls.indexOf(t);s>=0&&n._howls.splice(s,1);var r=!0;for(i=0;i<n._howls.length;i++)if(n._howls[i]._src===t._src||t._src.indexOf(n._howls[i]._src)>=0){r=!1;break}return h&&r&&delete h[t._src],n.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,s){var r=this["_on"+t];return"function"==typeof e&&r.push(s?{id:i,fn:e,once:s}:{id:i,fn:e}),this},off:function(t,e,i){var s=this,r=s["_on"+t],n=0;if("number"==typeof e&&(i=e,e=null),e||i)for(n=0;n<r.length;n++){var a=i===r[n].id;if(e===r[n].fn&&a||!e&&a){r.splice(n,1);break}}else if(t)s["_on"+t]=[];else{var o=Object.keys(s);for(n=0;n<o.length;n++)0===o[n].indexOf("_on")&&Array.isArray(s[o[n]])&&(s[o[n]]=[])}return s},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var s=this,r=s["_on"+t],n=r.length-1;n>=0;n--)r[n].id&&r[n].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(s,r[n].fn),0),r[n].once&&s.off(t,r[n].fn,r[n].id));return s._loadQueue(t),s},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var s=!(!t._loop&&!e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&s&&e.stop(t._id,!0).play(t._id),e._webAudio&&s){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=n.ctx.currentTime;var r=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),r)}return e._webAudio&&!s&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),n._autoSuspend()),e._webAudio||s||e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new o(t)},_drain:function(){var t=this,e=t._pool,i=0,s=0;if(!(t._sounds.length<e)){for(s=0;s<t._sounds.length;s++)t._sounds[s]._ended&&i++;for(s=t._sounds.length-1;s>=0;s--){if(i<=e)return;t._sounds[s]._ended&&(t._webAudio&&t._sounds[s]._node&&t._sounds[s]._node.disconnect(0),t._sounds.splice(s,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=n.ctx.createBufferSource(),t._node.bufferSource.buffer=h[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,n.ctx.currentTime),this},_cleanBuffer:function(t){var e=n._navigator&&n._navigator.vendor.indexOf("Apple")>=0;if(n._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),e))try{t.bufferSource.buffer=n._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(n._navigator&&n._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(t){this._parent=t,this.init()};o.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++n._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=n._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),t._node.gain.setValueAtTime(i,n.ctx.currentTime),t._node.paused=!0,t._node.connect(n.masterGain)):n.noAudio||(t._node=n._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(n._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=i*n.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++n._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(n._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var h={},l=function(t){var e=t._src;if(h[e])return t._duration=h[e].duration,void d(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),s=new Uint8Array(i.length),r=0;r<i.length;++r)s[r]=i.charCodeAt(r);u(s.buffer,t)}else{var n=new XMLHttpRequest;n.open(t._xhr.method,e,!0),n.withCredentials=t._xhr.withCredentials,n.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){n.setRequestHeader(e,t._xhr.headers[e])})),n.onload=function(){var e=(n.status+"")[0];"0"===e||"2"===e||"3"===e?u(n.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+n.status+".")},n.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete h[e],t.load())},c(n)}},c=function(t){try{t.send()}catch(e){t.onerror()}},u=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},s=function(t){t&&e._sounds.length>0?(h[e._src]=t,d(e,t)):i()};"undefined"!=typeof Promise&&1===n.ctx.decodeAudioData.length?n.ctx.decodeAudioData(t).then(s).catch(i):n.ctx.decodeAudioData(t,s,i)},d=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},p=function(){if(n.usingWebAudio){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(t){n.usingWebAudio=!1}n.ctx||(n.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(n._navigator&&n._navigator.platform),e=n._navigator&&n._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var s=/safari/.test(n._navigator&&n._navigator.userAgent.toLowerCase());n._navigator&&!s&&(n.usingWebAudio=!1)}n.usingWebAudio&&(n.masterGain=void 0===n.ctx.createGain?n.ctx.createGainNode():n.ctx.createGain(),n.masterGain.gain.setValueAtTime(n._muted?0:n._volume,n.ctx.currentTime),n.masterGain.connect(n.ctx.destination)),n._setup()}};void 0===(s=function(){return{Howler:n,Howl:a}}.apply(e,[]))||(t.exports=s),e.Howler=n,e.Howl=a,void 0!==i.g?(i.g.HowlerGlobal=r,i.g.Howler=n,i.g.Howl=a,i.g.Sound=o):"undefined"!=typeof window&&(window.HowlerGlobal=r,window.Howler=n,window.Howl=a,window.Sound=o)}(),function(){"use strict";var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var s=this;return s.ctx&&s.ctx.listener?(e="number"!=typeof e?s._pos[1]:e,i="number"!=typeof i?s._pos[2]:i,"number"!=typeof t?s._pos:(s._pos=[t,e,i],void 0!==s.ctx.listener.positionX?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]),s)):s},HowlerGlobal.prototype.orientation=function(t,e,i,s,r,n){var a=this;if(!a.ctx||!a.ctx.listener)return a;var o=a._orientation;return e="number"!=typeof e?o[1]:e,i="number"!=typeof i?o[2]:i,s="number"!=typeof s?o[3]:s,r="number"!=typeof r?o[4]:r,n="number"!=typeof n?o[5]:n,"number"!=typeof t?o:(a._orientation=[t,e,i,s,r,n],void 0!==a.ctx.listener.forwardX?(a.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),a.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),a.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),a.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),a.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),a.ctx.listener.upZ.setTargetAtTime(n,Howler.ctx.currentTime,.1)):a.ctx.listener.setOrientation(t,e,i,s,r,n),a)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"stereo",action:function(){s.stereo(t,i)}}),s;var r=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return s._stereo;s._stereo=t,s._pos=[t,0,0]}for(var n=s._getSoundIds(i),a=0;a<n.length;a++){var o=s._soundById(n[a]);if(o){if("number"!=typeof t)return o._stereo;o._stereo=t,o._pos=[t,0,0],o._node&&(o._pannerAttr.panningModel="equalpower",o._panner&&o._panner.pan||e(o,r),"spatial"===r?void 0!==o._panner.positionX?(o._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),o._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),o._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):o._panner.setPosition(t,0,0):o._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),s._emit("stereo",o._id)}}return s},Howl.prototype.pos=function(t,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"pos",action:function(){n.pos(t,i,s,r)}}),n;if(i="number"!=typeof i?0:i,s="number"!=typeof s?-.5:s,void 0===r){if("number"!=typeof t)return n._pos;n._pos=[t,i,s]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var h=n._soundById(a[o]);if(h){if("number"!=typeof t)return h._pos;h._pos=[t,i,s],h._node&&(h._panner&&!h._panner.pan||e(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setPosition(t,i,s)),n._emit("pos",h._id)}}return n},Howl.prototype.orientation=function(t,i,s,r){var n=this;if(!n._webAudio)return n;if("loaded"!==n._state)return n._queue.push({event:"orientation",action:function(){n.orientation(t,i,s,r)}}),n;if(i="number"!=typeof i?n._orientation[1]:i,s="number"!=typeof s?n._orientation[2]:s,void 0===r){if("number"!=typeof t)return n._orientation;n._orientation=[t,i,s]}for(var a=n._getSoundIds(r),o=0;o<a.length;o++){var h=n._soundById(a[o]);if(h){if("number"!=typeof t)return h._orientation;h._orientation=[t,i,s],h._node&&(h._panner||(h._pos||(h._pos=n._pos||[0,0,-.5]),e(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(s,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,s)),n._emit("orientation",h._id)}}return n},Howl.prototype.pannerAttr=function(){var t,i,s,r=this,n=arguments;if(!r._webAudio)return r;if(0===n.length)return r._pannerAttr;if(1===n.length){if("object"!=typeof n[0])return(s=r._soundById(parseInt(n[0],10)))?s._pannerAttr:r._pannerAttr;t=n[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),r._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:r._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:r._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:r._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:r._panningModel})}else 2===n.length&&(t=n[0],i=parseInt(n[1],10));for(var a=r._getSoundIds(i),o=0;o<a.length;o++)if(s=r._soundById(a[o])){var h=s._pannerAttr;h={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:h.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:h.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:h.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:h.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:h.panningModel};var l=s._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel):(s._pos||(s._pos=r._pos||[0,0,-.5]),e(s,"spatial"))}return r},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}()},733:(t,e,i)=>{t.exports=function t(e,i,s){function r(a,o){if(!i[a]){if(!e[a]){if(n)return n(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=i[a]={exports:{}};e[a][0].call(l.exports,(function(t){return r(e[a][1][t]||t)}),l,l.exports,t,e,i,s)}return i[a].exports}for(var n=void 0,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(t,e,i){"use strict";var s=t("./utils"),r=t("./support"),n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(t){for(var e,i,r,a,o,h,l,c=[],u=0,d=t.length,p=d,f="string"!==s.getTypeOf(t);u<t.length;)p=d-u,r=f?(e=t[u++],i=u<d?t[u++]:0,u<d?t[u++]:0):(e=t.charCodeAt(u++),i=u<d?t.charCodeAt(u++):0,u<d?t.charCodeAt(u++):0),a=e>>2,o=(3&e)<<4|i>>4,h=1<p?(15&i)<<2|r>>6:64,l=2<p?63&r:64,c.push(n.charAt(a)+n.charAt(o)+n.charAt(h)+n.charAt(l));return c.join("")},i.decode=function(t){var e,i,s,a,o,h,l=0,c=0,u="data:";if(t.substr(0,u.length)===u)throw new Error("Invalid base64 input, it looks like a data url.");var d,p=3*(t=t.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(t.charAt(t.length-1)===n.charAt(64)&&p--,t.charAt(t.length-2)===n.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=r.uint8array?new Uint8Array(0|p):new Array(0|p);l<t.length;)e=n.indexOf(t.charAt(l++))<<2|(a=n.indexOf(t.charAt(l++)))>>4,i=(15&a)<<4|(o=n.indexOf(t.charAt(l++)))>>2,s=(3&o)<<6|(h=n.indexOf(t.charAt(l++))),d[c++]=e,64!==o&&(d[c++]=i),64!==h&&(d[c++]=s);return d}},{"./support":30,"./utils":32}],2:[function(t,e,i){"use strict";var s=t("./external"),r=t("./stream/DataWorker"),n=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function o(t,e,i,s,r){this.compressedSize=t,this.uncompressedSize=e,this.crc32=i,this.compression=s,this.compressedContent=r}o.prototype={getContentWorker:function(){var t=new r(s.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",(function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new r(s.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,i){return t.pipe(new n).pipe(new a("uncompressedSize")).pipe(e.compressWorker(i)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,i){"use strict";var s=t("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(){return new s("STORE compression")},uncompressWorker:function(){return new s("STORE decompression")}},i.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,i){"use strict";var s=t("./utils"),r=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e){return void 0!==t&&t.length?"string"!==s.getTypeOf(t)?function(t,e,i,s){var n=r,a=0+i;t^=-1;for(var o=0;o<a;o++)t=t>>>8^n[255&(t^e[o])];return-1^t}(0|e,t,t.length):function(t,e,i,s){var n=r,a=0+i;t^=-1;for(var o=0;o<a;o++)t=t>>>8^n[255&(t^e.charCodeAt(o))];return-1^t}(0|e,t,t.length):0}},{"./utils":32}],5:[function(t,e,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(t,e,i){"use strict";var s;s="undefined"!=typeof Promise?Promise:t("lie"),e.exports={Promise:s}},{lie:37}],7:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=t("pako"),n=t("./utils"),a=t("./stream/GenericWorker"),o=s?"uint8array":"array";function h(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}i.magic="\b\0",n.inherits(h,a),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(n.transformTo(o,t.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},i.compressWorker=function(t){return new h("Deflate",t)},i.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,i){"use strict";function s(t,e){var i,s="";for(i=0;i<e;i++)s+=String.fromCharCode(255&t),t>>>=8;return s}function r(t,e,i,r,a,c){var u,d,p=t.file,f=t.compression,m=c!==o.utf8encode,_=n.transformTo("string",c(p.name)),g=n.transformTo("string",o.utf8encode(p.name)),v=p.comment,y=n.transformTo("string",c(v)),x=n.transformTo("string",o.utf8encode(v)),b=g.length!==p.name.length,T=x.length!==v.length,E="",w="",S="",A=p.dir,C=p.date,R={crc32:0,compressedSize:0,uncompressedSize:0};e&&!i||(R.crc32=t.crc32,R.compressedSize=t.compressedSize,R.uncompressedSize=t.uncompressedSize);var I=0;e&&(I|=8),m||!b&&!T||(I|=2048);var P=0,k=0;A&&(P|=16),"UNIX"===a?(k=798,P|=function(t,e){var i=t;return t||(i=e?16893:33204),(65535&i)<<16}(p.unixPermissions,A)):(k=20,P|=function(t){return 63&(t||0)}(p.dosPermissions)),u=C.getUTCHours(),u<<=6,u|=C.getUTCMinutes(),u<<=5,u|=C.getUTCSeconds()/2,d=C.getUTCFullYear()-1980,d<<=4,d|=C.getUTCMonth()+1,d<<=5,d|=C.getUTCDate(),b&&(w=s(1,1)+s(h(_),4)+g,E+="up"+s(w.length,2)+w),T&&(S=s(1,1)+s(h(y),4)+x,E+="uc"+s(S.length,2)+S);var D="";return D+="\n\0",D+=s(I,2),D+=f.magic,D+=s(u,2),D+=s(d,2),D+=s(R.crc32,4),D+=s(R.compressedSize,4),D+=s(R.uncompressedSize,4),D+=s(_.length,2),D+=s(E.length,2),{fileRecord:l.LOCAL_FILE_HEADER+D+_+E,dirRecord:l.CENTRAL_FILE_HEADER+s(k,2)+D+s(y.length,2)+"\0\0\0\0"+s(P,4)+s(r,4)+_+E+y}}var n=t("../utils"),a=t("../stream/GenericWorker"),o=t("../utf8"),h=t("../crc32"),l=t("../signature");function c(t,e,i,s){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=i,this.encodeFileName=s,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(c,a),c.prototype.push=function(t){var e=t.meta.percent||0,i=this.entriesCount,s=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,a.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:i?(e+100*(i-s-1))/i:100}}))},c.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var i=r(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},c.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,i=r(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),e)this.push({data:function(t){return l.DATA_DESCRIPTOR+s(t.crc32,4)+s(t.compressedSize,4)+s(t.uncompressedSize,4)}(t),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},c.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var i=this.bytesWritten-t,r=function(t,e,i,r,a){var o=n.transformTo("string",a(r));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+s(t,2)+s(t,2)+s(e,4)+s(i,4)+s(o.length,2)+o}(this.dirRecords.length,i,t,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},c.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},c.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()})),t.on("error",(function(t){e.error(t)})),this},c.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},c.prototype.error=function(t){var e=this._sources;if(!a.prototype.error.call(this,t))return!1;for(var i=0;i<e.length;i++)try{e[i].error(t)}catch(t){}return!0},c.prototype.lock=function(){a.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=c},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,i){"use strict";var s=t("../compressions"),r=t("./ZipFileWorker");i.generateWorker=function(t,e,i){var n=new r(e.streamFiles,i,e.platform,e.encodeFileName),a=0;try{t.forEach((function(t,i){a++;var r=function(t,e){var i=t||e,r=s[i];if(!r)throw new Error(i+" is not a valid compression method !");return r}(i.options.compression,e.compression),o=i.options.compressionOptions||e.compressionOptions||{},h=i.dir,l=i.date;i._compressWorker(r,o).withStreamInfo("file",{name:t,dir:h,date:l,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(n)})),n.entriesCount=a}catch(t){n.error(t)}return n}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,i){"use strict";function s(){if(!(this instanceof s))return new s;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new s;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(s.prototype=t("./object")).loadAsync=t("./load"),s.support=t("./support"),s.defaults=t("./defaults"),s.version="3.10.1",s.loadAsync=function(t,e){return(new s).loadAsync(t,e)},s.external=t("./external"),e.exports=s},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,i){"use strict";var s=t("./utils"),r=t("./external"),n=t("./utf8"),a=t("./zipEntries"),o=t("./stream/Crc32Probe"),h=t("./nodejsUtils");function l(t){return new r.Promise((function(e,i){var s=t.decompressed.getContentWorker().pipe(new o);s.on("error",(function(t){i(t)})).on("end",(function(){s.streamInfo.crc32!==t.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):e()})).resume()}))}e.exports=function(t,e){var i=this;return e=s.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:n.utf8decode}),h.isNode&&h.isStream(t)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):s.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then((function(t){var i=new a(e);return i.load(t),i})).then((function(t){var i=[r.Promise.resolve(t)],s=t.files;if(e.checkCRC32)for(var n=0;n<s.length;n++)i.push(l(s[n]));return r.Promise.all(i)})).then((function(t){for(var r=t.shift(),n=r.files,a=0;a<n.length;a++){var o=n[a],h=o.fileNameStr,l=s.resolve(o.fileNameStr);i.file(l,o.decompressed,{binary:!0,optimizedBinaryString:!0,date:o.date,dir:o.dir,comment:o.fileCommentStr.length?o.fileCommentStr:null,unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions,createFolders:e.createFolders}),o.dir||(i.file(l).unsafeOriginalName=h)}return r.zipComment.length&&(i.comment=r.zipComment),i}))}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,i){"use strict";var s=t("../utils"),r=t("../stream/GenericWorker");function n(t,e){r.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}s.inherits(n,r),n.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",(function(t){e.push({data:t,meta:{percent:0}})})).on("error",(function(t){e.isPaused?this.generatedError=t:e.error(t)})).on("end",(function(){e.isPaused?e._upstreamEnded=!0:e.end()}))},n.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},n.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=n},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,i){"use strict";var s=t("readable-stream").Readable;function r(t,e,i){s.call(this,e),this._helper=t;var r=this;t.on("data",(function(t,e){r.push(t)||r._helper.pause(),i&&i(e)})).on("error",(function(t){r.emit("error",t)})).on("end",(function(){r.push(null)}))}t("../utils").inherits(r,s),r.prototype._read=function(){this._helper.resume()},e.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,e,i){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var e=new Buffer(t);return e.fill(0),e},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,i){"use strict";function s(t,e,i){var s,r=n.getTypeOf(e),o=n.extend(i||{},h);o.date=o.date||new Date,null!==o.compression&&(o.compression=o.compression.toUpperCase()),"string"==typeof o.unixPermissions&&(o.unixPermissions=parseInt(o.unixPermissions,8)),o.unixPermissions&&16384&o.unixPermissions&&(o.dir=!0),o.dosPermissions&&16&o.dosPermissions&&(o.dir=!0),o.dir&&(t=m(t)),o.createFolders&&(s=f(t))&&_.call(this,s,!0);var u="string"===r&&!1===o.binary&&!1===o.base64;i&&void 0!==i.binary||(o.binary=!u),(e instanceof l&&0===e.uncompressedSize||o.dir||!e||0===e.length)&&(o.base64=!1,o.binary=!0,e="",o.compression="STORE",r="string");var g;g=e instanceof l||e instanceof a?e:d.isNode&&d.isStream(e)?new p(t,e):n.prepareContent(t,e,o.binary,o.optimizedBinaryString,o.base64);var v=new c(t,g,o);this.files[t]=v}var r=t("./utf8"),n=t("./utils"),a=t("./stream/GenericWorker"),o=t("./stream/StreamHelper"),h=t("./defaults"),l=t("./compressedObject"),c=t("./zipObject"),u=t("./generate"),d=t("./nodejsUtils"),p=t("./nodejs/NodejsStreamInputAdapter"),f=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return 0<e?t.substring(0,e):""},m=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},_=function(t,e){return e=void 0!==e?e:h.createFolders,t=m(t),this.files[t]||s.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function g(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,i,s;for(e in this.files)s=this.files[e],(i=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(i,s)},filter:function(t){var e=[];return this.forEach((function(i,s){t(i,s)&&e.push(s)})),e},file:function(t,e,i){if(1!==arguments.length)return t=this.root+t,s.call(this,t,e,i),this;if(g(t)){var r=t;return this.filter((function(t,e){return!e.dir&&r.test(t)}))}var n=this.files[this.root+t];return n&&!n.dir?n:null},folder:function(t){if(!t)return this;if(g(t))return this.filter((function(e,i){return i.dir&&t.test(e)}));var e=this.root+t,i=_.call(this,e),s=this.clone();return s.root=i.name,s},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var i=this.filter((function(e,i){return i.name.slice(0,t.length)===t})),s=0;s<i.length;s++)delete this.files[i[s].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,i={};try{if((i=n.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");n.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var s=i.comment||this.comment||"";e=u.generateWorker(this,i,s)}catch(t){(e=new a("error")).error(t)}return new o(e,i.type||"string",i.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,i){"use strict";e.exports=t("stream")},{stream:void 0}],17:[function(t,e,i){"use strict";var s=t("./DataReader");function r(t){s.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(r,s),r.prototype.byteAt=function(t){return this.data[this.zero+t]},r.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),i=t.charCodeAt(1),s=t.charCodeAt(2),r=t.charCodeAt(3),n=this.length-4;0<=n;--n)if(this.data[n]===e&&this.data[n+1]===i&&this.data[n+2]===s&&this.data[n+3]===r)return n-this.zero;return-1},r.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),i=t.charCodeAt(1),s=t.charCodeAt(2),r=t.charCodeAt(3),n=this.readData(4);return e===n[0]&&i===n[1]&&s===n[2]&&r===n[3]},r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,e,i){"use strict";var s=t("../utils");function r(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(){},readInt:function(t){var e,i=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)i=(i<<8)+this.byteAt(e);return this.index+=t,i},readString:function(t){return s.transformTo("string",this.readData(t))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=r},{"../utils":32}],19:[function(t,e,i){"use strict";var s=t("./Uint8ArrayReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,i){"use strict";var s=t("./DataReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},r.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},r.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},r.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,e,i){"use strict";var s=t("./ArrayReader");function r(t){s.call(this,t)}t("../utils").inherits(r,s),r.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,i){"use strict";var s=t("../utils"),r=t("../support"),n=t("./ArrayReader"),a=t("./StringReader"),o=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=s.getTypeOf(t);return s.checkSupport(e),"string"!==e||r.uint8array?"nodebuffer"===e?new o(t):r.uint8array?new h(s.transformTo("uint8array",t)):new n(s.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,i){"use strict";var s=t("./GenericWorker"),r=t("../utils");function n(t){s.call(this,"ConvertWorker to "+t),this.destType=t}r.inherits(n,s),n.prototype.processChunk=function(t){this.push({data:r.transformTo(this.destType,t.data),meta:t.meta})},e.exports=n},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,i){"use strict";var s=t("./GenericWorker"),r=t("../crc32");function n(){s.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(n,s),n.prototype.processChunk=function(t){this.streamInfo.crc32=r(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=n},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./GenericWorker");function n(t){r.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}s.inherits(n,r),n.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}r.prototype.processChunk.call(this,t)},e.exports=n},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./GenericWorker");function n(t){r.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=s.getTypeOf(t),e.isPaused||e._tickAndRepeat()}),(function(t){e.error(t)}))}s.inherits(n,r),n.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},n.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,s.delay(this._tickAndRepeat,[],this)),!0)},n.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(s.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},n.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=n},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,i){"use strict";function s(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}s.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var i=0;i<this._listeners[t].length;i++)this._listeners[t][i].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",(function(t){e.processChunk(t)})),t.on("end",(function(){e.end()})),t.on("error",(function(t){e.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=s},{}],29:[function(t,e,i){"use strict";var s=t("../utils"),r=t("./ConvertWorker"),n=t("./GenericWorker"),a=t("../base64"),o=t("../support"),h=t("../external"),l=null;if(o.nodestream)try{l=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function c(t,e,i){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=i,s.checkSupport(a),this._worker=t.pipe(new r(a)),t.lock()}catch(t){this._worker=new n("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return function(t,e){return new h.Promise((function(i,r){var n=[],o=t._internalType,h=t._outputType,l=t._mimeType;t.on("data",(function(t,i){n.push(t),e&&e(i)})).on("error",(function(t){n=[],r(t)})).on("end",(function(){try{var t=function(t,e,i){switch(t){case"blob":return s.newBlob(s.transformTo("arraybuffer",e),i);case"base64":return a.encode(e);default:return s.transformTo(t,e)}}(h,function(t,e){var i,s=0,r=null,n=0;for(i=0;i<e.length;i++)n+=e[i].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(r=new Uint8Array(n),i=0;i<e.length;i++)r.set(e[i],s),s+=e[i].length;return r;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}(o,n),l);i(t)}catch(t){r(t)}n=[]})).resume()}))}(this,t)},on:function(t,e){var i=this;return"data"===t?this._worker.on(t,(function(t){e.call(i,t.data,t.meta)})):this._worker.on(t,(function(){s.delay(e,arguments,i)})),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new l(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var s=new ArrayBuffer(0);try{i.blob=0===new Blob([s],{type:"application/zip"}).size}catch(t){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(s),i.blob=0===r.getBlob("application/zip").size}catch(t){i.blob=!1}}}try{i.nodestream=!!t("readable-stream").Readable}catch(t){i.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var s=t("./utils"),r=t("./support"),n=t("./nodejsUtils"),a=t("./stream/GenericWorker"),o=new Array(256),h=0;h<256;h++)o[h]=252<=h?6:248<=h?5:240<=h?4:224<=h?3:192<=h?2:1;function l(){a.call(this,"utf-8 decode"),this.leftOver=null}function c(){a.call(this,"utf-8 encode")}o[254]=o[254]=1,i.utf8encode=function(t){return r.nodebuffer?n.newBufferFrom(t,"utf-8"):function(t){var e,i,s,n,a,o=t.length,h=0;for(n=0;n<o;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=r.uint8array?new Uint8Array(h):new Array(h),n=a=0;a<h;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(s=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(s-56320),n++),i<128?e[a++]=i:(i<2048?e[a++]=192|i>>>6:(i<65536?e[a++]=224|i>>>12:(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63),e[a++]=128|i>>>6&63),e[a++]=128|63&i);return e}(t)},i.utf8decode=function(t){return r.nodebuffer?s.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,i,r,n,a=t.length,h=new Array(2*a);for(e=i=0;e<a;)if((r=t[e++])<128)h[i++]=r;else if(4<(n=o[r]))h[i++]=65533,e+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&e<a;)r=r<<6|63&t[e++],n--;1<n?h[i++]=65533:r<65536?h[i++]=r:(r-=65536,h[i++]=55296|r>>10&1023,h[i++]=56320|1023&r)}return h.length!==i&&(h.subarray?h=h.subarray(0,i):h.length=i),s.applyFromCharCode(h)}(t=s.transformTo(r.uint8array?"uint8array":"array",t))},s.inherits(l,a),l.prototype.processChunk=function(t){var e=s.transformTo(r.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var n=e;(e=new Uint8Array(n.length+this.leftOver.length)).set(this.leftOver,0),e.set(n,this.leftOver.length)}else e=this.leftOver.concat(e);this.leftOver=null}var a=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+o[t[i]]>e?i:e}(e),h=e;a!==e.length&&(r.uint8array?(h=e.subarray(0,a),this.leftOver=e.subarray(a,e.length)):(h=e.slice(0,a),this.leftOver=e.slice(a,e.length))),this.push({data:i.utf8decode(h),meta:t.meta})},l.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=l,s.inherits(c,a),c.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,i){"use strict";var s=t("./support"),r=t("./base64"),n=t("./nodejsUtils"),a=t("./external");function o(t){return t}function h(t,e){for(var i=0;i<t.length;++i)e[i]=255&t.charCodeAt(i);return e}t("setimmediate"),i.newBlob=function(t,e){i.checkSupport("blob");try{return new Blob([t],{type:e})}catch(i){try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return s.append(t),s.getBlob(e)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(t,e,i){var s=[],r=0,n=t.length;if(n<=i)return String.fromCharCode.apply(null,t);for(;r<n;)"array"===e||"nodebuffer"===e?s.push(String.fromCharCode.apply(null,t.slice(r,Math.min(r+i,n)))):s.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+i,n)))),r+=i;return s.join("")},stringifyByChar:function(t){for(var e="",i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return e},applyCanBeUsed:{uint8array:function(){try{return s.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return s.nodebuffer&&1===String.fromCharCode.apply(null,n.allocBuffer(1)).length}catch(t){return!1}}()}};function c(t){var e=65536,s=i.getTypeOf(t),r=!0;if("uint8array"===s?r=l.applyCanBeUsed.uint8array:"nodebuffer"===s&&(r=l.applyCanBeUsed.nodebuffer),r)for(;1<e;)try{return l.stringifyByChunk(t,s,e)}catch(t){e=Math.floor(e/2)}return l.stringifyByChar(t)}function u(t,e){for(var i=0;i<t.length;i++)e[i]=t[i];return e}i.applyFromCharCode=c;var d={};d.string={string:o,array:function(t){return h(t,new Array(t.length))},arraybuffer:function(t){return d.string.uint8array(t).buffer},uint8array:function(t){return h(t,new Uint8Array(t.length))},nodebuffer:function(t){return h(t,n.allocBuffer(t.length))}},d.array={string:c,array:o,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(t)}},d.arraybuffer={string:function(t){return c(new Uint8Array(t))},array:function(t){return u(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:o,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return n.newBufferFrom(new Uint8Array(t))}},d.uint8array={string:c,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:o,nodebuffer:function(t){return n.newBufferFrom(t)}},d.nodebuffer={string:c,array:function(t){return u(t,new Array(t.length))},arraybuffer:function(t){return d.nodebuffer.uint8array(t).buffer},uint8array:function(t){return u(t,new Uint8Array(t.length))},nodebuffer:o},i.transformTo=function(t,e){if(e=e||"",!t)return e;i.checkSupport(t);var s=i.getTypeOf(e);return d[s][t](e)},i.resolve=function(t){for(var e=t.split("/"),i=[],s=0;s<e.length;s++){var r=e[s];"."===r||""===r&&0!==s&&s!==e.length-1||(".."===r?i.pop():i.push(r))}return i.join("/")},i.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":s.nodebuffer&&n.isBuffer(t)?"nodebuffer":s.uint8array&&t instanceof Uint8Array?"uint8array":s.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(t){if(!s[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(t){var e,i,s="";for(i=0;i<(t||"").length;i++)s+="\\x"+((e=t.charCodeAt(i))<16?"0":"")+e.toString(16).toUpperCase();return s},i.delay=function(t,e,i){setImmediate((function(){t.apply(i||null,e||[])}))},i.inherits=function(t,e){function i(){}i.prototype=e.prototype,t.prototype=new i},i.extend=function(){var t,e,i={};for(t=0;t<arguments.length;t++)for(e in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],e)&&void 0===i[e]&&(i[e]=arguments[t][e]);return i},i.prepareContent=function(t,e,n,o,l){return a.Promise.resolve(e).then((function(t){return s.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new a.Promise((function(e,i){var s=new FileReader;s.onload=function(t){e(t.target.result)},s.onerror=function(t){i(t.target.error)},s.readAsArrayBuffer(t)})):t})).then((function(e){var c=i.getTypeOf(e);return c?("arraybuffer"===c?e=i.transformTo("uint8array",e):"string"===c&&(l?e=r.decode(e):n&&!0!==o&&(e=function(t){return h(t,s.uint8array?new Uint8Array(t.length):new Array(t.length))}(e))),e):a.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,e,i){"use strict";var s=t("./reader/readerFor"),r=t("./utils"),n=t("./signature"),a=t("./zipEntry"),o=t("./support");function h(t){this.files=[],this.loadOptions=t}h.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(e)+", expected "+r.pretty(t)+")")}},isSignature:function(t,e){var i=this.reader.index;this.reader.setIndex(t);var s=this.reader.readString(4)===e;return this.reader.setIndex(i),s},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=o.uint8array?"uint8array":"array",i=r.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,i,s=this.zip64EndOfCentralSize-44;0<s;)t=this.reader.readInt(2),e=this.reader.readInt(4),i=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(n.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(n.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(n.CENTRAL_DIRECTORY_END);if(t<0)throw this.isSignature(0,n.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(t);var e=t;if(this.checkSignature(n.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,n.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(n.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var s=e-i;if(0<s)this.isSignature(e,n.CENTRAL_FILE_HEADER)||(this.reader.zero=s);else if(s<0)throw new Error("Corrupted zip: missing "+Math.abs(s)+" bytes.")},prepareReader:function(t){this.reader=s(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=h},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,e,i){"use strict";var s=t("./reader/readerFor"),r=t("./utils"),n=t("./compressedObject"),a=t("./crc32"),o=t("./utf8"),h=t("./compressions"),l=t("./support");function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,i;if(t.skip(22),this.fileNameLength=t.readInt(2),i=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in h)if(Object.prototype.hasOwnProperty.call(h,e)&&h[e].magic===t)return h[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new n(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var t=s(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(t){var e,i,s,r=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index+4<r;)e=t.readInt(2),i=t.readInt(2),s=t.readData(i),this.extraFields[e]={id:e,length:i,value:s};t.setIndex(r)},handleUTF8:function(){var t=l.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var i=r.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var s=this.findExtraFieldUnicodeComment();if(null!==s)this.fileCommentStr=s;else{var n=r.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=s(t.value);return 1!==e.readInt(1)||a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=s(t.value);return 1!==e.readInt(1)||a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,i){"use strict";function s(t,e,i){this.name=t,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=e,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}}var r=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),a=t("./utf8"),o=t("./compressedObject"),h=t("./stream/GenericWorker");s.prototype={internalStream:function(t){var e=null,i="string";try{if(!t)throw new Error("No output type specified.");var s="string"===(i=t.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),e=this._decompressWorker();var n=!this._dataBinary;n&&!s&&(e=e.pipe(new a.Utf8EncodeWorker)),!n&&s&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new h("error")).error(t)}return new r(e,i,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof o&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new a.Utf8EncodeWorker)),o.createWorkerFrom(i,t,e)},_decompressWorker:function(){return this._data instanceof o?this._data.getContentWorker():this._data instanceof h?this._data:new n(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<l.length;u++)s.prototype[l[u]]=c;e.exports=s},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,s){(function(t){"use strict";var i,s,r=t.MutationObserver||t.WebKitMutationObserver;if(r){var n=0,a=new r(c),o=t.document.createTextNode("");a.observe(o,{characterData:!0}),i=function(){o.data=n=++n%2}}else if(t.setImmediate||void 0===t.MessageChannel)i="document"in t&&"onreadystatechange"in t.document.createElement("script")?function(){var e=t.document.createElement("script");e.onreadystatechange=function(){c(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(c,0)};else{var h=new t.MessageChannel;h.port1.onmessage=c,i=function(){h.port2.postMessage(0)}}var l=[];function c(){var t,e;s=!0;for(var i=l.length;i;){for(e=l,l=[],t=-1;++t<i;)e[t]();i=l.length}s=!1}e.exports=function(t){1!==l.push(t)||s||i()}}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,i){"use strict";var s=t("immediate");function r(){}var n={},a=["REJECTED"],o=["FULFILLED"],h=["PENDING"];function l(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=h,this.queue=[],this.outcome=void 0,t!==r&&p(this,t)}function c(t,e,i){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function u(t,e,i){s((function(){var s;try{s=e(i)}catch(s){return n.reject(t,s)}s===t?n.reject(t,new TypeError("Cannot resolve promise with itself")):n.resolve(t,s)}))}function d(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function(){e.apply(t,arguments)}}function p(t,e){var i=!1;function s(e){i||(i=!0,n.reject(t,e))}function r(e){i||(i=!0,n.resolve(t,e))}var a=f((function(){e(r,s)}));"error"===a.status&&s(a.value)}function f(t,e){var i={};try{i.value=t(e),i.status="success"}catch(t){i.status="error",i.value=t}return i}(e.exports=l).prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then((function(i){return e.resolve(t()).then((function(){return i}))}),(function(i){return e.resolve(t()).then((function(){throw i}))}))},l.prototype.catch=function(t){return this.then(null,t)},l.prototype.then=function(t,e){if("function"!=typeof t&&this.state===o||"function"!=typeof e&&this.state===a)return this;var i=new this.constructor(r);return this.state!==h?u(i,this.state===o?t:e,this.outcome):this.queue.push(new c(i,t,e)),i},c.prototype.callFulfilled=function(t){n.resolve(this.promise,t)},c.prototype.otherCallFulfilled=function(t){u(this.promise,this.onFulfilled,t)},c.prototype.callRejected=function(t){n.reject(this.promise,t)},c.prototype.otherCallRejected=function(t){u(this.promise,this.onRejected,t)},n.resolve=function(t,e){var i=f(d,e);if("error"===i.status)return n.reject(t,i.value);var s=i.value;if(s)p(t,s);else{t.state=o,t.outcome=e;for(var r=-1,a=t.queue.length;++r<a;)t.queue[r].callFulfilled(e)}return t},n.reject=function(t,e){t.state=a,t.outcome=e;for(var i=-1,s=t.queue.length;++i<s;)t.queue[i].callRejected(e);return t},l.resolve=function(t){return t instanceof this?t:n.resolve(new this(r),t)},l.reject=function(t){var e=new this(r);return n.reject(e,t)},l.all=function(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var a=new Array(i),o=0,h=-1,l=new this(r);++h<i;)c(t[h],h);return l;function c(t,r){e.resolve(t).then((function(t){a[r]=t,++o!==i||s||(s=!0,n.resolve(l,a))}),(function(t){s||(s=!0,n.reject(l,t))}))}},l.race=function(t){if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var e=t.length,i=!1;if(!e)return this.resolve([]);for(var s,a=-1,o=new this(r);++a<e;)s=t[a],this.resolve(s).then((function(t){i||(i=!0,n.resolve(o,t))}),(function(t){i||(i=!0,n.reject(o,t))}));return o}},{immediate:36}],38:[function(t,e,i){"use strict";var s={};(0,t("./lib/utils/common").assign)(s,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=s},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,i){"use strict";var s=t("./zlib/deflate"),r=t("./utils/common"),n=t("./utils/strings"),a=t("./zlib/messages"),o=t("./zlib/zstream"),h=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new o,this.strm.avail_out=0;var i=s.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==i)throw new Error(a[i]);if(e.header&&s.deflateSetHeader(this.strm,e.header),e.dictionary){var c;if(c="string"==typeof e.dictionary?n.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(i=s.deflateSetDictionary(this.strm,c)))throw new Error(a[i]);this._dict_set=!0}}function c(t,e){var i=new l(e);if(i.push(t,!0),i.err)throw i.msg||a[i.err];return i.result}l.prototype.push=function(t,e){var i,a,o=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?o.input=n.string2buf(t):"[object ArrayBuffer]"===h.call(t)?o.input=new Uint8Array(t):o.input=t,o.next_in=0,o.avail_in=o.input.length;do{if(0===o.avail_out&&(o.output=new r.Buf8(l),o.next_out=0,o.avail_out=l),1!==(i=s.deflate(o,a))&&0!==i)return this.onEnd(i),!(this.ended=!0);0!==o.avail_out&&(0!==o.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(n.buf2binstring(r.shrinkBuf(o.output,o.next_out))):this.onData(r.shrinkBuf(o.output,o.next_out)))}while((0<o.avail_in||0===o.avail_out)&&1!==i);return 4===a?(i=s.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==a||(this.onEnd(0),!(o.avail_out=0))},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Deflate=l,i.deflate=c,i.deflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},i.gzip=function(t,e){return(e=e||{}).gzip=!0,c(t,e)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,i){"use strict";var s=t("./zlib/inflate"),r=t("./utils/common"),n=t("./utils/strings"),a=t("./zlib/constants"),o=t("./zlib/messages"),h=t("./zlib/zstream"),l=t("./zlib/gzheader"),c=Object.prototype.toString;function u(t){if(!(this instanceof u))return new u(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var i=s.inflateInit2(this.strm,e.windowBits);if(i!==a.Z_OK)throw new Error(o[i]);this.header=new l,s.inflateGetHeader(this.strm,this.header)}function d(t,e){var i=new u(e);if(i.push(t,!0),i.err)throw i.msg||o[i.err];return i.result}u.prototype.push=function(t,e){var i,o,h,l,u,d,p=this.strm,f=this.options.chunkSize,m=this.options.dictionary,_=!1;if(this.ended)return!1;o=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?p.input=n.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?p.input=new Uint8Array(t):p.input=t,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(f),p.next_out=0,p.avail_out=f),(i=s.inflate(p,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&m&&(d="string"==typeof m?n.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,i=s.inflateSetDictionary(this.strm,d)),i===a.Z_BUF_ERROR&&!0===_&&(i=a.Z_OK,_=!1),i!==a.Z_STREAM_END&&i!==a.Z_OK)return this.onEnd(i),!(this.ended=!0);p.next_out&&(0!==p.avail_out&&i!==a.Z_STREAM_END&&(0!==p.avail_in||o!==a.Z_FINISH&&o!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(h=n.utf8border(p.output,p.next_out),l=p.next_out-h,u=n.buf2string(p.output,h),p.next_out=l,p.avail_out=f-l,l&&r.arraySet(p.output,p.output,h,l,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(_=!0)}while((0<p.avail_in||0===p.avail_out)&&i!==a.Z_STREAM_END);return i===a.Z_STREAM_END&&(o=a.Z_FINISH),o===a.Z_FINISH?(i=s.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===a.Z_OK):o!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(p.avail_out=0))},u.prototype.onData=function(t){this.chunks.push(t)},u.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},i.Inflate=u,i.inflate=d,i.inflateRaw=function(t,e){return(e=e||{}).raw=!0,d(t,e)},i.ungzip=d},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,i){"use strict";var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var i=e.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var s in i)i.hasOwnProperty(s)&&(t[s]=i[s])}}return t},i.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var r={arraySet:function(t,e,i,s,r){if(e.subarray&&t.subarray)t.set(e.subarray(i,i+s),r);else for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){var e,i,s,r,n,a;for(e=s=0,i=t.length;e<i;e++)s+=t[e].length;for(a=new Uint8Array(s),e=r=0,i=t.length;e<i;e++)n=t[e],a.set(n,r),r+=n.length;return a}},n={arraySet:function(t,e,i,s,r){for(var n=0;n<s;n++)t[r+n]=e[i+n]},flattenChunks:function(t){return[].concat.apply([],t)}};i.setTyped=function(t){t?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,r)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,n))},i.setTyped(s)},{}],42:[function(t,e,i){"use strict";var s=t("./common"),r=!0,n=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){n=!1}for(var a=new s.Buf8(256),o=0;o<256;o++)a[o]=252<=o?6:248<=o?5:240<=o?4:224<=o?3:192<=o?2:1;function h(t,e){if(e<65537&&(t.subarray&&n||!t.subarray&&r))return String.fromCharCode.apply(null,s.shrinkBuf(t,e));for(var i="",a=0;a<e;a++)i+=String.fromCharCode(t[a]);return i}a[254]=a[254]=1,i.string2buf=function(t){var e,i,r,n,a,o=t.length,h=0;for(n=0;n<o;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),h+=i<128?1:i<2048?2:i<65536?3:4;for(e=new s.Buf8(h),n=a=0;a<h;n++)55296==(64512&(i=t.charCodeAt(n)))&&n+1<o&&56320==(64512&(r=t.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?e[a++]=i:(i<2048?e[a++]=192|i>>>6:(i<65536?e[a++]=224|i>>>12:(e[a++]=240|i>>>18,e[a++]=128|i>>>12&63),e[a++]=128|i>>>6&63),e[a++]=128|63&i);return e},i.buf2binstring=function(t){return h(t,t.length)},i.binstring2buf=function(t){for(var e=new s.Buf8(t.length),i=0,r=e.length;i<r;i++)e[i]=t.charCodeAt(i);return e},i.buf2string=function(t,e){var i,s,r,n,o=e||t.length,l=new Array(2*o);for(i=s=0;i<o;)if((r=t[i++])<128)l[s++]=r;else if(4<(n=a[r]))l[s++]=65533,i+=n-1;else{for(r&=2===n?31:3===n?15:7;1<n&&i<o;)r=r<<6|63&t[i++],n--;1<n?l[s++]=65533:r<65536?l[s++]=r:(r-=65536,l[s++]=55296|r>>10&1023,l[s++]=56320|1023&r)}return h(l,s)},i.utf8border=function(t,e){var i;for((e=e||t.length)>t.length&&(e=t.length),i=e-1;0<=i&&128==(192&t[i]);)i--;return i<0||0===i?e:i+a[t[i]]>e?i:e}},{"./common":41}],43:[function(t,e,i){"use strict";e.exports=function(t,e,i,s){for(var r=65535&t|0,n=t>>>16&65535|0,a=0;0!==i;){for(i-=a=2e3<i?2e3:i;n=n+(r=r+e[s++]|0)|0,--a;);r%=65521,n%=65521}return r|n<<16|0}},{}],44:[function(t,e,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,i){"use strict";var s=function(){for(var t,e=[],i=0;i<256;i++){t=i;for(var s=0;s<8;s++)t=1&t?3988292384^t>>>1:t>>>1;e[i]=t}return e}();e.exports=function(t,e,i,r){var n=s,a=r+i;t^=-1;for(var o=r;o<a;o++)t=t>>>8^n[255&(t^e[o])];return-1^t}},{}],46:[function(t,e,i){"use strict";var s,r=t("../utils/common"),n=t("./trees"),a=t("./adler32"),o=t("./crc32"),h=t("./messages"),l=-2,c=258,u=262,d=113;function p(t,e){return t.msg=h[e],e}function f(t){return(t<<1)-(4<t?9:0)}function m(t){for(var e=t.length;0<=--e;)t[e]=0}function _(t){var e=t.state,i=e.pending;i>t.avail_out&&(i=t.avail_out),0!==i&&(r.arraySet(t.output,e.pending_buf,e.pending_out,i,t.next_out),t.next_out+=i,e.pending_out+=i,t.total_out+=i,t.avail_out-=i,e.pending-=i,0===e.pending&&(e.pending_out=0))}function g(t,e){n._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,_(t.strm)}function v(t,e){t.pending_buf[t.pending++]=e}function y(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function x(t,e){var i,s,r=t.max_chain_length,n=t.strstart,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-u?t.strstart-(t.w_size-u):0,l=t.window,d=t.w_mask,p=t.prev,f=t.strstart+c,m=l[n+a-1],_=l[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(l[(i=e)+a]===_&&l[i+a-1]===m&&l[i]===l[n]&&l[++i]===l[n+1]){n+=2,i++;do{}while(l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&l[++n]===l[++i]&&n<f);if(s=c-(f-n),n=f-c,a<s){if(t.match_start=e,o<=(a=s))break;m=l[n+a-1],_=l[n+a]}}}while((e=p[e&d])>h&&0!=--r);return a<=t.lookahead?a:t.lookahead}function b(t){var e,i,s,n,h,l,c,d,p,f,m=t.w_size;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-u)){for(r.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,e=i=t.hash_size;s=t.head[--e],t.head[e]=m<=s?s-m:0,--i;);for(e=i=m;s=t.prev[--e],t.prev[e]=m<=s?s-m:0,--i;);n+=m}if(0===t.strm.avail_in)break;if(l=t.strm,c=t.window,d=t.strstart+t.lookahead,f=void 0,(p=n)<(f=l.avail_in)&&(f=p),i=0===f?0:(l.avail_in-=f,r.arraySet(c,l.input,l.next_in,f,d),1===l.state.wrap?l.adler=a(l.adler,c,f,d):2===l.state.wrap&&(l.adler=o(l.adler,c,f,d)),l.next_in+=f,l.total_in+=f,f),t.lookahead+=i,t.lookahead+t.insert>=3)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+3-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<u&&0!==t.strm.avail_in)}function T(t,e){for(var i,s;;){if(t.lookahead<u){if(b(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==i&&t.strstart-i<=t.w_size-u&&(t.match_length=x(t,i)),t.match_length>=3)if(s=n._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else s=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(s&&(g(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(g(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(g(t,!1),0===t.strm.avail_out)?1:2}function E(t,e){for(var i,s,r;;){if(t.lookahead<u){if(b(t),t.lookahead<u&&0===e)return 1;if(0===t.lookahead)break}if(i=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==i&&t.prev_length<t.max_lazy_match&&t.strstart-i<=t.w_size-u&&(t.match_length=x(t,i),t.match_length<=5&&(1===t.strategy||3===t.match_length&&4096<t.strstart-t.match_start)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){for(r=t.strstart+t.lookahead-3,s=n._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,i=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=2,t.strstart++,s&&(g(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((s=n._tr_tally(t,0,t.window[t.strstart-1]))&&g(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(s=n._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(g(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(g(t,!1),0===t.strm.avail_out)?1:2}function w(t,e,i,s,r){this.good_length=t,this.max_lazy=e,this.nice_length=i,this.max_chain=s,this.func=r}function S(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),m(this.dyn_ltree),m(this.dyn_dtree),m(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),m(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),m(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function A(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:d,t.adler=2===e.wrap?0:1,e.last_flush=0,n._tr_init(e),0):p(t,l)}function C(t){var e=A(t);return 0===e&&function(t){t.window_size=2*t.w_size,m(t.head),t.max_lazy_match=s[t.level].max_lazy,t.good_match=s[t.level].good_length,t.nice_match=s[t.level].nice_length,t.max_chain_length=s[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),e}function R(t,e,i,s,n,a){if(!t)return l;var o=1;if(-1===e&&(e=6),s<0?(o=0,s=-s):15<s&&(o=2,s-=16),n<1||9<n||8!==i||s<8||15<s||e<0||9<e||a<0||4<a)return p(t,l);8===s&&(s=9);var h=new S;return(t.state=h).strm=t,h.wrap=o,h.gzhead=null,h.w_bits=s,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=n+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new r.Buf8(2*h.w_size),h.head=new r.Buf16(h.hash_size),h.prev=new r.Buf16(h.w_size),h.lit_bufsize=1<<n+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new r.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=a,h.method=i,C(t)}s=[new w(0,0,0,0,(function(t,e){var i=65535;for(i>t.pending_buf_size-5&&(i=t.pending_buf_size-5);;){if(t.lookahead<=1){if(b(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var s=t.block_start+i;if((0===t.strstart||t.strstart>=s)&&(t.lookahead=t.strstart-s,t.strstart=s,g(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-u&&(g(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(g(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(g(t,!1),t.strm.avail_out),1)})),new w(4,4,8,4,T),new w(4,5,16,8,T),new w(4,6,32,32,T),new w(4,4,16,16,E),new w(8,16,32,32,E),new w(8,16,128,128,E),new w(8,32,128,256,E),new w(32,128,258,1024,E),new w(32,258,258,4096,E)],i.deflateInit=function(t,e){return R(t,e,8,15,8,0)},i.deflateInit2=R,i.deflateReset=C,i.deflateResetKeep=A,i.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?l:(t.state.gzhead=e,0):l},i.deflate=function(t,e){var i,r,a,h;if(!t||!t.state||5<e||e<0)return t?p(t,l):l;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||666===r.status&&4!==e)return p(t,0===t.avail_out?-5:l);if(r.strm=t,i=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,v(r,31),v(r,139),v(r,8),r.gzhead?(v(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),v(r,255&r.gzhead.time),v(r,r.gzhead.time>>8&255),v(r,r.gzhead.time>>16&255),v(r,r.gzhead.time>>24&255),v(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),v(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(v(r,255&r.gzhead.extra.length),v(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=o(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(v(r,0),v(r,0),v(r,0),v(r,0),v(r,0),v(r,9===r.level?2:2<=r.strategy||r.level<2?4:0),v(r,3),r.status=d);else{var u=8+(r.w_bits-8<<4)<<8;u|=(2<=r.strategy||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(u|=32),u+=31-u%31,r.status=d,y(r,u),0!==r.strstart&&(y(r,t.adler>>>16),y(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(a=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),_(t),a=r.pending,r.pending!==r.pending_buf_size));)v(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),_(t),a=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,v(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===h&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){a=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),_(t),a=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,v(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>a&&(t.adler=o(t.adler,r.pending_buf,r.pending-a,a)),0===h&&(r.status=103)}else r.status=103;if(103===r.status&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&_(t),r.pending+2<=r.pending_buf_size&&(v(r,255&t.adler),v(r,t.adler>>8&255),t.adler=0,r.status=d)):r.status=d),0!==r.pending){if(_(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&f(e)<=f(i)&&4!==e)return p(t,-5);if(666===r.status&&0!==t.avail_in)return p(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&666!==r.status){var x=2===r.strategy?function(t,e){for(var i;;){if(0===t.lookahead&&(b(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,i&&(g(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(g(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(g(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var i,s,r,a,o=t.window;;){if(t.lookahead<=c){if(b(t),t.lookahead<=c&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&0<t.strstart&&(s=o[r=t.strstart-1])===o[++r]&&s===o[++r]&&s===o[++r]){a=t.strstart+c;do{}while(s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&r<a);t.match_length=c-(a-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(i=n._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(i=n._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),i&&(g(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(g(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(g(t,!1),0===t.strm.avail_out)?1:2}(r,e):s[r.level].func(r,e);if(3!==x&&4!==x||(r.status=666),1===x||3===x)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===x&&(1===e?n._tr_align(r):5!==e&&(n._tr_stored_block(r,0,0,!1),3===e&&(m(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),_(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(v(r,255&t.adler),v(r,t.adler>>8&255),v(r,t.adler>>16&255),v(r,t.adler>>24&255),v(r,255&t.total_in),v(r,t.total_in>>8&255),v(r,t.total_in>>16&255),v(r,t.total_in>>24&255)):(y(r,t.adler>>>16),y(r,65535&t.adler)),_(t),0<r.wrap&&(r.wrap=-r.wrap),0!==r.pending?0:1)},i.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&103!==e&&e!==d&&666!==e?p(t,l):(t.state=null,e===d?p(t,-3):0):l},i.deflateSetDictionary=function(t,e){var i,s,n,o,h,c,u,d,p=e.length;if(!t||!t.state)return l;if(2===(o=(i=t.state).wrap)||1===o&&42!==i.status||i.lookahead)return l;for(1===o&&(t.adler=a(t.adler,e,p,0)),i.wrap=0,p>=i.w_size&&(0===o&&(m(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new r.Buf8(i.w_size),r.arraySet(d,e,p-i.w_size,i.w_size,0),e=d,p=i.w_size),h=t.avail_in,c=t.next_in,u=t.input,t.avail_in=p,t.next_in=0,t.input=e,b(i);i.lookahead>=3;){for(s=i.strstart,n=i.lookahead-2;i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+3-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++,--n;);i.strstart=s,i.lookahead=2,b(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=c,t.input=u,t.avail_in=h,i.wrap=o,0},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,i){"use strict";e.exports=function(t,e){var i,s,r,n,a,o,h,l,c,u,d,p,f,m,_,g,v,y,x,b,T,E,w,S,A;i=t.state,s=t.next_in,S=t.input,r=s+(t.avail_in-5),n=t.next_out,A=t.output,a=n-(e-t.avail_out),o=n+(t.avail_out-257),h=i.dmax,l=i.wsize,c=i.whave,u=i.wnext,d=i.window,p=i.hold,f=i.bits,m=i.lencode,_=i.distcode,g=(1<<i.lenbits)-1,v=(1<<i.distbits)-1;t:do{f<15&&(p+=S[s++]<<f,f+=8,p+=S[s++]<<f,f+=8),y=m[p&g];e:for(;;){if(p>>>=x=y>>>24,f-=x,0==(x=y>>>16&255))A[n++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=m[(65535&y)+(p&(1<<x)-1)];continue e}if(32&x){i.mode=12;break t}t.msg="invalid literal/length code",i.mode=30;break t}b=65535&y,(x&=15)&&(f<x&&(p+=S[s++]<<f,f+=8),b+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=S[s++]<<f,f+=8,p+=S[s++]<<f,f+=8),y=_[p&v];i:for(;;){if(p>>>=x=y>>>24,f-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=_[(65535&y)+(p&(1<<x)-1)];continue i}t.msg="invalid distance code",i.mode=30;break t}if(T=65535&y,f<(x&=15)&&(p+=S[s++]<<f,(f+=8)<x&&(p+=S[s++]<<f,f+=8)),h<(T+=p&(1<<x)-1)){t.msg="invalid distance too far back",i.mode=30;break t}if(p>>>=x,f-=x,(x=n-a)<T){if(c<(x=T-x)&&i.sane){t.msg="invalid distance too far back",i.mode=30;break t}if(w=d,(E=0)===u){if(E+=l-x,x<b){for(b-=x;A[n++]=d[E++],--x;);E=n-T,w=A}}else if(u<x){if(E+=l+u-x,(x-=u)<b){for(b-=x;A[n++]=d[E++],--x;);if(E=0,u<b){for(b-=x=u;A[n++]=d[E++],--x;);E=n-T,w=A}}}else if(E+=u-x,x<b){for(b-=x;A[n++]=d[E++],--x;);E=n-T,w=A}for(;2<b;)A[n++]=w[E++],A[n++]=w[E++],A[n++]=w[E++],b-=3;b&&(A[n++]=w[E++],1<b&&(A[n++]=w[E++]))}else{for(E=n-T;A[n++]=A[E++],A[n++]=A[E++],A[n++]=A[E++],2<(b-=3););b&&(A[n++]=A[E++],1<b&&(A[n++]=A[E++]))}break}}break}}while(s<r&&n<o);s-=b=f>>3,p&=(1<<(f-=b<<3))-1,t.next_in=s,t.next_out=n,t.avail_in=s<r?r-s+5:5-(s-r),t.avail_out=n<o?o-n+257:257-(n-o),i.hold=p,i.bits=f}},{}],49:[function(t,e,i){"use strict";var s=t("../utils/common"),r=t("./adler32"),n=t("./crc32"),a=t("./inffast"),o=t("./inftrees"),h=-2;function l(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function u(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new s.Buf32(852),e.distcode=e.distdyn=new s.Buf32(592),e.sane=1,e.back=-1,0):h}function d(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,u(t)):h}function p(t,e){var i,s;return t&&t.state?(s=t.state,e<0?(i=0,e=-e):(i=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?h:(null!==s.window&&s.wbits!==e&&(s.window=null),s.wrap=i,s.wbits=e,d(t))):h}function f(t,e){var i,s;return t?(s=new c,(t.state=s).window=null,0!==(i=p(t,e))&&(t.state=null),i):h}var m,_,g=!0;function v(t){if(g){var e;for(m=new s.Buf32(512),_=new s.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(o(1,t.lens,0,288,m,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;o(2,t.lens,0,32,_,0,t.work,{bits:5}),g=!1}t.lencode=m,t.lenbits=9,t.distcode=_,t.distbits=5}function y(t,e,i,r){var n,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new s.Buf8(a.wsize)),r>=a.wsize?(s.arraySet(a.window,e,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):(r<(n=a.wsize-a.wnext)&&(n=r),s.arraySet(a.window,e,i-r,n,a.wnext),(r-=n)?(s.arraySet(a.window,e,i-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=n,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=n))),0}i.inflateReset=d,i.inflateReset2=p,i.inflateResetKeep=u,i.inflateInit=function(t){return f(t,15)},i.inflateInit2=f,i.inflate=function(t,e){var i,c,u,d,p,f,m,_,g,x,b,T,E,w,S,A,C,R,I,P,k,D,M,B,N=0,L=new s.Buf8(4),O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return h;12===(i=t.state).mode&&(i.mode=13),p=t.next_out,u=t.output,m=t.avail_out,d=t.next_in,c=t.input,f=t.avail_in,_=i.hold,g=i.bits,x=f,b=m,D=0;t:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;g<16;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(2&i.wrap&&35615===_){L[i.check=0]=255&_,L[1]=_>>>8&255,i.check=n(i.check,L,2,0),g=_=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&_)<<8)+(_>>8))%31){t.msg="incorrect header check",i.mode=30;break}if(8!=(15&_)){t.msg="unknown compression method",i.mode=30;break}if(g-=4,k=8+(15&(_>>>=4)),0===i.wbits)i.wbits=k;else if(k>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<k,t.adler=i.check=1,i.mode=512&_?10:12,g=_=0;break;case 2:for(;g<16;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(i.flags=_,8!=(255&i.flags)){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=_>>8&1),512&i.flags&&(L[0]=255&_,L[1]=_>>>8&255,i.check=n(i.check,L,2,0)),g=_=0,i.mode=3;case 3:for(;g<32;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.head&&(i.head.time=_),512&i.flags&&(L[0]=255&_,L[1]=_>>>8&255,L[2]=_>>>16&255,L[3]=_>>>24&255,i.check=n(i.check,L,4,0)),g=_=0,i.mode=4;case 4:for(;g<16;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.head&&(i.head.xflags=255&_,i.head.os=_>>8),512&i.flags&&(L[0]=255&_,L[1]=_>>>8&255,i.check=n(i.check,L,2,0)),g=_=0,i.mode=5;case 5:if(1024&i.flags){for(;g<16;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.length=_,i.head&&(i.head.extra_len=_),512&i.flags&&(L[0]=255&_,L[1]=_>>>8&255,i.check=n(i.check,L,2,0)),g=_=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(f<(T=i.length)&&(T=f),T&&(i.head&&(k=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),s.arraySet(i.head.extra,c,d,T,k)),512&i.flags&&(i.check=n(i.check,c,T,d)),f-=T,d+=T,i.length-=T),i.length))break t;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===f)break t;for(T=0;k=c[d+T++],i.head&&k&&i.length<65536&&(i.head.name+=String.fromCharCode(k)),k&&T<f;);if(512&i.flags&&(i.check=n(i.check,c,T,d)),f-=T,d+=T,k)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===f)break t;for(T=0;k=c[d+T++],i.head&&k&&i.length<65536&&(i.head.comment+=String.fromCharCode(k)),k&&T<f;);if(512&i.flags&&(i.check=n(i.check,c,T,d)),f-=T,d+=T,k)break t}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;g<16;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(_!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}g=_=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;g<32;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}t.adler=i.check=l(_),g=_=0,i.mode=11;case 11:if(0===i.havedict)return t.next_out=p,t.avail_out=m,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,2;t.adler=i.check=1,i.mode=12;case 12:if(5===e||6===e)break t;case 13:if(i.last){_>>>=7&g,g-=7&g,i.mode=27;break}for(;g<3;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}switch(i.last=1&_,g-=1,3&(_>>>=1)){case 0:i.mode=14;break;case 1:if(v(i),i.mode=20,6!==e)break;_>>>=2,g-=2;break t;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}_>>>=2,g-=2;break;case 14:for(_>>>=7&g,g-=7&g;g<32;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if((65535&_)!=(_>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&_,g=_=0,i.mode=15,6===e)break t;case 15:i.mode=16;case 16:if(T=i.length){if(f<T&&(T=f),m<T&&(T=m),0===T)break t;s.arraySet(u,c,d,T,p),f-=T,d+=T,m-=T,p+=T,i.length-=T;break}i.mode=12;break;case 17:for(;g<14;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(i.nlen=257+(31&_),_>>>=5,g-=5,i.ndist=1+(31&_),_>>>=5,g-=5,i.ncode=4+(15&_),_>>>=4,g-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;g<3;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.lens[O[i.have++]]=7&_,_>>>=3,g-=3}for(;i.have<19;)i.lens[O[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,M={bits:i.lenbits},D=o(0,i.lens,0,19,i.lencode,0,i.work,M),i.lenbits=M.bits,D){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;A=(N=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,C=65535&N,!((S=N>>>24)<=g);){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(C<16)_>>>=S,g-=S,i.lens[i.have++]=C;else{if(16===C){for(B=S+2;g<B;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(_>>>=S,g-=S,0===i.have){t.msg="invalid bit length repeat",i.mode=30;break}k=i.lens[i.have-1],T=3+(3&_),_>>>=2,g-=2}else if(17===C){for(B=S+3;g<B;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}g-=S,k=0,T=3+(7&(_>>>=S)),_>>>=3,g-=3}else{for(B=S+7;g<B;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}g-=S,k=0,T=11+(127&(_>>>=S)),_>>>=7,g-=7}if(i.have+T>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;T--;)i.lens[i.have++]=k}}if(30===i.mode)break;if(0===i.lens[256]){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,M={bits:i.lenbits},D=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,M),i.lenbits=M.bits,D){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,M={bits:i.distbits},D=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,M),i.distbits=M.bits,D){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,6===e)break t;case 20:i.mode=21;case 21:if(6<=f&&258<=m){t.next_out=p,t.avail_out=m,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,a(t,b),p=t.next_out,u=t.output,m=t.avail_out,d=t.next_in,c=t.input,f=t.avail_in,_=i.hold,g=i.bits,12===i.mode&&(i.back=-1);break}for(i.back=0;A=(N=i.lencode[_&(1<<i.lenbits)-1])>>>16&255,C=65535&N,!((S=N>>>24)<=g);){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(A&&0==(240&A)){for(R=S,I=A,P=C;A=(N=i.lencode[P+((_&(1<<R+I)-1)>>R)])>>>16&255,C=65535&N,!(R+(S=N>>>24)<=g);){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}_>>>=R,g-=R,i.back+=R}if(_>>>=S,g-=S,i.back+=S,i.length=C,0===A){i.mode=26;break}if(32&A){i.back=-1,i.mode=12;break}if(64&A){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&A,i.mode=22;case 22:if(i.extra){for(B=i.extra;g<B;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.length+=_&(1<<i.extra)-1,_>>>=i.extra,g-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;A=(N=i.distcode[_&(1<<i.distbits)-1])>>>16&255,C=65535&N,!((S=N>>>24)<=g);){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(0==(240&A)){for(R=S,I=A,P=C;A=(N=i.distcode[P+((_&(1<<R+I)-1)>>R)])>>>16&255,C=65535&N,!(R+(S=N>>>24)<=g);){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}_>>>=R,g-=R,i.back+=R}if(_>>>=S,g-=S,i.back+=S,64&A){t.msg="invalid distance code",i.mode=30;break}i.offset=C,i.extra=15&A,i.mode=24;case 24:if(i.extra){for(B=i.extra;g<B;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}i.offset+=_&(1<<i.extra)-1,_>>>=i.extra,g-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(0===m)break t;if(T=b-m,i.offset>T){if((T=i.offset-T)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}E=T>i.wnext?(T-=i.wnext,i.wsize-T):i.wnext-T,T>i.length&&(T=i.length),w=i.window}else w=u,E=p-i.offset,T=i.length;for(m<T&&(T=m),m-=T,i.length-=T;u[p++]=w[E++],--T;);0===i.length&&(i.mode=21);break;case 26:if(0===m)break t;u[p++]=i.length,m--,i.mode=21;break;case 27:if(i.wrap){for(;g<32;){if(0===f)break t;f--,_|=c[d++]<<g,g+=8}if(b-=m,t.total_out+=b,i.total+=b,b&&(t.adler=i.check=i.flags?n(i.check,u,b,p-b):r(i.check,u,b,p-b)),b=m,(i.flags?_:l(_))!==i.check){t.msg="incorrect data check",i.mode=30;break}g=_=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;g<32;){if(0===f)break t;f--,_+=c[d++]<<g,g+=8}if(_!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}g=_=0}i.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;default:return h}return t.next_out=p,t.avail_out=m,t.next_in=d,t.avail_in=f,i.hold=_,i.bits=g,(i.wsize||b!==t.avail_out&&i.mode<30&&(i.mode<27||4!==e))&&y(t,t.output,t.next_out,b-t.avail_out)?(i.mode=31,-4):(x-=t.avail_in,b-=t.avail_out,t.total_in+=x,t.total_out+=b,i.total+=b,i.wrap&&b&&(t.adler=i.check=i.flags?n(i.check,u,b,t.next_out-b):r(i.check,u,b,t.next_out-b)),t.data_type=i.bits+(i.last?64:0)+(12===i.mode?128:0)+(20===i.mode||15===i.mode?256:0),(0==x&&0===b||4===e)&&0===D&&(D=-5),D)},i.inflateEnd=function(t){if(!t||!t.state)return h;var e=t.state;return e.window&&(e.window=null),t.state=null,0},i.inflateGetHeader=function(t,e){var i;return t&&t.state?0==(2&(i=t.state).wrap)?h:((i.head=e).done=!1,0):h},i.inflateSetDictionary=function(t,e){var i,s=e.length;return t&&t.state?0!==(i=t.state).wrap&&11!==i.mode?h:11===i.mode&&r(1,e,s,0)!==i.check?-3:y(t,e,s,s)?(i.mode=31,-4):(i.havedict=1,0):h},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,i){"use strict";var s=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],o=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,i,h,l,c,u,d){var p,f,m,_,g,v,y,x,b,T=d.bits,E=0,w=0,S=0,A=0,C=0,R=0,I=0,P=0,k=0,D=0,M=null,B=0,N=new s.Buf16(16),L=new s.Buf16(16),O=null,F=0;for(E=0;E<=15;E++)N[E]=0;for(w=0;w<h;w++)N[e[i+w]]++;for(C=T,A=15;1<=A&&0===N[A];A--);if(A<C&&(C=A),0===A)return l[c++]=20971520,l[c++]=20971520,d.bits=1,0;for(S=1;S<A&&0===N[S];S++);for(C<S&&(C=S),E=P=1;E<=15;E++)if(P<<=1,(P-=N[E])<0)return-1;if(0<P&&(0===t||1!==A))return-1;for(L[1]=0,E=1;E<15;E++)L[E+1]=L[E]+N[E];for(w=0;w<h;w++)0!==e[i+w]&&(u[L[e[i+w]]++]=w);if(v=0===t?(M=O=u,19):1===t?(M=r,B-=257,O=n,F-=257,256):(M=a,O=o,-1),E=S,g=c,I=w=D=0,m=-1,_=(k=1<<(R=C))-1,1===t&&852<k||2===t&&592<k)return 1;for(;;){for(y=E-I,b=u[w]<v?(x=0,u[w]):u[w]>v?(x=O[F+u[w]],M[B+u[w]]):(x=96,0),p=1<<E-I,S=f=1<<R;l[g+(D>>I)+(f-=p)]=y<<24|x<<16|b|0,0!==f;);for(p=1<<E-1;D&p;)p>>=1;if(0!==p?(D&=p-1,D+=p):D=0,w++,0==--N[E]){if(E===A)break;E=e[i+u[w]]}if(C<E&&(D&_)!==m){for(0===I&&(I=C),g+=S,P=1<<(R=E-I);R+I<A&&!((P-=N[R+I])<=0);)R++,P<<=1;if(k+=1<<R,1===t&&852<k||2===t&&592<k)return 1;l[m=D&_]=C<<24|R<<16|g-c|0}}return 0!==D&&(l[g+D]=E-I<<24|64<<16|0),d.bits=C,0}},{"../utils/common":41}],51:[function(t,e,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,i){"use strict";var s=t("../utils/common");function r(t){for(var e=t.length;0<=--e;)t[e]=0}var n=256,a=286,o=30,h=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=new Array(576);r(p);var f=new Array(60);r(f);var m=new Array(512);r(m);var _=new Array(256);r(_);var g=new Array(29);r(g);var v,y,x,b=new Array(o);function T(t,e,i,s,r){this.static_tree=t,this.extra_bits=e,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=t&&t.length}function E(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function w(t){return t<256?m[t]:m[256+(t>>>7)]}function S(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function A(t,e,i){t.bi_valid>16-i?(t.bi_buf|=e<<t.bi_valid&65535,S(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=i-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=i)}function C(t,e,i){A(t,i[2*e],i[2*e+1])}function R(t,e){for(var i=0;i|=1&t,t>>>=1,i<<=1,0<--e;);return i>>>1}function I(t,e,i){var s,r,n=new Array(16),a=0;for(s=1;s<=h;s++)n[s]=a=a+i[s-1]<<1;for(r=0;r<=e;r++){var o=t[2*r+1];0!==o&&(t[2*r]=R(n[o]++,o))}}function P(t){var e;for(e=0;e<a;e++)t.dyn_ltree[2*e]=0;for(e=0;e<o;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function k(t){8<t.bi_valid?S(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function D(t,e,i,s){var r=2*e,n=2*i;return t[r]<t[n]||t[r]===t[n]&&s[e]<=s[i]}function M(t,e,i){for(var s=t.heap[i],r=i<<1;r<=t.heap_len&&(r<t.heap_len&&D(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!D(e,s,t.heap[r],t.depth));)t.heap[i]=t.heap[r],i=r,r<<=1;t.heap[i]=s}function B(t,e,i){var s,r,a,o,h=0;if(0!==t.last_lit)for(;s=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===s?C(t,r,e):(C(t,(a=_[r])+n+1,e),0!==(o=l[a])&&A(t,r-=g[a],o),C(t,a=w(--s),i),0!==(o=c[a])&&A(t,s-=b[a],o)),h<t.last_lit;);C(t,256,e)}function N(t,e){var i,s,r,n=e.dyn_tree,a=e.stat_desc.static_tree,o=e.stat_desc.has_stree,l=e.stat_desc.elems,c=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<l;i++)0!==n[2*i]?(t.heap[++t.heap_len]=c=i,t.depth[i]=0):n[2*i+1]=0;for(;t.heap_len<2;)n[2*(r=t.heap[++t.heap_len]=c<2?++c:0)]=1,t.depth[r]=0,t.opt_len--,o&&(t.static_len-=a[2*r+1]);for(e.max_code=c,i=t.heap_len>>1;1<=i;i--)M(t,n,i);for(r=l;i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],M(t,n,1),s=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=s,n[2*r]=n[2*i]+n[2*s],t.depth[r]=(t.depth[i]>=t.depth[s]?t.depth[i]:t.depth[s])+1,n[2*i+1]=n[2*s+1]=r,t.heap[1]=r++,M(t,n,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],function(t,e){var i,s,r,n,a,o,l=e.dyn_tree,c=e.max_code,u=e.stat_desc.static_tree,d=e.stat_desc.has_stree,p=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,m=e.stat_desc.max_length,_=0;for(n=0;n<=h;n++)t.bl_count[n]=0;for(l[2*t.heap[t.heap_max]+1]=0,i=t.heap_max+1;i<573;i++)m<(n=l[2*l[2*(s=t.heap[i])+1]+1]+1)&&(n=m,_++),l[2*s+1]=n,c<s||(t.bl_count[n]++,a=0,f<=s&&(a=p[s-f]),o=l[2*s],t.opt_len+=o*(n+a),d&&(t.static_len+=o*(u[2*s+1]+a)));if(0!==_){do{for(n=m-1;0===t.bl_count[n];)n--;t.bl_count[n]--,t.bl_count[n+1]+=2,t.bl_count[m]--,_-=2}while(0<_);for(n=m;0!==n;n--)for(s=t.bl_count[n];0!==s;)c<(r=t.heap[--i])||(l[2*r+1]!==n&&(t.opt_len+=(n-l[2*r+1])*l[2*r],l[2*r+1]=n),s--)}}(t,e),I(n,c,t.bl_count)}function L(t,e,i){var s,r,n=-1,a=e[1],o=0,h=7,l=4;for(0===a&&(h=138,l=3),e[2*(i+1)+1]=65535,s=0;s<=i;s++)r=a,a=e[2*(s+1)+1],++o<h&&r===a||(o<l?t.bl_tree[2*r]+=o:0!==r?(r!==n&&t.bl_tree[2*r]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,n=r,l=(o=0)===a?(h=138,3):r===a?(h=6,3):(h=7,4))}function O(t,e,i){var s,r,n=-1,a=e[1],o=0,h=7,l=4;for(0===a&&(h=138,l=3),s=0;s<=i;s++)if(r=a,a=e[2*(s+1)+1],!(++o<h&&r===a)){if(o<l)for(;C(t,r,t.bl_tree),0!=--o;);else 0!==r?(r!==n&&(C(t,r,t.bl_tree),o--),C(t,16,t.bl_tree),A(t,o-3,2)):o<=10?(C(t,17,t.bl_tree),A(t,o-3,3)):(C(t,18,t.bl_tree),A(t,o-11,7));n=r,l=(o=0)===a?(h=138,3):r===a?(h=6,3):(h=7,4)}}r(b);var F=!1;function U(t,e,i,r){A(t,0+(r?1:0),3),function(t,e,i,r){k(t),S(t,i),S(t,~i),s.arraySet(t.pending_buf,t.window,e,i,t.pending),t.pending+=i}(t,e,i)}i._tr_init=function(t){F||(function(){var t,e,i,s,r,n=new Array(16);for(s=i=0;s<28;s++)for(g[s]=i,t=0;t<1<<l[s];t++)_[i++]=s;for(_[i-1]=s,s=r=0;s<16;s++)for(b[s]=r,t=0;t<1<<c[s];t++)m[r++]=s;for(r>>=7;s<o;s++)for(b[s]=r<<7,t=0;t<1<<c[s]-7;t++)m[256+r++]=s;for(e=0;e<=h;e++)n[e]=0;for(t=0;t<=143;)p[2*t+1]=8,t++,n[8]++;for(;t<=255;)p[2*t+1]=9,t++,n[9]++;for(;t<=279;)p[2*t+1]=7,t++,n[7]++;for(;t<=287;)p[2*t+1]=8,t++,n[8]++;for(I(p,287,n),t=0;t<o;t++)f[2*t+1]=5,f[2*t]=R(t,5);v=new T(p,l,257,a,h),y=new T(f,c,0,o,h),x=new T(new Array(0),u,0,19,7)}(),F=!0),t.l_desc=new E(t.dyn_ltree,v),t.d_desc=new E(t.dyn_dtree,y),t.bl_desc=new E(t.bl_tree,x),t.bi_buf=0,t.bi_valid=0,P(t)},i._tr_stored_block=U,i._tr_flush_block=function(t,e,i,s){var r,a,o=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,i=4093624447;for(e=0;e<=31;e++,i>>>=1)if(1&i&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<n;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),N(t,t.l_desc),N(t,t.d_desc),o=function(t){var e;for(L(t,t.dyn_ltree,t.l_desc.max_code),L(t,t.dyn_dtree,t.d_desc.max_code),N(t,t.bl_desc),e=18;3<=e&&0===t.bl_tree[2*d[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=r&&(r=a)):r=a=i+5,i+4<=r&&-1!==e?U(t,e,i,s):4===t.strategy||a===r?(A(t,2+(s?1:0),3),B(t,p,f)):(A(t,4+(s?1:0),3),function(t,e,i,s){var r;for(A(t,e-257,5),A(t,i-1,5),A(t,s-4,4),r=0;r<s;r++)A(t,t.bl_tree[2*d[r]+1],3);O(t,t.dyn_ltree,e-1),O(t,t.dyn_dtree,i-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),B(t,t.dyn_ltree,t.dyn_dtree)),P(t),s&&k(t)},i._tr_tally=function(t,e,i){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&i,t.last_lit++,0===e?t.dyn_ltree[2*i]++:(t.matches++,e--,t.dyn_ltree[2*(_[i]+n+1)]++,t.dyn_dtree[2*w(e)]++),t.last_lit===t.lit_bufsize-1},i._tr_align=function(t){A(t,2,3),C(t,256,p),function(t){16===t.bi_valid?(S(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":41}],53:[function(t,e,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,s){(function(t){!function(t,e){"use strict";if(!t.setImmediate){var i,s,r,n,a=1,o={},h=!1,l=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,i="[object process]"==={}.toString.call(t.process)?function(t){process.nextTick((function(){d(t)}))}:function(){if(t.postMessage&&!t.importScripts){var e=!0,i=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=i,e}}()?(n="setImmediate$"+Math.random()+"$",t.addEventListener?t.addEventListener("message",p,!1):t.attachEvent("onmessage",p),function(e){t.postMessage(n+e,"*")}):t.MessageChannel?((r=new MessageChannel).port1.onmessage=function(t){d(t.data)},function(t){r.port2.postMessage(t)}):l&&"onreadystatechange"in l.createElement("script")?(s=l.documentElement,function(t){var e=l.createElement("script");e.onreadystatechange=function(){d(t),e.onreadystatechange=null,s.removeChild(e),e=null},s.appendChild(e)}):function(t){setTimeout(d,0,t)},c.setImmediate=function(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),s=0;s<e.length;s++)e[s]=arguments[s+1];var r={callback:t,args:e};return o[a]=r,i(a),a++},c.clearImmediate=u}function u(t){delete o[t]}function d(t){if(h)setTimeout(d,0,t);else{var e=o[t];if(e){h=!0;try{!function(t){var e=t.callback,i=t.args;switch(i.length){case 0:e();break;case 1:e(i[0]);break;case 2:e(i[0],i[1]);break;case 3:e(i[0],i[1],i[2]);break;default:e.apply(undefined,i)}}(e)}finally{u(t),h=!1}}}}function p(e){e.source===t&&"string"==typeof e.data&&0===e.data.indexOf(n)&&d(+e.data.slice(n.length))}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,void 0!==i.g?i.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[10])(10)},971:function(t,e,i){var s;t=i.nmd(t),function(r){e&&e.nodeType,t&&t.nodeType;var n="object"==typeof i.g&&i.g;n.global!==n&&n.window!==n&&n.self;var a,o=2147483647,h=36,l=/^xn--/,c=/[^\x20-\x7E]/,u=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,f=String.fromCharCode;function m(t){throw RangeError(d[t])}function _(t,e){for(var i=t.length,s=[];i--;)s[i]=e(t[i]);return s}function g(t,e){var i=t.split("@"),s="";return i.length>1&&(s=i[0]+"@",t=i[1]),s+_((t=t.replace(u,".")).split("."),e).join(".")}function v(t){for(var e,i,s=[],r=0,n=t.length;r<n;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<n?56320==(64512&(i=t.charCodeAt(r++)))?s.push(((1023&e)<<10)+(1023&i)+65536):(s.push(e),r--):s.push(e);return s}function y(t){return _(t,(function(t){var e="";return t>65535&&(e+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+f(t)})).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function b(t,e,i){var s=0;for(t=i?p(t/700):t>>1,t+=p(t/e);t>455;s+=h)t=p(t/35);return p(s+36*t/(t+38))}function T(t){var e,i,s,r,n,a,l,c,u,d,f,_=[],g=t.length,v=0,x=128,T=72;for((i=t.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)t.charCodeAt(s)>=128&&m("not-basic"),_.push(t.charCodeAt(s));for(r=i>0?i+1:0;r<g;){for(n=v,a=1,l=h;r>=g&&m("invalid-input"),((c=(f=t.charCodeAt(r++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:h)>=h||c>p((o-v)/a))&&m("overflow"),v+=c*a,!(c<(u=l<=T?1:l>=T+26?26:l-T));l+=h)a>p(o/(d=h-u))&&m("overflow"),a*=d;T=b(v-n,e=_.length+1,0==n),p(v/e)>o-x&&m("overflow"),x+=p(v/e),v%=e,_.splice(v++,0,x)}return y(_)}function E(t){var e,i,s,r,n,a,l,c,u,d,_,g,y,T,E,w=[];for(g=(t=v(t)).length,e=128,i=0,n=72,a=0;a<g;++a)(_=t[a])<128&&w.push(f(_));for(s=r=w.length,r&&w.push("-");s<g;){for(l=o,a=0;a<g;++a)(_=t[a])>=e&&_<l&&(l=_);for(l-e>p((o-i)/(y=s+1))&&m("overflow"),i+=(l-e)*y,e=l,a=0;a<g;++a)if((_=t[a])<e&&++i>o&&m("overflow"),_==e){for(c=i,u=h;!(c<(d=u<=n?1:u>=n+26?26:u-n));u+=h)E=c-d,T=h-d,w.push(f(x(d+E%T,0))),c=p(E/T);w.push(f(x(c,0))),n=b(i,y,s==r),i=0,++s}++i,++e}return w.join("")}a={version:"1.3.2",ucs2:{decode:v,encode:y},decode:T,encode:E,toASCII:function(t){return g(t,(function(t){return c.test(t)?"xn--"+E(t):t}))},toUnicode:function(t){return g(t,(function(t){return l.test(t)?T(t.slice(4).toLowerCase()):t}))}},void 0===(s=function(){return a}.call(e,i,e,t))||(t.exports=s)}()},587:t=>{"use strict";function e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,i,s,r){i=i||"&",s=s||"=";var n={};if("string"!=typeof t||0===t.length)return n;var a=/\+/g;t=t.split(i);var o=1e3;r&&"number"==typeof r.maxKeys&&(o=r.maxKeys);var h=t.length;o>0&&h>o&&(h=o);for(var l=0;l<h;++l){var c,u,d,p,f=t[l].replace(a,"%20"),m=f.indexOf(s);m>=0?(c=f.substr(0,m),u=f.substr(m+1)):(c=f,u=""),d=decodeURIComponent(c),p=decodeURIComponent(u),e(n,d)?Array.isArray(n[d])?n[d].push(p):n[d]=[n[d],p]:n[d]=p}return n}},361:t=>{"use strict";var e=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,i,s,r){return i=i||"&",s=s||"=",null===t&&(t=void 0),"object"==typeof t?Object.keys(t).map((function(r){var n=encodeURIComponent(e(r))+s;return Array.isArray(t[r])?t[r].map((function(t){return n+encodeURIComponent(e(t))})).join(i):n+encodeURIComponent(e(t[r]))})).join(i):r?encodeURIComponent(e(r))+s+encodeURIComponent(e(t)):""}},673:(t,e,i)=>{"use strict";e.decode=e.parse=i(587),e.encode=e.stringify=i(361)},575:(t,e,i)=>{"use strict";var s=i(971),r=i(502);function n(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}e.Qc=y,e.DB=function(t,e){return y(t,!1,!0).resolve(e)},e.WU=function(t){return r.isString(t)&&(t=y(t)),t instanceof n?t.format():n.prototype.format.call(t)};var a=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),u=["%","/","?",";","#"].concat(c),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},_={javascript:!0,"javascript:":!0},g={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=i(673);function y(t,e,i){if(t&&r.isObject(t)&&t instanceof n)return t;var s=new n;return s.parse(t,e,i),s}n.prototype.parse=function(t,e,i){if(!r.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=-1!==n&&n<t.indexOf("#")?"?":"#",l=t.split(o);l[0]=l[0].replace(/\\/g,"/");var y=t=l.join(o);if(y=y.trim(),!i&&1===t.split("#").length){var x=h.exec(y);if(x)return this.path=y,this.href=y,this.pathname=x[1],x[2]?(this.search=x[2],this.query=e?v.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var b=a.exec(y);if(b){var T=(b=b[0]).toLowerCase();this.protocol=T,y=y.substr(b.length)}if(i||b||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var E="//"===y.substr(0,2);!E||b&&_[b]||(y=y.substr(2),this.slashes=!0)}if(!_[b]&&(E||b&&!g[b])){for(var w,S,A=-1,C=0;C<d.length;C++)-1!==(R=y.indexOf(d[C]))&&(-1===A||R<A)&&(A=R);for(-1!==(S=-1===A?y.lastIndexOf("@"):y.lastIndexOf("@",A))&&(w=y.slice(0,S),y=y.slice(S+1),this.auth=decodeURIComponent(w)),A=-1,C=0;C<u.length;C++){var R;-1!==(R=y.indexOf(u[C]))&&(-1===A||R<A)&&(A=R)}-1===A&&(A=y.length),this.host=y.slice(0,A),y=y.slice(A),this.parseHost(),this.hostname=this.hostname||"";var I="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!I)for(var P=this.hostname.split(/\./),k=(C=0,P.length);C<k;C++){var D=P[C];if(D&&!D.match(p)){for(var M="",B=0,N=D.length;B<N;B++)D.charCodeAt(B)>127?M+="x":M+=D[B];if(!M.match(p)){var L=P.slice(0,C),O=P.slice(C+1),F=D.match(f);F&&(L.push(F[1]),O.unshift(F[2])),O.length&&(y="/"+O.join(".")+y),this.hostname=L.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),I||(this.hostname=s.toASCII(this.hostname));var U=this.port?":"+this.port:"",G=this.hostname||"";this.host=G+U,this.href+=this.host,I&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!m[T])for(C=0,k=c.length;C<k;C++){var z=c[C];if(-1!==y.indexOf(z)){var j=encodeURIComponent(z);j===z&&(j=escape(z)),y=y.split(z).join(j)}}var H=y.indexOf("#");-1!==H&&(this.hash=y.substr(H),y=y.slice(0,H));var Y=y.indexOf("?");if(-1!==Y?(this.search=y.substr(Y),this.query=y.substr(Y+1),e&&(this.query=v.parse(this.query)),y=y.slice(0,Y)):e&&(this.search="",this.query={}),y&&(this.pathname=y),g[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){U=this.pathname||"";var X=this.search||"";this.path=U+X}return this.href=this.format(),this},n.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",i=this.pathname||"",s=this.hash||"",n=!1,a="";this.host?n=t+this.host:this.hostname&&(n=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(n+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(a=v.stringify(this.query));var o=this.search||a&&"?"+a||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||g[e])&&!1!==n?(n="//"+(n||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):n||(n=""),s&&"#"!==s.charAt(0)&&(s="#"+s),o&&"?"!==o.charAt(0)&&(o="?"+o),e+n+(i=i.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+s},n.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},n.prototype.resolveObject=function(t){if(r.isString(t)){var e=new n;e.parse(t,!1,!0),t=e}for(var i=new n,s=Object.keys(this),a=0;a<s.length;a++){var o=s[a];i[o]=this[o]}if(i.hash=t.hash,""===t.href)return i.href=i.format(),i;if(t.slashes&&!t.protocol){for(var h=Object.keys(t),l=0;l<h.length;l++){var c=h[l];"protocol"!==c&&(i[c]=t[c])}return g[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(t.protocol&&t.protocol!==i.protocol){if(!g[t.protocol]){for(var u=Object.keys(t),d=0;d<u.length;d++){var p=u[d];i[p]=t[p]}return i.href=i.format(),i}if(i.protocol=t.protocol,t.host||_[t.protocol])i.pathname=t.pathname;else{for(var f=(t.pathname||"").split("/");f.length&&!(t.host=f.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),i.pathname=f.join("/")}if(i.search=t.search,i.query=t.query,i.host=t.host||"",i.auth=t.auth,i.hostname=t.hostname||t.host,i.port=t.port,i.pathname||i.search){var m=i.pathname||"",v=i.search||"";i.path=m+v}return i.slashes=i.slashes||t.slashes,i.href=i.format(),i}var y=i.pathname&&"/"===i.pathname.charAt(0),x=t.host||t.pathname&&"/"===t.pathname.charAt(0),b=x||y||i.host&&t.pathname,T=b,E=i.pathname&&i.pathname.split("/")||[],w=(f=t.pathname&&t.pathname.split("/")||[],i.protocol&&!g[i.protocol]);if(w&&(i.hostname="",i.port=null,i.host&&(""===E[0]?E[0]=i.host:E.unshift(i.host)),i.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===f[0]?f[0]=t.host:f.unshift(t.host)),t.host=null),b=b&&(""===f[0]||""===E[0])),x)i.host=t.host||""===t.host?t.host:i.host,i.hostname=t.hostname||""===t.hostname?t.hostname:i.hostname,i.search=t.search,i.query=t.query,E=f;else if(f.length)E||(E=[]),E.pop(),E=E.concat(f),i.search=t.search,i.query=t.query;else if(!r.isNullOrUndefined(t.search))return w&&(i.hostname=i.host=E.shift(),(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),i.search=t.search,i.query=t.query,r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i;if(!E.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var S=E.slice(-1)[0],A=(i.host||t.host||E.length>1)&&("."===S||".."===S)||""===S,C=0,R=E.length;R>=0;R--)"."===(S=E[R])?E.splice(R,1):".."===S?(E.splice(R,1),C++):C&&(E.splice(R,1),C--);if(!b&&!T)for(;C--;C)E.unshift("..");!b||""===E[0]||E[0]&&"/"===E[0].charAt(0)||E.unshift(""),A&&"/"!==E.join("/").substr(-1)&&E.push("");var I,P=""===E[0]||E[0]&&"/"===E[0].charAt(0);return w&&(i.hostname=i.host=P?"":E.length?E.shift():"",(I=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=I.shift(),i.host=i.hostname=I.shift())),(b=b||i.host&&E.length)&&!P&&E.unshift(""),E.length?i.pathname=E.join("/"):(i.pathname=null,i.path=null),r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=t.auth||i.auth,i.slashes=i.slashes||t.slashes,i.href=i.format(),i},n.prototype.parseHost=function(){var t=this.host,e=o.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)}},502:t=>{"use strict";t.exports={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}}}},e={};function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t={};i.r(t),i.d(t,{BaseTextureCache:()=>re,CanvasRenderTarget:()=>oe,DATA_URI:()=>le,EventEmitter:()=>Tt,ProgramCache:()=>ie,TextureCache:()=>se,clearTextureCache:()=>ae,correctBlendMode:()=>Ut,createIndicesForQuads:()=>Ht,decomposeDataUri:()=>ce,deprecation:()=>ee,destroyTextureCache:()=>ne,determineCrossOrigin:()=>de,earcut:()=>Et,getBufferType:()=>Yt,getResolutionOfUrl:()=>pe,hex2rgb:()=>Bt,hex2string:()=>Nt,interleaveTypedArrays:()=>Wt,isMobile:()=>H,isPow2:()=>Vt,isWebGLSupported:()=>Dt,log2:()=>qt,nextPow2:()=>$t,path:()=>Rt,premultiplyBlendMode:()=>Ft,premultiplyRgba:()=>Gt,premultiplyTint:()=>zt,premultiplyTintToRgba:()=>jt,removeItems:()=>Zt,rgb2hex:()=>Ot,sayHello:()=>Pt,sign:()=>Kt,skipHello:()=>It,string2hex:()=>Lt,trimCanvas:()=>he,uid:()=>Qt,url:()=>St});var e={};i.r(e),i.d(e,{calcGameAnimateTick:()=>To,calcTick:()=>bo});var s={};function r(t,e=!1){return"boolean"==typeof t?!!t:e}function n(t,e=0,i=-1/0,s=1/0){return!isNaN(t)&&i<=parseFloat(t)&&parseFloat(t)<=s?parseFloat(t):e}i.r(s),i.d(s,{gameEndCallback:()=>So,onKeyPressCallback:()=>Eo,pauseBtnClickCallback:()=>wo,runCallback:()=>Ao});const a={InputStart:function(t,e=0){if(t.preventDefault(),!this._isPaused)if(1===e)for(const e of t.changedTouches)this.addInput(e.clientX-this.renderSize.widthOffset,e.clientY,e.identifier);else this.addInput(t.clientX-this.renderSize.widthOffset,t.clientY,t.button)},InputMove:function(t,e=0){if(t.preventDefault(),1===e)for(const e of t.changedTouches)this.inputs[e.identifier]&&this.inputs[e.identifier].move(e.clientX-this.renderSize.widthOffset,e.clientY);else this.inputs[t.button]&&this.inputs[t.button].move(t.clientX-this.renderSize.widthOffset,t.clientY)},InputEnd:function(t,e=0){if(t.preventDefault(),1===e)for(const e of t.changedTouches)delete this.inputs[e.identifier];else delete this.inputs[t.button]}};class o{constructor(t,e){this.x=t,this.y=e,this.tick=0,this.isMoving=!1,this.isFlickable=!1,this.isFlicked=!1,this._deltaX=0,this._deltaY=0,this._lastDeltaX=0,this._lastDeltaY=0,this._currentTime=Date.now(),this._deltaTime=this._currentTime}move(t,e){const i=Date.now();this._lastDeltaX=this._deltaX,this._lastDeltaY=this._deltaY,this._deltaX=t-this.x,this._deltaY=e-this.y,this.x=t,this.y=e,this.tick=0,this.isMoving=!0,this._deltaTime=i-this._currentTime,this._currentTime=i;const s=(this._deltaX*this._lastDeltaX+this._deltaY*this._lastDeltaY)/Math.sqrt(this._lastDeltaX**2+this._lastDeltaY**2)/this._deltaTime;!this.isFlickable&&s>.8?(this.isFlickable=!0,this.isFlicked=!1):this.isFlickable&&s<.3&&(this.isFlickable=!1)}calcTick(){this.tick++}}var h=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(h||{}),l=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(l||{}),c=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(c||{}),u=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(u||{}),d=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(d||{}),p=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(p||{}),f=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(f||{}),m=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(m||{}),_=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(_||{}),g=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(g||{}),v=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(v||{}),y=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(y||{}),x=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(x||{}),b=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(b||{}),T=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(T||{}),E=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(E||{}),w=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(w||{}),S=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(S||{});const A={createCanvas:(t,e)=>{const i=document.createElement("canvas");return i.width=t,i.height=e,i},getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e)};var C=/iPhone/i,R=/iPod/i,I=/iPad/i,P=/\biOS-universal(?:.+)Mac\b/i,k=/\bAndroid(?:.+)Mobile\b/i,D=/Android/i,M=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,B=/Silk/i,N=/Windows Phone/i,L=/\bWindows(?:.+)ARM\b/i,O=/BlackBerry/i,F=/BB10/i,U=/Opera Mini/i,G=/\b(CriOS|Chrome)(?:.+)Mobile/i,z=/Mobile(?:.+)Firefox\b/i,j=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};const H=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var i=e.userAgent,s=i.split("[FBAN");void 0!==s[1]&&(i=s[0]),void 0!==(s=i.split("Twitter"))[1]&&(i=s[0]);var r=function(t){return function(e){return e.test(t)}}(i),n={apple:{phone:r(C)&&!r(N),ipod:r(R),tablet:!r(C)&&(r(I)||j(e))&&!r(N),universal:r(P),device:(r(C)||r(R)||r(I)||r(P)||j(e))&&!r(N)},amazon:{phone:r(M),tablet:!r(M)&&r(B),device:r(M)||r(B)},android:{phone:!r(N)&&r(M)||!r(N)&&r(k),tablet:!r(N)&&!r(M)&&!r(k)&&(r(B)||r(D)),device:!r(N)&&(r(M)||r(B)||r(k)||r(D))||r(/\bokhttp\b/i)},windows:{phone:r(N),tablet:r(L),device:r(N)||r(L)},other:{blackberry:r(O),blackberry10:r(F),opera:r(U),firefox:r(z),chrome:r(G),device:r(O)||r(F)||r(U)||r(z)||r(G)},any:!1,phone:!1,tablet:!1};return n.any=n.apple.device||n.android.device||n.windows.device||n.other.device,n.phone=n.apple.phone||n.android.phone||n.windows.phone,n.tablet=n.apple.tablet||n.android.tablet||n.windows.tablet,n}(globalThis.navigator),Y={ADAPTER:A,MIPMAP_TEXTURES:v.POW2,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,FILTER_MULTISAMPLE:w.NONE,SPRITE_MAX_TEXTURES:function(t){let e=!0;if(H.tablet||H.phone){if(H.apple.device){const t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(H.android.device){const t=navigator.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,useContextAlpha:!0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1,hello:!1},GC_MODE:b.AUTO,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:g.CLAMP,SCALE_MODE:_.LINEAR,PRECISION_VERTEX:T.HIGH,PRECISION_FRAGMENT:H.apple.device?T.HIGH:T.MEDIUM,CAN_UPLOAD_SAME_BUFFER:!H.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};Y.PREFER_ENV=h.WEBGL2,Y.STRICT_TEXTURE_CACHE=!1;var X=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(X||{});const W=t=>{if(("function"==typeof t||"object"==typeof t&&t.extension)&&(t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}),"object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},$={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(W).forEach((t=>{t.type.forEach((e=>this._removeHandlers[e]?.(t)))})),this},add(...t){return t.map(W).forEach((t=>{t.type.forEach((e=>{const i=this._addHandlers,s=this._queue;i[e]?i[e](t):(s[e]=s[e]||[],s[e].push(t))}))})),this},handle(t,e,i){const s=this._addHandlers,r=this._removeHandlers;s[t]=e,r[t]=i;const n=this._queue;return n[t]&&(n[t].forEach((t=>e(t))),delete n[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>(e.priority??-1)-(t.priority??-1))))}),(t=>{const i=e.indexOf(t.ref);-1!==i&&e.splice(i,1)}))}},V=2*Math.PI,q=180/Math.PI,Z=Math.PI/180;var K=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(K||{});class J{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new J(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}}const Q=[new J,new J,new J,new J];class tt{constructor(t=0,e=0,i=0,s=0){this.x=Number(t),this.y=Number(e),this.width=Number(i),this.height=Number(s),this.type=K.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new tt(0,0,0,0)}clone(){return new tt(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const i=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>i}const i=this.left,s=this.right,r=this.top,n=this.bottom;if(s<=i||n<=r)return!1;const a=Q[0].set(t.left,t.top),o=Q[1].set(t.left,t.bottom),h=Q[2].set(t.right,t.top),l=Q[3].set(t.right,t.bottom);if(h.x<=a.x||o.y<=a.y)return!1;const c=Math.sign(e.a*e.d-e.b*e.c);if(0===c)return!1;if(e.apply(a,a),e.apply(o,o),e.apply(h,h),e.apply(l,l),Math.max(a.x,o.x,h.x,l.x)<=i||Math.min(a.x,o.x,h.x,l.x)>=s||Math.max(a.y,o.y,h.y,l.y)<=r||Math.min(a.y,o.y,h.y,l.y)>=n)return!1;const u=c*(o.y-a.y),d=c*(a.x-o.x),p=u*i+d*r,f=u*s+d*r,m=u*i+d*n,_=u*s+d*n;if(Math.max(p,f,m,_)<=u*a.x+d*a.y||Math.min(p,f,m,_)>=u*l.x+d*l.y)return!1;const g=c*(a.y-h.y),v=c*(h.x-a.x),y=g*i+v*r,x=g*s+v*r,b=g*i+v*n,T=g*s+v*n;return!(Math.max(y,x,b,T)<=g*a.x+v*a.y||Math.min(y,x,b,T)>=g*l.x+v*l.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width),s=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(i-e,0),this.y=s,this.height=Math.max(r-s,0),this}ceil(t=1,e=.001){const i=Math.ceil((this.x+this.width-e)*t)/t,s=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=i-this.x,this.height=s-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),i=Math.max(this.x+this.width,t.x+t.width),s=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=i-e,this.y=s,this.height=r-s,this}}class et{constructor(t=0,e=0,i=0){this.x=t,this.y=e,this.radius=i,this.type=K.CIRC}clone(){return new et(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const i=this.radius*this.radius;let s=this.x-t,r=this.y-e;return s*=s,r*=r,s+r<=i}getBounds(){return new tt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}}class it{constructor(t=0,e=0,i=0,s=0){this.x=t,this.y=e,this.width=i,this.height=s,this.type=K.ELIP}clone(){return new it(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let i=(t-this.x)/this.width,s=(e-this.y)/this.height;return i*=i,s*=s,i+s<=1}getBounds(){return new tt(this.x-this.width,this.y-this.height,this.width,this.height)}}class st{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let i=0,s=e.length;i<s;i++)t.push(e[i].x,e[i].y);e=t}this.points=e,this.type=K.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new st(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let i=!1;const s=this.points.length/2;for(let r=0,n=s-1;r<s;n=r++){const s=this.points[2*r],a=this.points[2*r+1],o=this.points[2*n],h=this.points[2*n+1];a>e!=h>e&&t<(e-a)/(h-a)*(o-s)+s&&(i=!i)}return i}}class rt{constructor(t=0,e=0,i=0,s=0,r=20){this.x=t,this.y=e,this.width=i,this.height=s,this.radius=r,this.type=K.RREC}clone(){return new rt(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const i=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+i&&e<=this.y+this.height-i||t>=this.x+i&&t<=this.x+this.width-i)return!0;let s=t-(this.x+i),r=e-(this.y+i);const n=i*i;if(s*s+r*r<=n)return!0;if(s=t-(this.x+this.width-i),s*s+r*r<=n)return!0;if(r=e-(this.y+this.height-i),s*s+r*r<=n)return!0;if(s=t-(this.x+i),s*s+r*r<=n)return!0}return!1}}class nt{constructor(t,e,i=0,s=0){this._x=i,this._y=s,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new nt(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}class at{constructor(t=1,e=0,i=0,s=1,r=0,n=0){this.array=null,this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,i,s,r,n){return this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const i=e||this.array;return t?(i[0]=this.a,i[1]=this.b,i[2]=0,i[3]=this.c,i[4]=this.d,i[5]=0,i[6]=this.tx,i[7]=this.ty,i[8]=1):(i[0]=this.a,i[1]=this.c,i[2]=this.tx,i[3]=this.b,i[4]=this.d,i[5]=this.ty,i[6]=0,i[7]=0,i[8]=1),i}apply(t,e){e=e||new J;const i=t.x,s=t.y;return e.x=this.a*i+this.c*s+this.tx,e.y=this.b*i+this.d*s+this.ty,e}applyInverse(t,e){e=e||new J;const i=1/(this.a*this.d+this.c*-this.b),s=t.x,r=t.y;return e.x=this.d*i*s+-this.c*i*r+(this.ty*this.c-this.tx*this.d)*i,e.y=this.a*i*r+-this.b*i*s+(-this.ty*this.a+this.tx*this.b)*i,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),s=this.a,r=this.c,n=this.tx;return this.a=s*e-this.b*i,this.b=s*i+this.b*e,this.c=r*e-this.d*i,this.d=r*i+this.d*e,this.tx=n*e-this.ty*i,this.ty=n*i+this.ty*e,this}append(t){const e=this.a,i=this.b,s=this.c,r=this.d;return this.a=t.a*e+t.b*s,this.b=t.a*i+t.b*r,this.c=t.c*e+t.d*s,this.d=t.c*i+t.d*r,this.tx=t.tx*e+t.ty*s+this.tx,this.ty=t.tx*i+t.ty*r+this.ty,this}setTransform(t,e,i,s,r,n,a,o,h){return this.a=Math.cos(a+h)*r,this.b=Math.sin(a+h)*r,this.c=-Math.sin(a-o)*n,this.d=Math.cos(a-o)*n,this.tx=t-(i*this.a+s*this.c),this.ty=e-(i*this.b+s*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,i=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=i*t.a+this.d*t.c,this.d=i*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,i=this.b,s=this.c,r=this.d,n=t.pivot,a=-Math.atan2(-s,r),o=Math.atan2(i,e),h=Math.abs(a+o);return h<1e-5||Math.abs(V-h)<1e-5?(t.rotation=o,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=o),t.scale.x=Math.sqrt(e*e+i*i),t.scale.y=Math.sqrt(s*s+r*r),t.position.x=this.tx+(n.x*e+n.y*s),t.position.y=this.ty+(n.x*i+n.y*r),t}invert(){const t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,n=t*s-e*i;return this.a=s/n,this.b=-e/n,this.c=-i/n,this.d=t/n,this.tx=(i*this.ty-s*r)/n,this.ty=-(t*this.ty-e*r)/n,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new at;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}static get IDENTITY(){return new at}static get TEMP_MATRIX(){return new at}}const ot=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],ht=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],lt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],ct=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ut=[],dt=[],pt=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];ut.push(e);for(let i=0;i<16;i++){const s=pt(ot[t]*ot[i]+lt[t]*ht[i]),r=pt(ht[t]*ot[i]+ct[t]*ht[i]),n=pt(ot[t]*lt[i]+lt[t]*ct[i]),a=pt(ht[t]*lt[i]+ct[t]*ct[i]);for(let t=0;t<16;t++)if(ot[t]===s&&ht[t]===r&&lt[t]===n&&ct[t]===a){e.push(t);break}}}for(let t=0;t<16;t++){const e=new at;e.set(ot[t],ht[t],lt[t],ct[t],0,0),dt.push(e)}}();const ft={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>ot[t],uY:t=>ht[t],vX:t=>lt[t],vY:t=>ct[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>ut[t][e],sub:(t,e)=>ut[t][ft.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?ft.S:ft.N:2*Math.abs(e)<=Math.abs(t)?t>0?ft.E:ft.W:e>0?t>0?ft.SE:ft.SW:t>0?ft.NE:ft.NW,matrixAppendRotationInv:(t,e,i=0,s=0)=>{const r=dt[ft.inv(e)];r.tx=i,r.ty=s,t.append(r)}},mt=class{constructor(){this.worldTransform=new at,this.localTransform=new at,this.position=new nt(this.onChange,this,0,0),this.scale=new nt(this.onChange,this,1,1),this.pivot=new nt(this.onChange,this,0,0),this.skew=new nt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const i=t.worldTransform,s=this.worldTransform;s.a=e.a*i.a+e.b*i.c,s.b=e.a*i.b+e.b*i.d,s.c=e.c*i.a+e.d*i.c,s.d=e.c*i.b+e.d*i.d,s.tx=e.tx*i.a+e.ty*i.c+i.tx,s.ty=e.tx*i.b+e.ty*i.d+i.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let _t=mt;_t.IDENTITY=new mt;class gt{constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,i,s,r,n,a,o){if(arguments.length>8)throw new Error("max arguments reached");const{name:h,items:l}=this;this._aliasCount++;for(let c=0,u=l.length;c<u;c++)l[c][h](t,e,i,s,r,n,a,o);return l===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties(gt.prototype,{dispatch:{value:gt.prototype.emit},run:{value:gt.prototype.emit}}),Y.TARGET_FPMS=.06;var vt=(t=>(t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(vt||{});class yt{constructor(t,e=null,i=0,s=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=i,this.once=s}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}class xt{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new yt(null,null,1/0),this.deltaMS=1/Y.TARGET_FPMS,this.elapsedMS=1/Y.TARGET_FPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,i=vt.NORMAL){return this._addListener(new yt(t,e,i))}addOnce(t,e,i=vt.NORMAL){return this._addListener(new yt(t,e,i,!0))}_addListener(t){let e=this._head.next,i=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(i);break}i=e,e=e.next}t.previous||t.connect(i)}else t.connect(i);return this._startIfPossible(),this}remove(t,e){let i=this._head.next;for(;i;)i=i.match(t,e)?i.destroy():i.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Y.TARGET_FPMS;const i=this._head;let s=i.next;for(;s;)s=s.emit(this.deltaTime);i.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),i=Math.min(Math.max(0,e)/1e3,Y.TARGET_FPMS);this._maxElapsedMS=1/i}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!xt._shared){const t=xt._shared=new xt;t.autoStart=!0,t._protected=!0}return xt._shared}static get system(){if(!xt._system){const t=xt._system=new xt;t.autoStart=!0,t._protected=!0}return xt._system}}class bt{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,vt.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?xt.shared:new xt,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}bt.extension=X.Application,$.add(bt);var Tt=i(729),Et=i(187),wt=i(575);const St={parse:wt.Qc,format:wt.WU,resolve:wt.DB};function At(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function Ct(t){return t.split("?")[0].split("#")[0]}const Rt={toPosix:t=>("\\","/",t.replace(new RegExp(function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}("\\"),"g"),"/")),isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){At(t),t=this.toPosix(t);let e="";const i=/^file:\/\/\//.exec(t),s=/^[^/:]+:\/\//.exec(t),r=/^[^/:]+:\//.exec(t);if(i||s||r){const n=i?.[0]||s?.[0]||r?.[0];e=n,t=t.slice(n.length)}return e},toAbsolute(t,e,i){if(this.isDataUrl(t))return t;const s=Ct(this.toPosix(e??Y.ADAPTER.getBaseUrl())),r=Ct(this.toPosix(i??this.rootname(s)));return At(t),(t=this.toPosix(t)).startsWith("/")?Rt.join(r,t.slice(1)):this.isAbsolute(t)?t:this.join(s,t)},normalize(t){if(At(t=this.toPosix(t)),0===t.length)return".";let e="";const i=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const s=t.endsWith("/");return(t=function(t,e){let i,s="",r=0,n=-1,a=0;for(let e=0;e<=t.length;++e){if(e<t.length)i=t.charCodeAt(e);else{if(47===i)break;i=47}if(47===i){if(n===e-1||1===a);else if(n!==e-1&&2===a){if(s.length<2||2!==r||46!==s.charCodeAt(s.length-1)||46!==s.charCodeAt(s.length-2))if(s.length>2){const t=s.lastIndexOf("/");if(t!==s.length-1){-1===t?(s="",r=0):(s=s.slice(0,t),r=s.length-1-s.lastIndexOf("/")),n=e,a=0;continue}}else if(2===s.length||1===s.length){s="",r=0,n=e,a=0;continue}}else s.length>0?s+=`/${t.slice(n+1,e)}`:s=t.slice(n+1,e),r=e-n-1;n=e,a=0}else 46===i&&-1!==a?++a:a=-1}return s}(t)).length>0&&s&&(t+="/"),i?`/${t}`:e+t},isAbsolute(t){return At(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let i=0;i<t.length;++i){const s=t[i];if(At(s),s.length>0)if(void 0===e)e=s;else{const r=t[i-1]??"";this.extname(r)?e+=`/../${s}`:e+=`/${s}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(At(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const i=47===e;let s=-1,r=!0;const n=this.getProtocol(t),a=t;for(let i=(t=t.slice(n.length)).length-1;i>=1;--i)if(e=t.charCodeAt(i),47===e){if(!r){s=i;break}}else r=!1;return-1===s?i?"/":this.isUrl(a)?n+t:n:i&&1===s?"//":n+t.slice(0,s)},rootname(t){At(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const i=t.indexOf("/",e.length);e=-1!==i?t.slice(0,i):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){At(t),e&&At(e),t=this.toPosix(t);let i,s=0,r=-1,n=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let a=e.length-1,o=-1;for(i=t.length-1;i>=0;--i){const h=t.charCodeAt(i);if(47===h){if(!n){s=i+1;break}}else-1===o&&(n=!1,o=i+1),a>=0&&(h===e.charCodeAt(a)?-1==--a&&(r=i):(a=-1,r=o))}return s===r?r=o:-1===r&&(r=t.length),t.slice(s,r)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!n){s=i+1;break}}else-1===r&&(n=!1,r=i+1);return-1===r?"":t.slice(s,r)},extname(t){At(t);let e=-1,i=0,s=-1,r=!0,n=0;for(let a=(t=this.toPosix(t)).length-1;a>=0;--a){const o=t.charCodeAt(a);if(47!==o)-1===s&&(r=!1,s=a+1),46===o?-1===e?e=a:1!==n&&(n=1):-1!==e&&(n=-1);else if(!r){i=a+1;break}}return-1===e||-1===s||0===n||1===n&&e===s-1&&e===i+1?"":t.slice(e,s)},parse(t){At(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let i=(t=this.toPosix(t)).charCodeAt(0);const s=this.isAbsolute(t);let r;e.root=this.rootname(t),r=s||this.hasProtocol(t)?1:0;let n=-1,a=0,o=-1,h=!0,l=t.length-1,c=0;for(;l>=r;--l)if(i=t.charCodeAt(l),47!==i)-1===o&&(h=!1,o=l+1),46===i?-1===n?n=l:1!==c&&(c=1):-1!==n&&(c=-1);else if(!h){a=l+1;break}return-1===n||-1===o||0===c||1===c&&n===o-1&&n===a+1?-1!==o&&(e.base=e.name=0===a&&s?t.slice(1,o):t.slice(a,o)):(0===a&&s?(e.name=t.slice(1,n),e.base=t.slice(1,o)):(e.name=t.slice(a,n),e.base=t.slice(a,o)),e.ext=t.slice(n,o)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"};function It(){}function Pt(){}let kt;function Dt(){return void 0===kt&&(kt=function(){const t={stencil:!0,failIfMajorPerformanceCaveat:Y.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!Y.ADAPTER.getWebGLRenderingContext())return!1;const e=Y.ADAPTER.createCanvas();let i=e.getContext("webgl",t)||e.getContext("experimental-webgl",t);const s=!(!i||!i.getContextAttributes().stencil);if(i){const t=i.getExtension("WEBGL_lose_context");t&&t.loseContext()}return i=null,s}catch(t){return!1}}()),kt}Y.RETINA_PREFIX=/@([0-9\.]+)x/,Y.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var Mt={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Bt(t,e=[]){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function Nt(t){let e=t.toString(16);return e="000000".substring(0,6-e.length)+e,`#${e}`}function Lt(t){if("string"==typeof t&&("#"===(t=Mt[t.toLowerCase()]||t)[0]&&(t=t.slice(1)),3===t.length)){const[e,i,s]=t;t=e+e+i+i+s+s}return parseInt(t,16)}function Ot(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}const Ft=function(){const t=[],e=[];for(let i=0;i<32;i++)t[i]=i,e[i]=i;t[c.NORMAL_NPM]=c.NORMAL,t[c.ADD_NPM]=c.ADD,t[c.SCREEN_NPM]=c.SCREEN,e[c.NORMAL]=c.NORMAL_NPM,e[c.ADD]=c.ADD_NPM,e[c.SCREEN]=c.SCREEN_NPM;const i=[];return i.push(e),i.push(t),i}();function Ut(t,e){return Ft[e?1:0][t]}function Gt(t,e,i,s){return i=i||new Float32Array(4),s||void 0===s?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e):(i[0]=t[0],i[1]=t[1],i[2]=t[2]),i[3]=e,i}function zt(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;let i=t>>16&255,s=t>>8&255,r=255&t;return i=i*e+.5|0,s=s*e+.5|0,r=r*e+.5|0,(255*e<<24)+(i<<16)+(s<<8)+r}function jt(t,e,i,s){return(i=i||new Float32Array(4))[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,(s||void 0===s)&&(i[0]*=e,i[1]*=e,i[2]*=e),i[3]=e,i}function Ht(t,e=null){const i=6*t;if((e=e||new Uint16Array(i)).length!==i)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${i}`);for(let t=0,s=0;t<i;t+=6,s+=4)e[t+0]=s+0,e[t+1]=s+1,e[t+2]=s+2,e[t+3]=s+0,e[t+4]=s+2,e[t+5]=s+3;return e}function Yt(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}const Xt={Float32Array,Uint32Array,Int32Array,Uint8Array};function Wt(t,e){let i=0,s=0;const r={};for(let r=0;r<t.length;r++)s+=e[r],i+=t[r].length;const n=new ArrayBuffer(4*i);let a=null,o=0;for(let i=0;i<t.length;i++){const h=e[i],l=t[i],c=Yt(l);r[c]||(r[c]=new Xt[c](n)),a=r[c];for(let t=0;t<l.length;t++)a[(t/h|0)*s+o+t%h]=l[t];o+=h}return new Float32Array(n)}function $t(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}function Vt(t){return!(t&t-1||!t)}function qt(t){let e=(t>65535?1:0)<<4,i=((t>>>=e)>255?1:0)<<3;return e|=i,i=((t>>>=i)>15?1:0)<<2,e|=i,i=((t>>>=i)>3?1:0)<<1,e|=i,e|(t>>>=i)>>1}function Zt(t,e,i){const s=t.length;let r;if(e>=s||0===i)return;const n=s-(i=e+i>s?s-e:i);for(r=e;r<n;++r)t[r]=t[r+i];t.length=n}function Kt(t){return 0===t?0:t<0?-1:1}let Jt=0;function Qt(){return++Jt}const te={};function ee(t,e,i=3){if(te[e])return;let s=(new Error).stack;void 0===s?console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`):(s=s.split("\n").splice(i).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${e}\nDeprecated since v${t}`),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${e}\nDeprecated since v${t}`),console.warn(s))),te[e]=!0}const ie={},se=Object.create(null),re=Object.create(null);function ne(){let t;for(t in se)se[t].destroy();for(t in re)re[t].destroy()}function ae(){let t;for(t in se)delete se[t];for(t in re)delete re[t]}class oe{constructor(t,e,i){this.canvas=Y.ADAPTER.createCanvas(),this.context=this.canvas.getContext("2d"),this.resolution=i||Y.RESOLUTION,this.resize(t,e)}clear(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}resize(t,e){this.canvas.width=Math.round(t*this.resolution),this.canvas.height=Math.round(e*this.resolution)}destroy(){this.context=null,this.canvas=null}get width(){return this.canvas.width}set width(t){this.canvas.width=Math.round(t)}get height(){return this.canvas.height}set height(t){this.canvas.height=Math.round(t)}}function he(t){let e=t.width,i=t.height;const s=t.getContext("2d",{willReadFrequently:!0}),r=s.getImageData(0,0,e,i).data,n=r.length,a={top:null,left:null,right:null,bottom:null};let o,h,l,c=null;for(o=0;o<n;o+=4)0!==r[o+3]&&(h=o/4%e,l=~~(o/4/e),null===a.top&&(a.top=l),(null===a.left||h<a.left)&&(a.left=h),(null===a.right||a.right<h)&&(a.right=h+1),(null===a.bottom||a.bottom<l)&&(a.bottom=l));return null!==a.top&&(e=a.right-a.left,i=a.bottom-a.top+1,c=s.getImageData(a.left,a.top,e,i)),{height:i,width:e,data:c}}const le=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function ce(t){const e=le.exec(t);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}let ue;function de(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,ue||(ue=document.createElement("a")),ue.href=t;const i=St.parse(ue.href),s=!i.port&&""===e.port||i.port===e.port;return i.hostname===e.hostname&&s&&i.protocol===e.protocol?"":"anonymous"}function pe(t,e=1){const i=Y.RETINA_PREFIX.exec(t);return i?parseFloat(i[1]):e}const fe=[];function me(t,e){if(!t)return null;let i="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(i=e[1].toLowerCase())}for(let s=fe.length-1;s>=0;--s){const r=fe[s];if(r.test&&r.test(t,i))return new r(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class _e{constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new gt("setRealSize"),this.onUpdate=new gt("update"),this.onError=new gt("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,i){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class ge extends _e{constructor(t,e){const{width:i,height:s}=e||{};if(!i||!s)throw new Error("BufferResource width or height invalid");super(i,s),this.data=t}upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===y.UNPACK);const r=e.realWidth,n=e.realHeight;return i.width===r&&i.height===n?s.texSubImage2D(e.target,0,0,0,r,n,e.format,i.type,this.data):(i.width=r,i.height=n,s.texImage2D(e.target,0,i.internalFormat,r,n,0,e.format,i.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const ve={scaleMode:_.NEAREST,format:d.RGBA,alphaMode:y.NPM},ye=class extends Tt{constructor(t=null,e=null){super(),e=e||{};const{alphaMode:i,mipmap:s,anisotropicLevel:r,scaleMode:n,width:a,height:o,wrapMode:h,format:l,type:c,target:u,resolution:m,resourceOptions:_}=e;!t||t instanceof _e||((t=me(t,_)).internal=!0),this.resolution=m||Y.RESOLUTION,this.width=Math.round((a||0)*this.resolution)/this.resolution,this.height=Math.round((o||0)*this.resolution)/this.resolution,this._mipmap=s??Y.MIPMAP_TEXTURES,this.anisotropicLevel=r??Y.ANISOTROPIC_LEVEL,this._wrapMode=h||Y.WRAP_MODE,this._scaleMode=n??Y.SCALE_MODE,this.format=l||d.RGBA,this.type=c||f.UNSIGNED_BYTE,this.target=u||p.TEXTURE_2D,this.alphaMode=i??y.UNPACK,this.uid=Qt(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&o>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let i;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,i=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,i=!0),i&&this.dirtyStyleId++,this}setSize(t,e,i){return i=i||this.resolution,this.setRealSize(t*i,e*i,i)}setRealSize(t,e,i){return this.resolution=i||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=Vt(this.realWidth)&&Vt(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete re[this.cacheId],delete se[this.cacheId],this.cacheId=null),this.dispose(),ye.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,i=Y.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;if(s)r=t;else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Qt()}`}r=t._pixiId}let n=re[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in BaseTextureCache.`);return n||(n=new ye(t,e),n.cacheId=r,ye.addToCache(n,r)),n}static fromBuffer(t,e,i,s){t=t||new Float32Array(e*i*4);const r=new ge(t,{width:e,height:i}),n=t instanceof Float32Array?f.FLOAT:f.UNSIGNED_BYTE;return new ye(r,Object.assign({},ve,s||{width:e,height:i,type:n}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),re[e]&&console.warn(`BaseTexture added to the cache with an id [${e}] that already had an entry`),re[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=re[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete re[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete re[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let xe=ye;xe._globalBatch=0;class be extends _e{constructor(t,e){const{width:i,height:s}=e||{};super(i,s),this.items=[],this.itemDirtyIds=[];for(let e=0;e<t;e++){const t=new xe;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let i=0;i<this.length;i++)t[i]&&(t[i].castToBaseTexture?this.addBaseTextureAt(t[i].castToBaseTexture(),i):t[i]instanceof _e?this.addResourceAt(t[i],i):this.addResourceAt(me(t[i],e),i))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}class Te extends _e{constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,i){void 0!==i||e.startsWith("data:")?!1!==i&&(t.crossOrigin="string"==typeof i?i:"anonymous"):t.crossOrigin=de(e)}upload(t,e,i,s){const r=t.gl,n=e.realWidth,a=e.realHeight;if(s=s||this.source,"undefined"!=typeof HTMLImageElement&&s instanceof HTMLImageElement){if(!s.complete||0===s.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&s instanceof HTMLVideoElement&&s.readyState<=1&&0===s.buffered.length)return!1;return r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===y.UNPACK),this.noSubImage||e.target!==r.TEXTURE_2D||i.width!==n||i.height!==a?(i.width=n,i.height=a,r.texImage2D(e.target,0,i.internalFormat,e.format,i.type,s)):r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.format,i.type,s),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,i=t.naturalHeight||t.videoHeight||t.height;this.resize(e,i),super.update()}dispose(){this.source=null}}class Ee extends Te{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}}const we=class extends be{constructor(t,e){const{width:i,height:s,autoLoad:r,linkBaseTexture:n}=e||{};if(t&&t.length!==we.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:i,height:s});for(let t=0;t<we.SIDES;t++)this.items[t].target=p.TEXTURE_CUBE_MAP_POSITIVE_X+t;this.linkBaseTexture=!1!==n,t&&this.initFromArray(t,e),!1!==r&&this.load()}bind(t){super.bind(t),t.target=p.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,i){if(void 0===i&&(i=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=p.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,i){const s=this.itemDirtyIds;for(let r=0;r<we.SIDES;r++){const n=this.items[r];(s[r]<n.dirtyId||i.dirtyId<e.dirtyId)&&(n.valid&&n.resource?(n.resource.upload(t,n,i),s[r]=n.dirtyId):s[r]<-1&&(t.gl.texImage2D(n.target,0,i.internalFormat,e.realWidth,e.realHeight,0,e.format,i.type,null),s[r]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===we.SIDES}};let Se=we;Se.SIDES=6;class Ae extends Te{constructor(t,e){if(e=e||{},"string"==typeof t){const i=new Image;Te.crossOrigin(i,t,e.crossorigin),i.src=t,t=i}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??Y.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const i=this.source;this.url=i.src;const s=()=>{this.destroyed||(i.onload=null,i.onerror=null,this.resize(i.width,i.height),this._load=null,this.createBitmap?t(this.process()):t(this))};i.complete&&i.src?s():(i.onload=s,i.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,i=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:i?"cors":"no-cors"}).then((t=>t.blob())).then((i=>e(i,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===y.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,i){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,i);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,i,this.bitmap),!this.preserveBitmap){let t=!0;const s=e._glTextures;for(const r in s){const n=s[r];if(n!==i&&n.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}const Ce=class extends Te{constructor(t,e){e=e||{},super(Y.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Ce.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;Te.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,i=t.height;if(!e||!i)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let s=e*this.scale,r=i*this.scale;(this._overrideWidth||this._overrideHeight)&&(s=this._overrideWidth||this._overrideHeight/i*e,r=this._overrideHeight||this._overrideWidth/e*i),s=Math.round(s),r=Math.round(r);const n=this.source;n.width=s,n.height=r,n._pixiId=`canvas_${Qt()}`,n.getContext("2d").drawImage(t,0,0,e,i,0,0,s,r),this._resolve(),this._resolve=null}}static getSize(t){const e=Ce.SVG_SIZE.exec(t),i={};return e&&(i[e[1]]=Math.round(parseFloat(e[3])),i[e[5]]=Math.round(parseFloat(e[7]))),i}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Ce.SVG_XML.test(t)}};let Re=Ce;Re.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Re.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Ie=class extends Te{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const i=document.createElement("video");i.setAttribute("preload","auto"),i.setAttribute("webkit-playsinline",""),i.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const s=t[0].src||t[0];Te.crossOrigin(i,s,e.crossorigin);for(let e=0;e<t.length;++e){const s=document.createElement("source");let{src:r,mime:n}=t[e];r=r||t[e];const a=r.split("?").shift().toLowerCase(),o=a.slice(a.lastIndexOf(".")+1);n=n||Ie.MIME_TYPES[o]||`video/${o}`,s.src=r,s.type=n,i.appendChild(s)}t=i}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=xt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(xt.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(xt.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(xt.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(xt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(xt.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Ie.TYPES.includes(e)}};let Pe=Ie;Pe.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Pe.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};class ke extends Te{constructor(t,e){var i=(...t)=>{super(...t)};e=e||{},"string"==typeof t?(i(ke.EMPTY),this.url=t):(i(t),this.url=null),this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await Y.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const i=await e.blob();if(this.destroyed)return;const s=await createImageBitmap(i,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===y.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=s,this.update(),t(this)}catch(t){if(this.destroyed)return;e(t),this.onError.emit(t)}else t(this)}))),this._load}upload(t,e,i){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,i)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return ke._EMPTY=ke._EMPTY??Y.ADAPTER.createCanvas(0,0),ke._EMPTY}}fe.push(ke,Ae,Ee,Pe,Re,ge,Se,class extends be{constructor(t,e){const{width:i,height:s}=e||{};let r,n;Array.isArray(t)?(r=t,n=t.length):n=t,super(n,{width:i,height:s}),r&&this.initFromArray(r,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=p.TEXTURE_2D_ARRAY}upload(t,e,i){const{length:s,itemDirtyIds:r,items:n}=this,{gl:a}=t;i.dirtyId<0&&a.texImage3D(a.TEXTURE_2D_ARRAY,0,i.internalFormat,this._width,this._height,s,0,e.format,i.type,null);for(let t=0;t<s;t++){const s=n[t];r[t]<s.dirtyId&&(r[t]=s.dirtyId,s.valid&&a.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,t,s.resource.width,s.resource.height,1,e.format,i.type,s.resource.source))}return!0}});class De extends ge{upload(t,e,i){const s=t.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===y.UNPACK);const r=e.realWidth,n=e.realHeight;return i.width===r&&i.height===n?s.texSubImage2D(e.target,0,0,0,r,n,e.format,i.type,this.data):(i.width=r,i.height=n,s.texImage2D(e.target,0,i.internalFormat,r,n,0,e.format,i.type,this.data)),!0}}class Me{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new gt("disposeFramebuffer"),this.multisample=w.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new xe(null,{scaleMode:_.NEAREST,resolution:1,mipmap:v.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new xe(new De(null,{width:this.width,height:this.height}),{scaleMode:_.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:v.OFF,format:d.DEPTH_COMPONENT,type:f.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let i=0;i<this.colorTextures.length;i++){const s=this.colorTextures[i],r=s.resolution;s.setSize(t/r,e/r)}if(this.depthTexture){const i=this.depthTexture.resolution;this.depthTexture.setSize(t/i,e/i)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class Be extends xe{constructor(t={}){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=w.NONE),super(null,t),this.mipmap=v.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new Me(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class Ne{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,i){const s=e.width,r=e.height;if(i){const e=t.width/2/s,n=t.height/2/r,a=t.x/s+e,o=t.y/r+n;i=ft.add(i,ft.NW),this.x0=a+e*ft.uX(i),this.y0=o+n*ft.uY(i),i=ft.add(i,2),this.x1=a+e*ft.uX(i),this.y1=o+n*ft.uY(i),i=ft.add(i,2),this.x2=a+e*ft.uX(i),this.y2=o+n*ft.uY(i),i=ft.add(i,2),this.x3=a+e*ft.uX(i),this.y3=o+n*ft.uY(i)}else this.x0=t.x/s,this.y0=t.y/r,this.x1=(t.x+t.width)/s,this.y1=t.y/r,this.x2=(t.x+t.width)/s,this.y2=(t.y+t.height)/r,this.x3=t.x/s,this.y3=(t.y+t.height)/r;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}}const Le=new Ne;function Oe(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class Fe extends Tt{constructor(t,e,i,s,r,n){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new tt(0,0,1,1)),t instanceof Fe&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=s,this.valid=!1,this._uvs=Le,this.uvMatrix=null,this.orig=i||e,this._rotate=Number(r||0),!0===r)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=n?new J(n.x,n.y):new J(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;t?.url&&se[t.url]&&Fe.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,Fe.removeFromCache(this),this.textureCacheIds=null}clone(){const t=this._frame.clone(),e=this._frame===this.orig?t:this.orig.clone(),i=new Fe(this.baseTexture,!this.noFrame&&t,e,this.trim?.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(i._frame=t),i}updateUvs(){this._uvs===Le&&(this._uvs=new Ne),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},i=Y.STRICT_TEXTURE_CACHE){const s="string"==typeof t;let r=null;if(s)r=t;else if(t instanceof xe){if(!t.cacheId){const i=e?.pixiIdPrefix||"pixiid";t.cacheId=`${i}-${Qt()}`,xe.addToCache(t,t.cacheId)}r=t.cacheId}else{if(!t._pixiId){const i=e?.pixiIdPrefix||"pixiid";t._pixiId=`${i}_${Qt()}`}r=t._pixiId}let n=se[r];if(s&&i&&!n)throw new Error(`The cacheId "${r}" does not exist in TextureCache.`);return n||t instanceof xe?!n&&t instanceof xe&&(n=new Fe(t),Fe.addToCache(n,r)):(e.resolution||(e.resolution=pe(t)),n=new Fe(new xe(t,e)),n.baseTexture.cacheId=r,xe.addToCache(n.baseTexture,r),Fe.addToCache(n,r)),n}static fromURL(t,e){const i=Object.assign({autoLoad:!1},e?.resourceOptions),s=Fe.from(t,Object.assign({resourceOptions:i},e),!1),r=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):r.load().then((()=>Promise.resolve(s)))}static fromBuffer(t,e,i,s){return new Fe(xe.fromBuffer(t,e,i,s))}static fromLoader(t,e,i,s){const r=new xe(t,Object.assign({scaleMode:Y.SCALE_MODE,resolution:pe(e)},s)),{resource:n}=r;n instanceof Ae&&(n.url=e);const a=new Fe(r);return i||(i=e),xe.addToCache(a.baseTexture,i),Fe.addToCache(a,i),i!==e&&(xe.addToCache(a.baseTexture,e),Fe.addToCache(a,e)),a.baseTexture.valid?Promise.resolve(a):new Promise((t=>{a.baseTexture.once("loaded",(()=>t(a)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),se[e]&&console.warn(`Texture added to the cache with an id [${e}] that already had an entry`),se[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=se[t];if(e){const i=e.textureCacheIds.indexOf(t);return i>-1&&e.textureCacheIds.splice(i,1),delete se[t],e}}else if(t?.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)se[t.textureCacheIds[e]]===t&&delete se[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:i,width:s,height:r}=t,n=e+s>this.baseTexture.width,a=i+r>this.baseTexture.height;if(n||a){const t=n&&a?"and":"or",o=`X: ${e} + ${s} = ${e+s} > ${this.baseTexture.width}`,h=`Y: ${i} + ${r} = ${i+r} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${o} ${t} ${h}`)}this.valid=s&&r&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return Fe._EMPTY||(Fe._EMPTY=new Fe(new xe),Oe(Fe._EMPTY),Oe(Fe._EMPTY.baseTexture)),Fe._EMPTY}static get WHITE(){if(!Fe._WHITE){const t=Y.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),Fe._WHITE=new Fe(xe.from(t)),Oe(Fe._WHITE),Oe(Fe._WHITE.baseTexture)}return Fe._WHITE}}class Ue extends Fe{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,i=!0){const s=this.baseTexture.resolution,r=Math.round(t*s)/s,n=Math.round(e*s)/s;this.valid=r>0&&n>0,this._frame.width=this.orig.width=r,this._frame.height=this.orig.height=n,i&&this.baseTexture.resize(r,n),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new Ue(new Be(t))}}class Ge{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,i=w.NONE){const s=new Be(Object.assign({width:t,height:e,resolution:1,multisample:i},this.textureOptions));return new Ue(s)}getOptimalTexture(t,e,i=1,s=w.NONE){let r;t=Math.ceil(t*i-1e-6),e=Math.ceil(e*i-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?r=s>1?-s:-1:(r=((65535&(t=$t(t)))<<16|65535&(e=$t(e)))>>>0,s>1&&(r+=4294967296*s)),this.texturePool[r]||(this.texturePool[r]=[]);let n=this.texturePool[r].pop();return n||(n=this.createTexture(t,e,s)),n.filterPoolKey=r,n.setResolution(i),n}getFilterTexture(t,e,i){const s=this.getOptimalTexture(t.width,t.height,e||t.resolution,i||w.NONE);return s.filterFrame=t.filterFrame,s}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const t in this.texturePool){const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}Ge.SCREEN_KEY=-1;class ze{constructor(t,e=0,i=!1,s=f.FLOAT,r,n,a){this.buffer=t,this.size=e,this.normalized=i,this.type=s,this.stride=r,this.start=n,this.instance=a}destroy(){this.buffer=null}static from(t,e,i,s,r){return new ze(t,e,i,s,r)}}let je=0;class He{constructor(t,e=!0,i=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=i,this.static=e,this.id=je++,this.disposeRunner=new gt("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?S.ELEMENT_ARRAY_BUFFER:S.ARRAY_BUFFER}get index(){return this.type===S.ELEMENT_ARRAY_BUFFER}static from(t){return t instanceof Array&&(t=new Float32Array(t)),new He(t)}}const Ye={Float32Array,Uint32Array,Int32Array,Uint8Array},Xe={5126:4,5123:2,5121:1};let We=0;const $e={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array};class Ve{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=We++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new gt("disposeGeometry"),this.refCount=0}addAttribute(t,e,i=0,s=!1,r,n,a,o=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof He||(e instanceof Array&&(e=new Float32Array(e)),e=new He(e));const h=t.split("|");if(h.length>1){for(let t=0;t<h.length;t++)this.addAttribute(h[t],e,i,s,r);return this}let l=this.buffers.indexOf(e);return-1===l&&(this.buffers.push(e),l=this.buffers.length-1),this.attributes[t]=new ze(l,i,s,r,n,a,o),this.instanced=this.instanced||o,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof He||(t instanceof Array&&(t=new Uint16Array(t)),t=new He(t)),t.type=S.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],i=new He;let s;for(s in this.attributes){const i=this.attributes[s],r=this.buffers[i.buffer];t.push(r.data),e.push(i.size*Xe[i.type]/4),i.buffer=0}for(i.data=function(t,e){let i=0,s=0;const r={};for(let r=0;r<t.length;r++)s+=e[r],i+=t[r].length;const n=new ArrayBuffer(4*i);let a=null,o=0;for(let i=0;i<t.length;i++){const h=e[i],l=t[i],c=Yt(l);r[c]||(r[c]=new Ye[c](n)),a=r[c];for(let t=0;t<l.length;t++)a[(t/h|0)*s+o+t%h]=l[t];o+=h}return new Float32Array(n)}(t,e),s=0;s<this.buffers.length;s++)this.buffers[s]!==this.indexBuffer&&this.buffers[s].destroy();return this.buffers=[i],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new Ve;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new He(this.buffers[e].data.slice(0));for(const e in this.attributes){const i=this.attributes[e];t.attributes[e]=new ze(i.buffer,i.size,i.normalized,i.type,i.stride,i.start,i.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=S.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new Ve,i=[],s=[],r=[];let n;for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)s[t]=s[t]||0,s[t]+=n.buffers[t].data.length,r[t]=0}for(let t=0;t<n.buffers.length;t++)i[t]=new($e[Yt(n.buffers[t].data)])(s[t]),e.buffers[t]=new He(i[t]);for(let e=0;e<t.length;e++){n=t[e];for(let t=0;t<n.buffers.length;t++)i[t].set(n.buffers[t].data,r[t]),r[t]+=n.buffers[t].data.length}if(e.attributes=n.attributes,n.indexBuffer){e.indexBuffer=e.buffers[n.buffers.indexOf(n.indexBuffer)],e.indexBuffer.type=S.ELEMENT_ARRAY_BUFFER;let i=0,s=0,r=0,a=0;for(let t=0;t<n.buffers.length;t++)if(n.buffers[t]!==n.indexBuffer){a=t;break}for(const t in n.attributes){const e=n.attributes[t];(0|e.buffer)===a&&(s+=e.size*Xe[e.type]/4)}for(let n=0;n<t.length;n++){const o=t[n].indexBuffer.data;for(let t=0;t<o.length;t++)e.indexBuffer.data[t+r]+=i;i+=t[n].buffers[a].data.length/s,r+=o.length}}return e}}class qe extends Ve{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class Ze extends Ve{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new He(this.vertices),this.uvBuffer=new He(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let i=0,s=0;return this.uvs[0]=i,this.uvs[1]=s,this.uvs[2]=i+e.width/t.width,this.uvs[3]=s,this.uvs[4]=i+e.width/t.width,this.uvs[5]=s+e.height/t.height,this.uvs[6]=i,this.uvs[7]=s+e.height/t.height,i=e.x,s=e.y,this.vertices[0]=i,this.vertices[1]=s,this.vertices[2]=i+e.width,this.vertices[3]=s,this.vertices[4]=i+e.width,this.vertices[5]=s+e.height,this.vertices[6]=i,this.vertices[7]=s+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}let Ke=0;class Je{constructor(t,e,i){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Ke++,this.static=!!e,this.ubo=!!i,t instanceof He?(this.buffer=t,this.buffer.type=S.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new He(new Float32Array(1)),this.buffer.type=S.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,i){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new Je(e,i)}static from(t,e,i){return new Je(t,e,i)}static uboFrom(t,e){return new Je(t,e??!0,!0)}}class Qe{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=w.NONE,this.sourceFrame=new tt,this.destinationFrame=new tt,this.bindingSourceFrame=new tt,this.bindingDestinationFrame=new tt,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const ti=[new J,new J,new J,new J],ei=new at;class ii{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new Ge,this.statePool=[],this.quad=new qe,this.quadUv=new Ze,this.tempRect=new tt,this.activeState={},this.globalUniforms=new Je({outputFrame:new tt,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const i=this.renderer,s=this.defaultFilterStack,r=this.statePool.pop()||new Qe,n=this.renderer.renderTexture;let a=e[0].resolution,o=e[0].multisample,h=e[0].padding,l=e[0].autoFit,c=e[0].legacy??!0;for(let t=1;t<e.length;t++){const i=e[t];a=Math.min(a,i.resolution),o=Math.min(o,i.multisample),h=this.useMaxPadding?Math.max(h,i.padding):h+i.padding,l=l&&i.autoFit,c=c||(i.legacy??!0)}1===s.length&&(this.defaultFilterStack[0].renderTexture=n.current),s.push(r),r.resolution=a,r.multisample=o,r.legacy=c,r.target=t,r.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),r.sourceFrame.pad(h);const u=this.tempRect.copyFrom(n.sourceFrame);i.projection.transform&&this.transformAABB(ei.copyFrom(i.projection.transform).invert(),u),l?(r.sourceFrame.fit(u),(r.sourceFrame.width<=0||r.sourceFrame.height<=0)&&(r.sourceFrame.width=0,r.sourceFrame.height=0)):r.sourceFrame.intersects(u)||(r.sourceFrame.width=0,r.sourceFrame.height=0),this.roundFrame(r.sourceFrame,n.current?n.current.resolution:i.resolution,n.sourceFrame,n.destinationFrame,i.projection.transform),r.renderTexture=this.getOptimalFilterTexture(r.sourceFrame.width,r.sourceFrame.height,a,o),r.filters=e,r.destinationFrame.width=r.renderTexture.width,r.destinationFrame.height=r.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=r.sourceFrame.width,d.height=r.sourceFrame.height,r.renderTexture.filterFrame=r.sourceFrame,r.bindingSourceFrame.copyFrom(n.sourceFrame),r.bindingDestinationFrame.copyFrom(n.destinationFrame),r.transform=i.projection.transform,i.projection.transform=null,n.bind(r.renderTexture,r.sourceFrame,d),i.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),i=e.filters;this.activeState=e;const s=this.globalUniforms.uniforms;s.outputFrame=e.sourceFrame,s.resolution=e.resolution;const r=s.inputSize,n=s.inputPixel,a=s.inputClamp;if(r[0]=e.destinationFrame.width,r[1]=e.destinationFrame.height,r[2]=1/r[0],r[3]=1/r[1],n[0]=Math.round(r[0]*e.resolution),n[1]=Math.round(r[1]*e.resolution),n[2]=1/n[0],n[3]=1/n[1],a[0]=.5*n[2],a[1]=.5*n[3],a[2]=e.sourceFrame.width*r[2]-.5*n[2],a[3]=e.sourceFrame.height*r[3]-.5*n[3],e.legacy){const t=s.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();const o=t[t.length-1];if(this.renderer.framebuffer.blit(),1===i.length)i[0].apply(this,e.renderTexture,o.renderTexture,x.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,s=this.getOptimalFilterTexture(t.width,t.height,e.resolution);s.filterFrame=t.filterFrame;let r=0;for(r=0;r<i.length-1;++r){1===r&&e.multisample>1&&(s=this.getOptimalFilterTexture(t.width,t.height,e.resolution),s.filterFrame=t.filterFrame),i[r].apply(this,t,s,x.CLEAR,e);const n=t;t=s,s=n}i[r].apply(this,t,o.renderTexture,x.BLEND,e),r>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(s)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=x.CLEAR){const{renderTexture:i,state:s}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,t?.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,i.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?i.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const r=1&s.stateId||this.forceClear;(e===x.CLEAR||e===x.BLIT&&r)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,i,s){const r=this.renderer;r.state.set(t.state),this.bindAndClear(i,s),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,r.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),r.geometry.bind(this.quadUv),r.geometry.draw(u.TRIANGLES)):(r.geometry.bind(this.quad),r.geometry.draw(u.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:i,destinationFrame:s}=this.activeState,{orig:r}=e._texture,n=t.set(s.width,0,0,s.height,i.x,i.y),a=e.worldTransform.copyTo(at.TEMP_MATRIX);return a.invert(),n.prepend(a),n.scale(1/r.width,1/r.height),n.translate(e.anchor.x,e.anchor.y),n}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,i=1,s=w.NONE){return this.texturePool.getOptimalTexture(t,e,i,s)}getFilterTexture(t,e,i){if("number"==typeof t){const i=t;t=e,e=i}t=t||this.activeState.renderTexture;const s=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,i||w.NONE);return s.filterFrame=t.filterFrame,s}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const i=ti[0],s=ti[1],r=ti[2],n=ti[3];i.set(e.left,e.top),s.set(e.left,e.bottom),r.set(e.right,e.top),n.set(e.right,e.bottom),t.apply(i,i),t.apply(s,s),t.apply(r,r),t.apply(n,n);const a=Math.min(i.x,s.x,r.x,n.x),o=Math.min(i.y,s.y,r.y,n.y),h=Math.max(i.x,s.x,r.x,n.x),l=Math.max(i.y,s.y,r.y,n.y);e.x=a,e.y=o,e.width=h-a,e.height=l-o}roundFrame(t,e,i,s,r){if(!(t.width<=0||t.height<=0||i.width<=0||i.height<=0)){if(r){const{a:t,b:e,c:i,d:s}=r;if((Math.abs(e)>1e-4||Math.abs(i)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(s)>1e-4))return}(r=r?ei.copyFrom(r):ei.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.transformAABB(r,t),t.ceil(e),this.transformAABB(r.invert(),t)}}}ii.extension={type:X.RendererSystem,name:"filter"},$.add(ii);class si{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}class ri{constructor(t){this.renderer=t,this.emptyRenderer=new si(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:i}=this.renderer.texture;for(let s=e-1;s>=0;--s)t[s]=i[s]||null,t[s]&&(t[s]._batchLocation=s)}boundArray(t,e,i,s){const{elements:r,ids:n,count:a}=t;let o=0;for(let t=0;t<a;t++){const a=r[t],h=a._batchLocation;if(h>=0&&h<s&&e[h]===a)n[t]=h;else for(;o<s;){const s=e[o];if(!s||s._batchEnabled!==i||s._batchLocation!==o){n[t]=o,a._batchLocation=o,e[o]=a;break}o++}}}destroy(){this.renderer=null}}ri.extension={type:X.RendererSystem,name:"batch"},$.add(ri);let ni=0;class ai{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=ni++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,i=t.premultipliedAlpha??!0;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:i,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=ni++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let i;if(Y.PREFER_ENV>=h.WEBGL2&&(i=t.getContext("webgl2",e)),i)this.webGLVersion=2;else if(this.webGLVersion=1,i=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!i)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=i,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault()}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),i="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;i&&(this.webGLVersion=2),e&&!e.stencil&&console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const s=i||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")}}ai.extension={type:X.RendererSystem,name:"context"},$.add(ai);class oi{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=w.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const hi=new tt;class li{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new Me(10,10),this.msaaSamples=null}contextChange(){const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new tt,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,i=this.renderer.context.extensions.depthTexture;Y.PREFER_ENV===h.WEBGL_LEGACY&&(e=null,i=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),i||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,i=0){const{gl:s}=this;if(t){const r=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,s.bindFramebuffer(s.FRAMEBUFFER,r.framebuffer)),r.mipLevel!==i&&(t.dirtyId++,t.dirtyFormat++,r.mipLevel=i),r.dirtyId!==t.dirtyId&&(r.dirtyId=t.dirtyId,r.dirtyFormat!==t.dirtyFormat?(r.dirtyFormat=t.dirtyFormat,r.dirtySize=t.dirtySize,this.updateFramebuffer(t,i)):r.dirtySize!==t.dirtySize&&(r.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const i=t.colorTextures[e];this.renderer.texture.unbind(i.parentTextureArray||i)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>i,s=e.height>>i,r=t/e.width;this.setViewport(e.x*r,e.y*r,t,s)}else{const e=t.width>>i,s=t.height>>i;this.setViewport(0,0,e,s)}}else this.current&&(this.current=null,s.bindFramebuffer(s.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,i,s){const r=this.viewport;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),r.width===i&&r.height===s&&r.x===t&&r.y===e||(r.x=t,r.y=e,r.width=i,r.height=s,this.gl.viewport(t,e,i,s))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,i,s,r=l.COLOR|l.DEPTH){const{gl:n}=this;n.clearColor(t,e,i,s),n.clear(r)}initFramebuffer(t){const{gl:e}=this,i=new oi(e.createFramebuffer());return i.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=i,this.managedFramebuffers.push(t),t.disposeRunner.add(this),i}resizeFramebuffer(t){const{gl:e}=this,i=t.glFramebuffers[this.CONTEXT_UID];i.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,i.stencil),i.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const s=t.colorTextures;let r=s.length;e.drawBuffers||(r=Math.min(r,1));for(let n=0;n<r;n++){const r=s[n],a=r.parentTextureArray||r;this.renderer.texture.bind(a,0),0===n&&i.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,i.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,i.multisample,a._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:i}=this,s=t.glFramebuffers[this.CONTEXT_UID],r=t.colorTextures;let n=r.length;i.drawBuffers||(n=Math.min(n,1)),s.multisample>1&&this.canMultisampleFramebuffer(t)?s.msaaBuffer=s.msaaBuffer||i.createRenderbuffer():s.msaaBuffer&&(i.deleteRenderbuffer(s.msaaBuffer),s.msaaBuffer=null,s.blitFramebuffer&&(s.blitFramebuffer.dispose(),s.blitFramebuffer=null));const a=[];for(let o=0;o<n;o++){const n=r[o],h=n.parentTextureArray||n;this.renderer.texture.bind(h,0),0===o&&s.msaaBuffer?(i.bindRenderbuffer(i.RENDERBUFFER,s.msaaBuffer),i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,h._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.RENDERBUFFER,s.msaaBuffer)):(i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,n.target,h._glTextures[this.CONTEXT_UID].texture,e),a.push(i.COLOR_ATTACHMENT0+o))}if(a.length>1&&i.drawBuffers(a),t.depthTexture&&this.writeDepthTexture){const s=t.depthTexture;this.renderer.texture.bind(s,0),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,e)}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?s.stencil&&(i.deleteRenderbuffer(s.stencil),s.stencil=null):(s.stencil=s.stencil||i.createRenderbuffer(),i.bindRenderbuffer(i.RENDERBUFFER,s.stencil),s.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,s.multisample,i.DEPTH24_STENCIL8,t.width,t.height):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,t.width,t.height),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let i=w.NONE;if(t<=1||null===e)return i;for(let s=0;s<e.length;s++)if(e[s]<=t){i=e[s];break}return 1===i&&(i=w.NONE),i}blit(t,e,i){const{current:s,renderer:r,gl:n,CONTEXT_UID:a}=this;if(2!==r.context.webGLVersion)return;if(!s)return;const o=s.glFramebuffers[a];if(!o)return;if(!t){if(!o.msaaBuffer)return;const e=s.colorTextures[0];if(!e)return;o.blitFramebuffer||(o.blitFramebuffer=new Me(s.width,s.height),o.blitFramebuffer.addColorTexture(0,e)),(t=o.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===s.width&&t.height===s.height||(t.width=s.width,t.height=s.height,t.dirtyId++,t.dirtySize++)}e||((e=hi).width=s.width,e.height=s.height),i||(i=e);const h=e.width===i.width&&e.height===i.height;this.bind(t),n.bindFramebuffer(n.READ_FRAMEBUFFER,o.framebuffer),n.blitFramebuffer(e.left,e.top,e.right,e.bottom,i.left,i.top,i.right,i.bottom,n.COLOR_BUFFER_BIT,h?n.NEAREST:n.LINEAR)}disposeFramebuffer(t,e){const i=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(!i)return;delete t.glFramebuffers[this.CONTEXT_UID];const r=this.managedFramebuffers.indexOf(t);r>=0&&this.managedFramebuffers.splice(r,1),t.disposeRunner.remove(this),e||(s.deleteFramebuffer(i.framebuffer),i.msaaBuffer&&s.deleteRenderbuffer(i.msaaBuffer),i.stencil&&s.deleteRenderbuffer(i.stencil)),i.blitFramebuffer&&i.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let i=0;i<e.length;i++)this.disposeFramebuffer(e[i],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const i=t.width,s=t.height,r=this.gl,n=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,n),e.msaaBuffer?r.renderbufferStorageMultisample(r.RENDERBUFFER,e.multisample,r.DEPTH24_STENCIL8,i,s):r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,i,s),e.stencil=n,r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n)}reset(){this.current=this.unknownFramebuffer,this.viewport=new tt}destroy(){this.renderer=null}}li.extension={type:X.RendererSystem,name:"framebuffer"},$.add(li);const ci={5126:4,5123:2,5121:1};class ui{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;Y.PREFER_ENV===h.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,i)=>e.vertexAttribDivisorANGLE(t,i),t.drawElementsInstanced=(t,i,s,r,n)=>e.drawElementsInstancedANGLE(t,i,s,r,n),t.drawArraysInstanced=(t,i,s,r)=>e.drawArraysInstancedANGLE(t,i,s,r)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:i}=this;let s=t.glVertexArrayObjects[this.CONTEXT_UID],r=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},r=!0);const n=s[e.program.id]||this.initGeometryVao(t,e,r);this._activeGeometry=t,this._activeVao!==n&&(this._activeVao=n,this.hasVao?i.bindVertexArray(n):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];e.update(s)}}checkCompatibility(t,e){const i=t.attributes,s=e.attributeData;for(const t in s)if(!i[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,e){const i=t.attributes,s=e.attributeData,r=["g",t.id];for(const t in i)s[t]&&r.push(t,s[t].location);return r.join("-")}initGeometryVao(t,e,i=!0){const s=this.gl,r=this.CONTEXT_UID,n=this.renderer.buffer,a=e.program;a.glPrograms[r]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,a);const o=this.getSignature(t,a),h=t.glVertexArrayObjects[this.CONTEXT_UID];let l=h[o];if(l)return h[a.id]=l,l;const c=t.buffers,u=t.attributes,d={},p={};for(const t in c)d[t]=0,p[t]=0;for(const t in u)!u[t].size&&a.attributeData[t]?u[t].size=a.attributeData[t].size:u[t].size||console.warn(`PIXI Geometry attribute '${t}' size cannot be determined (likely the bound shader does not have the attribute)`),d[u[t].buffer]+=u[t].size*ci[u[t].type];for(const t in u){const e=u[t],i=e.size;void 0===e.stride&&(d[e.buffer]===i*ci[e.type]?e.stride=0:e.stride=d[e.buffer]),void 0===e.start&&(e.start=p[e.buffer],p[e.buffer]+=i*ci[e.type])}l=s.createVertexArray(),s.bindVertexArray(l);for(let t=0;t<c.length;t++){const e=c[t];n.bind(e),i&&e._glBuffers[r].refCount++}return this.activateVao(t,a),h[a.id]=l,h[o]=l,s.bindVertexArray(null),n.unbind(S.ARRAY_BUFFER),l}disposeGeometry(t,e){if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const i=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,r=t.buffers,n=this.renderer?.buffer;if(t.disposeRunner.remove(this),i){if(n)for(let t=0;t<r.length;t++){const i=r[t]._glBuffers[this.CONTEXT_UID];i&&(i.refCount--,0!==i.refCount||e||n.dispose(r[t],e))}if(!e)for(const t in i)if("g"===t[0]){const e=i[t];this._activeVao===e&&this.unbind(),s.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let i=0;i<e.length;i++)this.disposeGeometry(this.managedGeometries[e[i]],t)}activateVao(t,e){const i=this.gl,s=this.CONTEXT_UID,r=this.renderer.buffer,n=t.buffers,a=t.attributes;t.indexBuffer&&r.bind(t.indexBuffer);let o=null;for(const t in a){const h=a[t],l=n[h.buffer],c=l._glBuffers[s];if(e.attributeData[t]){o!==c&&(r.bind(l),o=c);const s=e.attributeData[t].location;if(i.enableVertexAttribArray(s),i.vertexAttribPointer(s,h.size,h.type||i.FLOAT,h.normalized,h.stride,h.start),h.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");i.vertexAttribDivisor(s,1)}}}}draw(t,e,i,s){const{gl:r}=this,n=this._activeGeometry;if(n.indexBuffer){const a=n.indexBuffer.data.BYTES_PER_ELEMENT,o=2===a?r.UNSIGNED_SHORT:r.UNSIGNED_INT;2===a||4===a&&this.canUseUInt32ElementIndex?n.instanced?r.drawElementsInstanced(t,e||n.indexBuffer.data.length,o,(i||0)*a,s||1):r.drawElements(t,e||n.indexBuffer.data.length,o,(i||0)*a):console.warn("unsupported index buffer type: uint32")}else n.instanced?r.drawArraysInstanced(t,i,e||n.getSize(),s||1):r.drawArrays(t,i,e||n.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}ui.extension={type:X.RendererSystem,name:"geometry"},$.add(ui);class di{constructor(t=null){this.type=E.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=Y.FILTER_MULTISAMPLE,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=E.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}const pi={};let fi,mi=pi;function _i(t,e,i){if("precision"!==t.substring(0,9)){let s=e;return e===T.HIGH&&i!==T.HIGH&&(s=T.MEDIUM),`precision ${s} float;\n${t}`}return i!==T.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}const gi={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function vi(t){return gi[t]}let yi=null;const xi={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function bi(t,e){if(!yi){const e=Object.keys(xi);yi={};for(let i=0;i<e.length;++i){const s=e[i];yi[t[s]]=xi[s]}}return yi[e]}const Ti=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],Ei={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},wi={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},Si=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function Ai(t){let e="";for(let i=0;i<t;++i)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(test == ${i}.0){}`);return e}let Ci=0;const Ri={};class Ii{constructor(t,e,i="pixi-shader",s={}){this.extra={},this.id=Ci++,this.vertexSrc=t||Ii.defaultVertexSrc,this.fragmentSrc=e||Ii.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=s,"#version"!==this.vertexSrc.substring(0,8)&&(i=i.replace(/\s+/g,"-"),Ri[i]?(Ri[i]++,i+=`-${Ri[i]}`):Ri[i]=1,this.vertexSrc=`#define SHADER_NAME ${i}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${i}\n${this.fragmentSrc}`,this.vertexSrc=_i(this.vertexSrc,Y.PRECISION_VERTEX,T.HIGH),this.fragmentSrc=_i(this.fragmentSrc,Y.PRECISION_FRAGMENT,function(){if(!fi){fi=T.MEDIUM;const t=function(){if(mi===pi||mi?.isContextLost()){const t=Y.ADAPTER.createCanvas();let e;Y.PREFER_ENV>=h.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),mi=e}return mi}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);fi=e.precision?T.HIGH:T.MEDIUM}}return fi}())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,i){const s=t+e;let r=ie[s];return r||(ie[s]=r=new Ii(t,e,i)),r}}class Pi{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof Je?e:new Je(e):new Je({}),this.disposeRunner=new gt("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const i in e.uniforms){const s=e.uniforms[i];if(s.group&&this.checkUniformExists(t,s))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,i){const s=Ii.from(t,e);return new Pi(s,i)}}class ki{constructor(){this.data=0,this.blendMode=c.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==c.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}static for2d(){const t=new ki;return t.depthTest=!1,t.blend=!0,t}}class Di extends Pi{constructor(t,e,i){super(Ii.from(t||Di.defaultVertexSrc,e||Di.defaultFragmentSrc),i),this.padding=0,this.resolution=Y.FILTER_RESOLUTION,this.multisample=Y.FILTER_MULTISAMPLE,this.enabled=!0,this.autoFit=!0,this.state=new ki}apply(t,e,i,s,r){t.applyFilter(this,e,i,s)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}}const Mi=new at;class Bi{constructor(t,e){this._texture=t,this.mapCoord=new at,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const i=this.mapCoord;for(let s=0;s<t.length;s+=2){const r=t[s],n=t[s+1];e[s]=r*i.a+n*i.c+i.tx,e[s+1]=r*i.b+n*i.d+i.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const i=e._uvs;this.mapCoord.set(i.x1-i.x0,i.y1-i.y0,i.x3-i.x0,i.y3-i.y0,i.x0,i.y0);const s=e.orig,r=e.trim;r&&(Mi.set(s.width/r.width,0,0,s.height/r.height,-r.x/r.width,-r.y/r.height),this.mapCoord.append(Mi));const n=e.baseTexture,a=this.uClampFrame,o=this.clampMargin/n.resolution,h=this.clampOffset;return a[0]=(e._frame.x+o+h)/n.width,a[1]=(e._frame.y+o+h)/n.height,a[2]=(e._frame.x+e._frame.width-o+h)/n.width,a[3]=(e._frame.y+e._frame.height-o+h)/n.height,this.uClampOffset[0]=h/n.realWidth,this.uClampOffset[1]=h/n.realHeight,this.isSimple=e._frame.width===n.width&&e._frame.height===n.height&&0===e.rotate,!0}}class Ni extends Di{constructor(t,e,i){let s=null;"string"!=typeof t&&void 0===e&&void 0===i&&(s=t,t=void 0,e=void 0,i=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",i),this.maskSprite=s,this.maskMatrix=new at}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,i,s){const r=this._maskSprite,n=r._texture;n.valid&&(n.uvMatrix||(n.uvMatrix=new Bi(n,0)),n.uvMatrix.update(),this.uniforms.npmAlpha=n.baseTexture.alphaMode?0:1,this.uniforms.mask=n,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,r).prepend(n.uvMatrix.mapCoord),this.uniforms.alpha=r.worldAlpha,this.uniforms.maskClamp=n.uvMatrix.uClampFrame,t.applyFilter(this,e,i,s))}}class Li{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let i=e;if(!i.isMaskData){const t=this.maskDataPool.pop()||new di;t.pooled=!0,t.maskObject=e,i=t}const s=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(i.copyCountersOrReset(s),i._colorMask=s?s._colorMask:15,i.autoDetect&&this.detect(i),i._target=t,i.type!==E.SPRITE&&this.maskStack.push(i),i.enabled)switch(i.type){case E.SCISSOR:this.renderer.scissor.push(i);break;case E.STENCIL:this.renderer.stencil.push(i);break;case E.SPRITE:i.copyCountersOrReset(null),this.pushSpriteMask(i);break;case E.COLOR:this.pushColorMask(i)}i.type===E.SPRITE&&this.maskStack.push(i)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case E.SCISSOR:this.renderer.scissor.pop(e);break;case E.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case E.SPRITE:this.popSpriteMask(e);break;case E.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===E.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=E.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=E.SCISSOR:t.type=E.STENCIL:t.type=E.COLOR}pushSpriteMask(t){const{maskObject:e}=t,i=t._target;let s=t._filters;s||(s=this.alphaMaskPool[this.alphaMaskIndex],s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new Ni]));const r=this.renderer,n=r.renderTexture;let a,o;if(n.current){const e=n.current;a=t.resolution||e.resolution,o=t.multisample??e.multisample}else a=t.resolution||r.resolution,o=t.multisample??r.multisample;s[0].resolution=a,s[0].multisample=o,s[0].maskSprite=e;const h=i.filterArea;i.filterArea=e.getBounds(!0),r.filter.push(i,s),i.filterArea=h,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,i=t._colorMask=e&t.colorMask;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}popColorMask(t){const e=t._colorMask,i=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;i!==e&&this.renderer.gl.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))}destroy(){this.renderer=null}}Li.extension={type:X.RendererSystem,name:"mask"},$.add(Li);class Oi{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,i=this.getStackLength();this.maskStack=t;const s=this.getStackLength();s!==i&&(0===s?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const Fi=new at,Ui=[],Gi=class extends Oi{constructor(t){super(t),this.glConst=Y.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:i}=t,{renderer:s}=this,r=s.renderTexture,n=i.getBounds(!0,Ui.pop()??new tt);this.roundFrameToPixels(n,r.current?r.current.resolution:s.resolution,r.sourceFrame,r.destinationFrame,s.projection.transform),e&&n.fit(e),t._scissorRectLocal=n}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:i,c:s,d:r}=t;return(Math.abs(i)>1e-4||Math.abs(s)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(r)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(Gi.isMatrixRotated(e.worldTransform))return!1;if(Gi.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const i=t._scissorRectLocal;return i.width>0&&i.height>0}roundFrameToPixels(t,e,i,s,r){Gi.isMatrixRotated(r)||((r=r?Fi.copyFrom(r):Fi.identity()).translate(-i.x,-i.y).scale(s.width/i.width,s.height/i.height).translate(s.x,s.y),this.renderer.filter.transformAABB(r,t),t.fit(s),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&Ui.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let zi=Gi;zi.extension={type:X.RendererSystem,name:"scissor"},$.add(zi);class ji extends Oi{constructor(t){super(t),this.glConst=Y.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:i}=this.renderer,s=t._stencilCounter;0===s&&(this.renderer.framebuffer.forceStencil(),i.clearStencil(0),i.clear(i.STENCIL_BUFFER_BIT),i.enable(i.STENCIL_TEST)),t._stencilCounter++;const r=t._colorMask;0!==r&&(t._colorMask=0,i.colorMask(!1,!1,!1,!1)),i.stencilFunc(i.EQUAL,s,4294967295),i.stencilOp(i.KEEP,i.KEEP,i.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==r&&(t._colorMask=r,i.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const i=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,s=i?i._colorMask:15;0!==s&&(i._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==s&&(i._colorMask=s,e.colorMask(0!=(1&s),0!=(2&s),0!=(4&s),0!=(8&s))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}ji.extension={type:X.RendererSystem,name:"stencil"},$.add(ji);class Hi{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new at,this.transform=null}update(t,e,i,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,i,s),this.transform&&this.projectionMatrix.append(this.transform);const r=this.renderer;r.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,r.globalUniforms.update(),r.shader.shader&&r.shader.syncUniformGroup(r.shader.shader.uniforms.globals)}calculateProjection(t,e,i,s){const r=this.projectionMatrix,n=s?-1:1;r.identity(),r.a=1/e.width*2,r.d=n*(1/e.height*2),r.tx=-1-e.x*r.a,r.ty=-n-e.y*r.d}setTransform(t){}destroy(){this.renderer=null}}Hi.extension={type:X.RendererSystem,name:"projection"},$.add(Hi);const Yi=new tt,Xi=new tt;class Wi{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new tt,this.destinationFrame=new tt,this.viewportFrame=new tt}bind(t=null,e,i){const s=this.renderer;let r,n,a;this.current=t,t?(r=t.baseTexture,a=r.resolution,e||(Yi.width=t.frame.width,Yi.height=t.frame.height,e=Yi),i||(Xi.x=t.frame.x,Xi.y=t.frame.y,Xi.width=e.width,Xi.height=e.height,i=Xi),n=r.framebuffer):(a=s.resolution,e||(Yi.width=s._view.screen.width,Yi.height=s._view.screen.height,e=Yi),i||((i=Yi).width=e.width,i.height=e.height));const o=this.viewportFrame;o.x=i.x*a,o.y=i.y*a,o.width=i.width*a,o.height=i.height*a,t||(o.y=s.view.height-(o.y+o.height)),o.ceil(),this.renderer.framebuffer.bind(n,o),this.renderer.projection.update(i,e,a,!n),t?this.renderer.mask.setMaskStack(r.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(i)}clear(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.renderer.background.colorRgba;const i=this.destinationFrame,s=this.current?this.current.baseTexture:this.renderer._view.screen,r=i.width!==s.width||i.height!==s.height;if(r){let{x:t,y:e,width:i,height:s}=this.viewportFrame;t=Math.round(t),e=Math.round(e),i=Math.round(i),s=Math.round(s),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,i,s)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),r&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}function $i(t,e,i,s,r){i.buffer.update(r)}Wi.extension={type:X.RendererSystem,name:"renderTexture"},$.add(Wi);const Vi={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},qi={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};class Zi{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function Ki(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}function Ji(t){const e=new Array(t);for(let t=0;t<e.length;t++)e[t]=!1;return e}function Qi(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return Ji(2*e);case"bvec3":return Ji(3*e);case"bvec4":return Ji(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function ts(t,e){const i=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),s=t.getShaderInfoLog(e),r=s.split("\n"),n={},a=r.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||n[t]||(n[t]=!0,0)))),o=[""];a.forEach((t=>{i[t-1]=`%c${i[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const h=i.join("\n");o[0]=h,console.error(s),console.groupCollapsed("click to view full shader code"),console.warn(...o),console.groupEnd()}let es,is=0;const ss={textureCount:0,uboCount:0};class rs{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=is++}systemCheck(){if(!function(){if("boolean"==typeof es)return es;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");es=!0===t({a:"b"},"a","b")}catch(t){es=!1}return es}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const i=t.program,s=i.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==i&&(this.program=i,this.gl.useProgram(s.program)),e||(ss.textureCount=0,ss.uboCount=0,this.syncUniformGroup(t.uniformGroup,ss)),s}setUniforms(t){const e=this.shader.program,i=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(i.uniformData,t,this.renderer)}syncUniformGroup(t,e){const i=this.getGlProgram();t.static&&t.dirtyId===i.uniformDirtyGroups[t.id]||(i.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,i,e))}syncUniforms(t,e,i){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,i)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){const i=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const s in t.uniforms){const r=e[s];if(!r){t.uniforms[s]?.group&&(t.uniforms[s].ubo?i.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${s}, '${s}');\n                    `):i.push(`\n                        renderer.shader.syncUniformGroup(uv.${s}, syncData);\n                    `));continue}const n=t.uniforms[s];let a=!1;for(let t=0;t<Ti.length;t++)if(Ti[t].test(r,n)){i.push(Ti[t].code(s,n)),a=!0;break}if(!a){const t=(1!==r.size||r.isArray?wi:Ei)[r.type].replace("location",`ud["${s}"].location`);i.push(`\n            cu = ud["${s}"];\n            cv = cu.value;\n            v = uv["${s}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",i.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const i=this.getGlProgram();if(!t.static||0!==t.dirtyId||!i.uniformGroups[t.id]){t.dirtyId=0;const s=i.uniformGroups[t.id]||this.createSyncBufferGroup(t,i,e);t.buffer.update(),s(i.uniformData,t.uniforms,this.renderer,ss,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,i.uniformBufferBindings[e])}createSyncBufferGroup(t,e,i){const{gl:s}=this.renderer;this.renderer.buffer.bind(t.buffer);const r=this.gl.getUniformBlockIndex(e.program,i);e.uniformBufferBindings[i]=this.shader.uniformBindCount,s.uniformBlockBinding(e.program,r,this.shader.uniformBindCount),this.shader.uniformBindCount++;const n=this.getSignature(t,this.shader.program.uniformData,"ubo");let a=this._uboCache[n];if(a||(a=this._uboCache[n]=function(t,e){if(!t.autoManage)return{size:0,syncFunc:$i};const i=function(t,e){const i=[];for(const s in t)e[s]&&i.push(e[s]);return i.sort(((t,e)=>t.index-e.index)),i}(t.uniforms,e),{uboElements:s,size:r}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let i=0,s=0,r=0;for(let t=0;t<e.length;t++){const n=e[t];if(i=qi[n.data.type],n.data.size>1&&(i=Math.max(i,16)*n.data.size),n.dataLen=i,s%i!=0&&s<16){const t=s%i%16;s+=t,r+=t}s+i>16?(r=16*Math.ceil(r/16),n.offset=r,r+=i,s=i):(n.offset=r,s+=i,r+=i)}return r=16*Math.ceil(r/16),{uboElements:e,size:r}}(i),n=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let e=0;e<s.length;e++){const i=s[e],r=t.uniforms[i.data.name],a=i.data.name;let o=!1;for(let t=0;t<Ti.length;t++){const e=Ti[t];if(e.codeUbo&&e.test(i.data,r)){n.push(`offset = ${i.offset/4};`,Ti[t].codeUbo(i.data.name,r)),o=!0;break}}if(!o)if(i.data.size>1){const t=vi(i.data.type),e=Math.max(qi[i.data.type]/16,1),s=t/e,r=(4-s%4)%4;n.push(`\n                cv = ud.${a}.value;\n                v = uv.${a};\n                offset = ${i.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${i.data.size*e}; i++)\n                {\n                    for(var j = 0; j < ${s}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${r};\n                }\n\n                `)}else{const t=Vi[i.data.type];n.push(`\n                cv = ud.${a}.value;\n                v = uv.${a};\n                offset = ${i.offset/4};\n                ${t};\n                `)}}return n.push("\n       renderer.buffer.update(buffer);\n    "),{size:r,syncFunc:new Function("ud","uv","renderer","syncData","buffer",n.join("\n"))}}(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(a.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=a.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,i){const s=t.uniforms,r=[`${i}-`];for(const t in s)r.push(t),e[t]&&r.push(e[t].type);return r.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,i=t.program,s=function(t,e){const i=Ki(t,t.VERTEX_SHADER,e.vertexSrc),s=Ki(t,t.FRAGMENT_SHADER,e.fragmentSrc),r=t.createProgram();t.attachShader(r,i),t.attachShader(r,s);const n=e.extra?.transformFeedbackVaryings;if(n&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(r,n.names,"separate"===n.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)||function(t,e,i,s){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(i,t.COMPILE_STATUS)||ts(t,i),t.getShaderParameter(s,t.COMPILE_STATUS)||ts(t,s),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(e)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(e)))}(t,r,i,s),e.attributeData=function(t,e){const i={},s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<s;r++){const s=e.getActiveAttrib(t,r);if(s.name.startsWith("gl_"))continue;const n=bi(e,s.type),a={type:n,name:s.name,size:vi(n),location:e.getAttribLocation(t,s.name)};i[s.name]=a}return i}(r,t),e.uniformData=function(t,e){const i={},s=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<s;r++){const s=e.getActiveUniform(t,r),n=s.name.replace(/\[.*?\]$/,""),a=!!s.name.match(/\[.*?\]$/),o=bi(e,s.type);i[n]={name:n,index:r,type:o,size:s.size,isArray:a,value:Qi(o,s.size)}}return i}(r,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const i=Object.keys(e.attributeData);i.sort(((t,e)=>t>e?1:-1));for(let s=0;s<i.length;s++)e.attributeData[i[s]].location=s,t.bindAttribLocation(r,s,i[s]);t.linkProgram(r)}t.deleteShader(i),t.deleteShader(s);const a={};for(const i in e.uniformData){const s=e.uniformData[i];a[i]={location:t.getUniformLocation(r,i),value:Qi(s.type,s.size)}}return new Zi(r,a)}(e,i);return i.glPrograms[this.renderer.CONTEXT_UID]=s,s}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}rs.extension={type:X.RendererSystem,name:"shader"},$.add(rs);const ns=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=c.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new ki,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[c.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.ADD]=[t.ONE,t.ONE],e[c.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.NONE]=[0,0],e[c.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[c.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[c.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[c.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[c.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[c.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[c.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[c.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[c.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[c.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[c.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,i=0;for(;e;)1&e&&this.map[i].call(this,!!(t.data&1<<i)),e>>=1,i++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(ns.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(ns.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],i=this.gl;2===e.length?i.blendFunc(e[0],e[1]):i.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,i.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,i.blendEquationSeparate(i.FUNC_ADD,i.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const i=this.checks.indexOf(t);e&&-1===i?this.checks.push(t):e||-1===i||this.checks.splice(i,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let as=ns;as.extension={type:X.RendererSystem,name:"state"},$.add(as);class os{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=Y.GC_MAX_IDLE,this.checkCountMax=Y.GC_MAX_CHECK_COUNT,this.mode=Y.GC_MODE}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==b.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let i=!1;for(let s=0;s<e.length;s++){const r=e[s];!r.framebuffer&&this.count-r.touched>this.maxIdle&&(t.destroyTexture(r,!0),e[s]=null,i=!0)}if(i){let t=0;for(let i=0;i<e.length;i++)null!==e[i]&&(e[t++]=e[i]);e.length=t}}unload(t){const e=this.renderer.texture,i=t._texture;i&&!i.framebuffer&&e.destroyTexture(i);for(let e=t.children.length-1;e>=0;e--)this.unload(t.children[e])}destroy(){this.renderer=null}}os.extension={type:X.RendererSystem,name:"textureGC"},$.add(os);class hs{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=f.UNSIGNED_BYTE,this.internalFormat=d.RGBA,this.samplerType=0}}class ls{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new xe,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[f.UNSIGNED_BYTE]:{[d.RGBA]:t.RGBA8,[d.RGB]:t.RGB8,[d.RG]:t.RG8,[d.RED]:t.R8,[d.RGBA_INTEGER]:t.RGBA8UI,[d.RGB_INTEGER]:t.RGB8UI,[d.RG_INTEGER]:t.RG8UI,[d.RED_INTEGER]:t.R8UI,[d.ALPHA]:t.ALPHA,[d.LUMINANCE]:t.LUMINANCE,[d.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[f.BYTE]:{[d.RGBA]:t.RGBA8_SNORM,[d.RGB]:t.RGB8_SNORM,[d.RG]:t.RG8_SNORM,[d.RED]:t.R8_SNORM,[d.RGBA_INTEGER]:t.RGBA8I,[d.RGB_INTEGER]:t.RGB8I,[d.RG_INTEGER]:t.RG8I,[d.RED_INTEGER]:t.R8I},[f.UNSIGNED_SHORT]:{[d.RGBA_INTEGER]:t.RGBA16UI,[d.RGB_INTEGER]:t.RGB16UI,[d.RG_INTEGER]:t.RG16UI,[d.RED_INTEGER]:t.R16UI,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[f.SHORT]:{[d.RGBA_INTEGER]:t.RGBA16I,[d.RGB_INTEGER]:t.RGB16I,[d.RG_INTEGER]:t.RG16I,[d.RED_INTEGER]:t.R16I},[f.UNSIGNED_INT]:{[d.RGBA_INTEGER]:t.RGBA32UI,[d.RGB_INTEGER]:t.RGB32UI,[d.RG_INTEGER]:t.RG32UI,[d.RED_INTEGER]:t.R32UI,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[f.INT]:{[d.RGBA_INTEGER]:t.RGBA32I,[d.RGB_INTEGER]:t.RGB32I,[d.RG_INTEGER]:t.RG32I,[d.RED_INTEGER]:t.R32I},[f.FLOAT]:{[d.RGBA]:t.RGBA32F,[d.RGB]:t.RGB32F,[d.RG]:t.RG32F,[d.RED]:t.R32F,[d.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[f.HALF_FLOAT]:{[d.RGBA]:t.RGBA16F,[d.RGB]:t.RGB16F,[d.RG]:t.RG16F,[d.RED]:t.R16F},[f.UNSIGNED_SHORT_5_6_5]:{[d.RGB]:t.RGB565},[f.UNSIGNED_SHORT_4_4_4_4]:{[d.RGBA]:t.RGBA4},[f.UNSIGNED_SHORT_5_5_5_1]:{[d.RGBA]:t.RGB5_A1},[f.UNSIGNED_INT_2_10_10_10_REV]:{[d.RGBA]:t.RGB10_A2,[d.RGBA_INTEGER]:t.RGB10_A2UI},[f.UNSIGNED_INT_10F_11F_11F_REV]:{[d.RGB]:t.R11F_G11F_B10F},[f.UNSIGNED_INT_5_9_9_9_REV]:{[d.RGB]:t.RGB9_E5},[f.UNSIGNED_INT_24_8]:{[d.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[f.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[d.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[f.UNSIGNED_BYTE]:{[d.RGBA]:t.RGBA,[d.RGB]:t.RGB,[d.ALPHA]:t.ALPHA,[d.LUMINANCE]:t.LUMINANCE,[d.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[f.UNSIGNED_SHORT_5_6_5]:{[d.RGB]:t.RGB},[f.UNSIGNED_SHORT_4_4_4_4]:{[d.RGBA]:t.RGBA},[f.UNSIGNED_SHORT_5_5_5_1]:{[d.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let t=0;t<e;t++)this.boundTextures[t]=null;this.emptyTextures={};const i=new hs(t.createTexture());t.bindTexture(t.TEXTURE_2D,i.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=i,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new hs(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let e=0;e<6;e++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let t=0;t<this.boundTextures.length;t++)this.bind(null,t)}bind(t,e=0){const{gl:i}=this;if(t=t?.castToBaseTexture(),t?.valid&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),this.updateTexture(t)):s.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,this.emptyTextures[i.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:i}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<i.length;t++)i[t]===this.unknownTexture&&this.bind(null,t)}for(let s=0;s<i.length;s++)i[s]===t&&(this.currentLocation!==s&&(e.activeTexture(e.TEXTURE0+s),this.currentLocation=s),e.bindTexture(t.target,this.emptyTextures[t.target].texture),i[s]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:i,CONTEXT_UID:s}=this;if(i)for(let i=t-1;i>=0;--i){const t=e[i];t&&t._glTextures[s].samplerType!==m.FLOAT&&this.renderer.texture.unbind(t)}}initTexture(t){const e=new hs(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){e.internalFormat=this.internalFormats[t.type]?.[t.format]??t.format,2===this.webGLVersion&&t.type===f.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){const e=t._glTextures[this.CONTEXT_UID];if(!e)return;const i=this.renderer;if(this.initTextureType(t,e),t.resource?.upload(i,t,e))e.samplerType!==m.FLOAT&&(this.hasIntegerTextures=!0);else{const s=t.realWidth,r=t.realHeight,n=i.gl;(e.width!==s||e.height!==r||e.dirtyId<0)&&(e.width=s,e.height=r,n.texImage2D(t.target,0,e.internalFormat,s,r,0,t.format,e.type,null))}t.dirtyStyleId!==e.dirtyStyleId&&this.updateTextureStyle(t),e.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:i}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),i.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&Zt(this.managedTextures,e,1)}}updateTextureStyle(t){const e=t._glTextures[this.CONTEXT_UID];e&&(t.mipmap!==v.POW2&&2===this.webGLVersion||t.isPowerOfTwo?e.mipmap=t.mipmap>=1:e.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?e.wrapMode=t.wrapMode:e.wrapMode=g.CLAMP,t.resource?.style(this.renderer,t,e)||this.setStyle(t,e),e.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const i=this.gl;if(e.mipmap&&t.mipmap!==v.ON_MANUAL&&i.generateMipmap(t.target),i.texParameteri(t.target,i.TEXTURE_WRAP_S,e.wrapMode),i.texParameteri(t.target,i.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===_.LINEAR?i.LINEAR_MIPMAP_LINEAR:i.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===_.LINEAR){const s=Math.min(t.anisotropicLevel,i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));i.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,s)}}else i.texParameteri(t.target,i.TEXTURE_MIN_FILTER,t.scaleMode===_.LINEAR?i.LINEAR:i.NEAREST);i.texParameteri(t.target,i.TEXTURE_MAG_FILTER,t.scaleMode===_.LINEAR?i.LINEAR:i.NEAREST)}destroy(){this.renderer=null}}ls.extension={type:X.RendererSystem,name:"texture"},$.add(ls);const cs=new _t;class us{constructor(t){this.renderer=t,this._tempMatrix=new at}generateTexture(t,e){const{region:i,...s}=e||{},r=i||t.getLocalBounds(null,!0);0===r.width&&(r.width=1),0===r.height&&(r.height=1);const n=Ue.create({width:r.width,height:r.height,...s});this._tempMatrix.tx=-r.x,this._tempMatrix.ty=-r.y;const a=t.transform;return t.transform=cs,this.renderer.render(t,{renderTexture:n,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=a,n}destroy(){}}us.extension={type:[X.RendererSystem,X.CanvasRendererSystem],name:"textureGenerator"},$.add(us);class ds{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color="string"==typeof t.color?Lt(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=Nt(t),Bt(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}ds.extension={type:[X.RendererSystem,X.CanvasRendererSystem],name:"background"},$.add(ds);class ps{constructor(t){this.renderer=t}init(t){this.screen=new tt(0,0,t.width,t.height),this.element=t.view||Y.ADAPTER.createCanvas(),this.resolution=t.resolution||Y.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const i=this.element.width/this.resolution,s=this.element.height/this.resolution;this.screen.width=i,this.screen.height=s,this.autoDensity&&(this.element.style.width=`${i}px`,this.element.style.height=`${s}px`),this.renderer.emit("resize",i,s),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){t&&this.element.parentNode?.removeChild(this.element),this.renderer=null,this.element=null,this.screen=null}}ps.extension={type:[X.RendererSystem,X.CanvasRendererSystem],name:"_view"},$.add(ps);class fs{constructor(t){this.renderer=t,this.plugins={}}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}fs.extension={type:[X.RendererSystem,X.CanvasRendererSystem],name:"_plugin"},$.add(fs);class ms extends Tt{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),i=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const e of i)this.addSystem(t.systems[e],e)}addRunners(...t){t.forEach((t=>{this.runners[t]=new gt(t)}))}addSystem(t,e){const i=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=i,this._systemsHash[e]=i;for(const t in this.runners)this.runners[t].add(i);return this}emitWithCustomOptions(t,e){const i=Object.keys(this._systemsHash);t.items.forEach((s=>{const r=i.find((t=>this._systemsHash[t]===s));s[t.name](e[r])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}class _s{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello&&console.log(`PixiJS 7.0.4 - ${e.rendererLogId} - https://pixijs.com`),e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}_s.extension={type:[X.RendererSystem,X.CanvasRendererSystem],name:"startup"},$.add(_s);class gs{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glTransformFeedbacks[i]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,s)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:i,renderer:s}=this;e&&s.shader.bind(e),i.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:i,CONTEXT_UID:s}=this,r=e.createTransformFeedback();t._glTransformFeedbacks[s]=r,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r);for(let r=0;r<t.buffers.length;r++){const n=t.buffers[r];n&&(i.buffer.update(n),n._glBuffers[s].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,r,n._glBuffers[s].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),r}disposeTransformFeedback(t,e){const i=t._glTransformFeedbacks[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this);const r=this.renderer.buffer;if(r)for(let i=0;i<t.buffers.length;i++){const s=t.buffers[i];if(!s)continue;const n=s._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||r.dispose(s,e))}i&&(e||s.deleteTransformFeedback(i),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}gs.extension={type:X.RendererSystem,name:"transformFeedback"},$.add(gs);const vs=[];$.handleByList(X.Renderer,vs);const ys=class extends ms{constructor(t){super(),t=Object.assign({},Y.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new Je({projectionMatrix:new at},!0);const e={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:ys.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e);const i={hello:t.hello,_plugin:ys.__plugins,background:{alpha:t.backgroundAlpha,color:t.background??t.backgroundColor,clearBeforeRender:t.clearBeforeRender},_view:{height:t.height,width:t.width,autoDensity:t.autoDensity,resolution:t.resolution,view:t.view},context:{antialias:t.antialias,context:t.context,powerPreference:t.powerPreference,premultipliedAlpha:t.premultipliedAlpha??(t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha),preserveDrawingBuffer:t.preserveDrawingBuffer}};this.startup.run(i)}static test(t){return!t?.forceCanvas&&Dt()}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return this.background.clearBeforeRender}get useContextAlpha(){return this.context.useContextAlpha}get preserveDrawingBuffer(){return this.context.preserveDrawingBuffer}get backgroundColor(){return this.background.color}set backgroundColor(t){this.background.color=t}get backgroundAlpha(){return this.background.color}set backgroundAlpha(t){this.background.alpha=t}get powerPreference(){return this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let xs=ys;xs.extension={type:X.Renderer,priority:1},xs.__plugins={},xs.__systems={},$.handleByMap(X.RendererPlugin,xs.__plugins),$.handleByMap(X.RendererSystem,xs.__systems),$.add(xs);class bs{constructor(){this.texArray=null,this.blend=0,this.type=u.TRIANGLES,this.start=0,this.size=0,this.data=null}}class Ts{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class Es{constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}class ws{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let i=0;i<t;i++)e[i]=i;this.defaultGroupCache[t]=Je.from({uSamplers:e},!0);let i=this.fragTemplate;i=i.replace(/%count%/gi,`${t}`),i=i.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Ii(this.vertexSrc,i)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new at,default:this.defaultGroupCache[t]};return new Pi(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let i=0;i<t;i++)i>0&&(e+="\nelse "),i<t-1&&(e+=`if(vTextureId < ${i}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${i}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class Ss extends Ve{constructor(t=!1){super(),this._buffer=new He(null,t,!1),this._indexBuffer=new He(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,f.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,f.FLOAT).addAttribute("aColor",this._buffer,4,!0,f.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,f.FLOAT).addIndex(this._indexBuffer)}}const As=class extends si{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=Ss,this.vertexSize=6,this.state=ki.for2d(),this.size=4*Y.SPRITE_BATCH_SIZE,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=As.defaultVertexSrc,fragment:e=As.defaultFragmentTemplate}={}){this.shaderGenerator=new ws(t,e)}contextChange(){const t=this.renderer.gl;Y.PREFER_ENV===h.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),Y.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const i=e.createShader(e.FRAGMENT_SHADER);for(;;){const s=Si.replace(/%forloop%/gi,Ai(t));if(e.shaderSource(i,s),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=As,i=this.size/4,s=Math.floor(i/this.MAX_TEXTURES)+1;for(;t.length<i;)t.push(new bs);for(;e.length<s;)e.push(new Ts);for(let t=0;t<this.MAX_TEXTURES;t++)this._tempBoundTextures[t]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,MAX_TEXTURES:e}=this,i=As._textureArrayPool,s=this.renderer.batch,r=this._tempBoundTextures,n=this.renderer.textureGC.count;let a=++xe._globalBatch,o=0,h=i[0],l=0;s.copyBoundTextures(r,e);for(let c=0;c<this._bufferSize;++c){const u=t[c];t[c]=null,u._batchEnabled!==a&&(h.count>=e&&(s.boundArray(h,r,a,e),this.buildDrawCalls(h,l,c),l=c,h=i[++o],++a),u._batchEnabled=a,u.touched=n,h.elements[h.count++]=u)}h.count>0&&(s.boundArray(h,r,a,e),this.buildDrawCalls(h,l,this._bufferSize),++o,++a);for(let t=0;t<r.length;t++)r[t]=null;xe._globalBatch=a}buildDrawCalls(t,e,i){const{_bufferedElements:s,_attributeBuffer:r,_indexBuffer:n,vertexSize:a}=this,o=As._drawCallPool;let h=this._dcIndex,l=this._aIndex,c=this._iIndex,u=o[h];u.start=this._iIndex,u.texArray=t;for(let d=e;d<i;++d){const i=s[d],p=i._texture.baseTexture,f=Ft[p.alphaMode?1:0][i.blendMode];s[d]=null,e<d&&u.blend!==f&&(u.size=c-u.start,e=d,u=o[++h],u.texArray=t,u.start=c),this.packInterleavedGeometry(i,r,n,l,c),l+=i.vertexData.length/2*a,c+=i.indices.length,u.blend=f}e<i&&(u.size=c-u.start,++h),this._dcIndex=h,this._aIndex=l,this._iIndex=c}bindAndClearTexArray(t){const e=this.renderer.texture;for(let i=0;i<t.count;i++)e.bind(t.elements[i],t.ids[i]),t.elements[i]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:i}=this;Y.CAN_UPLOAD_SAME_BUFFER?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(i),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:i}=this.renderer,s=As._drawCallPool;let r=null;for(let n=0;n<t;n++){const{texArray:t,type:a,size:o,start:h,blend:l}=s[n];r!==t&&(r=t,this.bindAndClearTexArray(t)),this.state.blendMode=l,i.set(this.state),e.drawElements(a,o,e.UNSIGNED_SHORT,2*h)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.MAX_TEXTURES),this.renderer.shader.bind(this._shader),Y.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=$t(Math.ceil(t/8)),i=qt(e),s=8*e;this._aBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._aBuffers[s];return r||(this._aBuffers[s]=r=new Es(s*this.vertexSize*4)),r}getIndexBuffer(t){const e=$t(Math.ceil(t/12)),i=qt(e),s=12*e;this._iBuffers.length<=i&&(this._iBuffers.length=i+1);let r=this._iBuffers[i];return r||(this._iBuffers[i]=r=new Uint16Array(s)),r}packInterleavedGeometry(t,e,i,s,r){const{uint32View:n,float32View:a}=e,o=s/this.vertexSize,h=t.uvs,l=t.indices,c=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),p=d<1&&t._texture.baseTexture.alphaMode?zt(t._tintRGB,d):t._tintRGB+(255*d<<24);for(let t=0;t<c.length;t+=2)a[s++]=c[t],a[s++]=c[t+1],a[s++]=h[t],a[s++]=h[t+1],n[s++]=p,a[s++]=u;for(let t=0;t<l.length;t++)i[r++]=o+l[t]}};let Cs=As;Cs.extension={name:"batch",type:X.RendererPlugin},Cs._drawCallPool=[],Cs._textureArrayPool=[],$.add(Cs);class Rs{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Is{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);e.bindBuffer(t.type,s.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:i,CONTEXT_UID:s}=this;if(this.boundBufferBases[e]!==t){const r=t._glBuffers[s]||this.createGLBuffer(t);this.boundBufferBases[e]=t,i.bindBufferBase(i.UNIFORM_BUFFER,e,r.buffer)}}bindBufferRange(t,e,i){const{gl:s,CONTEXT_UID:r}=this;i=i||0;const n=t._glBuffers[r]||this.createGLBuffer(t);s.bindBufferRange(s.UNIFORM_BUFFER,e||0,n.buffer,256*i,256)}update(t){const{gl:e,CONTEXT_UID:i}=this,s=t._glBuffers[i]||this.createGLBuffer(t);if(t._updateID!==s.updateID)if(s.updateID=t._updateID,e.bindBuffer(t.type,s.buffer),s.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const i=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;s.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,i)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const i=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),i&&(e||s.deleteBuffer(i.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let i=0;i<e.length;i++)this.dispose(this.managedBuffers[e[i]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:i}=this;return t._glBuffers[e]=new Rs(i.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Is.extension={type:X.RendererSystem,name:"buffer"},$.add(Is);class Ps{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const i=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,i)}else{const i=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,i)}e>=w.HIGH?this.multisample=w.HIGH:e>=w.MEDIUM?this.multisample=w.MEDIUM:e>=w.LOW?this.multisample=w.LOW:this.multisample=w.NONE}destroy(){}}Ps.extension={type:X.RendererSystem,name:"_multisample"},$.add(Ps);class ks{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;let s,r,n,a;if(e&&(s=e.renderTexture,r=e.clear,n=e.transform,a=e.skipUpdateTransform),this.renderingToScreen=!s,i.runners.prerender.emit(),i.emit("prerender"),i.projection.transform=n,!i.context.isLost){if(s||(this.lastObjectRendered=t),!a){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}i.renderTexture.bind(s),i.batch.currentRenderer.start(),(r??i.background.clearBeforeRender)&&i.renderTexture.clear(),t.render(i),i.batch.currentRenderer.flush(),s&&(e.blit&&i.framebuffer.blit(),s.baseTexture.update()),i.runners.postrender.emit(),i.projection.transform=null,i.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}ks.extension={type:X.RendererSystem,name:"objectRenderer"},$.add(ks),Y.SORTABLE_CHILDREN=!1;class Ds{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?tt.EMPTY:((t=t||new tt(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:i,b:s,c:r,d:n,tx:a,ty:o}=t,h=i*e.x+r*e.y+a,l=s*e.x+n*e.y+o;this.minX=Math.min(this.minX,h),this.maxX=Math.max(this.maxX,h),this.minY=Math.min(this.minY,l),this.maxY=Math.max(this.maxY,l)}addQuad(t){let e=this.minX,i=this.minY,s=this.maxX,r=this.maxY,n=t[0],a=t[1];e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,r=a>r?a:r,n=t[2],a=t[3],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,r=a>r?a:r,n=t[4],a=t[5],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,r=a>r?a:r,n=t[6],a=t[7],e=n<e?n:e,i=a<i?a:i,s=n>s?n:s,r=a>r?a:r,this.minX=e,this.minY=i,this.maxX=s,this.maxY=r}addFrame(t,e,i,s,r){this.addFrameMatrix(t.worldTransform,e,i,s,r)}addFrameMatrix(t,e,i,s,r){const n=t.a,a=t.b,o=t.c,h=t.d,l=t.tx,c=t.ty;let u=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=n*e+o*i+l,_=a*e+h*i+c;u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*s+o*i+l,_=a*s+h*i+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*e+o*r+l,_=a*e+h*r+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,m=n*s+o*r+l,_=a*s+h*r+c,u=m<u?m:u,d=_<d?_:d,p=m>p?m:p,f=_>f?_:f,this.minX=u,this.minY=d,this.maxX=p,this.maxY=f}addVertexData(t,e,i){let s=this.minX,r=this.minY,n=this.maxX,a=this.maxY;for(let o=e;o<i;o+=2){const e=t[o],i=t[o+1];s=e<s?e:s,r=i<r?i:r,n=e>n?e:n,a=i>a?i:a}this.minX=s,this.minY=r,this.maxX=n,this.maxY=a}addVertices(t,e,i,s){this.addVerticesMatrix(t.worldTransform,e,i,s)}addVerticesMatrix(t,e,i,s,r=0,n=r){const a=t.a,o=t.b,h=t.c,l=t.d,c=t.tx,u=t.ty;let d=this.minX,p=this.minY,f=this.maxX,m=this.maxY;for(let t=i;t<s;t+=2){const i=e[t],s=e[t+1],_=a*i+h*s+c,g=l*s+o*i+u;d=Math.min(d,_-r),f=Math.max(f,_+r),p=Math.min(p,g-n),m=Math.max(m,g+n)}this.minX=d,this.minY=p,this.maxX=f,this.maxY=m}addBounds(t){const e=this.minX,i=this.minY,s=this.maxX,r=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<i?t.minY:i,this.maxX=t.maxX>s?t.maxX:s,this.maxY=t.maxY>r?t.maxY:r}addBoundsMask(t,e){const i=t.minX>e.minX?t.minX:e.minX,s=t.minY>e.minY?t.minY:e.minY,r=t.maxX<e.maxX?t.maxX:e.maxX,n=t.maxY<e.maxY?t.maxY:e.maxY;if(i<=r&&s<=n){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=i<t?i:t,this.minY=s<e?s:e,this.maxX=r>a?r:a,this.maxY=n>o?n:o}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const i=t.minX>e.x?t.minX:e.x,s=t.minY>e.y?t.minY:e.y,r=t.maxX<e.x+e.width?t.maxX:e.x+e.width,n=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(i<=r&&s<=n){const t=this.minX,e=this.minY,a=this.maxX,o=this.maxY;this.minX=i<t?i:t,this.minY=s<e?s:e,this.maxX=r>a?r:a,this.maxY=n>o?n:o}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,i,s,r,n){t-=r,e-=n,i+=r,s+=n,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>i?this.maxX:i,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>s?this.maxY:s}}class Ms extends Tt{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new _t,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ds,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const s=e[i];Object.defineProperty(Ms.prototype,s,Object.getOwnPropertyDescriptor(t,s))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new tt),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new tt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ds);const e=this.transform,i=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const s=this._bounds,r=this._boundsID;this._bounds=this._localBounds;const n=this.getBounds(!1,t);return this.parent=i,this.transform=e,this._bounds=s,this._bounds.updateID+=this._boundsID-r,n}toGlobal(t,e,i=!1){return i||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,i,s){return e&&(t=e.toGlobal(t,i,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,i)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){this.parent?.removeChild(this)}setTransform(t=0,e=0,i=1,s=1,r=0,n=0,a=0,o=0,h=0){return this.position.x=t,this.position.y=e,this.scale.x=i||1,this.scale.y=s||1,this.rotation=r,this.skew.x=n,this.skew.y=a,this.pivot.x=o,this.pivot.y=h,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new Bs),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*q}set angle(t){this.transform.rotation=t*Z}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class Bs extends Ms{constructor(){super(...arguments),this.sortDirty=null}}function Ns(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}Ms.prototype.displayObjectUpdateTransform=Ms.prototype.updateTransform;class Ls extends Ms{constructor(){super(),this.children=[],this.sortableChildren=Y.SORTABLE_CHILDREN,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const i=this.getChildIndex(t),s=this.getChildIndex(e);this.children[i]=e,this.children[s]=t,this.onChildrenChange(i<s?i:s)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const i=this.getChildIndex(t);Zt(this.children,i,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,Zt(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,Zt(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const i=t,s=e-i;let r;if(s>0&&s<=e){r=this.children.splice(i,s);for(let t=0;t<r.length;++t)r[t].parent=null,r[t].transform&&(r[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<r.length;++t)r[t].emit("removed",this),this.emit("childRemoved",r[t],this,t);return r}if(0===s&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e];i._lastSortedIndex=e,t||0===i.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(Ns),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const i=super.getLocalBounds(t);if(!e)for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}return i}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let i,s;if(this.cullArea?(i=this.cullArea,s=this.worldTransform):this._render!==Ls.prototype._render&&(i=this.getBounds(!0)),i&&e.intersects(i,s))this._render(t);else if(this.cullArea)return;for(let e=0,i=this.children.length;e<i;++e){const i=this.children[e],s=i.cullable;i.cullable=s||!this.cullArea,i.render(t),i.cullable=s}}render(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters?.length)this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}}renderAdvanced(t){const e=this.filters,i=this._mask;if(e){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<e.length;t++)e[t].enabled&&this._enabledFilters.push(e[t])}const s=e&&this._enabledFilters?.length||i&&(!i.isMaskData||i.enabled&&(i.autoDetect||i.type!==E.NONE));if(s&&t.batch.flush(),e&&this._enabledFilters?.length&&t.filter.push(this,this._enabledFilters),i&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].render(t)}s&&t.batch.flush(),i&&t.mask.pop(this),e&&this._enabledFilters?.length&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:t?.children,i=this.removeChildren(0,this.children.length);if(e)for(let e=0;e<i.length;++e)i[e].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}}Ls.prototype.containerUpdateTransform=Ls.prototype.updateTransform;const Os=new J,Fs=new Uint16Array([0,1,2,0,2,3]);class Us extends Ls{constructor(t){super(),this._anchor=new nt(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=c.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||Fe.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Fs,this.pluginName="batch",this.isSprite=!0,this._roundPixels=Y.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Kt(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Kt(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,n=e.d,a=e.tx,o=e.ty,h=this.vertexData,l=t.trim,c=t.orig,u=this._anchor;let d=0,p=0,f=0,m=0;if(l?(p=l.x-u._x*c.width,d=p+l.width,m=l.y-u._y*c.height,f=m+l.height):(p=-u._x*c.width,d=p+c.width,m=-u._y*c.height,f=m+c.height),h[0]=i*p+r*m+a,h[1]=n*m+s*p+o,h[2]=i*d+r*m+a,h[3]=n*m+s*d+o,h[4]=i*d+r*f+a,h[5]=n*f+s*d+o,h[6]=i*p+r*f+a,h[7]=n*f+s*p+o,this._roundPixels){const t=Y.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,i=t.orig,s=this._anchor,r=this.transform.worldTransform,n=r.a,a=r.b,o=r.c,h=r.d,l=r.tx,c=r.ty,u=-s._x*i.width,d=u+i.width,p=-s._y*i.height,f=p+i.height;e[0]=n*u+o*p+l,e[1]=h*p+a*u+c,e[2]=n*d+o*p+l,e[3]=h*p+a*d+c,e[4]=n*d+o*f+l,e[5]=h*f+a*d+c,e[6]=n*u+o*f+l,e[7]=h*f+a*u+c}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Ds),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new tt),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Os);const e=this._texture.orig.width,i=this._texture.orig.height,s=-e*this.anchor.x;let r=0;return Os.x>=s&&Os.x<s+e&&(r=-i*this.anchor.y,Os.y>=r&&Os.y<r+i)}destroy(t){if(super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t?.texture){const e="boolean"==typeof t?t:t?.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const i=t instanceof Fe?t:Fe.from(t,e);return new Us(i)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=Kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=Kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||Fe.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const Gs=new J;class zs extends Us{constructor(t,e=100,i=100){super(t),this.tileTransform=new _t,this._width=e,this._height=i,this.uvMatrix=this.texture.uvMatrix||new Bi(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}get clampMargin(){return this.uvMatrix.clampMargin}set clampMargin(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)}get tileScale(){return this.tileTransform.scale}set tileScale(t){this.tileTransform.scale.copyFrom(t)}get tilePosition(){return this.tileTransform.position}set tilePosition(t){this.tileTransform.position.copyFrom(t)}_onTextureUpdate(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215}_render(t){const e=this._texture;e&&e.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))}_calculateBounds(){const t=this._width*-this._anchor._x,e=this._height*-this._anchor._y,i=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,e,i,s)}getLocalBounds(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new tt),t=this._localBoundsRect),this._bounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,Gs);const e=this._width,i=this._height,s=-e*this.anchor._x;if(Gs.x>=s&&Gs.x<s+e){const t=-i*this.anchor._y;if(Gs.y>=t&&Gs.y<t+i)return!0}return!1}destroy(t){super.destroy(t),this.tileTransform=null,this.uvMatrix=null}static from(t,e){const i=t instanceof Fe?t:Fe.from(t,e);return new zs(i,e.width,e.height)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}}var js="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const Hs=new at;class Ys extends si{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new Ze,this.state=ki.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=Pi.from(js,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?Pi.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):Pi.from(js,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,i=this.quad;let s=i.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y);const r=t.uvRespectAnchor?t.anchor.x:0,n=t.uvRespectAnchor?t.anchor.y:0;s=i.uvs,s[0]=s[6]=-r,s[1]=s[3]=-n,s[2]=s[4]=1-r,s[5]=s[7]=1-n,i.invalidate();const a=t._texture,o=a.baseTexture,h=o.alphaMode>0,l=t.tileTransform.localTransform,c=t.uvMatrix;let u=o.isPowerOfTwo&&a.frame.width===o.width&&a.frame.height===o.height;u&&(o._glTextures[e.CONTEXT_UID]?u=o.wrapMode!==g.CLAMP:o.wrapMode===g.CLAMP&&(o.wrapMode=g.REPEAT));const d=u?this.simpleShader:this.shader,p=a.width,f=a.height,m=t._width,_=t._height;Hs.set(l.a*p/m,l.b*p/_,l.c*f/m,l.d*f/_,l.tx/m,l.ty/_),Hs.invert(),u?Hs.prepend(c.mapCoord):(d.uniforms.uMapCoord=c.mapCoord.toArray(!0),d.uniforms.uClampFrame=c.uClampFrame,d.uniforms.uClampOffset=c.uClampOffset),d.uniforms.uTransform=Hs.toArray(!0),d.uniforms.uColor=jt(t.tint,t.worldAlpha,d.uniforms.uColor,h),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=a,e.shader.bind(d),e.geometry.bind(i),this.state.blendMode=Ut(t.blendMode,h),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}Ys.extension={name:"tilingSprite",type:X.RendererPlugin},$.add(Ys);const{deprecation:Xs}=t,Ws=class extends ms{constructor(t){super(),this.rendererLogId="Canvas",t=Object.assign({},Y.RENDER_OPTIONS,t);const e={runners:["init","destroy","contextChange","reset","update","postrender","prerender","resize"],systems:Ws.__systems,priority:["textureGenerator","background","_view","_plugin","startup","mask","canvasContext","objectRenderer"]};this.setup(e);const i={hello:t.hello,_plugin:Ws.__plugins,background:{alpha:t.backgroundAlpha,color:t.background??t.backgroundColor,clearBeforeRender:t.clearBeforeRender},_view:{height:t.height,width:t.width,autoDensity:t.autoDensity,resolution:t.resolution}};this.startup.run(i)}static test(){return!0}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}reset(){}render(t,e){this.objectRenderer.render(t,e)}clear(){this.canvasContext.clear()}destroy(t){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}resize(t,e){this._view.resizeView(t,e)}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get clearBeforeRender(){return this.background.clearBeforeRender}get blendModes(){return this.canvasContext.blendModes}get maskManager(){return Xs("7.0.0","renderer.maskManager has been deprecated, please use renderer.mask instead"),this.mask}get refresh(){return!0}get rootContext(){return this.canvasContext.rootContext}get context(){return this.canvasContext.activeContext}get smoothProperty(){return this.canvasContext.smoothProperty}setBlendMode(t,e){this.canvasContext.setBlendMode(t,e)}invalidateBlendMode(){this.canvasContext.invalidateBlendMode()}setContextTransform(t,e,i){this.canvasContext.setContextTransform(t,e,i)}get backgroundColor(){return this.background.color}set backgroundColor(t){this.background.color=t}get backgroundAlpha(){return this.background.color}set backgroundAlpha(t){this.background.alpha=t}get preserveDrawingBuffer(){return!1}get useContextAlpha(){return!1}};let $s=Ws;$s.extension={type:X.Renderer,priority:0},$s.__plugins={},$s.__systems={},$.handleByMap(X.CanvasRendererPlugin,$s.__plugins),$.handleByMap(X.CanvasRendererSystem,$s.__systems),$.add($s);class Vs{constructor(t){this._foundShapes=[],this.renderer=t}pushMask(t){const e=this.renderer,i=t.maskObject||t;e.canvasContext.activeContext.save();const s=this._foundShapes;if(this.recursiveFindShapes(i,s),s.length>0){const t=e.canvasContext.activeContext;t.beginPath();for(let t=0;t<s.length;t++){const e=s[t],i=e.transform.worldTransform;this.renderer.canvasContext.setContextTransform(i),this.renderGraphicsShape(e)}s.length=0,t.clip()}}recursiveFindShapes(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);const{children:i}=t;if(i)for(let t=0;t<i.length;t++)this.recursiveFindShapes(i[t],e)}renderGraphicsShape(t){t.finishPoly();const e=this.renderer.canvasContext.activeContext,i=t.geometry.graphicsData,s=i.length;if(0!==s)for(let t=0;t<s;t++){const s=i[t],r=s.shape;if(r.type===K.POLY){let t=r.points;const i=s.holes;let n,a,o,h;e.moveTo(t[0],t[1]);for(let i=1;i<t.length/2;i++)e.lineTo(t[2*i],t[2*i+1]);if(i.length>0){n=0,o=t[0],h=t[1];for(let e=2;e+2<t.length;e+=2)n+=(t[e]-o)*(t[e+3]-h)-(t[e+2]-o)*(t[e+1]-h);for(let s=0;s<i.length;s++)if(t=i[s].shape.points,t){a=0,o=t[0],h=t[1];for(let e=2;e+2<t.length;e+=2)a+=(t[e]-o)*(t[e+3]-h)-(t[e+2]-o)*(t[e+1]-h);if(a*n<0){e.moveTo(t[0],t[1]);for(let i=2;i<t.length;i+=2)e.lineTo(t[i],t[i+1])}else{e.moveTo(t[t.length-2],t[t.length-1]);for(let i=t.length-4;i>=0;i-=2)e.lineTo(t[i],t[i+1])}i[s].shape.closeStroke&&e.closePath()}}t[0]===t[t.length-2]&&t[1]===t[t.length-1]&&e.closePath()}else if(r.type===K.RECT)e.rect(r.x,r.y,r.width,r.height),e.closePath();else if(r.type===K.CIRC)e.arc(r.x,r.y,r.radius,0,2*Math.PI),e.closePath();else if(r.type===K.ELIP){const t=2*r.width,i=2*r.height,s=r.x-t/2,n=r.y-i/2,a=.5522848,o=t/2*a,h=i/2*a,l=s+t,c=n+i,u=s+t/2,d=n+i/2;e.moveTo(s,d),e.bezierCurveTo(s,d-h,u-o,n,u,n),e.bezierCurveTo(u+o,n,l,d-h,l,d),e.bezierCurveTo(l,d+h,u+o,c,u,c),e.bezierCurveTo(u-o,c,s,d+h,s,d),e.closePath()}else if(r.type===K.RREC){const t=r.x,i=r.y,s=r.width,n=r.height;let a=r.radius;const o=Math.min(s,n)/2;a=a>o?o:a,e.moveTo(t,i+a),e.lineTo(t,i+n-a),e.quadraticCurveTo(t,i+n,t+a,i+n),e.lineTo(t+s-a,i+n),e.quadraticCurveTo(t+s,i+n,t+s,i+n-a),e.lineTo(t+s,i+a),e.quadraticCurveTo(t+s,i,t+s-a,i),e.lineTo(t+a,i),e.quadraticCurveTo(t,i,t,i+a),e.closePath()}}}popMask(t){t.canvasContext.activeContext.restore(),t.canvasContext.invalidateBlendMode()}destroy(){}}Vs.extension={type:X.CanvasRendererSystem,name:"mask"},$.add(Vs);class qs{constructor(t){this.renderer=t}render(t,e){const i=this.renderer;if(!i.view)return;const s=i.canvasContext;let r,n,a,o;e&&(r=e.renderTexture,n=e.clear,a=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!r,i.emit("prerender");const h=i.resolution;r?(r=r.castToBaseTexture(),r._canvasRenderTarget||(r._canvasRenderTarget=new oe(r.width,r.height,r.resolution),r.resource=new Ee(r._canvasRenderTarget.canvas),r.valid=!0),s.activeContext=r._canvasRenderTarget.context,i.canvasContext.activeResolution=r._canvasRenderTarget.resolution):(s.activeContext=s.rootContext,s.activeResolution=h);const l=s.activeContext;if(s._projTransform=a||null,r||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}if(l.save(),l.setTransform(1,0,0,1,0,0),l.globalAlpha=1,s._activeBlendMode=c.NORMAL,s._outerBlend=!1,l.globalCompositeOperation=s.blendModes[c.NORMAL],n??i.background.clearBeforeRender)if(this.renderingToScreen){l.clearRect(0,0,i.width,i.height);const t=i.background;t.alpha>0&&(l.globalAlpha=t.alpha,l.fillStyle=t.colorString,l.fillRect(0,0,i.width,i.height),l.globalAlpha=1)}else{r._canvasRenderTarget.clear();const t=r.clearColor;t[3]>0&&(l.globalAlpha=t[3]??1,l.fillStyle=Nt(Ot(t)),l.fillRect(0,0,r.realWidth,r.realHeight),l.globalAlpha=1)}const u=s.activeContext;s.activeContext=l,t.renderCanvas(i),s.activeContext=u,l.restore(),s.activeResolution=h,s._projTransform=null,i.emit("postrender")}destroy(){this.lastObjectRendered=null,this.render=null}}function Zs(t){const e=Y.ADAPTER.createCanvas(6,1),i=e.getContext("2d");return i.fillStyle=t,i.fillRect(0,0,6,1),e}function Ks(){if("undefined"==typeof document)return!1;const t=Zs("#ff00ff"),e=Zs("#ffff00"),i=Y.ADAPTER.createCanvas(6,1).getContext("2d");i.globalCompositeOperation="multiply",i.drawImage(t,0,0),i.drawImage(e,2,0);const s=i.getImageData(2,0,1,1);if(!s)return!1;const r=s.data;return 255===r[0]&&0===r[1]&&0===r[2]}qs.extension={type:X.CanvasRendererSystem,name:"objectRenderer"},$.add(qs);const Js=new at;class Qs{constructor(t){this.activeResolution=1,this.smoothProperty="imageSmoothingEnabled",this.blendModes=function(t=[]){return Ks()?(t[c.NORMAL]="source-over",t[c.ADD]="lighter",t[c.MULTIPLY]="multiply",t[c.SCREEN]="screen",t[c.OVERLAY]="overlay",t[c.DARKEN]="darken",t[c.LIGHTEN]="lighten",t[c.COLOR_DODGE]="color-dodge",t[c.COLOR_BURN]="color-burn",t[c.HARD_LIGHT]="hard-light",t[c.SOFT_LIGHT]="soft-light",t[c.DIFFERENCE]="difference",t[c.EXCLUSION]="exclusion",t[c.HUE]="hue",t[c.SATURATION]="saturation",t[c.COLOR]="color",t[c.LUMINOSITY]="luminosity"):(t[c.NORMAL]="source-over",t[c.ADD]="lighter",t[c.MULTIPLY]="source-over",t[c.SCREEN]="source-over",t[c.OVERLAY]="source-over",t[c.DARKEN]="source-over",t[c.LIGHTEN]="source-over",t[c.COLOR_DODGE]="source-over",t[c.COLOR_BURN]="source-over",t[c.HARD_LIGHT]="source-over",t[c.SOFT_LIGHT]="source-over",t[c.DIFFERENCE]="source-over",t[c.EXCLUSION]="source-over",t[c.HUE]="source-over",t[c.SATURATION]="source-over",t[c.COLOR]="source-over",t[c.LUMINOSITY]="source-over"),t[c.NORMAL_NPM]=t[c.NORMAL],t[c.ADD_NPM]=t[c.ADD],t[c.SCREEN_NPM]=t[c.SCREEN],t[c.SRC_IN]="source-in",t[c.SRC_OUT]="source-out",t[c.SRC_ATOP]="source-atop",t[c.DST_OVER]="destination-over",t[c.DST_IN]="destination-in",t[c.DST_OUT]="destination-out",t[c.DST_ATOP]="destination-atop",t[c.XOR]="xor",t[c.SUBTRACT]="source-over",t}(),this._activeBlendMode=null,this._projTransform=null,this._outerBlend=!1,this.renderer=t}init(){const t=this.renderer.background.alpha<1;if(this.rootContext=this.renderer.view.getContext("2d",{alpha:t}),this.activeContext=this.rootContext,!this.rootContext.imageSmoothingEnabled){const t=this.rootContext;t.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":t.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":t.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":t.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")}}setContextTransform(t,e,i){let s=t;const r=this._projTransform,n=this.activeResolution;i=i||n,r&&(s=Js,s.copyFrom(t),s.prepend(r)),e?this.activeContext.setTransform(s.a*i,s.b*i,s.c*i,s.d*i,s.tx*n|0,s.ty*n|0):this.activeContext.setTransform(s.a*i,s.b*i,s.c*i,s.d*i,s.tx*n,s.ty*n)}clear(t,e){const{activeContext:i,renderer:s}=this;t=t??this.renderer.background.colorString,i.clearRect(0,0,s.width,s.height),t&&(i.globalAlpha=e??this.renderer.background.alpha,i.fillStyle=t,i.fillRect(0,0,s.width,s.height),i.globalAlpha=1)}setBlendMode(t,e){const i=t===c.SRC_IN||t===c.SRC_OUT||t===c.DST_IN||t===c.DST_ATOP;!e&&i&&(t=c.NORMAL),this._activeBlendMode!==t&&(this._activeBlendMode=t,this._outerBlend=i,this.activeContext.globalCompositeOperation=this.blendModes[t])}resize(){this.smoothProperty&&(this.rootContext[this.smoothProperty]=Y.SCALE_MODE===_.LINEAR)}invalidateBlendMode(){this._activeBlendMode=this.blendModes.indexOf(this.activeContext.globalCompositeOperation)}destroy(){this.renderer=null,this.rootContext=null,this.activeContext=null,this.smoothProperty=null}}Qs.extension={type:X.CanvasRendererSystem,name:"canvasContext"},$.add(Qs);const tr={canvas:null,getTintedCanvas:(t,e)=>{const i=t.texture,s=`#${`00000${(0|(e=tr.roundColor(e))).toString(16)}`.slice(-6)}`;i.tintCache=i.tintCache||{};const r=i.tintCache[s];let n;if(r){if(r.tintId===i._updateID)return i.tintCache[s];n=i.tintCache[s]}else n=Y.ADAPTER.createCanvas();if(tr.tintMethod(i,e,n),n.tintId=i._updateID,tr.convertTintToImage&&void 0!==n.toDataURL){const t=new Image;t.src=n.toDataURL(),i.tintCache[s]=t}else i.tintCache[s]=n;return n},getTintedPattern:(t,e)=>{const i=`#${`00000${(0|(e=tr.roundColor(e))).toString(16)}`.slice(-6)}`;t.patternCache=t.patternCache||{};let s=t.patternCache[i];return s?.tintId===t._updateID||(tr.canvas||(tr.canvas=Y.ADAPTER.createCanvas()),tr.tintMethod(t,e,tr.canvas),s=tr.canvas.getContext("2d").createPattern(tr.canvas,"repeat"),s.tintId=t._updateID,t.patternCache[i]=s),s},tintWithMultiply:(t,e,i)=>{const s=i.getContext("2d"),r=t._frame.clone(),n=t.baseTexture.resolution;r.x*=n,r.y*=n,r.width*=n,r.height*=n,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),s.save(),s.fillStyle=`#${`00000${(0|e).toString(16)}`.slice(-6)}`,s.fillRect(0,0,r.width,r.height),s.globalCompositeOperation="multiply";const a=t.baseTexture.getDrawableSource();s.drawImage(a,r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.globalCompositeOperation="destination-atop",s.drawImage(a,r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.restore()},tintWithOverlay:(t,e,i)=>{const s=i.getContext("2d"),r=t._frame.clone(),n=t.baseTexture.resolution;r.x*=n,r.y*=n,r.width*=n,r.height*=n,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),s.save(),s.globalCompositeOperation="copy",s.fillStyle=`#${`00000${(0|e).toString(16)}`.slice(-6)}`,s.fillRect(0,0,r.width,r.height),s.globalCompositeOperation="destination-atop",s.drawImage(t.baseTexture.getDrawableSource(),r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.restore()},tintWithPerPixel:(t,e,i)=>{const s=i.getContext("2d"),r=t._frame.clone(),n=t.baseTexture.resolution;r.x*=n,r.y*=n,r.width*=n,r.height*=n,i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),s.save(),s.globalCompositeOperation="copy",s.drawImage(t.baseTexture.getDrawableSource(),r.x,r.y,r.width,r.height,0,0,r.width,r.height),s.restore();const a=Bt(e),o=a[0],h=a[1],l=a[2],c=s.getImageData(0,0,r.width,r.height),u=c.data;for(let t=0;t<u.length;t+=4)u[t+0]*=o,u[t+1]*=h,u[t+2]*=l;s.putImageData(c,0,0)},roundColor:t=>{const e=tr.cacheStepsPerColorChannel,i=Bt(t);return i[0]=Math.min(255,i[0]/e*e),i[1]=Math.min(255,i[1]/e*e),i[2]=Math.min(255,i[2]/e*e),Ot(i)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Ks(),tintMethod:null};tr.tintMethod=tr.canUseMultiply?tr.tintWithMultiply:tr.tintWithPerPixel,xe.prototype.getDrawableSource=function(){const t=this.resource;return t?t.bitmap||t.source:null},Be.prototype._canvasRenderTarget=null,Fe.prototype.patternCache=null,Fe.prototype.tintCache=null;const er=new at,ir=new at,sr=[new J,new J,new J,new J];zs.prototype._renderCanvas=function(t){const e=this._texture;if(!e.baseTexture.valid)return;const i=t.canvasContext.activeContext,s=this.worldTransform,r=e.baseTexture,n=r.getDrawableSource(),a=r.resolution;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;const t=new oe(e._frame.width,e._frame.height,a);16777215!==this.tint?(this._tintedCanvas=tr.getTintedCanvas(this,this.tint),t.context.drawImage(this._tintedCanvas,0,0)):t.context.drawImage(n,-e._frame.x*a,-e._frame.y*a),this._cachedTint=this.tint,this._canvasPattern=t.context.createPattern(t.canvas,"repeat")}i.globalAlpha=this.worldAlpha,t.canvasContext.setBlendMode(this.blendMode),this.tileTransform.updateLocalTransform();const o=this.tileTransform.localTransform,h=this._width,l=this._height;er.identity(),ir.copyFrom(o),this.uvRespectAnchor||ir.translate(-this.anchor.x*h,-this.anchor.y*l),ir.scale(this.tileScale.x/a,this.tileScale.y/a),er.prepend(ir),er.prepend(s),t.canvasContext.setContextTransform(er),i.fillStyle=this._canvasPattern;const c=this.anchor.x*-h,u=this.anchor.y*-l;sr[0].set(c,u),sr[1].set(c+h,u),sr[2].set(c+h,u+l),sr[3].set(c,u+l);for(let t=0;t<4;t++)ir.applyInverse(sr[t],sr[t]);i.beginPath(),i.moveTo(sr[0].x,sr[0].y);for(let t=1;t<4;t++)i.lineTo(sr[t].x,sr[t].y);i.closePath(),i.fill()};class rr{constructor(t,e,i){this.geometry=new Ve,this.indexBuffer=null,this.size=i,this.dynamicProperties=[],this.staticProperties=[];for(let i=0;i<t.length;++i){let s=t[i];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||f.FLOAT,offset:s.offset},e[i]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new He(Ht(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let t=0;t<this.dynamicProperties.length;++t){const i=this.dynamicProperties[t];i.offset=e,e+=i.size,this.dynamicStride+=i.size}const i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new He(this.dynamicData,!1,!1);let s=0;this.staticStride=0;for(let t=0;t<this.staticProperties.length;++t){const e=this.staticProperties[t];e.offset=s,s+=e.size,this.staticStride+=e.size}const r=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(r),this.staticDataUint32=new Uint32Array(r),this.staticBuffer=new He(this.staticData,!0,!1);for(let e=0;e<this.dynamicProperties.length;++e){const i=this.dynamicProperties[e];t.addAttribute(i.attributeName,this.dynamicBuffer,0,i.type===f.UNSIGNED_BYTE,i.type,4*this.dynamicStride,4*i.offset)}for(let e=0;e<this.staticProperties.length;++e){const i=this.staticProperties[e];t.addAttribute(i.attributeName,this.staticBuffer,0,i.type===f.UNSIGNED_BYTE,i.type,4*this.staticStride,4*i.offset)}}uploadDynamic(t,e,i){for(let s=0;s<this.dynamicProperties.length;s++){const r=this.dynamicProperties[s];r.uploadFunction(t,e,i,r.type===f.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,r.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,i){for(let s=0;s<this.staticProperties.length;s++){const r=this.staticProperties[s];r.uploadFunction(t,e,i,r.type===f.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,r.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class nr extends si{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new at,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:f.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=Pi.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=ki.for2d()}render(t){const e=t.children,i=t._maxSize,s=t._batchSize,r=this.renderer;let n=e.length;if(0===n)return;n>i&&!t.autoResize&&(n=i);let a=t._buffers;a||(a=t._buffers=this.generateBuffers(t));const o=e[0]._texture.baseTexture,h=o.alphaMode>0;this.state.blendMode=Ut(t.blendMode,h),r.state.set(this.state);const l=r.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(r.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Gt(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,h),this.shader.uniforms.uSampler=o,this.renderer.shader.bind(this.shader);let u=!1;for(let i=0,o=0;i<n;i+=s,o+=1){let h=n-i;h>s&&(h=s),o>=a.length&&a.push(this._generateOneMoreBuffer(t));const c=a[o];c.uploadDynamic(e,i,h);const d=t._bufferUpdateIDs[o]||0;u=u||c._updateID<d,u&&(c._updateID=t._updateID,c.uploadStatic(e,i,h)),r.geometry.bind(c.geometry),l.drawElements(l.TRIANGLES,6*h,l.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],i=t._maxSize,s=t._batchSize,r=t._properties;for(let t=0;t<i;t+=s)e.push(new rr(this.properties,r,s));return e}_generateOneMoreBuffer(t){const e=t._batchSize,i=t._properties;return new rr(this.properties,i,e)}uploadVertices(t,e,i,s,r,n){let a=0,o=0,h=0,l=0;for(let c=0;c<i;++c){const i=t[e+c],u=i._texture,d=i.scale.x,p=i.scale.y,f=u.trim,m=u.orig;f?(o=f.x-i.anchor.x*m.width,a=o+f.width,l=f.y-i.anchor.y*m.height,h=l+f.height):(a=m.width*(1-i.anchor.x),o=m.width*-i.anchor.x,h=m.height*(1-i.anchor.y),l=m.height*-i.anchor.y),s[n]=o*d,s[n+1]=l*p,s[n+r]=a*d,s[n+r+1]=l*p,s[n+2*r]=a*d,s[n+2*r+1]=h*p,s[n+3*r]=o*d,s[n+3*r+1]=h*p,n+=4*r}}uploadPosition(t,e,i,s,r,n){for(let a=0;a<i;a++){const i=t[e+a].position;s[n]=i.x,s[n+1]=i.y,s[n+r]=i.x,s[n+r+1]=i.y,s[n+2*r]=i.x,s[n+2*r+1]=i.y,s[n+3*r]=i.x,s[n+3*r+1]=i.y,n+=4*r}}uploadRotation(t,e,i,s,r,n){for(let a=0;a<i;a++){const i=t[e+a].rotation;s[n]=i,s[n+r]=i,s[n+2*r]=i,s[n+3*r]=i,n+=4*r}}uploadUvs(t,e,i,s,r,n){for(let a=0;a<i;++a){const i=t[e+a]._texture._uvs;i?(s[n]=i.x0,s[n+1]=i.y0,s[n+r]=i.x1,s[n+r+1]=i.y1,s[n+2*r]=i.x2,s[n+2*r+1]=i.y2,s[n+3*r]=i.x3,s[n+3*r+1]=i.y3,n+=4*r):(s[n]=0,s[n+1]=0,s[n+r]=0,s[n+r+1]=0,s[n+2*r]=0,s[n+2*r+1]=0,s[n+3*r]=0,s[n+3*r+1]=0,n+=4*r)}}uploadTint(t,e,i,s,r,n){for(let a=0;a<i;++a){const i=t[e+a],o=i._texture.baseTexture.alphaMode>0,h=i.alpha,l=h<1&&o?zt(i._tintRGB,h):i._tintRGB+(255*h<<24);s[n]=l,s[n+r]=l,s[n+2*r]=l,s[n+3*r]=l,n+=4*r}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}nr.extension={name:"particle",type:X.RendererPlugin},$.add(nr),class extends Ls{constructor(t=1500,e,i=16384,s=!1){super(),i>16384&&(i=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=i,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=c.NORMAL,this.autoResize=s,this.roundPixels=!0,this.baseTexture=null,this.setProperties(e),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}setProperties(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])}updateTransform(){this.displayObjectUpdateTransform()}get tint(){return this._tint}set tint(t){this._tint=t,Bt(t,this.tintRgb)}render(t){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(()=>this.onChildrenChange(0)))),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))}onChildrenChange(t){const e=Math.floor(t/this._batchSize);for(;this._bufferUpdateIDs.length<e;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[e]=++this._updateID}dispose(){if(this._buffers){for(let t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}}destroy(t){super.destroy(t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null}}.prototype.renderCanvas=function(t){if(!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable)return;const e=t.canvasContext.activeContext,i=this.worldTransform;let s=!0,r=0,n=0,a=0,o=0;t.canvasContext.setBlendMode(this.blendMode),e.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(let h=0;h<this.children.length;++h){const l=this.children[h];if(!l.visible)continue;if(!l._texture.valid)continue;const c=l._texture.frame;if(e.globalAlpha=this.worldAlpha*l.alpha,l.rotation%(2*Math.PI)==0)s&&(t.canvasContext.setContextTransform(i,!1,1),s=!1),r=l.anchor.x*(-c.width*l.scale.x)+l.position.x+.5,n=l.anchor.y*(-c.height*l.scale.y)+l.position.y+.5,a=c.width*l.scale.x,o=c.height*l.scale.y;else{s||(s=!0),l.displayObjectUpdateTransform();const e=l.worldTransform;t.canvasContext.setContextTransform(e,this.roundPixels,1),r=l.anchor.x*-c.width+.5,n=l.anchor.y*-c.height+.5,a=c.width,o=c.height}const u=l._texture.baseTexture.resolution,d=t.canvasContext.activeResolution;e.drawImage(l._texture.baseTexture.getDrawableSource(),c.x*u,c.y*u,c.width*u,c.height*u,r*d,n*d,a*d,o*d)}},Ls.prototype._renderCanvas=function(t){},Ls.prototype.renderCanvas=function(t){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&t.mask.pushMask(this._mask),this._renderCanvas(t);for(let e=0,i=this.children.length;e<i;++e)this.children[e].renderCanvas(t);this._mask&&t.mask.popMask(t)}},Ms.prototype.renderCanvas=function(t){};var ar=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(ar||{});const or={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:ar.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},hr=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];class lr{constructor(t){this.styleID=0,this.reset(),dr(this,t,t)}clone(){const t={};return dr(t,this,or),new lr(t)}reset(){dr(this,or,or)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=ur(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=ur(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=ur(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let t=e.length-1;t>=0;t--){let i=e[t].trim();/([\"\'])[^\'\"]+\1/.test(i)||hr.includes(i)||(i=`"${i}"`),e[t]=i}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}}function cr(t){return"number"==typeof t?Nt(t):("string"==typeof t&&t.startsWith("0x")&&(t=t.replace("0x","#")),t)}function ur(t){if(Array.isArray(t)){for(let e=0;e<t.length;++e)t[e]=cr(t[e]);return t}return cr(t)}function dr(t,e,i){for(const s in i)Array.isArray(e[s])?t[s]=e[s].slice():t[s]=e[s]}const pr={willReadFrequently:!0};class fr{constructor(t,e,i,s,r,n,a,o,h){this.text=t,this.style=e,this.width=i,this.height=s,this.lines=r,this.lineWidths=n,this.lineHeight=a,this.maxLineWidth=o,this.fontProperties=h}static measureText(t,e,i,s=fr._canvas){i=null==i?e.wordWrap:i;const r=e.toFontString(),n=fr.measureFont(r);0===n.fontSize&&(n.fontSize=e.fontSize,n.ascent=e.fontSize);const a=s.getContext("2d",pr);a.font=r;const o=(i?fr.wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),h=new Array(o.length);let l=0;for(let t=0;t<o.length;t++){const i=a.measureText(o[t]).width+(o[t].length-1)*e.letterSpacing;h[t]=i,l=Math.max(l,i)}let c=l+e.strokeThickness;e.dropShadow&&(c+=e.dropShadowDistance);const u=e.lineHeight||n.fontSize+e.strokeThickness;let d=Math.max(u,n.fontSize+e.strokeThickness)+(o.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new fr(t,e,c,d,o,h,u+e.leading,l,n)}static wordWrap(t,e,i=fr._canvas){const s=i.getContext("2d",pr);let r=0,n="",a="";const o=Object.create(null),{letterSpacing:h,whiteSpace:l}=e,c=fr.collapseSpaces(l),u=fr.collapseNewlines(l);let d=!c;const p=e.wordWrapWidth+h,f=fr.tokenize(t);for(let t=0;t<f.length;t++){let i=f[t];if(fr.isNewline(i)){if(!u){a+=fr.addLine(n),d=!c,n="",r=0;continue}i=" "}if(c){const t=fr.isBreakingSpace(i),e=fr.isBreakingSpace(n[n.length-1]);if(t&&e)continue}const l=fr.getFromCache(i,h,o,s);if(l>p)if(""!==n&&(a+=fr.addLine(n),n="",r=0),fr.canBreakWords(i,e.breakWords)){const t=fr.wordWrapSplit(i);for(let l=0;l<t.length;l++){let c=t[l],u=1;for(;t[l+u];){const s=t[l+u],r=c[c.length-1];if(fr.canBreakChars(r,s,i,l,e.breakWords))break;c+=s,u++}l+=c.length-1;const f=fr.getFromCache(c,h,o,s);f+r>p&&(a+=fr.addLine(n),d=!1,n="",r=0),n+=c,r+=f}}else{n.length>0&&(a+=fr.addLine(n),n="",r=0);const e=t===f.length-1;a+=fr.addLine(i,!e),d=!1,n="",r=0}else l+r>p&&(d=!1,a+=fr.addLine(n),n="",r=0),(n.length>0||!fr.isBreakingSpace(i)||d)&&(n+=i,r+=l)}return a+=fr.addLine(n,!1),a}static addLine(t,e=!0){return t=fr.trimRight(t),e?`${t}\n`:t}static getFromCache(t,e,i,s){let r=i[t];if("number"!=typeof r){const n=t.length*e;r=s.measureText(t).width+n,i[t]=r}return r}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const i=t[e];if(!fr.isBreakingSpace(i))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&fr._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&fr._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let i="";if("string"!=typeof t)return e;for(let s=0;s<t.length;s++){const r=t[s],n=t[s+1];fr.isBreakingSpace(r,n)||fr.isNewline(r)?(""!==i&&(e.push(i),i=""),e.push(r)):i+=r}return""!==i&&e.push(i),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,i,s,r){return!0}static wordWrapSplit(t){return t.split("")}static measureFont(t){if(fr._fonts[t])return fr._fonts[t];const e={ascent:0,descent:0,fontSize:0},i=fr._canvas,s=fr._context;s.font=t;const r=fr.METRICS_STRING+fr.BASELINE_SYMBOL,n=Math.ceil(s.measureText(r).width);let a=Math.ceil(s.measureText(fr.BASELINE_SYMBOL).width);const o=Math.ceil(fr.HEIGHT_MULTIPLIER*a);a=a*fr.BASELINE_MULTIPLIER|0,i.width=n,i.height=o,s.fillStyle="#f00",s.fillRect(0,0,n,o),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(r,0,a);const h=s.getImageData(0,0,n,o).data,l=h.length,c=4*n;let u=0,d=0,p=!1;for(u=0;u<a;++u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d+=c}for(e.ascent=a-u,d=l-c,p=!1,u=o;u>a;--u){for(let t=0;t<c;t+=4)if(255!==h[d+t]){p=!0;break}if(p)break;d-=c}return e.descent=u-a,e.fontSize=e.ascent+e.descent,fr._fonts[t]=e,e}static clearMetrics(t=""){t?delete fr._fonts[t]:fr._fonts={}}static get _canvas(){if(!fr.__canvas){let t;try{const e=new OffscreenCanvas(0,0);if(e.getContext("2d",pr)?.measureText)return fr.__canvas=e,e;t=Y.ADAPTER.createCanvas()}catch(e){t=Y.ADAPTER.createCanvas()}t.width=t.height=10,fr.__canvas=t}return fr.__canvas}static get _context(){return fr.__context||(fr.__context=fr._canvas.getContext("2d",pr)),fr.__context}}fr._fonts={},fr.METRICS_STRING="|ÉqÅ",fr.BASELINE_SYMBOL="M",fr.BASELINE_MULTIPLIER=1.4,fr.HEIGHT_MULTIPLIER=2,fr._newlines=[10,13],fr._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const mr={texture:!0,children:!1,baseTexture:!0},_r=class extends Us{constructor(t,e,i){let s=!1;i||(i=Y.ADAPTER.createCanvas(),s=!0),i.width=3,i.height=3;const r=Fe.from(i);r.orig=new tt,r.trim=new tt,super(r),this._ownCanvas=s,this.canvas=i,this.context=i.getContext("2d",{willReadFrequently:!0}),this._resolution=Y.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const i=this.context,s=fr.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),r=s.width,n=s.height,a=s.lines,o=s.lineHeight,h=s.lineWidths,l=s.maxLineWidth,c=s.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,r)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,n)+2*e.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=e.strokeThickness,i.textBaseline=e.textBaseline,i.lineJoin=e.lineJoin,i.miterLimit=e.miterLimit;const p=e.dropShadow?2:1;for(let t=0;t<p;++t){const r=e.dropShadow&&0===t,p=r?Math.ceil(Math.max(1,n)+2*e.padding):0,f=p*this._resolution;if(r){i.fillStyle="black",i.strokeStyle="black";const t=e.dropShadowColor,s=Bt("number"==typeof t?t:Lt(t)),r=e.dropShadowBlur*this._resolution,n=e.dropShadowDistance*this._resolution;i.shadowColor=`rgba(${255*s[0]},${255*s[1]},${255*s[2]},${e.dropShadowAlpha})`,i.shadowBlur=r,i.shadowOffsetX=Math.cos(e.dropShadowAngle)*n,i.shadowOffsetY=Math.sin(e.dropShadowAngle)*n+f}else i.fillStyle=this._generateFillStyle(e,a,s),i.strokeStyle=e.stroke,i.shadowColor="black",i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;let m=(o-c.fontSize)/2;o-c.fontSize<0&&(m=0);for(let t=0;t<a.length;t++)u=e.strokeThickness/2,d=e.strokeThickness/2+t*o+c.ascent+m,"right"===e.align?u+=l-h[t]:"center"===e.align&&(u+=(l-h[t])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(a[t],u+e.padding,d+e.padding-p,!0),e.fill&&this.drawLetterSpacing(a[t],u+e.padding,d+e.padding-p)}this.updateTexture()}drawLetterSpacing(t,e,i,s=!1){const r=this._style.letterSpacing,n=_r.experimentalLetterSpacing&&("letterSpacing"in CanvasRenderingContext2D.prototype||"textLetterSpacing"in CanvasRenderingContext2D.prototype);if(0===r||n)return n&&(this.context.letterSpacing=r,this.context.textLetterSpacing=r),void(s?this.context.strokeText(t,e,i):this.context.fillText(t,e,i));let a=e;const o=Array.from?Array.from(t):t.split("");let h=this.context.measureText(t).width,l=0;for(let t=0;t<o.length;++t){const e=o[t];s?this.context.strokeText(e,a,i):this.context.fillText(e,a,i);let n="";for(let e=t+1;e<o.length;++e)n+=o[e];l=this.context.measureText(n).width,a+=h-l+r,h=l}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=he(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,i=this._style,s=i.trim?0:i.padding,r=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-s,e.trim.y=-s,e.orig.width=e._frame.width-2*s,e.orig.height=e._frame.height-2*s,this._onTextureUpdate(),r.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,i){const s=t.fill;if(!Array.isArray(s))return s;if(1===s.length)return s[0];let r;const n=t.dropShadow?t.dropShadowDistance:0,a=t.padding||0,o=this.canvas.width/this._resolution-n-2*a,h=this.canvas.height/this._resolution-n-2*a,l=s.slice(),c=t.fillGradientStops.slice();if(!c.length){const t=l.length+1;for(let e=1;e<t;++e)c.push(e/t)}if(l.unshift(s[0]),c.unshift(0),l.push(s[s.length-1]),c.push(1),t.fillGradientType===ar.LINEAR_VERTICAL){r=this.context.createLinearGradient(o/2,a,o/2,h+a);const s=i.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const n=i.lineHeight*(t-1)+s,a=i.lineHeight*t;let o=a;t>0&&n>a&&(o=(a+n)/2);const u=a+s,d=i.lineHeight*(t+1);let p=u;t+1<e.length&&d<u&&(p=(u+d)/2);const f=(p-o)/h;for(let t=0;t<l.length;t++){let e=0;e="number"==typeof c[t]?c[t]:t/l.length;let i=Math.min(1,Math.max(0,o/h+e*f));i=Number(i.toFixed(5)),r.addColorStop(i,l[t])}}}else{r=this.context.createLinearGradient(a,h/2,o+a,h/2);const t=l.length+1;let e=1;for(let i=0;i<l.length;i++){let s;s="number"==typeof c[i]?c[i]:e/t,r.addColorStop(s,l[i]),e++}}return r}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},mr,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=Kt(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=Kt(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof lr?t:new lr(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let gr=_r;gr.experimentalLetterSpacing=!1,gr.prototype._renderCanvas=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),Us.prototype._renderCanvas.call(this,t)},["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class vr extends Di{constructor(){super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n","varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",{m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1}),this.alpha=1}_loadMatrix(t,e=!1){let i=t;e&&(this._multiply(i,this.uniforms.m,t),i=this._colorMatrix(i)),this.uniforms.m=i}_multiply(t,e,i){return t[0]=e[0]*i[0]+e[1]*i[5]+e[2]*i[10]+e[3]*i[15],t[1]=e[0]*i[1]+e[1]*i[6]+e[2]*i[11]+e[3]*i[16],t[2]=e[0]*i[2]+e[1]*i[7]+e[2]*i[12]+e[3]*i[17],t[3]=e[0]*i[3]+e[1]*i[8]+e[2]*i[13]+e[3]*i[18],t[4]=e[0]*i[4]+e[1]*i[9]+e[2]*i[14]+e[3]*i[19]+e[4],t[5]=e[5]*i[0]+e[6]*i[5]+e[7]*i[10]+e[8]*i[15],t[6]=e[5]*i[1]+e[6]*i[6]+e[7]*i[11]+e[8]*i[16],t[7]=e[5]*i[2]+e[6]*i[7]+e[7]*i[12]+e[8]*i[17],t[8]=e[5]*i[3]+e[6]*i[8]+e[7]*i[13]+e[8]*i[18],t[9]=e[5]*i[4]+e[6]*i[9]+e[7]*i[14]+e[8]*i[19]+e[9],t[10]=e[10]*i[0]+e[11]*i[5]+e[12]*i[10]+e[13]*i[15],t[11]=e[10]*i[1]+e[11]*i[6]+e[12]*i[11]+e[13]*i[16],t[12]=e[10]*i[2]+e[11]*i[7]+e[12]*i[12]+e[13]*i[17],t[13]=e[10]*i[3]+e[11]*i[8]+e[12]*i[13]+e[13]*i[18],t[14]=e[10]*i[4]+e[11]*i[9]+e[12]*i[14]+e[13]*i[19]+e[14],t[15]=e[15]*i[0]+e[16]*i[5]+e[17]*i[10]+e[18]*i[15],t[16]=e[15]*i[1]+e[16]*i[6]+e[17]*i[11]+e[18]*i[16],t[17]=e[15]*i[2]+e[16]*i[7]+e[17]*i[12]+e[18]*i[17],t[18]=e[15]*i[3]+e[16]*i[8]+e[17]*i[13]+e[18]*i[18],t[19]=e[15]*i[4]+e[16]*i[9]+e[17]*i[14]+e[18]*i[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const i=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}tint(t,e){const i=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(i,e)}greyscale(t,e){const i=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const i=Math.cos(t),s=Math.sin(t),r=1/3,n=(0,Math.sqrt)(r),a=[i+(1-i)*r,r*(1-i)-n*s,r*(1-i)+n*s,0,0,r*(1-i)+n*s,i+r*(1-i),r*(1-i)-n*s,0,0,r*(1-i)-n*s,r*(1-i)+n*s,i+r*(1-i),0,0,0,0,0,1,0];this._loadMatrix(a,e)}contrast(t,e){const i=(t||0)+1,s=-.5*(i-1),r=[i,0,0,0,s,0,i,0,0,s,0,0,i,0,s,0,0,0,1,0];this._loadMatrix(r,e)}saturate(t=0,e){const i=2*t/3+1,s=-.5*(i-1),r=[i,s,s,0,0,s,i,s,0,0,s,s,i,0,0,0,0,0,1,0];this._loadMatrix(r,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,i,s,r){const n=((i=i||16770432)>>16&255)/255,a=(i>>8&255)/255,o=(255&i)/255,h=((s=s||3375104)>>16&255)/255,l=(s>>8&255)/255,c=(255&s)/255,u=[.3,.59,.11,0,0,n,a,o,t=t||.2,0,h,l,c,e=e||.15,0,n-h,a-l,o-c,0,0];this._loadMatrix(u,r)}night(t,e){const i=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(i,e)}predator(t,e){const i=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(i,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}vr.prototype.grayscale=vr.prototype.greyscale;const yr=new at;Ms.prototype._cacheAsBitmap=!1,Ms.prototype._cacheData=null,Ms.prototype._cacheAsBitmapResolution=null,Ms.prototype._cacheAsBitmapMultisample=null;class xr{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Ms.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new xr),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Ms.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Ms.prototype._initCachedDisplayObject=function(t){if(this._cacheData?.sprite)return;const e=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if(this.filters?.length){const t=this.filters[0].padding;i.pad(t)}i.ceil(Y.RESOLUTION);const s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),n=t.renderTexture.destinationFrame.clone(),a=t.projection.transform,o=Ue.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${Qt()}`;this._cacheData.textureCacheId=h,xe.addToCache(o.baseTexture,h),Fe.addToCache(o,h);const l=this.transform.localTransform.copyTo(yr).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=a,t.renderTexture.bind(s,r,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;const c=new Us(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-i.x/i.width,c.anchor.y=-i.y/i.height,c.alpha=e,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=c.containsPoint.bind(c)},Ms.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Ms.prototype._initCachedDisplayObjectCanvas=function(t){if(this._cacheData?.sprite)return;const e=this.getLocalBounds(null,!0),i=this.alpha;this.alpha=1;const s=t.canvasContext.activeContext,r=t._projTransform;e.ceil(Y.RESOLUTION);const n=Ue.create({width:e.width,height:e.height}),a=`cacheAsBitmap_${Qt()}`;this._cacheData.textureCacheId=a,xe.addToCache(n.baseTexture,a),Fe.addToCache(n,a);const o=yr;this.transform.localTransform.copyTo(o),o.invert(),o.tx-=e.x,o.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:n,clear:!0,transform:o,skipUpdateTransform:!1}),t.canvasContext.activeContext=s,t._projTransform=r,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=i;const h=new Us(n);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-e.x/e.width,h.anchor.y=-e.y/e.height,h.alpha=i,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)},Ms.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Ms.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Ms.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,xe.removeFromCache(this._cacheData.textureCacheId),Fe.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Ms.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Ms.prototype.name=null,Ls.prototype.getChildByName=function(t,e){for(let e=0,i=this.children.length;e<i;e++)if(this.children[e].name===t)return this.children[e];if(e)for(let e=0,i=this.children.length;e<i;e++){const i=this.children[e];if(!i.getChildByName)continue;const s=i.getChildByName(t,!0);if(s)return s}return null},Ms.prototype.getGlobalPosition=function(t=new J,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};class br{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=br.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new J,this.page=new J,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,i){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,i,s,r){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class Tr extends br{constructor(){super(...arguments),this.client=new J,this.movement=new J,this.offset=new J,this.global=new J,this.screen=new J}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,s,r,n,a,o,h,l,c,u,d,p,f){throw new Error("Method not implemented.")}}class Er extends Tr{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class wr extends Tr{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const Sr=new J,Ar=new J;class Cr{constructor(t){this.dispatch=new Tt,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let i=0,s=e.length;i<s;i++)e[i].fn(t);else console.warn(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,e){const i=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,Sr.set(t,e),this.hitTestFn,this.hitPruneFn);return i&&i[0]}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let s=0,r=i.length-1;s<r;s++)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let s=i.length-2;s>=0;s--)if(t.currentTarget=i[s],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,i=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const s=i.children;if(s)for(let i=0;i<s.length;i++)this.all(t,e,s[i]);t.currentTarget=i,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,i,s,r){if(!t||!t.visible)return null;if(r(t,i))return null;if(t.interactiveChildren&&t.children){const n=t.children;for(let a=n.length-1;a>=0;a--){const o=n[a],h=this.hitTestRecursive(o,e||o.interactive,i,s,r);if(h){if(h.length>0&&!h[h.length-1].parent)continue;return(h.length>0||t.interactive)&&h.push(t),h}}}return e&&s(t,i)?t.interactive?[t]:[]:null}hitPruneFn(t,e){if(t.hitArea&&(t.worldTransform.applyInverse(e,Ar),!t.hitArea.contains(Ar.x,Ar.y)))return!0;if(t._mask){const i=t._mask.isMaskData?t._mask.maskObject:t._mask;if(i&&!i.containsPoint?.(e))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t.containsPoint&&t.containsPoint(e)}notifyTarget(t,e){e=e??t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.createPointerEvent(t),i="mouse"===e.pointerType||"pen"===e.pointerType,s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.overTargets);if(s.overTargets&&r!==e.target){const s="mousemove"===t.type?"mouseout":"pointerout",n=this.createPointerEvent(t,s,r);if(this.dispatchEvent(n,"pointerout"),i&&this.dispatchEvent(n,"mouseout"),!e.composedPath().includes(r)){const s=this.createPointerEvent(t,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&!e.composedPath().includes(s.target);)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;this.freeEvent(s)}this.freeEvent(n)}if(r!==e.target){const s="mousemove"===t.type?"mouseover":"pointerover",n=this.clonePointerEvent(e,s);this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover");let a=r?.parent;for(;a&&a!==this.rootTarget.parent&&a!==e.target;)a=a.parent;if(!a||a===this.rootTarget.parent){const t=this.clonePointerEvent(e,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==r&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(n)}const n=this.moveOnAll?"all":"dispatchEvent";this[n](e,"pointermove"),"touch"===e.pointerType&&this[n](e,"touchmove"),i&&(this[n](e,"mousemove"),this.cursor=e.target?.cursor),s.overTargets=e.composedPath(),this.freeEvent(e)}mapPointerOver(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.createPointerEvent(t),s="mouse"===i.pointerType||"pen"===i.pointerType;this.dispatchEvent(i,"pointerover"),s&&this.dispatchEvent(i,"mouseover"),"mouse"===i.pointerType&&(this.cursor=i.target?.cursor);const r=this.clonePointerEvent(i,"pointerenter");for(r.eventPhase=r.AT_TARGET;r.target&&r.target!==this.rootTarget.parent;)r.currentTarget=r.target,this.notifyTarget(r),s&&this.notifyTarget(r,"mouseenter"),r.target=r.target.parent;e.overTargets=i.composedPath(),this.freeEvent(i),this.freeEvent(r)}mapPointerOut(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId);if(e.overTargets){const i="mouse"===t.pointerType||"pen"===t.pointerType,s=this.findMountedTarget(e.overTargets),r=this.createPointerEvent(t,"pointerout",s);this.dispatchEvent(r),i&&this.dispatchEvent(r,"mouseout");const n=this.createPointerEvent(t,"pointerleave",s);for(n.eventPhase=n.AT_TARGET;n.target&&n.target!==this.rootTarget.parent;)n.currentTarget=n.target,this.notifyTarget(n),i&&this.notifyTarget(n,"mouseleave"),n.target=n.target.parent;e.overTargets=null,this.freeEvent(r),this.freeEvent(n)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=performance.now(),i=this.createPointerEvent(t);if(this.dispatchEvent(i,"pointerup"),"touch"===i.pointerType)this.dispatchEvent(i,"touchend");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.dispatchEvent(i,t?"rightup":"mouseup")}const s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[t.button]);let n=r;if(r&&!i.composedPath().includes(r)){let e=r;for(;e&&!i.composedPath().includes(e);){if(i.currentTarget=e,this.notifyTarget(i,"pointerupoutside"),"touch"===i.pointerType)this.notifyTarget(i,"touchendoutside");else if("mouse"===i.pointerType||"pen"===i.pointerType){const t=2===i.button;this.notifyTarget(i,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete s.pressTargetsByButton[t.button],n=e}if(n){const r=this.clonePointerEvent(i,"click");r.target=n,r.path=null,s.clicksByButton[t.button]||(s.clicksByButton[t.button]={clickCount:0,target:r.target,timeStamp:e});const a=s.clicksByButton[t.button];a.target===r.target&&e-a.timeStamp<200?++a.clickCount:a.clickCount=1,a.target=r.target,a.timeStamp=e,r.detail=a.clickCount,"mouse"===r.pointerType?this.dispatchEvent(r,"click"):"touch"===r.pointerType&&this.dispatchEvent(r,"tap"),this.dispatchEvent(r,"pointertap"),this.freeEvent(r)}this.freeEvent(i)}mapPointerUpOutside(t){if(!(t instanceof Er))return void console.warn("EventBoundary cannot map a non-pointer event as a pointer event");const e=this.trackingData(t.pointerId),i=this.findMountedTarget(e.pressTargetsByButton[t.button]),s=this.createPointerEvent(t);if(i){let r=i;for(;r;)s.currentTarget=r,this.notifyTarget(s,"pointerupoutside"),"touch"===s.pointerType?this.notifyTarget(s,"touchendoutside"):"mouse"!==s.pointerType&&"pen"!==s.pointerType||this.notifyTarget(s,2===s.button?"rightupoutside":"mouseupoutside"),r=r.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(s)}mapWheel(t){if(!(t instanceof wr))return void console.warn("EventBoundary cannot map a non-wheel event as a wheel event");const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){const s=this.allocateEvent(Er);return this.copyPointerData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=i??this.hitTest(s.global.x,s.global.y),"string"==typeof e&&(s.type=e),s}createWheelEvent(t){const e=this.allocateEvent(wr);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const i=this.allocateEvent(Er);return i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Er&&e instanceof Er&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof Tr&&e instanceof Tr&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.fn.call(i.context,t);else for(let e=0,s=i.length;e<s&&!t.propagationImmediatelyStopped;e++)i[e].fn.call(i[e].context,t)}}const Rr={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class Ir{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new Cr(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new Er(null),this.rootWheelEvent=new wr(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const i=this.cursorStyles[t];if(i)switch(typeof i){case"string":e&&(this.domElement.style.cursor=i);break;case"function":i(t);break;case"object":e&&Object.assign(this.domElement.style,i)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);this.autoPreventDefault&&e[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let t=0,i=e.length;t<i;t++){const i=e[t],s=this.bootstrapEvent(this.rootPointerEvent,i);this.rootBoundary.mapEvent(s)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const i=e!==this.domElement?"outside":"",s=this.normalizeToPointerData(t);for(let t=0,e=s.length;t<e;t++){const e=this.bootstrapEvent(this.rootPointerEvent,s[t]);e.type+=i,this.rootBoundary.mapEvent(e)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let t=0,i=e.length;t<i;t++){const i=this.bootstrapEvent(this.rootPointerEvent,e[t]);this.rootBoundary.mapEvent(i)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,i){let s;s=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const r=1/this.resolution;t.x=(e-s.left)*(this.domElement.width/s.width)*r,t.y=(i-s.top)*(this.domElement.height/s.height)*r}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let i=0,s=t.changedTouches.length;i<s;i++){const s=t.changedTouches[i];void 0===s.button&&(s.button=0),void 0===s.buttons&&(s.buttons=1),void 0===s.isPrimary&&(s.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===s.width&&(s.width=s.radiusX||1),void 0===s.height&&(s.height=s.radiusY||1),void 0===s.tiltX&&(s.tiltX=0),void 0===s.tiltY&&(s.tiltY=0),void 0===s.pointerType&&(s.pointerType="touch"),void 0===s.pointerId&&(s.pointerId=s.identifier||0),void 0===s.pressure&&(s.pressure=s.force||.5),void 0===s.twist&&(s.twist=0),void 0===s.tangentialPressure&&(s.tangentialPressure=0),void 0===s.layerX&&(s.layerX=s.offsetX=s.clientX),void 0===s.layerY&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&!(this.supportsPointerEvents&&t instanceof globalThis.PointerEvent)){const i=t;void 0===i.isPrimary&&(i.isPrimary=!0),void 0===i.width&&(i.width=1),void 0===i.height&&(i.height=1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="mouse"),void 0===i.pointerId&&(i.pointerId=1),void 0===i.pressure&&(i.pressure=.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}else e.push(t);return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=Rr[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}Ir.extension={name:"events",type:[X.RendererSystem,X.CanvasRendererSystem]},$.add(Ir);const Pr={interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(t,e,i){const s="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,s)},removeEventListener(t,e,i){const s="function"==typeof e?void 0:e;t="boolean"==typeof i&&i||"object"==typeof i&&i.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,s)},dispatchEvent(t){if(!(t instanceof br))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Ms.mixin(Pr),Ms.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class kr{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(H.tablet||H.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode?.appendChild(this.div))}deactivate(){this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode?.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let t=0;t<e.length;t++)this.updateAccessibleObjects(e[t])}update(){const t=performance.now();if(H.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:i,width:s,height:r}=this.renderer.view.getBoundingClientRect(),{width:n,height:a,resolution:o}=this.renderer,h=s/n*o,l=r/a*o;let c=this.div;c.style.left=`${e}px`,c.style.top=`${i}px`,c.style.width=`${n}px`,c.style.height=`${a}px`;for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.renderId!==this.renderId)e._accessibleActive=!1,Zt(this.children,t,1),this.div.removeChild(e._accessibleDiv),this.pool.push(e._accessibleDiv),e._accessibleDiv=null,t--;else{c=e._accessibleDiv;let t=e.hitArea;const i=e.worldTransform;e.hitArea?(c.style.left=(i.tx+t.x*i.a)*h+"px",c.style.top=(i.ty+t.y*i.d)*l+"px",c.style.width=t.width*i.a*h+"px",c.style.height=t.height*i.d*l+"px"):(t=e.getBounds(),this.capHitArea(t),c.style.left=t.x*h+"px",c.style.top=t.y*l+"px",c.style.width=t.width*h+"px",c.style.height=t.height*l+"px",c.title!==e.accessibleTitle&&null!==e.accessibleTitle&&(c.title=e.accessibleTitle),c.getAttribute("aria-label")!==e.accessibleHint&&null!==e.accessibleHint&&c.setAttribute("aria-label",e.accessibleHint)),e.accessibleTitle===c.title&&e.tabIndex===c.tabIndex||(c.title=e.accessibleTitle,c.tabIndex=e.tabIndex,this.debug&&this.updateDebugHTML(c))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:i}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>i&&(t.height=i-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:i}=t.target,s=this.renderer.events.rootBoundary,r=Object.assign(new br(s),{target:i});s.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>s.dispatchEvent(r,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}kr.extension={name:"accessibility",type:[X.RendererPlugin,X.CanvasRendererPlugin]},$.add(kr);const Dr=class{constructor(t){this.stage=new Ls,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of vs)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),Dr._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const i=Dr._plugins.slice(0);i.reverse(),i.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let Mr=Dr;Mr._plugins=[],$.handleByList(X.Application,Mr._plugins);class Br{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:i,clientHeight:s}=this._resizeTo;t=i,e=s}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}Br.extension=X.Application,$.add(Br);class Nr{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let i=0;i<e;i++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}const Lr=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),Or=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){return this._cache.get(t)}set(t,e){const i=Lr(t);let s;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];if(r.test(e)){s=r.getCacheableAssets(i,e);break}}s||(s={},i.forEach((t=>{s[t]=e})));const r=Object.keys(s),n={cacheKeys:r,keys:i};if(i.forEach((t=>{this._cacheMap.set(t,n)})),r.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,s[t])})),e instanceof Fe){const t=e;i.forEach((e=>{t.baseTexture!==Fe.EMPTY.baseTexture&&xe.addToCache(t.baseTexture,e),Fe.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}},Fr=t=>!Array.isArray(t);class Ur{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const i={promise:null,parser:null};return i.promise=(async()=>{let s=null;for(let r=0;r<this.parsers.length;r++){const n=this.parsers[r];if(n.load&&n.test?.(t,e,this)){s=await n.load(t,e,this),i.parser=n;break}}if(!i.parser)return null;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];r.parse&&r.parse&&await(r.testParse?.(s,e,this))&&(s=await r.parse(s,e,this)||s,i.parser=r)}return s})(),i}async load(t,e){let i=0;const s={},r=Fr(t),n=Lr(t,(t=>({src:t}))),a=n.length,o=n.map((async t=>{const r=Rt.toAbsolute(t.src);if(!s[t.src])try{this.promiseCache[r]||(this.promiseCache[r]=this._getLoadPromiseAndParser(r,t)),s[t.src]=await this.promiseCache[r].promise,e&&e(++i/a)}catch(e){throw delete this.promiseCache[r],delete s[t.src],new Error(`[Loader.load] Failed to load ${r}.\n${e}`)}}));return await Promise.all(o),r?s[n[0].src]:s}async unload(t){const e=Lr(t,(t=>({src:t}))).map((async t=>{const e=Rt.toAbsolute(t.src),i=this.promiseCache[e];if(i){const s=await i.promise;i.parser?.unload?.(s,t,this),delete this.promiseCache[e]}}));await Promise.all(e)}get parsers(){return this._parsers}}function Gr(t,e,i,s,r){const n=e[i];for(let a=0;a<n.length;a++){const o=n[a];i<e.length-1?Gr(t.replace(s[i],o),e,i+1,s,r):r.push(t.replace(s[i],o))}}function zr(t){const e=t.match(/\{(.*?)\}/g),i=[];if(e){const s=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");s.push(e)})),Gr(t,s,0,e,i)}else i.push(t);return i}class jr{constructor(){this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this._preferredOrder=[],this._resolverHash={},this._assetMap={},this._rootPath=null,this._basePath=null,this._manifest=null}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const i=[];Array.isArray(e)?e.forEach((t=>{"string"==typeof t.name?i.push(t.name):i.push(...t.name),this.add(t.name,t.srcs)})):Object.keys(e).forEach((t=>{i.push(t),this.add(t,e[t])})),this._bundles[t]=i}add(t,e,i){const s=Lr(t);s.forEach((t=>{this._assetMap[t]})),Array.isArray(e)||(e="string"==typeof e?zr(e):[e]);const r=e.map((t=>{let e=t;if("string"==typeof t){let i=!1;for(let s=0;s<this._parsers.length;s++){const r=this._parsers[s];if(r.test(t)){e=r.parse(t),i=!0;break}}i||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=s),(this._basePath||this._rootPath)&&(e.src=Rt.toAbsolute(e.src,this._basePath,this._rootPath)),e.data=e.data??i,e}));s.forEach((t=>{this._assetMap[t]=r}))}resolveBundle(t){const e=Fr(t);t=Lr(t);const i={};return t.forEach((t=>{const e=this._bundles[t];e&&(i[t]=this.resolve(e))})),e?i[t[0]]:i}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const i in e)t[i]=e[i].src;return t}return e.src}resolve(t){const e=Fr(t);t=Lr(t);const i={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const i=this._getPreferredOrder(e),s=e[0];i?.priority.forEach((t=>{i.params[t].forEach((i=>{const s=e.filter((e=>!!e[t]&&e[t]===i));s.length&&(e=s)}))})),this._resolverHash[t]=e[0]??s}else{let e=t;(this._basePath||this._rootPath)&&(e=Rt.toAbsolute(e,this._basePath,this._rootPath)),this._resolverHash[t]={src:e}}i[t]=this._resolverHash[t]})),e?i[t[0]]:i}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],i=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(i)return i}return this._preferredOrder[0]}}const Hr=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new jr,this.loader=new Ur,this.cache=Or,this._backgroundLoader=new Nr(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){if(this._initialized)return;if(this._initialized=!0,t.basePath&&(this.resolver.basePath=t.basePath),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const e=t.texturePreference?.resolution??1,i="number"==typeof e?[e]:e;let s=[];if(t.texturePreference?.format){const e=t.texturePreference?.format;s="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(s=await t.remove(s))}else for(const t of this._detections)await t.test()&&(s=await t.add(s));this.resolver.prefer({params:{format:s,resolution:i}})}add(t,e,i){this.resolver.add(t,e,i)}async load(t,e){this._initialized||await this.init();const i=Fr(t),s=Lr(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):t)),r=this.resolver.resolve(s),n=await this._mapLoadToResolve(r,e);return i?n[s[0]]:n}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let i=!1;"string"==typeof t&&(i=!0,t=[t]);const s=this.resolver.resolveBundle(t),r={},n=Object.keys(s);let a=0,o=0;const h=()=>{e?.(++a/o)},l=n.map((t=>{const e=s[t];return o+=Object.keys(e).length,this._mapLoadToResolve(e,h).then((e=>{r[t]=e}))}));return await Promise.all(l),i?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return Or.get(t);const e={};for(let i=0;i<t.length;i++)e[i]=Or.get(t[i]);return e}async _mapLoadToResolve(t,e){const i=Object.values(t),s=Object.keys(t);this._backgroundLoader.active=!1;const r=await this.loader.load(i,e);this._backgroundLoader.active=!0;const n={};return i.forEach(((t,e)=>{const i=r[t.src],a=[t.src];t.alias&&a.push(...t.alias),n[s[e]]=i,Or.set(a,i)})),n}async unload(t){this._initialized||await this.init();const e=Lr(t).map((t=>"string"!=typeof t?t.src:t)),i=this.resolver.resolve(e);await this._unloadFromResolved(i)}async unloadBundle(t){this._initialized||await this.init(),t=Lr(t);const e=this.resolver.resolveBundle(t),i=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(i)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{Or.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}};$.handleByList(X.LoadParser,Hr.loader.parsers).handleByList(X.ResolveParser,Hr.resolver.parsers).handleByList(X.CacheParser,Hr.cache.parsers).handleByList(X.DetectionParser,Hr.detections);const Yr={loader:X.LoadParser,resolver:X.ResolveParser,cache:X.CacheParser,detection:X.DetectionParser};$.handle(X.Asset,(t=>{const e=t.ref;Object.entries(Yr).filter((([t])=>!!e[t])).forEach((([t,i])=>$.add(Object.assign(e[t],{extension:e[t].extension??i}))))}),(t=>{const e=t.ref;Object.keys(Yr).filter((t=>!!e[t])).forEach((t=>$.remove(e[t])))}));const Xr={extension:X.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof Fe)),getCacheableAssets:(t,e)=>{const i={};return t.forEach((t=>{e.forEach(((e,s)=>{i[t+(0===s?"":s+1)]=e}))})),i}};$.add(Xr);var Wr=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(Wr||{});const $r={extension:{type:X.LoadParser,priority:Wr.Low},test:t=>Rt.extname(t).includes(".json"),async load(t){const e=await Y.ADAPTER.fetch(t);return await e.json()}};$.add($r);const Vr={extension:{type:X.LoadParser,priority:Wr.Low},test:t=>Rt.extname(t).includes(".txt"),async load(t){const e=await Y.ADAPTER.fetch(t);return await e.text()}};$.add(Vr);const qr=["normal","bold","100","200","300","400","500","600","700","800","900"],Zr=["woff","woff2","ttf","otf"],Kr={extension:{type:X.LoadParser,priority:Wr.Low},test(t){const e=t.split("?")[0].split(".").pop();return Zr.includes(e)},async load(t,e){if(!globalThis.navigator.onLine)throw new Error("[loadWebFont] Cannot load font - navigator is offline");const i=Y.ADAPTER.getFontFaceSet();if(i){const s=[],r=e.data?.family??function(t){const e=Rt.extname(t);return Rt.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")}(t),n=e.data?.weights?.filter((t=>qr.includes(t)))??["normal"],a=e.data??{};for(let e=0;e<n.length;e++){const o=n[e],h=new FontFace(r,`url(${t})`,{...a,weight:o});await h.load(),i.add(h),s.push(h)}return 1===s.length?s[0]:s}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>Y.ADAPTER.getFontFaceSet().delete(t)))}};$.add(Kr);let Jr,Qr=0;const tn="\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    ",en="\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };";let sn;const rn=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([tn],{type:"application/javascript"})),i=new Worker(e);i.addEventListener("message",(s=>{i.terminate(),URL.revokeObjectURL(e),t(s.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===Jr&&(Jr=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<Jr&&(sn||(sn=URL.createObjectURL(new Blob([en],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(sn),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const i=new Promise(((i,s)=>{this.queue.push({id:t,arguments:e,resolve:i,reject:s})}));return this.next(),i}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),i=e.id;this.resolveHash[Qr]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Qr++,id:i})}};function nn(t,e){const i=t.split("?")[0],s=Rt.extname(i).toLowerCase();return Array.isArray(e)?e.includes(s.toLowerCase()):s.toLowerCase()===e}function an(t,e,i){const s=new Fe(t);return s.baseTexture.on("dispose",(()=>{delete e.promiseCache[i]})),s}const on=[".jpg",".png",".jpeg",".avif",".webp"],hn={extension:{type:X.LoadParser,priority:Wr.High},config:{preferWorkers:!0},test(t){let e=!1;for(let i=0;i<on.length;i++)if(t.startsWith(`data:image/${on[i].slice(1)}`)){e=!0;break}return e||nn(t,on)},async load(t,e,i){let s=null;s=globalThis.createImageBitmap?this.config.preferWorkers&&await rn.isImageBitmapSupported()?await rn.loadImageBitmap(t):await async function(t){const e=await Y.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const i=await e.blob();return await createImageBitmap(i)}(t):await new Promise((e=>{s=new Image,s.crossOrigin="anonymous",s.src=t,s.complete?e(s):s.onload=()=>{e(s)}}));const r=new xe(s,{resolution:pe(t),...e.data});return r.resource.src=t,an(r,i,t)},unload(t){t.destroy(!0)}};$.add(hn),X.LoadParser,Wr.High;const ln={extension:X.ResolveParser,test:hn.test,parse:t=>({resolution:parseFloat(Y.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t})};$.add(ln);const cn={extension:{type:X.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await Y.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};$.add(cn);const un={extension:{type:X.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await Y.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};$.add(un);const dn=["png","jpg","jpeg"],pn={extension:{type:X.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...dn],remove:async t=>t.filter((t=>!dn.includes(t)))};$.add(pn);var fn=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(fn||{});const mn={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};class _n extends ge{constructor(t,e={width:1,height:1,autoLoad:!0}){let i,s;"string"==typeof t?(i=t,s=new Uint8Array):(i=null,s=t),super(s,e),this.origin=i,this.buffer=s?new Es(s):null,this.origin&&!1!==e.autoLoad&&this.load(),s?.length&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const t=await fetch(this.origin),e=await t.blob(),i=await e.arrayBuffer();return this.data=new Uint32Array(i),this.buffer=new Es(i),this.loaded=!0,this.onBlobLoaded(i),this.update(),this}}class gn extends _n{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=gn._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||gn._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,i){const s=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let t=0,e=this.levels;t<e;t++){const{levelID:e,levelWidth:i,levelHeight:r,levelBuffer:n}=this._levelBuffers[t];s.compressedTexImage2D(s.TEXTURE_2D,e,this.format,i,r,0,n)}return!0}onBlobLoaded(){this._levelBuffers=gn._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,i,s,r,n,a){const o=new Array(i);let h=t.byteOffset,l=n,c=a,u=l+s-1&~(s-1),d=c+r-1&~(r-1),p=u*d*mn[e];for(let n=0;n<i;n++)o[n]={levelID:n,levelWidth:i>1?l:u,levelHeight:i>1?c:d,levelBuffer:new Uint8Array(t.buffer,h,p)},h+=p,l=l>>1||1,c=c>>1||1,u=l+s-1&~(s-1),d=c+r-1&~(r-1),p=u*d*mn[e];return o}}let vn,yn;function xn(){yn={s3tc:vn.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:vn.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:vn.getExtension("WEBGL_compressed_texture_etc"),etc1:vn.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:vn.getExtension("WEBGL_compressed_texture_pvrtc")||vn.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:vn.getExtension("WEBGL_compressed_texture_atc"),astc:vn.getExtension("WEBGL_compressed_texture_astc")}}const bn={extension:{type:X.DetectionParser,priority:2},test:async()=>{const t=Y.ADAPTER.createCanvas().getContext("webgl");return!!t&&(vn=t,!0)},add:async t=>{yn||xn();const e=[];for(const t in yn)yn[t]&&e.push(t);return[...e,...t]},remove:async t=>(yn||xn(),t.filter((t=>!(t in yn))))};$.add(bn);const Tn={827611204:fn.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:fn.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:fn.COMPRESSED_RGBA_S3TC_DXT5_EXT},En={70:fn.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:fn.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:fn.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:fn.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:fn.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:fn.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:fn.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:fn.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:fn.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT},wn=[171,75,84,88,32,49,49,187,13,10,26,10],Sn={[f.UNSIGNED_BYTE]:1,[f.UNSIGNED_SHORT]:2,[f.INT]:4,[f.UNSIGNED_INT]:4,[f.FLOAT]:4,[f.HALF_FLOAT]:8},An={[d.RGBA]:4,[d.RGB]:3,[d.RG]:2,[d.RED]:1,[d.LUMINANCE]:1,[d.LUMINANCE_ALPHA]:2,[d.ALPHA]:1},Cn={[f.UNSIGNED_SHORT_4_4_4_4]:2,[f.UNSIGNED_SHORT_5_5_5_1]:2,[f.UNSIGNED_SHORT_5_6_5]:2};function Rn(t){switch(t){case d.RGBA:return d.RGBA_INTEGER;case d.RGB:return d.RGB_INTEGER;case d.RG:return d.RG_INTEGER;case d.RED:return d.RED_INTEGER;default:return t}}const In={extension:{type:X.LoadParser,priority:Wr.High},test:t=>nn(t,".dds"),async load(t,e,i){const s=await Y.ADAPTER.fetch(t),r=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const i=new Uint32Array(t,0,124/Uint32Array.BYTES_PER_ELEMENT),s=i[3],r=i[4],n=i[7],a=new Uint32Array(t,19*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),o=a[1];if(4&o){const i=a[2];if(808540228!==i){const e=Tn[i],a=new Uint8Array(t,128);return[new gn(a,{format:e,width:r,height:s,levels:n})]}const o=128,h=new Uint32Array(e.buffer,o,20/Uint32Array.BYTES_PER_ELEMENT),l=h[0],c=h[1],u=h[2],d=h[3],p=En[l];if(void 0===p)throw new Error(`DDSParser cannot parse texture data with DXGI format ${l}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===c)throw new Error("DDSParser does not supported 3D texture data");const f=new Array,m=148;if(1===d)f.push(new Uint8Array(t,m));else{const e=mn[p];let i=0,a=r,o=s;for(let t=0;t<n;t++)i+=Math.max(1,a+3&-4)*Math.max(1,o+3&-4)*e,a>>>=1,o>>>=1;let h=m;for(let e=0;e<d;e++)f.push(new Uint8Array(t,h,i)),h+=i}return f.map((t=>new gn(t,{format:p,width:r,height:s,levels:n})))}if(64&o)throw new Error("DDSParser does not support uncompressed texture data.");if(512&o)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&o)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&o)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await s.arrayBuffer()).map((s=>an(new xe(s,{mipmap:v.OFF,alphaMode:y.NO_PREMULTIPLIED_ALPHA,resolution:pe(t),...e.data}),i,t)));return 1===r.length?r[0]:r},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};$.add(In);const Pn={extension:{type:X.LoadParser,priority:Wr.High},test:t=>nn(t,".ktx"),async load(t,e,i){const s=await Y.ADAPTER.fetch(t),r=await s.arrayBuffer(),{compressed:n,uncompressed:a,kvData:o}=function(t,e,i=!1){const s=new DataView(e);if(!function(t,e){for(let t=0;t<wn.length;t++)if(e.getUint8(t)!==wn[t])return!1;return!0}(0,s))return null;const r=67305985===s.getUint32(12,!0),n=s.getUint32(16,r),a=s.getUint32(24,r),o=s.getUint32(28,r),h=s.getUint32(36,r),l=s.getUint32(40,r)||1,c=s.getUint32(44,r)||1,u=s.getUint32(48,r)||1,d=s.getUint32(52,r),p=s.getUint32(56,r),m=s.getUint32(60,r);if(0===l||1!==c)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const _=h+3&-4,g=l+3&-4,v=new Array(u);let y,x=h*l;if(0===n&&(x=_*g),y=0!==n?Sn[n]?Sn[n]*An[a]:Cn[n]:mn[o],void 0===y)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const b=i?function(t,e,i){const s=new Map;let r=0;for(;r<e;){const n=t.getUint32(64+r,i),a=64+r+4,o=3-(n+3)%4;if(0===n||n>e-r){console.error("KTXLoader: keyAndValueByteSize out of bounds");break}let h=0;for(;h<n&&0!==t.getUint8(a+h);h++);if(-1===h){console.error("KTXLoader: Failed to find null byte terminating kvData key");break}const l=(new TextDecoder).decode(new Uint8Array(t.buffer,a,h)),c=new DataView(t.buffer,a+h+1,n-h-1);s.set(l,c),r+=4+n+o}return s}(s,m,r):null;let T=x*y,E=h,w=l,S=_,A=g,C=64+m;for(let t=0;t<p;t++){const i=s.getUint32(C,r);let a=C+4;for(let i=0;i<u;i++){let s=v[i];s||(s=v[i]=new Array(p)),s[t]={levelID:t,levelWidth:p>1||0!==n?E:S,levelHeight:p>1||0!==n?w:A,levelBuffer:new Uint8Array(e,a,T)},a+=T}C+=i+4,C=C%4!=0?C+4-C%4:C,E=E>>1||1,w=w>>1||1,S=E+4-1&-4,A=w+4-1&-4,T=S*A*y}return 0!==n?{uncompressed:v.map((t=>{let e=t[0].levelBuffer,i=!1;return n===f.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):n===f.UNSIGNED_INT?(i=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):n===f.INT&&(i=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new ge(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:n,format:i?Rn(a):a}})),kvData:b}:{compressed:v.map((t=>new gn(null,{format:o,width:h,height:l,levels:p,levelBuffers:t}))),kvData:b}}(0,r),h=n??a,l={mipmap:v.OFF,alphaMode:y.NO_PREMULTIPLIED_ALPHA,resolution:pe(t),...e.data},c=h.map((e=>{h===a&&Object.assign(l,{type:e.type,format:e.format});const s=new xe(e,l);return s.ktxKeyValueData=o,an(s,i,t)}));return 1===c.length?c[0]:c},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};$.add(Pn);const kn={extension:X.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{if("ktx"===t.split("?")[0].split(".").pop()){const e=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(e.some((e=>t.endsWith(e))))return{resolution:parseFloat(Y.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat(Y.RETINA_PREFIX.exec(t)?.[1]??"1"),format:t.split(".").pop(),src:t}}};$.add(kn);const Dn=new tt,Mn=class{constructor(t){this.renderer=t}async image(t,e,i){const s=new Image;return s.src=await this.base64(t,e,i),s}async base64(t,e,i){const s=this.canvas(t);if(void 0!==s.toDataURL)return s.toDataURL(e,i);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:i});return await new Promise((e=>{const i=new FileReader;i.onload=()=>e(i.result),i.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(t,e){const i=this.renderer;let s,r,n=!1,a=!1;t&&(t instanceof Ue?r=t:(r=this.renderer.generateTexture(t),a=!0)),r?(s=r.baseTexture.resolution,e=e??r.frame,n=!1,i.renderTexture.bind(r)):(s=i.resolution,e||((e=Dn).width=i.width,e.height=i.height),n=!0,i.renderTexture.bind(null));const o=Math.round(e.width*s),h=Math.round(e.height*s);let l=new oe(o,h,1);const c=new Uint8Array(4*o*h),u=i.gl;u.readPixels(Math.round(e.x*s),Math.round(e.y*s),o,h,u.RGBA,u.UNSIGNED_BYTE,c);const d=l.context.getImageData(0,0,o,h);if(Mn.arrayPostDivide(c,d.data),l.context.putImageData(d,0,0),n){const t=new oe(l.width,l.height,1);t.context.scale(1,-1),t.context.drawImage(l.canvas,0,-h),l.destroy(),l=t}return a&&r.destroy(!0),l.canvas}pixels(t,e){const i=this.renderer;let s,r,n=!1;t&&(t instanceof Ue?r=t:(r=this.renderer.generateTexture(t),n=!0)),r?(s=r.baseTexture.resolution,e=e??r.frame,i.renderTexture.bind(r)):(s=i.resolution,e||((e=Dn).width=i.width,e.height=i.height),i.renderTexture.bind(null));const a=Math.round(e.width*s),o=Math.round(e.height*s),h=new Uint8Array(4*a*o),l=i.gl;return l.readPixels(Math.round(e.x*s),Math.round(e.y*s),a,o,l.RGBA,l.UNSIGNED_BYTE,h),n&&r.destroy(!0),Mn.arrayPostDivide(h,h),h}destroy(){this.renderer=null}static arrayPostDivide(t,e){for(let i=0;i<t.length;i+=4){const s=e[i+3]=t[i+3];0!==s?(e[i]=Math.round(Math.min(255*t[i]/s,255)),e[i+1]=Math.round(Math.min(255*t[i+1]/s,255)),e[i+2]=Math.round(Math.min(255*t[i+2]/s,255))):(e[i]=t[i],e[i+1]=t[i+1],e[i+2]=t[i+2])}}};let Bn=Mn;Bn.extension={name:"extract",type:X.RendererSystem},$.add(Bn);var Nn=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(Nn||{}),Ln=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(Ln||{});const On={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let i=Math.ceil(t/this.maxLength);return i<this.minSegments?i=this.minSegments:i>this.maxSegments&&(i=this.maxSegments),i}};class Fn{constructor(){this.color=16777215,this.alpha=1,this.texture=Fe.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new Fn;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=Fe.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}function Un(t,e=!1){const i=t.length;if(i<6)return;let s=0;for(let e=0,r=t[i-2],n=t[i-1];e<i;e+=2){const i=t[e],a=t[e+1];s+=(i-r)*(a+n),r=i,n=a}if(!e&&s>0||e&&s<=0){const e=i/2;for(let s=e+e%2;s<i;s+=2){const e=i-s-2,r=i-s-1,n=s,a=s+1;[t[e],t[n]]=[t[n],t[e]],[t[r],t[a]]=[t[a],t[r]]}}}const Gn={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let i=t.points;const s=t.holes,r=e.points,n=e.indices;if(i.length>=6){Un(i,!1);const t=[];for(let e=0;e<s.length;e++){const r=s[e];Un(r.points,!0),t.push(i.length/2),i=i.concat(r.points)}const e=Et(i,t,2);if(!e)return;const a=r.length/2;for(let t=0;t<e.length;t+=3)n.push(e[t]+a),n.push(e[t+1]+a),n.push(e[t+2]+a);for(let t=0;t<i.length;t++)r.push(i[t])}}},zn={build(t){const e=t.points;let i,s,r,n,a,o;if(t.type===K.CIRC){const e=t.shape;i=e.x,s=e.y,a=o=e.radius,r=n=0}else if(t.type===K.ELIP){const e=t.shape;i=e.x,s=e.y,a=e.width,o=e.height,r=n=0}else{const e=t.shape,h=e.width/2,l=e.height/2;i=e.x+h,s=e.y+l,a=o=Math.max(0,Math.min(e.radius,Math.min(h,l))),r=h-a,n=l-o}if(!(a>=0&&o>=0&&r>=0&&n>=0))return void(e.length=0);const h=Math.ceil(2.3*Math.sqrt(a+o)),l=8*h+(r?4:0)+(n?4:0);if(e.length=l,0===l)return;if(0===h)return e.length=8,e[0]=e[6]=i+r,e[1]=e[3]=s+n,e[2]=e[4]=i-r,void(e[5]=e[7]=s-n);let c=0,u=4*h+(r?2:0)+2,d=u,p=l;{const t=r+a,o=n,h=i+t,l=i-t,f=s+o;if(e[c++]=h,e[c++]=f,e[--u]=f,e[--u]=l,n){const t=s-o;e[d++]=l,e[d++]=t,e[--p]=t,e[--p]=h}}for(let t=1;t<h;t++){const l=Math.PI/2*(t/h),f=r+Math.cos(l)*a,m=n+Math.sin(l)*o,_=i+f,g=i-f,v=s+m,y=s-m;e[c++]=_,e[c++]=v,e[--u]=v,e[--u]=g,e[d++]=g,e[d++]=y,e[--p]=y,e[--p]=_}{const t=n+o,a=i+r,h=i-r,l=s+t,u=s-t;e[c++]=a,e[c++]=l,e[--p]=u,e[--p]=a,r&&(e[c++]=h,e[c++]=l,e[--p]=u,e[--p]=h)}},triangulate(t,e){const i=t.points,s=e.points,r=e.indices;if(0===i.length)return;let n=s.length/2;const a=n;let o,h;if(t.type!==K.RREC){const e=t.shape;o=e.x,h=e.y}else{const e=t.shape;o=e.x+e.width/2,h=e.y+e.height/2}const l=t.matrix;s.push(t.matrix?l.a*o+l.c*h+l.tx:o,t.matrix?l.b*o+l.d*h+l.ty:h),n++,s.push(i[0],i[1]);for(let t=2;t<i.length;t+=2)s.push(i[t],i[t+1]),r.push(n++,a,n);r.push(a+1,a,n)}},jn={build(t){const e=t.shape,i=e.x,s=e.y,r=e.width,n=e.height,a=t.points;a.length=0,r>=0&&n>=0&&a.push(i,s,i+r,s,i+r,s+n,i,s+n)},triangulate(t,e){const i=t.points,s=e.points;if(0===i.length)return;const r=s.length/2;s.push(i[0],i[1],i[2],i[3],i[6],i[7],i[4],i[5]),e.indices.push(r,r+1,r+2,r+1,r+2,r+3)}},Hn={build(t){zn.build(t)},triangulate(t,e){zn.triangulate(t,e)}};function Yn(t,e,i,s,r,n,a,o){let h,l;a?(h=s,l=-i):(h=-s,l=i);const c=t-i*r+h,u=e-s*r+l,d=t+i*n+h,p=e+s*n+l;return o.push(c,u),o.push(d,p),2}function Xn(t,e,i,s,r,n,a,o){const h=i-t,l=s-e;let c=Math.atan2(h,l),u=Math.atan2(r-t,n-e);o&&c<u?c+=2*Math.PI:!o&&c>u&&(u+=2*Math.PI);let d=c;const p=u-c,f=Math.abs(p),m=Math.sqrt(h*h+l*l),_=1+(15*f*Math.sqrt(m)/Math.PI>>0),g=p/_;if(d+=g,o){a.push(t,e),a.push(i,s);for(let i=1,s=d;i<_;i++,s+=g)a.push(t,e),a.push(t+Math.sin(s)*m,e+Math.cos(s)*m);a.push(t,e),a.push(r,n)}else{a.push(i,s),a.push(t,e);for(let i=1,s=d;i<_;i++,s+=g)a.push(t+Math.sin(s)*m,e+Math.cos(s)*m),a.push(t,e);a.push(r,n),a.push(t,e)}return 2*_}function Wn(t,e){t.lineStyle.native?function(t,e){let i=0;const s=t.shape,r=t.points||s.points,n=s.type!==K.POLY||s.closeStroke;if(0===r.length)return;const a=e.points,o=e.indices,h=r.length/2,l=a.length/2;let c=l;for(a.push(r[0],r[1]),i=1;i<h;i++)a.push(r[2*i],r[2*i+1]),o.push(c,c+1),c++;n&&o.push(c,l)}(t,e):function(t,e){const i=t.shape;let s=t.points||i.points.slice();const r=e.closePointEps;if(0===s.length)return;const n=t.lineStyle,a=new J(s[0],s[1]),o=new J(s[s.length-2],s[s.length-1]),h=i.type!==K.POLY||i.closeStroke,l=Math.abs(a.x-o.x)<r&&Math.abs(a.y-o.y)<r;if(h){s=s.slice(),l&&(s.pop(),s.pop(),o.set(s[s.length-2],s[s.length-1]));const t=.5*(a.x+o.x),e=.5*(o.y+a.y);s.unshift(t,e),s.push(t,e)}const c=e.points,u=s.length/2;let d=s.length;const p=c.length/2,f=n.width/2,m=f*f,_=n.miterLimit*n.miterLimit;let g=s[0],v=s[1],y=s[2],x=s[3],b=0,T=0,E=-(v-x),w=g-y,S=0,A=0,C=Math.sqrt(E*E+w*w);E/=C,w/=C,E*=f,w*=f;const R=n.alignment,I=2*(1-R),P=2*R;h||(n.cap===Ln.ROUND?d+=Xn(g-E*(I-P)*.5,v-w*(I-P)*.5,g-E*I,v-w*I,g+E*P,v+w*P,c,!0)+2:n.cap===Ln.SQUARE&&(d+=Yn(g,v,E,w,I,P,!0,c))),c.push(g-E*I,v-w*I),c.push(g+E*P,v+w*P);for(let t=1;t<u-1;++t){g=s[2*(t-1)],v=s[2*(t-1)+1],y=s[2*t],x=s[2*t+1],b=s[2*(t+1)],T=s[2*(t+1)+1],E=-(v-x),w=g-y,C=Math.sqrt(E*E+w*w),E/=C,w/=C,E*=f,w*=f,S=-(x-T),A=y-b,C=Math.sqrt(S*S+A*A),S/=C,A/=C,S*=f,A*=f;const e=y-g,i=v-x,r=y-b,a=T-x,o=e*r+i*a,h=i*r-a*e,l=h<0;if(Math.abs(h)<.001*Math.abs(o)){c.push(y-E*I,x-w*I),c.push(y+E*P,x+w*P),o>=0&&(n.join===Nn.ROUND?d+=Xn(y,x,y-E*I,x-w*I,y-S*I,x-A*I,c,!1)+4:d+=2,c.push(y-S*P,x-A*P),c.push(y+S*I,x+A*I));continue}const u=(-E+g)*(-w+x)-(-E+y)*(-w+v),p=(-S+b)*(-A+x)-(-S+y)*(-A+T),R=(e*p-r*u)/h,k=(a*u-i*p)/h,D=(R-y)*(R-y)+(k-x)*(k-x),M=y+(R-y)*I,B=x+(k-x)*I,N=y-(R-y)*P,L=x-(k-x)*P,O=l?I:P;D<=Math.min(e*e+i*i,r*r+a*a)+O*O*m?n.join===Nn.BEVEL||D/m>_?(l?(c.push(M,B),c.push(y+E*P,x+w*P),c.push(M,B),c.push(y+S*P,x+A*P)):(c.push(y-E*I,x-w*I),c.push(N,L),c.push(y-S*I,x-A*I),c.push(N,L)),d+=2):n.join===Nn.ROUND?l?(c.push(M,B),c.push(y+E*P,x+w*P),d+=Xn(y,x,y+E*P,x+w*P,y+S*P,x+A*P,c,!0)+4,c.push(M,B),c.push(y+S*P,x+A*P)):(c.push(y-E*I,x-w*I),c.push(N,L),d+=Xn(y,x,y-E*I,x-w*I,y-S*I,x-A*I,c,!1)+4,c.push(y-S*I,x-A*I),c.push(N,L)):(c.push(M,B),c.push(N,L)):(c.push(y-E*I,x-w*I),c.push(y+E*P,x+w*P),n.join===Nn.ROUND?d+=l?Xn(y,x,y+E*P,x+w*P,y+S*P,x+A*P,c,!0)+2:Xn(y,x,y-E*I,x-w*I,y-S*I,x-A*I,c,!1)+2:n.join===Nn.MITER&&D/m<=_&&(l?(c.push(N,L),c.push(N,L)):(c.push(M,B),c.push(M,B)),d+=2),c.push(y-S*I,x-A*I),c.push(y+S*P,x+A*P),d+=2)}g=s[2*(u-2)],v=s[2*(u-2)+1],y=s[2*(u-1)],x=s[2*(u-1)+1],E=-(v-x),w=g-y,C=Math.sqrt(E*E+w*w),E/=C,w/=C,E*=f,w*=f,c.push(y-E*I,x-w*I),c.push(y+E*P,x+w*P),h||(n.cap===Ln.ROUND?d+=Xn(y-E*(I-P)*.5,x-w*(I-P)*.5,y-E*I,x-w*I,y+E*P,x+w*P,c,!1)+2:n.cap===Ln.SQUARE&&(d+=Yn(y,x,E,w,I,P,!1,c)));const k=e.indices,D=On.epsilon*On.epsilon;for(let t=p;t<d+p-2;++t)g=c[2*t],v=c[2*t+1],y=c[2*(t+1)],x=c[2*(t+1)+1],b=c[2*(t+2)],T=c[2*(t+2)+1],Math.abs(g*(x-T)+y*(T-v)+b*(v-x))<D||k.push(t,t+1,t+2)}(t,e)}class $n{static curveTo(t,e,i,s,r,n){const a=n[n.length-2],o=n[n.length-1]-e,h=a-t,l=s-e,c=i-t,u=Math.abs(o*c-h*l);if(u<1e-8||0===r)return n[n.length-2]===t&&n[n.length-1]===e||n.push(t,e),null;const d=o*o+h*h,p=l*l+c*c,f=o*l+h*c,m=r*Math.sqrt(d)/u,_=r*Math.sqrt(p)/u,g=m*f/d,v=_*f/p,y=m*c+_*h,x=m*l+_*o,b=h*(_+g),T=o*(_+g),E=c*(m+v),w=l*(m+v);return{cx:y+t,cy:x+e,radius:r,startAngle:Math.atan2(T-x,b-y),endAngle:Math.atan2(w-x,E-y),anticlockwise:h*l>c*o}}static arc(t,e,i,s,r,n,a,o,h){const l=a-n,c=On._segmentsCount(Math.abs(l)*r,40*Math.ceil(Math.abs(l)/V)),u=l/(2*c),d=2*u,p=Math.cos(u),f=Math.sin(u),m=c-1,_=m%1/m;for(let t=0;t<=m;++t){const e=u+n+d*(t+_*t),a=Math.cos(e),o=-Math.sin(e);h.push((p*a+f*o)*r+i,(p*-o+f*a)*r+s)}}}class Vn{static curveLength(t,e,i,s,r,n,a,o){let h=0,l=0,c=0,u=0,d=0,p=0,f=0,m=0,_=0,g=0,v=0,y=t,x=e;for(let b=1;b<=10;++b)l=b/10,c=l*l,u=c*l,d=1-l,p=d*d,f=p*d,m=f*t+3*p*l*i+3*d*c*r+u*a,_=f*e+3*p*l*s+3*d*c*n+u*o,g=y-m,v=x-_,y=m,x=_,h+=Math.sqrt(g*g+v*v);return h}static curveTo(t,e,i,s,r,n,a){const o=a[a.length-2],h=a[a.length-1];a.length-=2;const l=On._segmentsCount(Vn.curveLength(o,h,t,e,i,s,r,n));let c=0,u=0,d=0,p=0,f=0;a.push(o,h);for(let m=1,_=0;m<=l;++m)_=m/l,c=1-_,u=c*c,d=u*c,p=_*_,f=p*_,a.push(d*o+3*u*_*t+3*c*p*i+f*r,d*h+3*u*_*e+3*c*p*s+f*n)}}class qn{static curveLength(t,e,i,s,r,n){const a=t-2*i+r,o=e-2*s+n,h=2*i-2*t,l=2*s-2*e,c=4*(a*a+o*o),u=4*(a*h+o*l),d=h*h+l*l,p=2*Math.sqrt(c+u+d),f=Math.sqrt(c),m=2*c*f,_=2*Math.sqrt(d),g=u/f;return(m*p+f*u*(p-_)+(4*d*c-u*u)*Math.log((2*f+g+p)/(g+_)))/(4*m)}static curveTo(t,e,i,s,r){const n=r[r.length-2],a=r[r.length-1],o=On._segmentsCount(qn.curveLength(n,a,t,e,i,s));let h=0,l=0;for(let c=1;c<=o;++c){const u=c/o;h=n+(t-n)*u,l=a+(e-a)*u,r.push(h+(t+(i-t)*u-h)*u,l+(e+(s-e)*u-l)*u)}}}const Zn={[K.POLY]:Gn,[K.CIRC]:zn,[K.ELIP]:zn,[K.RECT]:jn,[K.RREC]:Hn},Kn=[],Jn=[];class Qn{constructor(t,e=null,i=null,s=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=i,this.fillStyle=e,this.matrix=s,this.type=t.type}clone(){return new Qn(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}class ta{constructor(){this.reset()}begin(t,e,i){this.reset(),this.style=t,this.start=e,this.attribStart=i}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}const ea=new J,ia=class extends Ss{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Ds,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jn.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),Kn.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,i=null,s=null){const r=new Qn(t,e,i,s);return this.graphicsData.push(r),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const i=new Qn(t,null,null,e),s=this.graphicsData[this.graphicsData.length-1];return i.lineStyle=s.lineStyle,s.holes.push(i),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let i=0;i<e.length;++i){const s=e[i];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,ea):ea.copyFrom(t),s.shape.contains(ea.x,ea.y))){let t=!1;if(s.holes)for(let e=0;e<s.holes.length;e++)if(s.holes[e].shape.contains(ea.x,ea.y)){t=!0;break}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let i=null,s=null;this.batches.length>0&&(i=this.batches[this.batches.length-1],s=i.style);for(let r=this.shapeIndex;r<e.length;r++){this.shapeIndex++;const n=e[r],a=n.fillStyle,o=n.lineStyle;Zn[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix),(a.visible||o.visible)&&this.processHoles(n.holes);for(let e=0;e<2;e++){const r=0===e?a:o;if(!r.visible)continue;const h=r.texture.baseTexture,l=this.indices.length,c=this.points.length/2;h.wrapMode=g.REPEAT,0===e?this.processFill(n):this.processLine(n);const u=this.points.length/2-c;0!==u&&(i&&!this._compareStyles(s,r)&&(i.end(l,c),i=null),i||(i=Kn.pop()||new ta,i.begin(r,l,c),this.batches.push(i),s=r),this.addUvs(this.points,t,r.texture,c,u,r.matrix))}}const r=this.indices.length,n=this.points.length/2;if(i&&i.end(r,n),0===this.batches.length)return void(this.batchable=!0);const a=n>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&a===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=a?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&t.texture.baseTexture===e.texture.baseTexture&&t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],i=e.fillStyle,s=e.lineStyle;if(i&&!i.texture.baseTexture.valid)return!1;if(s&&!s.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,i=t.length;e<i;e++){const i=t[e];for(let t=0;t<i.size;t++){const e=i.start+t;this.indicesUint16[e]=this.indicesUint16[e]-i.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*ia.BATCHABLE_SIZE}buildDrawCalls(){let t=++xe._globalBatch;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Jn.push(this.drawCalls[t]);this.drawCalls.length=0;const e=this.colors,i=this.textureIds;let s=Jn.pop();s||(s=new bs,s.texArray=new Ts),s.texArray.count=0,s.start=0,s.size=0,s.type=u.TRIANGLES;let r=0,n=null,a=0,o=!1,h=u.TRIANGLES,l=0;this.drawCalls.push(s);for(let c=0;c<this.batches.length;c++){const d=this.batches[c],p=8,f=d.style,m=f.texture.baseTexture;o!==!!f.native&&(o=!!f.native,h=o?u.LINES:u.TRIANGLES,n=null,r=p,t++),n!==m&&(n=m,m._batchEnabled!==t&&(r===p&&(t++,r=0,s.size>0&&(s=Jn.pop(),s||(s=new bs,s.texArray=new Ts),this.drawCalls.push(s)),s.start=l,s.size=0,s.texArray.count=0,s.type=h),m.touched=1,m._batchEnabled=t,m._batchLocation=r,m.wrapMode=g.REPEAT,s.texArray.elements[s.texArray.count++]=m,r++)),s.size+=d.size,l+=d.size,a=m._batchLocation,this.addColors(e,f.color,f.alpha,d.attribSize,d.attribStart),this.addTextureIds(i,a,d.attribSize,d.attribStart)}xe._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,i=this.colors,s=this.textureIds,r=new ArrayBuffer(3*t.length*4),n=new Float32Array(r),a=new Uint32Array(r);let o=0;for(let r=0;r<t.length/2;r++)n[o++]=t[2*r],n[o++]=t[2*r+1],n[o++]=e[2*r],n[o++]=e[2*r+1],a[o++]=i[r],n[o++]=s[r];this._buffer.update(r),this._indexBuffer.update(this.indicesUint16)}processFill(t){t.holes.length?Gn.triangulate(t,this):Zn[t.type].triangulate(t,this)}processLine(t){Wn(t,this);for(let e=0;e<t.holes.length;e++)Wn(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const i=t[e];Zn[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let i=0;i<t.length/2;i++){const s=t[2*i],r=t[2*i+1];t[2*i]=e.a*s+e.c*r+e.tx,t[2*i+1]=e.b*s+e.d*r+e.ty}}addColors(t,e,i,s,r=0){const n=zt((e>>16)+(65280&e)+((255&e)<<16),i);t.length=Math.max(t.length,r+s);for(let e=0;e<s;e++)t[r+e]=n}addTextureIds(t,e,i,s=0){t.length=Math.max(t.length,s+i);for(let r=0;r<i;r++)t[s+r]=e}addUvs(t,e,i,s,r,n=null){let a=0;const o=e.length,h=i.frame;for(;a<r;){let i=t[2*(s+a)],r=t[2*(s+a)+1];if(n){const t=n.a*i+n.c*r+n.tx;r=n.b*i+n.d*r+n.ty,i=t}a++,e.push(i/h.width,r/h.height)}const l=i.baseTexture;(h.width<l.width||h.height<l.height)&&this.adjustUvs(e,i,o,r)}adjustUvs(t,e,i,s){const r=e.baseTexture,n=1e-6,a=i+2*s,o=e.frame,h=o.width/r.width,l=o.height/r.height;let c=o.x/o.width,u=o.y/o.height,d=Math.floor(t[i]+n),p=Math.floor(t[i+1]+n);for(let e=i+2;e<a;e+=2)d=Math.min(d,Math.floor(t[e]+n)),p=Math.min(p,Math.floor(t[e+1]+n));c-=d,u-=p;for(let e=i;e<a;e+=2)t[e]=(t[e]+c)*h,t[e+1]=(t[e+1]+u)*l}};let sa=ia;sa.BATCHABLE_SIZE=100;class ra extends Fn{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=Ln.BUTT,this.join=Nn.MITER,this.miterLimit=10}clone(){const t=new ra;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const na=new Float32Array(3),aa={},oa=class extends Ls{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new Fn,this._lineStyle=new ra,this._matrix=null,this._holeMode=!1,this.state=ki.for2d(),this._geometry=t||new sa,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=c.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new oa(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(t){this._tint=t}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,i=1,s=.5,r=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:i,alignment:s,native:r}),this.lineTextureStyle(t)}lineTextureStyle(t){t=Object.assign({width:0,texture:Fe.WHITE,color:t?.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ln.BUTT,join:Nn.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();const e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new st,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new st,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const i=this.currentPath.points,s=i[i.length-2],r=i[i.length-1];return s===t&&r===e||i.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this._initCurve();const r=this.currentPath.points;return 0===r.length&&this.moveTo(0,0),qn.curveTo(t,e,i,s,r),this}bezierCurveTo(t,e,i,s,r,n){return this._initCurve(),Vn.curveTo(t,e,i,s,r,n,this.currentPath.points),this}arcTo(t,e,i,s,r){this._initCurve(t,e);const n=this.currentPath.points,a=$n.curveTo(t,e,i,s,r,n);if(a){const{cx:t,cy:e,radius:i,startAngle:s,endAngle:r,anticlockwise:n}=a;this.arc(t,e,i,s,r,n)}return this}arc(t,e,i,s,r,n=!1){if(s===r)return this;if(!n&&r<=s?r+=V:n&&s<=r&&(s+=V),0==r-s)return this;const a=t+Math.cos(s)*i,o=e+Math.sin(s)*i,h=this._geometry.closePointEps;let l=this.currentPath?this.currentPath.points:null;if(l){const t=Math.abs(l[l.length-2]-a),e=Math.abs(l[l.length-1]-o);t<h&&e<h||l.push(a,o)}else this.moveTo(a,o),l=this.currentPath.points;return $n.arc(a,o,t,e,i,s,r,n,l),this}beginFill(t=0,e=1){return this.beginTextureFill({texture:Fe.WHITE,color:t,alpha:e})}beginTextureFill(t){t=Object.assign({texture:Fe.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();const e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,i,s){return this.drawShape(new tt(t,e,i,s))}drawRoundedRect(t,e,i,s,r){return this.drawShape(new rt(t,e,i,s,r))}drawCircle(t,e,i){return this.drawShape(new et(t,e,i))}drawEllipse(t,e,i,s){return this.drawShape(new it(t,e,i,s))}drawPolygon(...t){let e,i=!0;const s=t[0];s.points?(i=s.closeStroke,e=s.points):e=Array.isArray(t[0])?t[0]:t;const r=new st(e);return r.closeStroke=i,this.drawShape(r),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==K.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,i=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=i,this.vertexData=new Float32Array(t.points);for(let s=0;s<i;s++){const i=t.batches[s],r=i.style.color,n=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),a=new Float32Array(t.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),o={vertexData:n,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*i.start,i.size),uvs:a,_batchRGB:Bt(r),_tintRGB:r,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[s]=o}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,i=this.batches.length;e<i;e++){const i=this.batches[e];i.worldAlpha=this.worldAlpha*i.alpha,t.plugins[this.pluginName].render(i)}}}_renderDirect(t){const e=this._resolveDirectShader(t),i=this._geometry,s=this.tint,r=this.worldAlpha,n=e.uniforms,a=i.drawCalls;n.translationMatrix=this.transform.worldTransform,n.tint[0]=(s>>16&255)/255*r,n.tint[1]=(s>>8&255)/255*r,n.tint[2]=(255&s)/255*r,n.tint[3]=r,t.shader.bind(e),t.geometry.bind(i,e),t.state.set(this.state);for(let e=0,s=a.length;e<s;e++)this._renderDrawCallDirect(t,i.drawCalls[e])}_renderDrawCallDirect(t,e){const{texArray:i,type:s,size:r,start:n}=e,a=i.count;for(let e=0;e<a;e++)t.texture.bind(i.elements[e],e);t.geometry.draw(s,r,n)}_resolveDirectShader(t){let e=this.shader;const i=this.pluginName;if(!e){if(!aa[i]){const{MAX_TEXTURES:e}=t.plugins[i],s=new Int32Array(e);for(let t=0;t<e;t++)s[t]=t;const r={tint:new Float32Array([1,1,1,1]),translationMatrix:new at,default:Je.from({uSamplers:s},!0)},n=t.plugins[i]._shader.program;aa[i]=new Pi(n,r)}e=aa[i]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:i,maxX:s,maxY:r}=t.bounds;this._bounds.addFrame(this.transform,e,i,s,r)}containsPoint(t){return this.worldTransform.applyInverse(t,oa._TEMP_POINT),this._geometry.containsPoint(oa._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const t=Bt(this.tint,na);for(let e=0;e<this.batches.length;e++){const i=this.batches[e],s=i._batchRGB,r=(t[0]*s[0]*255<<16)+(t[1]*s[1]*255<<8)+(0|t[2]*s[2]*255);i._tintRGB=(r>>16)+(65280&r)+((255&r)<<16)}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,i=e.a,s=e.b,r=e.c,n=e.d,a=e.tx,o=e.ty,h=this._geometry.points,l=this.vertexData;let c=0;for(let t=0;t<h.length;t+=2){const e=h[t],u=h[t+1];l[c++]=i*e+r*u+a,l[c++]=n*u+s*e+o}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let ha=oa;ha._TEMP_POINT=new J;class la{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const ca=new J,ua=new st,da=class extends Ls{constructor(t,e,i,s=u.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=i||ki.for2d(),this.drawMode=s,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=Y.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===u.TRIANGLES&&e.length<2*da.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,i=this.shader;i.uvMatrix&&(i.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=i._tintRGB,this._texture=i.texture;const s=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[s]),t.plugins[s].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,i=t._updateID;if(i===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const s=this.transform.worldTransform,r=s.a,n=s.b,a=s.c,o=s.d,h=s.tx,l=s.ty,c=this.vertexData;for(let t=0;t<c.length/2;t++){const i=e[2*t],s=e[2*t+1];c[2*t]=r*i+a*s+h,c[2*t+1]=n*i+o*s+l}if(this._roundPixels){const t=Y.RESOLUTION;for(let e=0;e<c.length;++e)c[e]=Math.round(c[e]*t)/t}this.vertexDirty=i}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new la(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,ca);const e=this.geometry.getBuffer("aVertexPosition").data,i=ua.points,s=this.geometry.getIndex().data,r=s.length,n=4===this.drawMode?3:1;for(let t=0;t+2<r;t+=n){const r=2*s[t],n=2*s[t+1],a=2*s[t+2];if(i[0]=e[r],i[1]=e[r+1],i[2]=e[n],i[3]=e[n+1],i[4]=e[a],i[5]=e[a+1],ua.contains(ca.x,ca.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let pa=da;pa.BATCHABLE_SIZE=100;class fa extends Pi{constructor(t,e){const i={uSampler:t,alpha:1,uTextureMatrix:at.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(i,e.uniforms),super(e.program||Ii.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),i),this._colorDirty=!1,this.uvMatrix=new Bi(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;jt(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class ma extends Ve{constructor(t,e,i){super();const s=new He(t),r=new He(e,!0),n=new He(i,!0,!0);this.addAttribute("aVertexPosition",s,2,!1,f.FLOAT).addAttribute("aTextureCoord",r,2,!1,f.FLOAT).addIndex(n),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class _a extends ma{constructor(t=100,e=100,i=10,s=10){super(),this.segWidth=i,this.segHeight=s,this.width=t,this.height=e,this.build()}build(){const t=this.segWidth*this.segHeight,e=[],i=[],s=[],r=this.segWidth-1,n=this.segHeight-1,a=this.width/r,o=this.height/n;for(let s=0;s<t;s++){const t=s%this.segWidth,h=s/this.segWidth|0;e.push(t*a,h*o),i.push(t/r,h/n)}const h=r*n;for(let t=0;t<h;t++){const e=t%r,i=t/r|0,n=i*this.segWidth+e,a=i*this.segWidth+e+1,o=(i+1)*this.segWidth+e,h=(i+1)*this.segWidth+e+1;s.push(n,a,o,a,h,o)}this.buffers[0].data=new Float32Array(e),this.buffers[1].data=new Float32Array(i),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}}class ga extends ma{constructor(t=200,e,i=0){super(new Float32Array(4*e.length),new Float32Array(4*e.length),new Uint16Array(6*(e.length-1))),this.points=e,this._width=t,this.textureScale=i,this.build()}get width(){return this._width}build(){const t=this.points;if(!t)return;const e=this.getBuffer("aVertexPosition"),i=this.getBuffer("aTextureCoord"),s=this.getIndex();if(t.length<1)return;e.data.length/4!==t.length&&(e.data=new Float32Array(4*t.length),i.data=new Float32Array(4*t.length),s.data=new Uint16Array(6*(t.length-1)));const r=i.data,n=s.data;r[0]=0,r[1]=0,r[2]=0,r[3]=1;let a=0,o=t[0];const h=this._width*this.textureScale,l=t.length;for(let e=0;e<l;e++){const i=4*e;if(this.textureScale>0){const i=o.x-t[e].x,s=o.y-t[e].y,r=Math.sqrt(i*i+s*s);o=t[e],a+=r/h}else a=e/(l-1);r[i]=a,r[i+1]=0,r[i+2]=a,r[i+3]=1}let c=0;for(let t=0;t<l-1;t++){const e=2*t;n[c++]=e,n[c++]=e+1,n[c++]=e+2,n[c++]=e+2,n[c++]=e+1,n[c++]=e+3}i.update(),s.update(),this.updateVertices()}updateVertices(){const t=this.points;if(t.length<1)return;let e,i=t[0],s=0,r=0;const n=this.buffers[0].data,a=t.length;for(let o=0;o<a;o++){const h=t[o],l=4*o;e=o<t.length-1?t[o+1]:h,r=-(e.x-i.x),s=e.y-i.y;let c=10*(1-o/(a-1));c>1&&(c=1);const u=Math.sqrt(s*s+r*r),d=this.textureScale>0?this.textureScale*this._width/2:this._width/2;s/=u,r/=u,s*=d,r*=d,n[l]=h.x+s,n[l+1]=h.y+r,n[l+2]=h.x-s,n[l+3]=h.y-r,i=h}this.buffers[0].update()}update(){this.textureScale>0?this.build():this.updateVertices()}}class va extends pa{constructor(t,e,i){super(new _a(t.width,t.height,e,i),new fa(Fe.WHITE)),this.texture=t,this.autoResize=!0}textureUpdated(){this._textureID=this.shader.texture._updateID;const t=this.geometry,{width:e,height:i}=this.shader.texture;!this.autoResize||t.width===e&&t.height===i||(t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build())}set texture(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))}get texture(){return this.shader.texture}_render(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),super._render(t)}destroy(t){this.shader.texture.off("update",this.textureUpdated,this),super.destroy(t)}}class ya extends va{constructor(t,e=10,i=10,s=10,r=10){super(Fe.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=e,this._rightWidth=s,this._topHeight=i,this._bottomHeight=r,this.texture=t}textureUpdated(){this._textureID=this.shader.texture._updateID,this._refresh()}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}updateHorizontalVertices(){const t=this.vertices,e=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*e,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*e,t[25]=t[27]=t[29]=t[31]=this._height}updateVerticalVertices(){const t=this.vertices,e=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*e,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*e,t[6]=t[14]=t[22]=t[30]=this._width}_getMinScale(){const t=this._leftWidth+this._rightWidth,e=this._width>t?1:this._width/t,i=this._topHeight+this._bottomHeight,s=this._height>i?1:this._height/i;return Math.min(e,s)}get width(){return this._width}set width(t){this._width=t,this._refresh()}get height(){return this._height}set height(t){this._height=t,this._refresh()}get leftWidth(){return this._leftWidth}set leftWidth(t){this._leftWidth=t,this._refresh()}get rightWidth(){return this._rightWidth}set rightWidth(t){this._rightWidth=t,this._refresh()}get topHeight(){return this._topHeight}set topHeight(t){this._topHeight=t,this._refresh()}get bottomHeight(){return this._bottomHeight}set bottomHeight(t){this._bottomHeight=t,this._refresh()}_refresh(){const t=this.texture,e=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;const i=1/this._origWidth,s=1/this._origHeight;e[0]=e[8]=e[16]=e[24]=0,e[1]=e[3]=e[5]=e[7]=0,e[6]=e[14]=e[22]=e[30]=1,e[25]=e[27]=e[29]=e[31]=1,e[2]=e[10]=e[18]=e[26]=i*this._leftWidth,e[4]=e[12]=e[20]=e[28]=1-i*this._rightWidth,e[9]=e[11]=e[13]=e[15]=s*this._topHeight,e[17]=e[19]=e[21]=e[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()}}Y.UPLOADS_PER_FRAME=4;class xa{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function ba(t,e){let i=!1;if(t?._textures?.length)for(let s=0;s<t._textures.length;s++)if(t._textures[s]instanceof Fe){const r=t._textures[s].baseTexture;e.includes(r)||(e.push(r),i=!0)}return i}function Ta(t,e){if(t.baseTexture instanceof xe){const i=t.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Ea(t,e){if(t._texture&&t._texture instanceof Fe){const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function wa(t,e){return e instanceof gr&&(e.updateText(!0),!0)}function Sa(t,e){if(e instanceof lr){const t=e.toFontString();return fr.measureFont(t),!0}return!1}function Aa(t,e){if(t instanceof gr){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const i=t._texture.baseTexture;return e.includes(i)||e.push(i),!0}return!1}function Ca(t,e){return t instanceof lr&&(e.includes(t)||e.push(t),!0)}class Ra{constructor(t){this.limiter=new xa(Y.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook(Aa),this.registerFindHook(Ca),this.registerFindHook(ba),this.registerFindHook(Ta),this.registerFindHook(Ea),this.registerUploadHook(wa),this.registerUploadHook(Sa)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,xt.system.addOnce(this.tick,this,vt.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let i=0,s=this.uploadHooks.length;i<s;i++)if(this.uploadHooks[i](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)xt.system.addOnce(this.tick,this,vt.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,i=t.length;e<i;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,i=this.addHooks.length;e<i&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Ls)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&xt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}}function Ia(t,e){return e instanceof xe&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function Pa(t,e){if(!(e instanceof ha))return!1;const{geometry:i}=e;e.finishPoly(),i.updateBatches();const{batches:s}=i;for(let e=0;e<s.length;e++){const{texture:i}=s[e].style;i&&Ia(t,i.baseTexture)}return i.batchable||t.geometry.bind(i,e._resolveDirectShader(t)),!0}function ka(t,e){return t instanceof ha&&(e.push(t),!0)}class Da extends Ra{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(ka),this.registerUploadHook(Ia),this.registerUploadHook(Pa)}}Da.extension={name:"prepare",type:X.RendererSystem},$.add(Da);const Ma=class{constructor(t,e,i=null){this.linkedSheets=[],this._texture=t instanceof Fe?t:null,this.baseTexture=t instanceof xe?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const s=this.baseTexture.resource;this.resolution=this._updateResolution(i||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let i=pe(t,null);return null===i&&(i=parseFloat(e??"1")),1!==i&&this.baseTexture.setResolution(i),i}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Ma.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const i=Ma.BATCH_SIZE;for(;e-t<i&&e<this._frameKeys.length;){const t=this._frameKeys[e],i=this._frames[t],s=i.frame;if(s){let e=null,r=null;const n=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,a=new tt(0,0,Math.floor(n.w)/this.resolution,Math.floor(n.h)/this.resolution);e=i.rotated?new tt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.h)/this.resolution,Math.floor(s.w)/this.resolution):new tt(Math.floor(s.x)/this.resolution,Math.floor(s.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(r=new tt(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution)),this.textures[t]=new Fe(this.baseTexture,e,a,r,i.rotated?2:0,i.anchor),Fe.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let i=0;i<t[e].length;i++){const s=t[e][i];this.animations[e].push(this.textures[s])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Ma.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*Ma.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){for(const t in this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(this._texture?.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let Ba=Ma;Ba.BATCH_SIZE=1e3;const Na=["jpg","png","jpeg","avif","webp"];function La(t,e,i){const s={};if(t.forEach((t=>{s[t]=e})),Object.keys(e.textures).forEach((t=>{s[t]=e.textures[t]})),!i){const i=Rt.dirname(t[0]);e.linkedSheets.forEach(((t,r)=>{const n=La([`${i}/${e.data.meta.related_multi_packs[r]}`],t,!0);Object.assign(s,n)}))}return s}const Oa={extension:X.Asset,cache:{test:t=>t instanceof Ba,getCacheableAssets:(t,e)=>La(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),i=e.pop(),s=e.pop();return"json"===i&&Na.includes(s)},parse:t=>{const e=t.split(".");return{resolution:parseFloat(Y.RETINA_PREFIX.exec(t)?.[1]??"1"),format:e[e.length-2],src:t}}},loader:{extension:{type:X.LoadParser,priority:Wr.Normal},testParse:async(t,e)=>Rt.extname(e.src).includes(".json")&&!!t.frames,async parse(t,e,i){let s=Rt.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");const r=s+t.meta.image,n=(await i.load([r]))[r],a=new Ba(n.baseTexture,t,e.src);await a.parse();const o=t?.meta?.related_multi_packs;if(Array.isArray(o)){const t=[];for(const r of o){if("string"!=typeof r)continue;const n=s+r;e.data?.ignoreMultiPack||t.push(i.load({src:n,data:{ignoreMultiPack:!0}}))}const r=await Promise.all(t);a.linkedSheets=r,r.forEach((t=>{t.linkedSheets=[a].concat(a.linkedSheets.filter((e=>e!==t)))}))}return a},unload(t){t.destroy(!0)}}};$.add(Oa);class Fa extends Us{constructor(t,e=!0){super(t[0]instanceof Fe?t[0]:t[0].texture),this._textures=null,this._durations=null,this._autoUpdate=e,this._isConnectedToTicker=!1,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this._playing=!1,this._previousFrame=null,this.textures=t}stop(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(xt.shared.remove(this.update,this),this._isConnectedToTicker=!1))}play(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(xt.shared.add(this.update,this,vt.HIGH),this._isConnectedToTicker=!0))}gotoAndStop(t){this.stop(),this.currentFrame=t}gotoAndPlay(t){this.currentFrame=t,this.play()}update(t){if(!this._playing)return;const e=this.animationSpeed*t,i=this.currentFrame;if(null!==this._durations){let i=this._currentTime%1*this._durations[this.currentFrame];for(i+=e/60*1e3;i<0;)this._currentTime--,i+=this._durations[this.currentFrame];const s=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);i>=this._durations[this.currentFrame];)i-=this._durations[this.currentFrame]*s,this._currentTime+=s;this._currentTime+=i/this._durations[this.currentFrame]}else this._currentTime+=e;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):i!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<i||this.animationSpeed<0&&this.currentFrame>i)&&this.onLoop(),this.updateTexture())}updateTexture(){const t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))}destroy(t){this.stop(),super.destroy(t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null}static fromFrames(t){const e=[];for(let i=0;i<t.length;++i)e.push(Fe.from(t[i]));return new Fa(e)}static fromImages(t){const e=[];for(let i=0;i<t.length;++i)e.push(Fe.from(t[i]));return new Fa(e)}get totalFrames(){return this._textures.length}get textures(){return this._textures}set textures(t){if(t[0]instanceof Fe)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(let e=0;e<t.length;e++)this._textures.push(t[e].texture),this._durations.push(t[e].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()}get currentFrame(){let t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t}set currentFrame(t){if(t<0||t>this.totalFrames-1)throw new Error(`[AnimatedSprite]: Invalid frame index value ${t}, expected to be between 0 and totalFrames ${this.totalFrames}.`);const e=this.currentFrame;this._currentTime=t,e!==this.currentFrame&&this.updateTexture()}get playing(){return this._playing}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(xt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(xt.shared.add(this.update,this),this._isConnectedToTicker=!0))}}class Ua{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class Ga{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),i={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const t in e){const s=e[t].match(/^[a-z]+/gm)[0],r=e[t].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),n={};for(const t in r){const e=r[t].split("="),i=e[0],s=e[1].replace(/"/gm,""),a=parseFloat(s),o=isNaN(a)?s:a;n[i]=o}i[s].push(n)}const s=new Ua;return i.info.forEach((t=>s.info.push({face:t.face,size:parseInt(t.size,10)}))),i.common.forEach((t=>s.common.push({lineHeight:parseInt(t.lineHeight,10)}))),i.page.forEach((t=>s.page.push({id:parseInt(t.id,10),file:t.file}))),i.char.forEach((t=>s.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),i.kerning.forEach((t=>s.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),i.distanceField.forEach((t=>s.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),s}}class za{static test(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new Ua,i=t.getElementsByTagName("info"),s=t.getElementsByTagName("common"),r=t.getElementsByTagName("page"),n=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),o=t.getElementsByTagName("distanceField");for(let t=0;t<i.length;t++)e.info.push({face:i[t].getAttribute("face"),size:parseInt(i[t].getAttribute("size"),10)});for(let t=0;t<s.length;t++)e.common.push({lineHeight:parseInt(s[t].getAttribute("lineHeight"),10)});for(let t=0;t<r.length;t++)e.page.push({id:parseInt(r[t].getAttribute("id"),10)||0,file:r[t].getAttribute("file")});for(let t=0;t<n.length;t++){const i=n[t];e.char.push({id:parseInt(i.getAttribute("id"),10),page:parseInt(i.getAttribute("page"),10)||0,x:parseInt(i.getAttribute("x"),10),y:parseInt(i.getAttribute("y"),10),width:parseInt(i.getAttribute("width"),10),height:parseInt(i.getAttribute("height"),10),xoffset:parseInt(i.getAttribute("xoffset"),10),yoffset:parseInt(i.getAttribute("yoffset"),10),xadvance:parseInt(i.getAttribute("xadvance"),10)})}for(let t=0;t<a.length;t++)e.kerning.push({first:parseInt(a[t].getAttribute("first"),10),second:parseInt(a[t].getAttribute("second"),10),amount:parseInt(a[t].getAttribute("amount"),10)});for(let t=0;t<o.length;t++)e.distanceField.push({fieldType:o[t].getAttribute("fieldType"),distanceRange:parseInt(o[t].getAttribute("distanceRange"),10)});return e}}class ja{static test(t){if("string"==typeof t&&t.includes("<font>")){const e=(new globalThis.DOMParser).parseFromString(t,"text/xml");return za.test(e)}return!1}static parse(t){const e=(new globalThis.DOMParser).parseFromString(t,"text/xml");return za.parse(e)}}const Ha=[Ga,za,ja];function Ya(t,e,i,s,r,n,a){const o=i.text,h=i.fontProperties;e.translate(s,r),e.scale(n,n);const l=a.strokeThickness/2,c=-a.strokeThickness/2;if(e.font=a.toFontString(),e.lineWidth=a.strokeThickness,e.textBaseline=a.textBaseline,e.lineJoin=a.lineJoin,e.miterLimit=a.miterLimit,e.fillStyle=function(t,e,i,s,r,n){const a=i.fill;if(!Array.isArray(a))return a;if(1===a.length)return a[0];let o;const h=i.dropShadow?i.dropShadowDistance:0,l=i.padding||0,c=t.width/s-h-2*l,u=t.height/s-h-2*l,d=a.slice(),p=i.fillGradientStops.slice();if(!p.length){const t=d.length+1;for(let e=1;e<t;++e)p.push(e/t)}if(d.unshift(a[0]),p.unshift(0),d.push(a[a.length-1]),p.push(1),i.fillGradientType===ar.LINEAR_VERTICAL){o=e.createLinearGradient(c/2,l,c/2,u+l);let t=0;const s=(n.fontProperties.fontSize+i.strokeThickness)/u;for(let e=0;e<r.length;e++){const i=n.lineHeight*e;for(let e=0;e<d.length;e++){let r=0;r="number"==typeof p[e]?p[e]:e/d.length;const n=i/u+r*s;let a=Math.max(t,n);a=Math.min(a,1),o.addColorStop(a,d[e]),t=a}}}else{o=e.createLinearGradient(l,u/2,c+l,u/2);const t=d.length+1;let i=1;for(let e=0;e<d.length;e++){let s;s="number"==typeof p[e]?p[e]:i/t,o.addColorStop(s,d[e]),i++}}return o}(t,e,a,n,[o],i),e.strokeStyle=a.stroke,a.dropShadow){const t=a.dropShadowColor,i=Bt("number"==typeof t?t:Lt(t)),s=a.dropShadowBlur*n,r=a.dropShadowDistance*n;e.shadowColor=`rgba(${255*i[0]},${255*i[1]},${255*i[2]},${a.dropShadowAlpha})`,e.shadowBlur=s,e.shadowOffsetX=Math.cos(a.dropShadowAngle)*r,e.shadowOffsetY=Math.sin(a.dropShadowAngle)*r}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;a.stroke&&a.strokeThickness&&e.strokeText(o,l,c+i.lineHeight-h.descent),a.fill&&e.fillText(o,l,c+i.lineHeight-h.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function Xa(t){return Array.from?Array.from(t):t.split("")}function Wa(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}const $a=class{constructor(t,e,i){const[s]=t.info,[r]=t.common,[n]=t.page,[a]=t.distanceField,o=pe(n.file),h={};this._ownsTextures=i,this.font=s.face,this.size=s.size,this.lineHeight=r.lineHeight/o,this.chars={},this.pageTextures=h;for(let i=0;i<t.page.length;i++){const{id:s,file:r}=t.page[i];h[s]=e instanceof Array?e[i]:e[r],a?.fieldType&&"none"!==a.fieldType&&(h[s].baseTexture.alphaMode=y.NO_PREMULTIPLIED_ALPHA,h[s].baseTexture.mipmap=v.OFF)}for(let e=0;e<t.char.length;e++){const{id:i,page:s}=t.char[e];let{x:r,y:n,width:a,height:l,xoffset:c,yoffset:u,xadvance:d}=t.char[e];r/=o,n/=o,a/=o,l/=o,c/=o,u/=o,d/=o;const p=new tt(r+h[s].frame.x/o,n+h[s].frame.y/o,a,l);this.chars[i]={xOffset:c,yOffset:u,xAdvance:d,kerning:{},texture:new Fe(h[s].baseTexture,p),page:s}}for(let e=0;e<t.kerning.length;e++){let{first:i,second:s,amount:r}=t.kerning[e];i/=o,s/=o,r/=o,this.chars[s]&&(this.chars[s].kerning[i]=r)}this.distanceFieldRange=a?.distanceRange,this.distanceFieldType=a?.fieldType?.toLowerCase()??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,i){let s;if(t instanceof Ua)s=t;else{const e=function(t){for(let e=0;e<Ha.length;e++)if(Ha[e].test(t))return Ha[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");s=e.parse(t)}e instanceof Fe&&(e=[e]);const r=new $a(s,e,i);return $a.available[r.font]=r,r}static uninstall(t){const e=$a.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete $a.available[t]}static from(t,e,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:s,padding:r,resolution:n,textureWidth:a,textureHeight:o,...h}=Object.assign({},$a.defaultOptions,i),l=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let i=0,s=t.length;i<s;i++){const s=t[i];if(Array.isArray(s)){if(2!==s.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${s.length}.`);const t=s[0].charCodeAt(0),i=s[1].charCodeAt(0);if(i<t)throw new Error("[BitmapFont]: Invalid character range.");for(let s=t,r=i;s<=r;s++)e.push(String.fromCharCode(s))}else e.push(...Xa(s))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(s),c=e instanceof lr?e:new lr(e),u=a,d=new Ua;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};let p,f,m,_=0,g=0,v=0;const y=[],x=[];for(let t=0;t<l.length;t++){p||(p=Y.ADAPTER.createCanvas(),p.width=a,p.height=o,f=p.getContext("2d"),m=new xe(p,{resolution:n,...h}),y.push(m),x.push(new Fe(m)),d.page.push({id:x.length-1,file:""}));const e=l[t],i=fr.measureText(e,c,!1,p),s=i.width,b=Math.ceil(i.height),T=Math.ceil(("italic"===c.fontStyle?2:1)*s);if(g>=o-b*n){if(0===g)throw new Error(`[BitmapFont] textureHeight ${o}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,p=null,f=null,m=null,g=0,_=0,v=0;continue}if(v=Math.max(b+i.fontProperties.descent,v),T*n+_>=u){if(0===_)throw new Error(`[BitmapFont] textureWidth ${a}px is too small (fontFamily: '${c.fontFamily}', fontSize: ${c.fontSize}px, char: '${e}')`);--t,g+=v*n,g=Math.ceil(g),_=0,v=0;continue}Ya(p,f,i,_,g,n,c);const E=Wa(i.text);d.char.push({id:E,page:x.length-1,x:_/n,y:g/n,width:T,height:b,xoffset:0,yoffset:0,xadvance:Math.ceil(s-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),_+=(T+2*r)*n,_=Math.ceil(_)}for(let t=0,e=l.length;t<e;t++){const i=l[t];for(let t=0;t<e;t++){const e=l[t],s=f.measureText(i).width,r=f.measureText(e).width,n=f.measureText(i+e).width-(s+r);n&&d.kerning.push({first:Wa(i),second:Wa(e),amount:n})}}const b=new $a(d,x,!0);return void 0!==$a.available[t]&&$a.uninstall(t),$a.available[t]=b,b}};let Va=$a;Va.ALPHA=[["a","z"],["A","Z"]," "],Va.NUMERIC=[["0","9"]],Va.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],Va.ASCII=[[" ","~"]],Va.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:$a.ALPHANUMERIC},Va.available={};const qa=[],Za=[],Ka=[],Ja=class extends Ls{constructor(t,e={}){super(),this._tint=16777215;const{align:i,tint:s,maxWidth:r,letterSpacing:n,fontName:a,fontSize:o}=Object.assign({},Ja.styleDefaults,e);if(!Va.available[a])throw new Error(`Missing BitmapFont "${a}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=i,this._tint=s,this._font=void 0,this._fontName=a,this._fontSize=o,this.text=t,this._maxWidth=r,this._maxLineHeight=0,this._letterSpacing=n,this._anchor=new nt((()=>{this.dirty=!0}),this,0,0),this._roundPixels=Y.ROUND_PIXELS,this.dirty=!0,this._resolution=Y.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){const t=Va.available[this._fontName],e=this.fontSize,i=e/t.size,s=new J,r=[],n=[],a=[],o=Xa(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),h=this._maxWidth*t.size/e,l="none"===t.distanceFieldType?qa:Za;let u=null,d=0,p=0,f=0,m=-1,_=0,g=0,v=0,y=0;for(let e=0;e<o.length;e++){const i=o[e],l=Wa(i);if(/(?:\s)/.test(i)&&(m=e,_=d,y++),"\r"===i||"\n"===i){n.push(d),a.push(-1),p=Math.max(p,d),++f,++g,s.x=0,s.y+=t.lineHeight,u=null,y=0;continue}const c=t.chars[l];if(!c)continue;u&&c.kerning[u]&&(s.x+=c.kerning[u]);const x=Ka.pop()||{texture:Fe.EMPTY,line:0,charCode:0,prevSpaces:0,position:new J};x.texture=c.texture,x.line=f,x.charCode=l,x.position.x=s.x+c.xOffset+this._letterSpacing/2,x.position.y=s.y+c.yOffset,x.prevSpaces=y,r.push(x),d=x.position.x+Math.max(c.xAdvance-c.xOffset,c.texture.orig.width),s.x+=c.xAdvance+this._letterSpacing,v=Math.max(v,c.yOffset+c.texture.height),u=l,-1!==m&&h>0&&s.x>h&&(++g,Zt(r,1+m-g,1+e-m),e=m,m=-1,n.push(_),a.push(r.length>0?r[r.length-1].prevSpaces:0),p=Math.max(p,_),f++,s.x=0,s.y+=t.lineHeight,u=null,y=0)}const x=o[o.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=_),n.push(d),p=Math.max(p,d),a.push(-1));const b=[];for(let t=0;t<=f;t++){let e=0;"right"===this._align?e=p-n[t]:"center"===this._align?e=(p-n[t])/2:"justify"===this._align&&(e=a[t]<0?0:(p-n[t])/a[t]),b.push(e)}const T=r.length,E={},w=[],S=this._activePagesMeshData;l.push(...S);for(let e=0;e<T;e++){const i=r[e].texture,s=i.baseTexture.uid;if(!E[s]){let e=l.pop();if(!e){const i=new ma;let s,r;"none"===t.distanceFieldType?(s=new fa(Fe.EMPTY),r=c.NORMAL):(s=new fa(Fe.EMPTY,{program:Ii.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),r=c.NORMAL_NPM);const n=new pa(i,s);n.blendMode=r,e={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:n,vertices:null,uvs:null,indices:null}}e.index=0,e.indexCount=0,e.vertexCount=0,e.uvsCount=0,e.total=0;const{_textureCache:r}=this;r[s]=r[s]||new Fe(i.baseTexture),e.mesh.texture=r[s],e.mesh.tint=this._tint,w.push(e),E[s]=e}E[s].total++}for(let t=0;t<S.length;t++)w.includes(S[t])||this.removeChild(S[t].mesh);for(let t=0;t<w.length;t++)w[t].mesh.parent!==this&&this.addChild(w[t].mesh);this._activePagesMeshData=w;for(const t in E){const e=E[t],i=e.total;if(!(e.indices?.length>6*i)||e.vertices.length<2*pa.BATCHABLE_SIZE)e.vertices=new Float32Array(8*i),e.uvs=new Float32Array(8*i),e.indices=new Uint16Array(6*i);else{const t=e.total,i=e.vertices;for(let e=4*t*2;e<i.length;e++)i[e]=0}e.mesh.size=6*i}for(let t=0;t<T;t++){const e=r[t];let s=e.position.x+b[e.line]*("justify"===this._align?e.prevSpaces:1);this._roundPixels&&(s=Math.round(s));const n=s*i,a=e.position.y*i,o=e.texture,h=E[o.baseTexture.uid],l=o.frame,c=o._uvs,u=h.index++;h.indices[6*u+0]=0+4*u,h.indices[6*u+1]=1+4*u,h.indices[6*u+2]=2+4*u,h.indices[6*u+3]=0+4*u,h.indices[6*u+4]=2+4*u,h.indices[6*u+5]=3+4*u,h.vertices[8*u+0]=n,h.vertices[8*u+1]=a,h.vertices[8*u+2]=n+l.width*i,h.vertices[8*u+3]=a,h.vertices[8*u+4]=n+l.width*i,h.vertices[8*u+5]=a+l.height*i,h.vertices[8*u+6]=n,h.vertices[8*u+7]=a+l.height*i,h.uvs[8*u+0]=c.x0,h.uvs[8*u+1]=c.y0,h.uvs[8*u+2]=c.x1,h.uvs[8*u+3]=c.y1,h.uvs[8*u+4]=c.x2,h.uvs[8*u+5]=c.y2,h.uvs[8*u+6]=c.x3,h.uvs[8*u+7]=c.y3}this._textWidth=p*i,this._textHeight=(s.y+t.lineHeight)*i;for(const t in E){const e=E[t];if(0!==this.anchor.x||0!==this.anchor.y){let t=0;const i=this._textWidth*this.anchor.x,s=this._textHeight*this.anchor.y;for(let r=0;r<e.total;r++)e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s,e.vertices[t++]-=i,e.vertices[t++]-=s}this._maxLineHeight=v*i;const s=e.mesh.geometry.getBuffer("aVertexPosition"),r=e.mesh.geometry.getBuffer("aTextureCoord"),n=e.mesh.geometry.getIndex();s.data=e.vertices,r.data=e.uvs,n.data=e.indices,s.update(),r.update(),n.update()}for(let t=0;t<r.length;t++)Ka.push(r[t]);this._font=t,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:i,size:s}=Va.available[this._fontName];if("none"!==i){const{a:i,b:r,c:n,d:a}=this.worldTransform,o=Math.sqrt(i*i+r*r),h=Math.sqrt(n*n+a*a),l=(Math.abs(o)+Math.abs(h))/2,c=this.fontSize/s,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=l*e*c*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=Va.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(t){if(this._tint!==t){this._tint=t;for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!Va.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??Va.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,i="none"===Va.available[this._fontName].distanceFieldType?qa:Za;i.push(...this._activePagesMeshData);for(const t of this._activePagesMeshData)this.removeChild(t.mesh);this._activePagesMeshData=[],i.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=Fe.EMPTY}));for(const t in e)e[t].destroy(),delete e[t];this._font=null,this._textureCache=null,super.destroy(t)}};Ja.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const Qa=[".xml",".fnt"],to={extension:{type:X.LoadParser,priority:Wr.Normal},test:t=>Qa.includes(Rt.extname(t)),testParse:async t=>Ga.test(t)||ja.test(t),async parse(t,e,i){const s=Ga.test(t)?Ga.parse(t):ja.parse(t),{src:r}=e,{page:n}=s,a=[];for(let t=0;t<n.length;++t){const e=n[t].file,i=Rt.join(Rt.dirname(r),e);a.push(i)}const o=await i.load(a),h=a.map((t=>o[t]));return Va.install(s,h,!0)},load:async(t,e)=>(await Y.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};$.add(to);class eo{constructor(t){this.renderer=t}render(t){const e=this.renderer,i=t.worldTransform;e.canvasContext.activeContext.globalAlpha=t.worldAlpha,e.canvasContext.setBlendMode(t.blendMode),e.canvasContext.setContextTransform(i,t.roundPixels),t.drawMode!==u.TRIANGLES?this._renderTriangleMesh(t):this._renderTriangles(t)}_renderTriangleMesh(t){const e=t.geometry.buffers[0].data.length;for(let i=0;i<e-2;i++){const e=2*i;this._renderDrawTriangle(t,e,e+2,e+4)}}_renderTriangles(t){const e=t.geometry.getIndex().data,i=e.length;for(let s=0;s<i;s+=3){const i=2*e[s],r=2*e[s+1],n=2*e[s+2];this._renderDrawTriangle(t,i,r,n)}}_renderDrawTriangle(t,e,i,s){const r=this.renderer.canvasContext.activeContext,n=t.geometry.buffers[0].data,{uvs:a,texture:o}=t;if(!o.valid)return;const h=16777215!==t.tint,l=o.baseTexture,c=l.width,u=l.height;h&&t._cachedTint!==t.tint&&(t._cachedTint=t.tint,t._cachedTexture=t._cachedTexture||new Fe(l),t._tintedCanvas=tr.getTintedCanvas({texture:t._cachedTexture},t.tint));const d=h?t._tintedCanvas:l.getDrawableSource(),p=a[e]*l.width,f=a[i]*l.width,m=a[s]*l.width,_=a[e+1]*l.height,g=a[i+1]*l.height,v=a[s+1]*l.height;let y=n[e],x=n[i],b=n[s],T=n[e+1],E=n[i+1],w=n[s+1];const S=t.canvasPadding/this.renderer.canvasContext.activeResolution;if(S>0){const{a:e,b:i,c:s,d:r}=t.worldTransform,n=(y+x+b)/3,a=(T+E+w)/3;let o=y-n,h=T-a,l=e*o+s*h,c=i*o+r*h,u=Math.sqrt(l*l+c*c),d=1+S/u;y=n+o*d,T=a+h*d,o=x-n,h=E-a,l=e*o+s*h,c=i*o+r*h,u=Math.sqrt(l*l+c*c),d=1+S/u,x=n+o*d,E=a+h*d,o=b-n,h=w-a,l=e*o+s*h,c=i*o+r*h,u=Math.sqrt(l*l+c*c),d=1+S/u,b=n+o*d,w=a+h*d}r.save(),r.beginPath(),r.moveTo(y,T),r.lineTo(x,E),r.lineTo(b,w),r.closePath(),r.clip();const A=p*g+_*m+f*v-g*m-_*f-p*v,C=y*g+_*b+x*v-g*b-_*x-y*v,R=p*x+y*m+f*b-x*m-y*f-p*b,I=p*g*b+_*x*m+y*f*v-y*g*m-_*f*b-p*x*v,P=T*g+_*w+E*v-g*w-_*E-T*v,k=p*E+T*m+f*w-E*m-T*f-p*w,D=p*g*w+_*E*m+T*f*v-T*g*m-_*f*w-p*E*v;r.transform(C/A,P/A,R/A,k/A,I/A,D/A),r.drawImage(d,0,0,c*l.resolution,u*l.resolution,0,0,c,u),r.restore(),this.renderer.canvasContext.invalidateBlendMode()}renderMeshFlat(t){const e=this.renderer.canvasContext.activeContext,i=t.geometry.getBuffer("aVertexPosition").data,s=i.length/2;e.beginPath();for(let t=1;t<s-2;++t){const s=2*t,r=i[s],n=i[s+1],a=i[s+2],o=i[s+3],h=i[s+4],l=i[s+5];e.moveTo(r,n),e.lineTo(a,o),e.lineTo(h,l)}e.fillStyle="#FF0000",e.fill(),e.closePath()}destroy(){this.renderer=null}}eo.extension={name:"mesh",type:X.CanvasRendererPlugin},$.add(eo),Y.MESH_CANVAS_PADDING=0,fa.prototype._renderCanvas=function(t,e){t.plugins.mesh.render(e)},ya.prototype._cachedTint=16777215,ya.prototype._tintedCanvas=null,ya.prototype._canvasUvs=null,ya.prototype._renderCanvas=function(t){const e=t.canvasContext.activeContext,i=this.worldTransform,s=16777215!==this.tint,r=this.texture;if(!r.valid)return;s&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=tr.getTintedCanvas(this,this.tint));const n=s?this._tintedCanvas:r.baseTexture.getDrawableSource();this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);const a=this.vertices,o=this._canvasUvs,h=s?0:r.frame.x,l=s?0:r.frame.y,c=h+r.frame.width,u=l+r.frame.height;o[0]=h,o[1]=h+this._leftWidth,o[2]=c-this._rightWidth,o[3]=c,o[4]=l,o[5]=l+this._topHeight,o[6]=u-this._bottomHeight,o[7]=u;for(let t=0;t<8;t++)o[t]*=r.baseTexture.resolution;e.globalAlpha=this.worldAlpha,t.canvasContext.setBlendMode(this.blendMode),t.canvasContext.setContextTransform(i,this.roundPixels);for(let t=0;t<3;t++)for(let i=0;i<3;i++){const s=2*i+8*t,r=Math.max(1,o[i+1]-o[i]),h=Math.max(1,o[t+5]-o[t+4]),l=Math.max(1,a[s+10]-a[s]),c=Math.max(1,a[s+11]-a[s+1]);e.drawImage(n,o[i],o[t+4],r,h,a[s],a[s+1],l,c)}};let io,so=!1;pa.prototype._cachedTint=16777215,pa.prototype._tintedCanvas=null,pa.prototype._cachedTexture=null,pa.prototype._renderCanvas=function(t){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas?this.material._renderCanvas(t,this):so||(so=!0,globalThis.console&&console.warn("Mesh with custom shaders are not supported in CanvasRenderer."))},pa.prototype._canvasPadding=null,Object.defineProperty(pa.prototype,"canvasPadding",{get(){return null!==this._canvasPadding?this._canvasPadding:Y.MESH_CANVAS_PADDING},set(t){this._canvasPadding=t}}),class extends pa{constructor(t=Fe.EMPTY,e,i,s,r){const n=new ma(e,i,s);n.getBuffer("aVertexPosition").static=!1,super(n,new fa(t),null,r),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}.prototype._renderCanvas=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)},class extends pa{constructor(t,e,i=0){const s=new ga(t.height,e,i),r=new fa(t);i>0&&(t.baseTexture.wrapMode=g.REPEAT),super(s,r),this.autoUpdate=!0}_render(t){const e=this.geometry;(this.autoUpdate||e._width!==this.shader.texture.height)&&(e._width=this.shader.texture.height,e.update()),super._render(t)}}.prototype._renderCanvas=function(t){(this.autoUpdate||this.geometry._width!==this.shader.texture.height)&&(this.geometry._width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(t,this)};class ro{static offsetPolygon(t,e){const i=[],s=t.length;e=ro.isPolygonClockwise(t)?e:-1*e;for(let r=0;r<s;r+=2){let n=r-2;n<0&&(n+=s);const a=(r+2)%s;let o=t[r]-t[n],h=t[r+1]-t[n+1],l=Math.sqrt(o*o+h*h);o/=l,h/=l,o*=e,h*=e;const c=-h,u=o,d=[t[n]+c,t[n+1]+u],p=[t[r]+c,t[r+1]+u];let f=t[a]-t[r],m=t[a+1]-t[r+1];l=Math.sqrt(f*f+m*m),f/=l,m/=l,f*=e,m*=e;const _=-m,g=f,v=[t[r]+_,t[r+1]+g],y=[t[a]+_,t[a+1]+g],x=ro.findIntersection(d[0],d[1],p[0],p[1],v[0],v[1],y[0],y[1]);x&&i.push(...x)}return i}static findIntersection(t,e,i,s,r,n,a,o){const h=(o-n)*(i-t)-(a-r)*(s-e),l=(a-r)*(e-n)-(o-n)*(t-r);if(0===h)return 0===l&&0==(i-t)*(e-n)-(s-e)*(t-r)?[(t+i)/2,(e+s)/2]:null;const c=l/h;return[t+c*(i-t),e+c*(s-e)]}static isPolygonClockwise(t){let e=0;for(let i=0,s=t.length-2;i<t.length;s=i,i+=2)e+=(t[i]-t[s])*(t[i+1]+t[s+1]);return e>0}}class no{constructor(t){this._svgMatrix=null,this._tempMatrix=new at,this.renderer=t}_calcCanvasStyle(t,e){let i;return t.texture&&t.texture.baseTexture!==Fe.WHITE.baseTexture?t.texture.valid?(i=tr.getTintedPattern(t.texture,e),this.setPatternTransform(i,t.matrix||at.IDENTITY)):i="#808080":i=`#${`00000${(0|e).toString(16)}`.slice(-6)}`,i}render(t){const e=this.renderer,i=e.canvasContext.activeContext,s=t.worldAlpha,r=t.transform.worldTransform;e.canvasContext.setContextTransform(r),e.canvasContext.setBlendMode(t.blendMode);const n=t.geometry.graphicsData;let a,o;const h=(t.tint>>16&255)/255,l=(t.tint>>8&255)/255,c=(255&t.tint)/255;for(let t=0;t<n.length;t++){const u=n[t],d=u.shape,p=u.fillStyle,f=u.lineStyle,m=0|u.fillStyle.color,_=0|u.lineStyle.color;if(u.matrix&&e.canvasContext.setContextTransform(r.copyTo(this._tempMatrix).append(u.matrix)),p.visible){const t=((m>>16&255)/255*h*255<<16)+((m>>8&255)/255*l*255<<8)+(255&m)/255*c*255;a=this._calcCanvasStyle(p,t)}if(f.visible){const t=((_>>16&255)/255*h*255<<16)+((_>>8&255)/255*l*255<<8)+(255&_)/255*c*255;o=this._calcCanvasStyle(f,t)}if(i.lineWidth=f.width,i.lineCap=f.cap,i.lineJoin=f.join,i.miterLimit=f.miterLimit,u.type===K.POLY){i.beginPath();const t=d;let e=t.points;const r=u.holes;let n,h,l,c,m;i.moveTo(e[0],e[1]);for(let t=2;t<e.length;t+=2)i.lineTo(e[t],e[t+1]);if(t.closeStroke&&i.closePath(),r.length>0){m=[],n=0,l=e[0],c=e[1];for(let t=2;t+2<e.length;t+=2)n+=(e[t]-l)*(e[t+3]-c)-(e[t+2]-l)*(e[t+1]-c);for(let t=0;t<r.length;t++)if(e=r[t].shape.points,e){h=0,l=e[0],c=e[1];for(let t=2;t+2<e.length;t+=2)h+=(e[t]-l)*(e[t+3]-c)-(e[t+2]-l)*(e[t+1]-c);if(h*n<0){i.moveTo(e[0],e[1]);for(let t=2;t<e.length;t+=2)i.lineTo(e[t],e[t+1])}else{i.moveTo(e[e.length-2],e[e.length-1]);for(let t=e.length-4;t>=0;t-=2)i.lineTo(e[t],e[t+1])}r[t].shape.closeStroke&&i.closePath(),m[t]=h*n<0}}p.visible&&(i.globalAlpha=p.alpha*s,i.fillStyle=a,i.fill()),f.visible&&this.paintPolygonStroke(t,f,o,r,m,s,i)}else if(u.type===K.RECT){const t=d;if(p.visible&&(i.globalAlpha=p.alpha*s,i.fillStyle=a,i.fillRect(t.x,t.y,t.width,t.height)),f.visible){const e=f.width*(.5-(1-f.alignment)),r=t.width+2*e,n=t.height+2*e;i.globalAlpha=f.alpha*s,i.strokeStyle=o,i.strokeRect(t.x-e,t.y-e,r,n)}}else if(u.type===K.CIRC){const t=d;if(i.beginPath(),i.arc(t.x,t.y,t.radius,0,2*Math.PI),i.closePath(),p.visible&&(i.globalAlpha=p.alpha*s,i.fillStyle=a,i.fill()),f.visible){if(.5!==f.alignment){const e=f.width*(.5-(1-f.alignment));i.beginPath(),i.arc(t.x,t.y,t.radius+e,0,2*Math.PI),i.closePath()}i.globalAlpha=f.alpha*s,i.strokeStyle=o,i.stroke()}}else if(u.type===K.ELIP){const t=d,e=1===f.alignment;if(e||this.paintEllipse(t,p,f,a,s,i),f.visible){if(.5!==f.alignment){const e=.5522848,s=f.width*(.5-(1-f.alignment)),r=2*(t.width+s),n=2*(t.height+s),a=t.x-r/2,o=t.y-n/2,h=r/2*e,l=n/2*e,c=a+r,u=o+n,d=a+r/2,p=o+n/2;i.beginPath(),i.moveTo(a,p),i.bezierCurveTo(a,p-l,d-h,o,d,o),i.bezierCurveTo(d+h,o,c,p-l,c,p),i.bezierCurveTo(c,p+l,d+h,u,d,u),i.bezierCurveTo(d-h,u,a,p+l,a,p),i.closePath()}i.globalAlpha=f.alpha*s,i.strokeStyle=o,i.stroke()}e&&this.paintEllipse(t,p,f,a,s,i)}else if(u.type===K.RREC){const t=d,e=1===f.alignment;if(e||this.paintRoundedRectangle(t,p,f,a,s,i),f.visible){if(.5!==f.alignment){const e=t.width,s=t.height,r=f.width*(.5-(1-f.alignment)),n=t.x-r,a=t.y-r,o=t.width+2*r,h=t.height+2*r,l=r*(f.alignment>=1?Math.min(o/e,h/s):Math.min(e/o,s/h));let c=t.radius+l;const u=Math.min(o,h)/2;c=c>u?u:c,i.beginPath(),i.moveTo(n,a+c),i.lineTo(n,a+h-c),i.quadraticCurveTo(n,a+h,n+c,a+h),i.lineTo(n+o-c,a+h),i.quadraticCurveTo(n+o,a+h,n+o,a+h-c),i.lineTo(n+o,a+c),i.quadraticCurveTo(n+o,a,n+o-c,a),i.lineTo(n+c,a),i.quadraticCurveTo(n,a,n,a+c),i.closePath()}i.globalAlpha=f.alpha*s,i.strokeStyle=o,i.stroke()}e&&this.paintRoundedRectangle(t,p,f,a,s,i)}}}paintPolygonStroke(t,e,i,s,r,n,a){if(.5!==e.alignment){const i=e.width*(.5-(1-e.alignment));let n,o=ro.offsetPolygon(t.points,i);a.beginPath(),a.moveTo(o[0],o[1]);for(let t=2;t<o.length;t+=2)a.lineTo(o[t],o[t+1]);t.closeStroke&&a.closePath();for(let t=0;t<s.length;t++){if(n=s[t].shape.points,o=ro.offsetPolygon(n,i),r[t]){a.moveTo(o[0],o[1]);for(let t=2;t<o.length;t+=2)a.lineTo(o[t],o[t+1])}else{a.moveTo(o[o.length-2],o[o.length-1]);for(let t=o.length-4;t>=0;t-=2)a.lineTo(o[t],o[t+1])}s[t].shape.closeStroke&&a.closePath()}}a.globalAlpha=e.alpha*n,a.strokeStyle=i,a.stroke()}paintEllipse(t,e,i,s,r,n){const a=2*t.width,o=2*t.height,h=t.x-a/2,l=t.y-o/2,c=.5522848,u=a/2*c,d=o/2*c,p=h+a,f=l+o,m=h+a/2,_=l+o/2;0===i.alignment&&n.save(),n.beginPath(),n.moveTo(h,_),n.bezierCurveTo(h,_-d,m-u,l,m,l),n.bezierCurveTo(m+u,l,p,_-d,p,_),n.bezierCurveTo(p,_+d,m+u,f,m,f),n.bezierCurveTo(m-u,f,h,_+d,h,_),n.closePath(),0===i.alignment&&n.clip(),e.visible&&(n.globalAlpha=e.alpha*r,n.fillStyle=s,n.fill()),0===i.alignment&&n.restore()}paintRoundedRectangle(t,e,i,s,r,n){const a=t.x,o=t.y,h=t.width,l=t.height;let c=t.radius;const u=Math.min(h,l)/2;c=c>u?u:c,0===i.alignment&&n.save(),n.beginPath(),n.moveTo(a,o+c),n.lineTo(a,o+l-c),n.quadraticCurveTo(a,o+l,a+c,o+l),n.lineTo(a+h-c,o+l),n.quadraticCurveTo(a+h,o+l,a+h,o+l-c),n.lineTo(a+h,o+c),n.quadraticCurveTo(a+h,o,a+h-c,o),n.lineTo(a+c,o),n.quadraticCurveTo(a,o,a,o+c),n.closePath(),0===i.alignment&&n.clip(),e.visible&&(n.globalAlpha=e.alpha*r,n.fillStyle=s,n.fill()),0===i.alignment&&n.restore()}setPatternTransform(t,e){if(!1!==this._svgMatrix){if(!this._svgMatrix){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");if(e?.createSVGMatrix&&(this._svgMatrix=e.createSVGMatrix()),!this._svgMatrix||!t.setTransform)return void(this._svgMatrix=!1)}this._svgMatrix.a=e.a,this._svgMatrix.b=e.b,this._svgMatrix.c=e.c,this._svgMatrix.d=e.d,this._svgMatrix.e=e.tx,this._svgMatrix.f=e.ty,t.setTransform(this._svgMatrix.inverse())}}destroy(){this.renderer=null,this._svgMatrix=null,this._tempMatrix=null}}no.extension={name:"graphics",type:X.CanvasRendererPlugin},$.add(no);const ao=new at;ha.prototype.generateCanvasTexture=function(t,e=1){const i=this.getLocalBounds(),s=Ue.create({width:i.width,height:i.height,scaleMode:t,resolution:e});io||(io=new $s),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(ao),ao.invert(),ao.tx-=i.x,ao.ty-=i.y,io.render(this,{renderTexture:s,clear:!0,transform:ao});const r=Fe.from(s.baseTexture._canvasRenderTarget.canvas,{scaleMode:t});return r.baseTexture.setResolution(e),r},ha.prototype.cachedGraphicsData=[],ha.prototype._renderCanvas=function(t){!0!==this.isMask&&(this.finishPoly(),t.plugins.graphics.render(this))};const oo=new at;class ho{constructor(t){this.renderer=t}render(t){const e=t._texture,i=this.renderer,s=i.canvasContext.activeContext,r=i.canvasContext.activeResolution;if(!e.valid)return;const n=e._frame.width,a=e._frame.height;let o=e._frame.width,h=e._frame.height;e.trim&&(o=e.trim.width,h=e.trim.height);let l=t.transform.worldTransform,u=0,d=0;const p=e.baseTexture.getDrawableSource();if(e.orig.width<=0||e.orig.height<=0||!e.valid||!p)return;i.canvasContext.setBlendMode(t.blendMode,!0),s.globalAlpha=t.worldAlpha;const f=e.baseTexture.scaleMode===_.LINEAR,m=i.canvasContext.smoothProperty;m&&s[m]!==f&&(s[m]=f),e.trim?(u=e.trim.width/2+e.trim.x-t.anchor.x*e.orig.width,d=e.trim.height/2+e.trim.y-t.anchor.y*e.orig.height):(u=(.5-t.anchor.x)*e.orig.width,d=(.5-t.anchor.y)*e.orig.height),e.rotate&&(l.copyTo(oo),l=oo,ft.matrixAppendRotationInv(l,e.rotate,u,d),u=0,d=0),u-=o/2,d-=h/2,i.canvasContext.setContextTransform(l,t.roundPixels,1),t.roundPixels&&(u|=0,d|=0);const g=e.baseTexture.resolution,v=i.canvasContext._outerBlend;v&&(s.save(),s.beginPath(),s.rect(u*r,d*r,o*r,h*r),s.clip()),16777215!==t.tint?(t._cachedTint===t.tint&&t._tintedCanvas.tintId===t._texture._updateID||(t._cachedTint=t.tint,t._tintedCanvas=tr.getTintedCanvas(t,t.tint)),s.drawImage(t._tintedCanvas,0,0,Math.floor(n*g),Math.floor(a*g),Math.floor(u*r),Math.floor(d*r),Math.floor(o*r),Math.floor(h*r))):s.drawImage(p,e._frame.x*g,e._frame.y*g,Math.floor(n*g),Math.floor(a*g),Math.floor(u*r),Math.floor(d*r),Math.floor(o*r),Math.floor(h*r)),v&&s.restore(),i.canvasContext.setBlendMode(c.NORMAL)}destroy(){this.renderer=null}}ho.extension={name:"sprite",type:X.CanvasRendererPlugin},$.add(ho),Us.prototype._tintedCanvas=null,Us.prototype._renderCanvas=function(t){t.plugins.sprite.render(this)};const lo=new tt;class co{constructor(t){this.renderer=t}async image(t,e,i){const s=new Image;return s.src=await this.base64(t,e,i),s}async base64(t,e,i){const s=this.canvas(t);if(void 0!==s.toDataURL)return s.toDataURL(e,i);if(void 0!==s.convertToBlob){const t=await s.convertToBlob({type:e,quality:i});return await new Promise((e=>{const i=new FileReader;i.onload=()=>e(i.result),i.readAsDataURL(t)}))}throw new Error("CanvasExtract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(t,e){const i=this.renderer;let s,r,n;t&&(n=t instanceof Ue?t:i.generateTexture(t)),n?(s=n.baseTexture._canvasRenderTarget.context,r=n.baseTexture._canvasRenderTarget.resolution,e=e??n.frame):(s=i.canvasContext.rootContext,r=i._view.resolution,e||((e=lo).width=i.width,e.height=i.height));const a=Math.round(e.x*r),o=Math.round(e.y*r),h=Math.round(e.width*r),l=Math.round(e.height*r),c=new oe(h,l,1),u=s.getImageData(a,o,h,l);return c.context.putImageData(u,0,0),c.canvas}pixels(t,e){const i=this.renderer;let s,r,n;t&&(n=t instanceof Ue?t:i.generateTexture(t)),n?(s=n.baseTexture._canvasRenderTarget.context,r=n.baseTexture._canvasRenderTarget.resolution,e=e??n.frame):(s=i.canvasContext.rootContext,r=i.resolution,e||((e=lo).width=i.width,e.height=i.height));const a=Math.round(e.x*r),o=Math.round(e.y*r),h=Math.round(e.width*r),l=Math.round(e.height*r);return s.getImageData(a,o,h,l).data}destroy(){this.renderer=null}}function uo(t,e){const i=t;if(e instanceof xe){const t=e.source,s=0===t.width?i.canvas.width:Math.min(i.canvas.width,t.width),r=0===t.height?i.canvas.height:Math.min(i.canvas.height,t.height);return i.ctx.drawImage(t,0,0,s,r,0,0,i.canvas.width,i.canvas.height),!0}return!1}co.extension={name:"extract",type:X.CanvasRendererSystem},$.add(co);class po extends Ra{constructor(t){super(t),this.uploadHookHelper=this,this.canvas=Y.ADAPTER.createCanvas(16,16),this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(uo)}destroy(){super.destroy(),this.ctx=null,this.canvas=null}}po.extension={name:"prepare",type:X.CanvasRendererSystem},$.add(po);class fo{constructor(t={}){if(!t.canvas)throw new Error("You cannot add inputs without a canvas");this._inputStart=a.InputStart.bind(this),this._inputMove=a.InputMove.bind(this),this._inputEnd=a.InputEnd.bind(this),this._touchInputStart=t=>{this._inputStart(t,1)},this._touchInputMove=t=>{this._inputMove(t,1)},this._touchInputEnd=t=>{this._inputEnd(t,1)},this._mouseInputStart=t=>{this._inputStart(t,0)},this._mouseInputMove=t=>{this._inputMove(t,0)},this._mouseInputEnd=t=>{this._inputEnd(t,0)},this._noCanvasMenu=t=>(t.preventDefault(),!1),this.addListenerToCanvas(t.canvas),this.reset()}reset(){this.tap=[],this.inputs={},this._isPaused=!1}addListenerToCanvas(t){if(!(t instanceof HTMLCanvasElement))throw new Error("This is not a canvas");let e=!1;try{t.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){e={passive:!1}}}))}catch(t){}t.addEventListener("touchstart",this._touchInputStart,e),t.addEventListener("touchmove",this._touchInputMove,e),t.addEventListener("touchend",this._touchInputEnd,e),t.addEventListener("touchcancel",this._touchInputEnd,e),t.addEventListener("mousedown",this._mouseInputStart,e),t.addEventListener("mousemove",this._mouseInputMove,e),t.addEventListener("mouseup",this._mouseInputEnd,e),t.addEventListener("contextmenu",this._noCanvasMenu,e)}removeListenerFromCanvas(t){if(!(t instanceof HTMLCanvasElement))throw new Error("This is not a canvas");t.removeEventListener("touchstart",this._touchInputStart),t.removeEventListener("touchmove",this._touchInputMove),t.removeEventListener("touchend",this._touchInputEnd),t.removeEventListener("touchcancel",this._touchInputEnd),t.removeEventListener("mousedown",this._mouseInputStart),t.removeEventListener("mousemove",this._mouseInputMove),t.removeEventListener("mouseup",this._mouseInputEnd),t.removeEventListener("contextmenu",this._noCanvasMenu)}createSprite(t,e=!0){e&&(this.sprite=new ha,this.sprite.zIndex=99999,t.addChild(this.sprite))}addInput(t,e,i=-1){let s=new o(t,e);this.tap.push(s),this.inputs[i]=s}calcTick(){this.sprite&&this.sprite.clear();for(const t in this.inputs)if(this.inputs[t]&&(this.inputs[t].calcTick(),this.sprite)){let e=this.inputs[t].tick-1==0?this.inputs[t].isMoving?65535:16776960:16711935;this.sprite.beginFill(e).drawCircle(this.inputs[t].x,this.inputs[t].y,30*this.renderSize.heightPercent).endFill()}this.tap.length=0}resizeSprites(t){this.renderSize=t}destroySprites(){this.sprite&&(this.sprite.destroy(),this.sprite=void 0)}}class mo{constructor(t=0,e=!0,i=!1,s=!1){this._notesCount=Number(t),this._showAPStatus=!!e,this._autoPlay=!!s,(isNaN(this._notesCount)||this._notesCount<=0)&&(console.warn("Invaild note count, Won't calculate score."),this._notesCount=0),this.scorePerNote=i?1e6/t:9e5/t,this.scorePerCombo=i?0:1e5/t,this.renderSize={},this.reset()}reset(){this._score=0,this.score=0,this.acc=0,this.combo=0,this.maxCombo=0,this.judgedNotes=0,this.perfect=0,this.good=0,this.bad=0,this.miss=0,this.judgeLevel=-1,this.APType=2,this.levelPassed=!1,this.sprites&&(this.sprites.combo.number.text="0",this.sprites.acc.text="ACCURACY 0.00%",this.sprites.score.text="0000000",this.sprites.combo.text.position.x=this.sprites.combo.number.width+6*this.renderSize.heightPercent)}createSprites(t){this.sprites||(this.sprites={},this.sprites.combo={},this.sprites.combo.container=new Ls,this.sprites.combo.container.zIndex=99999,this.sprites.combo.number=new gr("0",{fontFamily:"A-OTF Shin Go Pr6N H",fill:16777215}),this.sprites.combo.number.alpha=.81,this.sprites.combo.text=new gr(this._autoPlay?"AUTOPLAY":"COMBO",{fontFamily:"MiSans",fill:16777215}),this.sprites.combo.text.alpha=.55,this.sprites.combo.container.addChild(this.sprites.combo.number,this.sprites.combo.text),t.addChild(this.sprites.combo.container),this.sprites.acc=new gr("ACCURACY 0.00%",{fontFamily:"MiSans",fill:16777215}),this.sprites.acc.alpha=.63,this.sprites.acc.zIndex=99999,t.addChild(this.sprites.acc),this.sprites.score=new gr("0000000",{fontFamily:"A-OTF Shin Go Pr6N H",fill:16777215}),this.sprites.score.alpha=.58,this.sprites.score.anchor.set(1,0),this.sprites.score.zIndex=99999,t.addChild(this.sprites.score))}resizeSprites(t,e){this.renderSize=t,this.sprites&&(this.sprites.combo.number.style.fontSize=60*t.heightPercent,this.sprites.combo.text.style.fontSize=30*t.heightPercent,this.sprites.acc.style.fontSize=20*t.heightPercent,this.sprites.score.style.fontSize=50*t.heightPercent,e?(this.sprites.combo.container.position.y=t.height,this.sprites.acc.position.y=t.height,this.sprites.score.position.y=t.height):(this.sprites.combo.container.position.x=72*t.heightPercent,this.sprites.combo.container.position.y=41*t.heightPercent,this.sprites.combo.text.position.x=this.sprites.combo.number.width+6*t.heightPercent,this.sprites.combo.text.position.y=30*t.heightPercent,this.sprites.acc.position.x=72*t.heightPercent,this.sprites.acc.position.y=113*t.heightPercent,this.sprites.score.position.x=t.width-139*t.heightPercent,this.sprites.score.position.y=61*t.heightPercent))}pushJudge(t=0,e=[]){if(this._autoPlay)this.perfect+=1,this.combo+=1,this.maxCombo=this.combo,this._score+=this.scorePerNote+this.scorePerCombo;else if(t>2){if(this.combo+=1,this.combo>this.maxCombo&&(this.maxCombo=this.combo),4===t)this.perfect+=1;else if(this.good+=1,this.APType>=2&&(this.APType=1,this._showAPStatus))for(const t of e){if(!isNaN(t.color))return;if(!t.sprite)return;t.sprite.tint=11854335}this._score+=this.scorePerNote+(this.combo>=this.maxCombo?this.scorePerCombo*(4===t?1:.65):0)}else{if(2===t?this.bad+=1:this.miss+=1,this.APType>=1&&(this.APType=0,this._showAPStatus))for(const t of e){if(!isNaN(t.color))return;if(!t.sprite)return;t.sprite.tint=16777215}this.combo=0}this.judgedNotes++,this.score=Math.round(this._score),this.acc=(this.perfect+.65*this.good)/this.judgedNotes,this.score>=1e6?this.judgeLevel=6:this.score>=96e4?this.judgeLevel=5:this.score>=92e4?this.judgeLevel=4:this.score>=88e4?this.judgeLevel=3:this.score>=82e4?this.judgeLevel=2:this.score>=7e5?this.judgeLevel=1:this.judgeLevel=0,this.judgeLevel>=1&&(this.levelPassed=!0),this.sprites&&(this.sprites.combo.number.text=this.combo,this.sprites.acc.text="ACCURACY "+(100*this.acc).toFixed(2)+"%",this.sprites.score.text=function(t,e=3){let i=t+"";for(;i.length<e;)i="0"+i;return i}(this.score.toFixed(0),7),this.sprites.combo.text.position.x=this.sprites.combo.number.width+6*this.renderSize.heightPercent)}destroySprites(){this.sprites&&(this.sprites.combo.number.destroy(),this.sprites.combo.text.destroy(),this.sprites.combo.container.destroy(),this.sprites.combo=void 0,this.sprites.acc.destroy(),this.sprites.acc=void 0,this.sprites.score.destroy(),this.sprites.score=void 0,this.sprites=void 0)}}class _o{constructor(t,e=1){this.x=t.x,this.y=t.y,this.input=t,this.type=e}isInArea(t,e,i,s,r){return Math.abs((this.x-t)*i+(this.y-e)*s)<=r}}var go;(async()=>{const t=document.createElement("canvas"),e=t.getContext("2d",{alpha:!0});t.width=t.height=52,e.clearRect(0,0,52,52),e.beginPath(),e.rect(0,0,26,26),e.fillStyle="#FFFFFF",e.fill();const i=Fe.from(await createImageBitmap(t));i.defaultAnchor.set(.5),Fe.addToCache(i,"clickAnimatePoint"),go=i})();class vo{constructor(t={}){if(this.chart=t.chart,this.stage=t.stage,this.textures=t.assets.textures,this.sounds=t.assets.sounds,!t.stage)throw new Error("You cannot do judgement without a stage");if(!t.chart)throw new Error("You cannot do judgement without a chart");this._autoPlay=r(t.autoPlay,!1),this._hitsound=r(t.hitsound,!0),this._hitsoundVolume=n(t.hitsoundVolume,1,0,1),this.score=new mo(this.chart.totalRealNotes,r(t.showAPStatus,!0),r(t.challangeMode,!1),this._autoPlay),this.input=new fo({canvas:t.canvas,autoPlay:this._autoPlay}),this.judgeTimes={perfect:(t.challangeMode?40:80)/1e3,good:(t.challangeMode?75:160)/1e3,bad:(t.challangeMode?90:180)/1e3},this.calcTick=this.calcTick.bind(this),this.calcNote=yo.bind(this),this.reset()}reset(){this.judgePoints=[],this.score.reset(),this.input.reset(),this._holdBetween=.15,this.clickParticleContainer&&this.clickParticleContainer.removeChildren()}createSprites(t=!0){this.clickParticleContainer=new Ls,this.clickParticleContainer.zIndex=99999,this.stage.addChild(this.clickParticleContainer),this.score.createSprites(this.stage),this.input.createSprite(this.stage,t),this._clickAnimBaseScale={normal:256/this.textures.normal[0].baseTexture.width,bad:256/this.textures.bad[0].baseTexture.width}}resizeSprites(t,e){this.renderSize=t,this.score.resizeSprites(t,e),this.input.resizeSprites(t,e)}calcTick(){this.createJudgePoints(),this.input.tap.length=0,this.input.calcTick();for(const t of this.clickParticleContainer.children){if(!t)break;const e=(Date.now()-t.startTime)/500;e>=1?t.destroy(!1):(t.alpha=1-e,t.scale.set((((.2078*e-1.6524)*e+1.6399)*e+.4988)*t.baseScale),t.distance=t._distance*(9*e/(8*e+1))*.6*t.baseScale,t.position.x=t.distance*t.cosr-t.distance*t.sinr+t.basePos.x,t.position.y=t.distance*t.cosr+t.distance*t.sinr+t.basePos.y)}}createJudgePoints(){if(this.judgePoints.length=0,!this._autoPlay){for(const t of this.input.tap)t instanceof o&&this.judgePoints.push(new _o(t,1));for(const t in this.input.inputs)this.input.inputs[t]instanceof o&&(this.input.inputs[t].isFlickable&&!this.input.inputs[t].isFlicked?this.judgePoints.push(new _o(this.input.inputs[t],2)):this.judgePoints.push(new _o(this.input.inputs[t],3)))}}pushNoteJudge(t){this.score.pushJudge(t.score,this.chart.judgelines),t.score>=2&&(this.createClickAnimate(t),t.score>=3&&this.playHitsound(t))}createClickAnimate(t){let e=new Fa(t.score>=3?this.textures.normal:this.textures.bad),i=5.6*this.renderSize.noteScale;if(t.score>=3&&3!=t.type?e.position.set(t.sprite.judgelineX,t.sprite.judgelineY):e.position.copyFrom(t.sprite.position),e.scale.set((t.score>=3?this._clickAnimBaseScale.normal:this._clickAnimBaseScale.bad)*i),e.tint=4===t.score?16772256:3===t.score?11854335:7095107,e.loop=!1,t.score>=3){let s=0;for(;s<4;){let r=new Us(go);r.tint=4===t.score?16772256:11854335,r.startTime=Date.now(),r.basePos=e.position,r.baseScale=i,r.distance=r._distance=100*Math.random()+250,r.direction=Math.floor(360*Math.random()),r.sinr=Math.sin(r.direction),r.cosr=Math.cos(r.direction),this.clickParticleContainer.addChild(r),s++}}else e.angle=t.sprite.angle;return e.onFrameChange=function(){this.alpha=1-this.currentFrame/this.totalFrames},e.onComplete=function(){this.destroy(!1)},this.stage.addChild(e),e.play(),e}playHitsound(t){if(this._hitsound)if(t.hitsound)t.hitsound.play();else switch(t.type){case 1:case 3:this.sounds.tap.play();break;case 2:this.sounds.drag.play();break;case 4:this.sounds.flick.play()}}destroySprites(){this.reset(),this.clickParticleContainer.destroy({children:!0,texture:!1,baseTexture:!1}),this.input.destroySprites(),this.score.destroySprites()}}function yo(t,e){if(e.isFake)return;if(e.isScored&&e.isScoreAnimated)return;if(!e.isScored){if(3!==e.type&&e.time+this.judgeTimes.bad<t)return e.isScored=!0,e.score=1,e.scoreTime=NaN,this.score.pushJudge(0,this.chart.judgelines),e.sprite.alpha=0,void(e.isScoreAnimated=!0);if(3===e.type&&e.time+this.judgeTimes.good<t)return e.isScored=!0,e.score=1,e.scoreTime=NaN,this.score.pushJudge(0,this.chart.judgelines),e.sprite.alpha=.5,void(e.isScoreAnimated=!0)}let i=e.time-t,s=i>0?i:-1*i,r=e.judgeline,n=e.sprite.position;if(3!==e.type&&!e.isScoreAnimated&&e.time<=t&&(e.sprite.alpha=1+i/this.judgeTimes.bad),this._autoPlay){let s={x:n.x,y:n.y,isFlicked:!1};1===e.type?i<=0&&this.judgePoints.push(new _o(s,1)):2===e.type?i<=this.judgeTimes.bad&&this.judgePoints.push(new _o(s,3)):3===e.type?!e.isScored&&i<=0?this.judgePoints.push(new _o(s,1)):e.isScored&&t-e.lastHoldTime>=this._holdBetween&&this.judgePoints.push(new _o(s,3)):4===e.type&&i<=this.judgeTimes.bad&&this.judgePoints.push(new _o(s,2))}switch(e.type){case 1:for(let t=0;t<this.judgePoints.length;t++)if(1===this.judgePoints[t].type&&this.judgePoints[t].isInArea(n.x,n.y,r.cosr,r.sinr,this.renderSize.noteWidth)&&(s<=this.judgeTimes.bad&&(e.isScored=!0,e.scoreTime=i,s<=this.judgeTimes.perfect?e.score=4:s<=this.judgeTimes.good?e.score=3:e.score=2),e.isScored)){this.pushNoteJudge(e),e.sprite.alpha=0,e.isScoreAnimated=!0,this.judgePoints.splice(t,1);break}break;case 2:if(e.isScored&&!e.isScoreAnimated&&i<=0)this.pushNoteJudge(e),e.sprite.alpha=0,e.isScoreAnimated=!0;else if(!e.isScored)for(let t=0;t<this.judgePoints.length;t++)if(this.judgePoints[t].isInArea(n.x,n.y,r.cosr,r.sinr,this.renderSize.noteWidth)&&s<=this.judgeTimes.good){e.isScored=!0,e.score=4,e.scoreTime=NaN;break}break;case 3:if(e.isScored){if(t-e.lastHoldTime>=this._holdBetween&&this.createClickAnimate(e),e.holdTimeLength-t<=this.judgeTimes.bad){this.score.pushJudge(e.score,this.chart.judgelines),e.isScoreAnimated=!0;break}t-e.lastHoldTime>=this._holdBetween&&(e.lastHoldTime=t,e.isHolding=!1)}for(let a=0;a<this.judgePoints.length;a++){if(!e.isScored&&1===this.judgePoints[a].type&&this.judgePoints[a].isInArea(n.x,n.y,r.cosr,r.sinr,this.renderSize.noteWidth)&&s<=this.judgeTimes.good){e.isScored=!0,e.scoreTime=i,s<=this.judgeTimes.perfect?e.score=4:e.score=3,this.createClickAnimate(e),this.playHitsound(e),e.isHolding=!0,e.lastHoldTime=t,this.judgePoints.splice(a,1);break}this.judgePoints[a].isInArea(n.x,n.y,r.cosr,r.sinr,this.renderSize.noteWidth)&&(e.isHolding=!0)}this.paused||!e.isScored||e.isHolding||(e.score=1,e.scoreTime=NaN,this.score.pushJudge(1,this.chart.judgelines),e.sprite.alpha=.5,e.isScoreAnimated=!0);break;case 4:if(e.isScored&&!e.isScoreAnimated&&i<=0)this.pushNoteJudge(e),e.sprite.alpha=0,e.isScoreAnimated=!0;else if(!e.isScored)for(let t=0;t<this.judgePoints.length;t++)if(2===this.judgePoints[t].type&&this.judgePoints[t].isInArea(n.x,n.y,r.cosr,r.sinr,this.renderSize.noteWidth)&&s<=this.judgeTimes.good){e.isScored=!0,e.score=4,e.scoreTime=NaN,this.judgePoints[t].input.isFlicked=!0,this.judgePoints.splice(t,1);break}}}class xo{constructor(t=1,e=0){this.speed=parseFloat(n(t,1,0,2).toFixed(2)),this.offset=1e3*n(e,0),this.reset()}reset(){this.startTime=NaN,this.pauseTime=NaN,this.isPaused=!0}start(){isNaN(this.startTime)&&(this.startTime=Date.now()+this.offset,this.isPaused=!1)}pause(){isNaN(this.startTime)||(this.isPaused=!this.isPaused,this.isPaused?this.pauseTime=Date.now():(this.startTime=Date.now()-(this.pauseTime-this.startTime),this.pauseTime=NaN))}skip(t){isNaN(this.pauseTime)||(this.startTime+=t,this.startTime>this.pauseTime&&(this.startTime=this.pauseTime))}get time(){return isNaN(this.startTime)?0:((isNaN(this.pauseTime)?Date.now():this.pauseTime)-this.startTime)*this.speed/1e3}}function bo(){{let t=this.sprites.pauseButton;1===t.clickCount?t.alpha<1?t.alpha=.5+(Date.now()-t.lastClickTime)/200*.5:t.alpha>=1&&Date.now()-t.lastClickTime>=2e3?(t.clickCount=0,t.lastRenderTime=Date.now(),t.isEndRendering=!0):t.alpha>=1&&(t.alpha=1,t.lastRenderTime=Date.now()):0===t.clickCount&&t.isEndRendering&&(t.alpha>.5?t.alpha=1-(Date.now()-t.lastRenderTime)/200*.5:t.alpha<=.5&&(t.alpha=.5,t.lastRenderTime=Date.now(),t.isEndRendering=!1))}switch(this._animateStatus){case 0:this._calcGameAnimateTick(!0);break;case 1:this.chart.calcTime(this._audioTimer.time),this.judgement._holdBetween=this.chart.holdBetween,this._isPaused||this.judgement.calcTick(),this.sprites.progressBar.scale.x=this._audioTimer.time/this.chart.music._duration*this.sprites.progressBar.baseScaleX;break;case 2:this._calcGameAnimateTick(!1)}}function To(t=!0){let e=(Date.now()-(t?this._gameStartTime:this._gameEndTime))/1500,i=t?1-Math.pow(1-e,4):Math.pow(1-e,4),s={score:this.judgement.score.sprites,chart:this.chart.sprites};s.score.combo.container.position.y=-(s.score.combo.container.height+s.score.acc.height)+(s.score.combo.container.height+s.score.acc.height+41*this.render.sizer.heightPercent)*i,s.score.acc.position.y=s.score.combo.container.position.y+72*this.render.sizer.heightPercent,s.score.score.position.y=-s.score.score.height+(s.score.score.height+61*this.render.sizer.heightPercent)*i,this.sprites.pauseButton.position.y=-this.sprites.pauseButton.height+(this.sprites.pauseButton.height+75*this.render.sizer.heightPercent)*i,this.sprites.progressBar.position.y=-12*this.render.sizer.heightPercent*(1-i),s.chart.info.songName.position.y=this.render.sizer.height+s.chart.info.songName.height-(s.chart.info.songName.height+66*this.render.sizer.heightPercent)*i,s.chart.info.songDiff.position.y=s.chart.info.songName.position.y+24*this.render.sizer.heightPercent,this.sprites.fakeJudgeline.width=this.render.sizer.width*i,this.chart.sprites.bg&&this.chart.sprites.bg.cover&&(this.chart.sprites.bg.cover.alpha=this._settings.bgDim*i),e>=1&&(t?(this._animateStatus=1,this.resize(!0,!1),setTimeout((async()=>{this._musicId=this.chart.music.play();for(const t of this.chart.judgelines)t.sprite&&(t.sprite.alpha=1,t.debugSprite&&(t.debugSprite.visible=!0));for(const t of this.chart.notes)t.sprite&&(t.sprite.alpha=t.basicAlpha);this._isPaused=!1,this._isEnded=!1,this.sprites.fakeJudgeline.visible=!1,this._runCallback("start")}),200)):(this._animateStatus=3,this._isPaused=!0,this._isEnded=!0,this._runCallback("end"),this._audioTimer.reset()))}function Eo(t){let e=t.keyCode,i=t.ctrlKey,s=t.shiftKey,r=0;if(!this._isPaused&&this._settings.autoPlay&&1===this._animateStatus){switch(e){case 37:r=2e3;break;case 39:r=-2e3;break;default:return}i&&s?r*=5:i?r*=2:s&&(r*=.5),this._audioTimer.pause(),this._audioTimer.skip(r);{let n=this._audioTimer.time,a=0;for(const h of this.chart.notes)if(!h.isFake){if(h.score<=0)break;h.time<n?a++:h.reset()}function o(t,e=3){let i=t+"";for(;i.length<e;)i="0"+i;return i}this.judgement.score.perfect=this.judgement.score.judgedNotes=this.judgement.score.combo=this.judgement.score.maxCombo=a,this.judgement.score._score=(this.judgement.score.scorePerNote+this.judgement.score.scorePerCombo)*a,this.judgement.score.sprites&&(this.judgement.score.sprites.combo.number.text=this.judgement.score.combo,this.judgement.score.sprites.acc.text="ACCURACY "+(100*this.judgement.score.acc).toFixed(2)+"%",this.judgement.score.sprites.score.text=o(this.judgement.score.score.toFixed(0),7),this.judgement.score.sprites.combo.text.position.x=this.judgement.score.sprites.combo.number.width+6*this.render.sizer.heightPercent)}this.chart.music.once("play",(()=>{this._audioTimer.pause()})),this.chart.music.pause(),this.chart.music.seek(this._audioTimer.time),this.chart.music.play()}}function wo(){let t=this.sprites.pauseButton;t.clickCount++,t.clickCount>=2&&Date.now()-t.lastClickTime<=2e3&&(this.pause(),t.lastRenderTime=Date.now(),t.isEndRendering=!0,t.clickCount=0),t.lastClickTime=Date.now()}function So(){this._animateStatus=2,this._gameEndTime=Date.now(),this.sprites.fakeJudgeline.visible=!0,this.judgement.clickParticleContainer.removeChildren(),this._settings.showAPStatus&&(1===this.judgement.score.APType?this.sprites.fakeJudgeline.tint=11854335:0===this.judgement.score.APType&&(this.sprites.fakeJudgeline.tint=16777215));for(const t of this.chart.judgelines)t.sprite&&(t.sprite.alpha=0,t.debugSprite&&(t.debugSprite.visible=!1));for(const t of this.chart.notes)t.sprite&&(t.sprite.alpha=0,t.debugSprite&&(t.debugSprite.visible=!1));this.judgement.input.sprite&&this.judgement.input.sprite.clear()}function Ao(t){this.functions[t]&&this.functions[t].forEach((t=>t(this)))}Y.RENDER_OPTIONS.hello=!0;const Co=(()=>{const t=document.createElement("canvas"),e=t.getContext("2d");t.width=1920,t.height=12,e.clearRect(0,0,1920,12),e.fillStyle="#FFFFFF",e.fillRect(0,0,1920,12);const i=Fe.from(t);return Fe.addToCache(i,"progressBar"),i})();class Ro{constructor(t){let i={...t};if(i.render||(i.render={}),i.settings||(i.settings={}),this.chart=i.chart,this.assets=i.assets,this.zipFiles=i.zipFiles,!this.chart)throw new Error("You must select a chart to play");if(!this.assets)throw new Error("Render must use a texture object for creating sprites.");this.zipFiles||(this.zipFiles={}),this.render=new Mr({width:n(i.render.width,document.documentElement.clientWidth,0),height:n(i.render.height,document.documentElement.clientHeight,0),resolution:n(i.render.resolution,window.devicePixelRatio,1),autoDensity:r(i.render.autoDensity,!0),antialias:r(i.render.antialias,!0),forceCanvas:r(i.render.forceCanvas,!1),view:i.render.canvas?i.render.canvas:void 0,backgroundAlpha:1}),this.render.parentNode=i.render.resizeTo?i.render.resizeTo:i.render.canvas?i.render.canvas.parentNode:this.render.view.parentElement,this.render.mainContainer=new Ls,this.render.mainContainer.zIndex=10,this.render.stage.addChild(this.render.mainContainer),this.render.mainContainerMask=new ha,this.render.mainContainerMask.cacheAsBitmap=!0,this.judgement=new vo({chart:this.chart,stage:this.render.mainContainer,canvas:this.render.view,assets:{textures:{normal:this.assets.textures.clickRaw,bad:this.assets.textures.clickRaw},sounds:{tap:this.assets.sounds.tap,drag:this.assets.sounds.drag,flick:this.assets.sounds.flick}},hitsound:r(i.settings.hitsound,!0),hitsoundVolume:n(i.settings.hitsoundVolume,1,0,1),showAPStatus:r(i.settings.showAPStatus,!0),challengeMode:r(i.settings.challengeMode,!1),autoPlay:r(i.settings.autoPlay,!1)}),this.sprites={},this.functions={start:[],pause:[],end:[]},this._settings={noteScale:n(i.settings.noteScale,8e3),bgDim:n(i.settings.bgDim,.5,0,1),offset:n(i.settings.audioOffset,0),speed:n(i.settings.speed,1,0,2),showFPS:r(i.settings.showFPS,!0),showInputPoint:r(i.settings.showInputPoint,!0),multiNoteHL:r(i.settings.multiNoteHL,!0),showAPStatus:r(i.settings.showAPStatus,!0),challengeMode:r(i.settings.challengeMode,!1),autoPlay:r(i.settings.autoPlay,!1),debug:r(i.settings.debug,!1)},this._watermarkText=function(t,e=""){return"string"==typeof t&&""!=t?t:e}(i.watermark,"github/MisaLiu/phi-chart-render"),this._musicId=null,this._audioTimer=new xo(this._settings.speed,this.chart.offset+this._settings.offset),this._audioOffset=0,this._animateStatus=NaN,this._gameStartTime=NaN,this._gameEndTime=NaN,this._isPaused=!1,this._isEnded=!1,this.resize=this.resize.bind(this);for(const t in e)this["_"+t]=e[t].bind(this);for(const t in s)this["_"+t]=s[t].bind(this);if(this._settings.speed<.25)throw new Error("Speed too slow");if(this._settings.speed>2)throw new Error("Speed too fast");this.resize(!1),window.addEventListener("resize",this.resize),this._settings.autoPlay&&window.addEventListener("keydown",this._onKeyPressCallback)}createSprites(){if(this.chart.bg){this.render.mainContainerCover=new Us(this.chart.bg);let t=new ha;t.beginFill(0),t.drawRect(0,0,this.render.mainContainerCover.texture.width,this.render.mainContainerCover.texture.height),t.endFill(),t.position.x=-this.render.mainContainerCover.width/2,t.position.y=-this.render.mainContainerCover.height/2,t.alpha=.5,this.render.mainContainerCover.zIndex=1,this.render.mainContainerCover.addChild(t),this.render.mainContainerCover.anchor.set(.5),this.render.stage.addChild(this.render.mainContainerCover)}if(this.chart.createSprites(this.render.mainContainer,this.render.sizer,this.assets.textures,this.zipFiles,this._settings.speed,this._settings.bgDim,this._settings.multiNoteHL,this._settings.debug),this._settings.showAPStatus)for(const t of this.chart.judgelines)t.sprite&&(t.sprite.tint=16772256);this.judgement.stage=this.render.mainContainer,this.judgement.createSprites(this._settings.showInputPoint),this.sprites.progressBar=new Us(Co),this.sprites.progressBar.width=0,this.sprites.progressBar.alpha=.75,this.sprites.progressBar.zIndex=99999,this.render.mainContainer.addChild(this.sprites.progressBar),this.sprites.pauseButton=new Us(this.assets.textures.pauseButton),this.sprites.pauseButton.interactive=!0,this.sprites.pauseButton.buttonMode=!0,this.sprites.pauseButton.cursor="pointer",this.sprites.pauseButton.on("pointerdown",this._pauseBtnClickCallback),this.sprites.pauseButton.hitArea=new tt(-1.5*this.sprites.pauseButton.texture.width,-this.sprites.pauseButton.texture.height/2,2*this.sprites.pauseButton.texture.width,2*this.sprites.pauseButton.texture.height),this.sprites.pauseButton.clickCount=0,this.sprites.pauseButton.lastClickTime=Date.now(),this.sprites.pauseButton.isEndRendering=!1,this.sprites.pauseButton.lastRenderTime=Date.now(),this.sprites.pauseButton.anchor.set(1,0),this.sprites.pauseButton.alpha=.5,this.sprites.pauseButton.zIndex=99999,this.render.mainContainer.addChild(this.sprites.pauseButton),this.sprites.fakeJudgeline=new Us(this.assets.textures.judgeline),this.sprites.fakeJudgeline.anchor.set(.5),this.sprites.fakeJudgeline.zIndex=99999,this._settings.showAPStatus&&(this.sprites.fakeJudgeline.tint=16772256),this.render.mainContainer.addChild(this.sprites.fakeJudgeline),this._settings.showFPS&&(this.render.fpsText=new gr("FPS: 0",{fontFamily:"MiSans",align:"right",fill:16777215}),this.render.fpsText.anchor.x=1,this.render.fpsText.alpha=.5,this.render.fpsText.zIndex=999999,this.render.mainContainer.addChild(this.render.fpsText)),this.render.watermark=new gr(this._watermarkText,{fontFamily:"MiSans",align:"right",fill:16777215}),this.render.watermark.anchor.set(1),this.render.watermark.alpha=.5,this.render.watermark.zIndex=999999,this.render.mainContainer.addChild(this.render.watermark),this.render.mainContainer.sortChildren(),this.render.stage.sortChildren();for(const t in this.judgement.sounds)this.judgement.sounds[t].load()}start(){if(this.render){if(!this.chart.music)throw new Error("You must have a music to play");if(this._musicId)throw new Error("You have already started");this.resize(),this.render.fpsText&&(this.render.fpsCounter=setInterval((()=>{this.render.fpsText.text="FPS: "+this.render.ticker.FPS.toFixed(0)}),500)),this.chart.music.rate(this._settings.speed),this.chart.music.once("play",(()=>{this._audioTimer.start()})),this.chart.music.on("end",this._gameEndCallback),this._animateStatus=0,this._gameStartTime=Date.now(),this.chart.noteJudgeCallback=this.judgement.calcNote,this.render.ticker.add(this._calcTick),this.chart.calcTime(0);for(const t of this.chart.judgelines)t.sprite&&(t.sprite.alpha=0,t.debugSprite&&(t.debugSprite.visible=!1));for(const t of this.chart.notes)t.sprite&&(t.sprite.alpha=0,t.debugSprite&&(t.debugSprite.visible=!1),t.hitsound&&t.hitsound.volume(this.judgement._hitsoundVolume));for(const t in this.judgement.sounds)this.judgement.sounds[t].volume(this.judgement._hitsoundVolume)}}pause(){this._isPaused=!this._isPaused,this.judgement.input._isPaused=this._isPaused,this._musicId&&(this._isPaused?(this.chart.music.pause(),this._runCallback("pause"),this._audioTimer.pause(),this.chart.music.once("play",(()=>{this._audioTimer.pause()}))):this.chart.music.play(this._musicId))}restart(){if(this._musicId){this.render.ticker.remove(this._calcTick),this.chart.music.stop(),this.chart.music.off("play"),this._audioTimer.reset(),this._musicId=null,this.chart.reset(),this.judgement.reset(),this.resize(),this.chart.calcTime(0),this._isPaused=!1,this._isEnded=!1,this._animateStatus=0,this._gameStartTime=Date.now(),this._gameEndTime=NaN,this.chart.music.once("play",(()=>{this._audioTimer.start()})),this.render.ticker.add(this._calcTick),this._settings.showAPStatus&&(this.sprites.fakeJudgeline.tint=16772256),this.sprites.fakeJudgeline.visible=!0;for(const t of this.chart.judgelines)t.sprite&&(t.sprite.alpha=0,this._settings.showAPStatus&&(t.sprite.tint=16772256),t.debugSprite&&(t.debugSprite.visible=!1));for(const t of this.chart.notes)t.sprite&&(t.sprite.alpha=0,t.debugSprite&&(t.debugSprite.visible=!1))}}destroy(t=!1){const e=this.render.view;this.render.ticker.remove(this._calcTick),this.chart.music.stop(),this.chart.music.off("play"),this.chart.music.off("end"),this._audioTimer.reset(),this.render.fpsText&&clearInterval(this.render.fpsCounter),this.chart.reset(),this.chart.destroySprites(),this.judgement.destroySprites(),this.judgement.input.removeListenerFromCanvas(e),window.removeEventListener("resize",this.resize),window.removeEventListener("keydown",this._onKeyPressCallback),e.width=e.height=0,this.render.destroy(t,{children:!0,texture:!1,baseTexture:!1})}on(t,e){this.functions[t]&&e instanceof Function&&this.functions[t].push(e)}resize(t=!0,e=!0){if(this.render){if(this.render.renderer.resize(this.render.parentNode.clientWidth,this.render.parentNode.clientHeight),this.render.sizer=function(t,e,i=8e3){let s={};return s.width=e/9*16<t?e/9*16:t,s.height=e,s.widthPercent=s.width*(9/160),s.widthOffset=(t-s.width)/2,s.widerScreen=s.width<t,s.startX=-s.width/12,s.endX=s.width*(13/12),s.startY=-s.height/12,s.endY=s.height*(13/12),s.noteSpeed=.6*s.height,s.noteScale=s.width/i,s.noteWidth=.117775*s.width,s.lineScale=s.width>.75*s.height?s.height/18.75:s.width/14.0625,s.heightPercent=s.height/1080,s.textureScale=s.height/750,s}(this.render.screen.width,this.render.screen.height,this._settings.noteScale),this.render.mainContainer.position.x=this.render.sizer.widthOffset,this.render.sizer.widerScreen&&this.render.mainContainer?(this.render.mainContainer.mask=this.render.mainContainerMask,this.render.mainContainerMask.visible=!0,this.render.mainContainerMask.clear().beginFill(16777215).drawRect(this.render.sizer.widthOffset,0,this.render.sizer.width,this.render.sizer.height).endFill()):(this.render.mainContainer.mask=null,this.render.mainContainerMask.visible=!1),this.render.sizer.widerScreen&&this.render.mainContainerCover){let t=this.render.screen.width/this.render.mainContainerCover.texture.width,e=this.render.screen.height/this.render.mainContainerCover.texture.height,i=t>e?t:e;this.render.mainContainerCover.scale.set(i),this.render.mainContainerCover.position.set(this.render.screen.width/2,this.render.screen.height/2),this.render.mainContainerCover.visible=!0}else this.render.mainContainerCover&&(this.render.mainContainerCover.visible=!1);!this._isEnded&&this.sprites&&(this.sprites.progressBar&&(this.sprites.progressBar.position.set(0,0),this.sprites.progressBar.scale.y=this.render.sizer.heightPercent,this.sprites.progressBar.baseScaleX=this.render.sizer.width/this.sprites.progressBar.texture.baseTexture.width),this.sprites.pauseButton&&(this.sprites.pauseButton.position.x=this.render.sizer.width-72*this.render.sizer.heightPercent,this.sprites.pauseButton.position.y=75*this.render.sizer.heightPercent,this.sprites.pauseButton.scale.set(.94*this.render.sizer.heightPercent)),this.sprites.fakeJudgeline&&(this.sprites.fakeJudgeline.position.x=this.render.sizer.width/2,this.sprites.fakeJudgeline.position.y=this.render.sizer.height/2,this.sprites.fakeJudgeline.height=18.75*this.render.sizer.lineScale*.008,(e||this._isEnded)&&(this.sprites.fakeJudgeline.width=0))),this.render.fpsText&&(this.render.fpsText.position.x=this.render.sizer.width,this.render.fpsText.position.y=0,this.render.fpsText.style.fontSize=32*this.render.sizer.heightPercent,this.render.fpsText.style.padding=8*this.render.sizer.heightPercent),this.render.watermark&&(this.render.watermark.position.x=this.render.sizer.width,this.render.watermark.position.y=this.render.sizer.height,this.render.watermark.style.fontSize=24*this.render.sizer.heightPercent),t&&(this.judgement.resizeSprites(this.render.sizer,this._isEnded),this.chart.resizeSprites(this.render.sizer,this._isEnded))}}}const Io=.125;function Po(t){return t.startTime=parseFloat((t.startTime[0]+t.startTime[1]/t.startTime[2]).toFixed(3)),t.endTime=parseFloat((t.endTime[0]+t.endTime[1]/t.endTime[2]).toFixed(3)),t}function ko(t,e,i,s=1){if(t.start==t.end)return t.start;if(t.startTime>i)throw new Error("currentTime must bigger than startTime");if(t.endTime<i)throw new Error("currentTime must smaller than endTime");let r=(i-t.startTime)/(t.endTime-t.startTime),a=1-r,o=e[t.easingType-s]?e[t.easingType-s]:e[0],h=o(n(t.easingLeft,0,0,1)*a+n(t.easingRight,1,0,1)*r),l=o(n(t.easingLeft,0,0,1));return h=(h-l)/(o(n(t.easingRight,1,0,1))-l),t.start*(1-h)+t.end*h}const Do={CalcBetweenTime:Io,calculateEventBeat:Po,calculateEventsBeat:function(t){return t.forEach((t=>{t=Po(t)})),t},valueCalculator:ko,calculateRealTime:function(t,e){let i=t.slice(),s=e.slice();return s.forEach((t=>{for(let e=0,s=i.length;e<s;e++){let r=i[e];if(!(r.startBeat>t.endTime)){t.endTime=r.startTime+(t.endTime-r.startBeat)*r.beatTime;for(let r=e;r<s;r++){let e=i[r];if(!(e.startBeat>t.startTime)){t.startTime=e.startTime+(t.startTime-e.startBeat)*e.beatTime;break}}break}}})),s.slice()},calculateEventEase:function(t,e,i=1,s=!1){let r=[],n=t.endTime-t.startTime;if(!t)return[];if(t.easingType&&e[t.easingType-i]&&(t.easingType-i!=0||s)&&t.easingType<=e.length&&t.start!=t.end)for(let s=0,a=Math.ceil(n/Io);s<a;s++){let n=t.startTime+s*Io,a=t.startTime+(s+1)*Io<=t.endTime?t.startTime+(s+1)*Io:t.endTime;r.push({startTime:n,endTime:a,start:ko(t,e,n,i),end:ko(t,e,a,i)})}else r.push({startTime:t.startTime,endTime:t.endTime,start:t.start,end:t.end});return r},calculateHoldBetween:function(t){let e=t.slice(),i=[];return e.sort(((t,e)=>t.startTime-e.startTime)),e.forEach((t=>{i.length<=0?i.push({startTime:t.startTime,endTime:t.startTime,bpm:t.bpm,holdBetween:(-1.2891*t.bpm+396.71)/1e3}):(i[i.length-1].endTime=t.startTime,i[i.length-1].bpm!=t.bpm&&i.push({startTime:t.startTime,endTime:t.startTime,bpm:t.bpm,holdBetween:(-1.2891*t.bpm+396.71)/1e3}))})),i.sort(((t,e)=>t.startTime-e.startTime)),i.length>0?(i[0].startTime=-999,i[i.length-1].endTime=1e4):i.push({startTime:-999,endTime:1e4,bpm:120,holdBetween:.242018}),i},arrangeSameValueEvent:function(t){if(!t||t.length<=0)return[];let e=t.slice(),i=[e.shift()];for(const t of e)i[i.length-1].start==i[i.length-1].end&&t.start==t.end&&i[i.length-1].start==t.start?i[i.length-1].endTime=t.endTime:i.push(t);return i.slice()},arrangeSameSingleValueEvent:function(t){if(!t||t.length<=0)return[];let e=[];for(let i of t){let t=e[e.length-1];t&&t.value==i.value?t.endTime=i.endTime:e.push(i)}return e.slice()}};class Mo{constructor(t){this.id=n(t.id,-1,0),this.texture=t.texture?t.texture:null,this.parentLine=t.parentLine?t.parentLine:null,this.zIndex=n(t.zIndex,NaN,1),this.isCover=r(t.isCover,!0),this.useOfficialScale=!1,this.eventLayers=[],this.floorPositions=[],this.extendEvent={color:[],scaleX:[],scaleY:[],text:[],incline:[]},this.noteControls={alpha:[],scale:[],x:[]},this.isText=!1,this.sprite=void 0,this.reset()}reset(){this.speed=1,this.x=.5,this.y=.5,this.alpha=1,this.deg=0,this.sinr=0,this.cosr=1,this.floorPosition=0,this.baseScaleX=3,this.baseScaleY=2.88,this.extendEvent.scaleX.length>0&&this.extendEvent.scaleX[0].startTime<=0?this.scaleX=this.extendEvent.scaleX[0].start:this.scaleX=1,this.extendEvent.scaleY.length>0&&this.extendEvent.scaleY[0].startTime<=0?this.scaleY=this.extendEvent.scaleY[0].start:this.scaleY=1,this.inclineSinr=NaN,this.color=NaN,this.sprite&&(this.sprite.alpha=1,this.sprite.angle=0,this.sprite.scale.set(1),this.isText&&(this.sprite.text=""))}sortEvent(t=!1){this.eventLayers.forEach((t=>{t.sort()}));for(const t in this.extendEvent)this.extendEvent[t].sort(((t,e)=>t.startTime-e.startTime));for(const t in this.eventLayers[0])"speed"!=t&&this.eventLayers[0][t]instanceof Array&&(this.eventLayers[0][t][0].startTime<=0||this.eventLayers[0][t].unshift({startTime:-99,endTime:this.eventLayers[0][t][0].startTime,start:0,end:0}));for(const t in this.noteControls)this.noteControls[t].sort(((t,e)=>e.y-t.y))}calcFloorPosition(){if(this.eventLayers.length<=0)throw new Error("No event layer in this judgeline");let t=0;this.eventLayers.forEach((e=>{e.speed=Do.arrangeSameSingleValueEvent(e.speed),e.speed.length<1&&t++})),t==this.eventLayers.length&&(console.warn("Line "+this.id+" don't have any speed event, use default speed."),this.eventLayers[0].speed.push({startTime:0,endTime:1e4,start:1,end:1}));let e={},i=0,s=[];this.floorPositions=[],this.eventLayers.forEach(((t,i)=>{t.speed.forEach(((i,r)=>{i.endTime=t.speed[r+1]?t.speed[r+1].startTime:1e4;let n=i.startTime.toFixed(3);e[n]||s.push({startTime:i.startTime,endTime:NaN,floorPosition:NaN}),e[n]=!0})),0===i&&t.speed[0].startTime>0&&t.speed.unshift({startTime:-99,endTime:t.speed[0]?t.speed[0].startTime:1e4,value:t.speed[0]?t.speed[0].value:1})})),s.sort(((t,e)=>t.startTime-e.startTime)),s.unshift({startTime:-999,endTime:s[0]?s[0].startTime:1e4,floorPosition:-999}),i+=s[0].endTime;for(let t=1;t<s.length;t++){let e=s[t],r=t<s.length-1?s[t+1]:{startTime:1e4},n=e.startTime;s[t].floorPosition=i,s[t].endTime=r.startTime,i+=(r.startTime-e.startTime)*this._calcSpeedValue(n)}this.floorPositions=s}getFloorPosition(t){if(this.floorPositions.length<=0)throw new Error("No floorPosition created, please call calcFloorPosition() first");let e={};for(const i of this.floorPositions)if(!(i.endTime<t)){if(i.startTime>t)break;e.startTime=i.startTime,e.endTime=i.endTime,e.floorPosition=i.floorPosition}return e.value=this._calcSpeedValue(t),e}_calcSpeedValue(t){let e=0;return this.eventLayers.forEach((i=>{let s=0;for(const e of i.speed)if(!(e.endTime<t)){if(e.startTime>t)break;s=e.value}e+=s})),e}createSprite(t,e,i=!1){if(this.sprite)return this.sprite;if(this.isText?this.sprite=new gr("",{fontFamily:"MiSans",align:"center",fill:16777215}):(this.sprite=new Us(e[this.texture]?e[this.texture]:t.judgeline),this.texture&&(this.baseScaleX=this.baseScaleY=1)),this.sprite.anchor.set(.5),this.sprite.alpha=1,i){let t=new Ls,e=new gr(this.id,{fontSize:48,fill:16711840}),i=(new ha).beginFill(16711840).drawRect(-22,-22,44,44).endFill();e.anchor.set(.5),e.position.set(0,-36-e.width/2),t.addChild(e),t.addChild(i),this.debugSprite=t}return this.extendEvent.scaleX.length>0&&this.extendEvent.scaleX[0].startTime<=0&&(this.scaleX=this.extendEvent.scaleX[0].start),this.extendEvent.scaleY.length>0&&this.extendEvent.scaleY[0].startTime<=0&&(this.scaleY=this.extendEvent.scaleY[0].start),this.sprite}calcTime(t,e){this.speed=0,this.x=0,this.y=0,this.alpha=0,this.deg=0;for(const e of this.eventLayers)e.calcTime(t),this.speed+=e._speed,this.x+=e._posX,this.y+=e._posY,this.alpha+=e._alpha,this.deg+=e._rotate;for(const e of this.floorPositions)if(!(e.endTime<t)){if(e.startTime>t)break;this.floorPosition=(t-e.startTime)*this.speed+e.floorPosition}for(const e of this.extendEvent.scaleX){if(e.endTime<t)continue;if(e.startTime>t)break;let i=(t-e.startTime)/(e.endTime-e.startTime),s=1-i;this.scaleX=e.start*s+e.end*i,this.sprite.scale.x=this.scaleX*this.baseScaleX}for(const e of this.extendEvent.scaleY){if(e.endTime<t)continue;if(e.startTime>t)break;let i=(t-e.startTime)/(e.endTime-e.startTime),s=1-i;this.scaleY=e.start*s+e.end*i,this.sprite.scale.y=this.scaleY*this.baseScaleY}for(const e of this.extendEvent.text)if(!(e.endTime<t)){if(e.startTime>t)break;this.sprite.text=e.value}for(const e of this.extendEvent.color)if(!(e.endTime<t)){if(e.startTime>t)break;this.color=this.sprite.tint=e.value}for(const e of this.extendEvent.incline){if(e.endTime<t)continue;if(e.startTime>t)break;let i=(t-e.startTime)/(e.endTime-e.startTime),s=1-i;this.inclineSinr=Math.sin(e.start*s+e.end*i)}if(this.cosr=Math.cos(this.deg),this.sinr=Math.sin(this.deg),this.parentLine){let t=this.x,e=this.y;this.x=t*this.parentLine.cosr+e*this.parentLine.sinr+this.parentLine.x,this.y=-t*this.parentLine.sinr+e*this.parentLine.cosr+this.parentLine.y}this.sprite.position.x=(this.x+.5)*e.width,this.sprite.position.y=(.5-this.y)*e.height,this.sprite.alpha=this.alpha>=0?this.alpha:0,this.sprite.rotation=this.deg,this.sprite.visible=this.alpha>0,this.debugSprite&&(this.debugSprite.position=this.sprite.position,this.debugSprite.rotation=this.sprite.rotation,this.debugSprite.alpha=.2+.8*this.sprite.alpha)}calcNoteControl(t,e,i){if(this.noteControls[e].length<=0)return i;let s=i;for(const i of this.noteControls[e]){if(i.y<t)break;s=i.value}return s}}class Bo{constructor(){this.speed=[],this.moveX=[],this.moveY=[],this.alpha=[],this.rotate=[],this._speed=0,this._posX=0,this._posY=0,this._alpha=0,this._rotate=0}sort(){const t=(t,e)=>t.startTime-e.startTime;this.speed.sort(t),this.moveX.sort(t),this.moveY.sort(t),this.alpha.sort(t),this.rotate.sort(t)}calcTime(t){this._posX=No(this.moveX,t,this._posX),this._posY=No(this.moveY,t,this._posY),this._alpha=No(this.alpha,t,this._alpha),this._rotate=No(this.rotate,t,this._rotate);for(const e of this.speed)if(!(e.endTime<t)){if(e.startTime>t)break;this._speed=e.value}}}function No(t,e,i=0){for(const i of t){if(i.endTime<e)continue;if(i.startTime>e)break;if(i.start==i.end)return i.start;let t=(e-i.startTime)/(i.endTime-i.startTime),s=1-t;return i.start*s+i.end*t}return i}class Lo{constructor(t){if(this.id=n(t.id,-1,0),this.type=n(t.type,1,1,4),this.time=n(t.time,-1),this.holdTime=3===this.type?n(t.holdTime,0):0,this.holdTimeLength=3===this.type?parseFloat(this.time+this.holdTime):0,this.speed=n(t.speed,1),this.floorPosition=n(t.floorPosition,this.time),this.holdLength=3===this.type?n(t.holdLength,0):0,this.endPosition=parseFloat(this.floorPosition+this.holdLength),this.positionX=n(t.positionX,0),this.basicAlpha=n(t.basicAlpha,1,0,1),this.visibleTime=n(t.visibleTime,NaN,0,999998),this.yOffset=n(t.yOffset,0),this.xScale=n(t.xScale,1,0),this.isAbove=r(t.isAbove,!0),this.isFake=r(t.isFake,!1),this.isMulti=r(t.isMulti,!1),this.useOfficialSpeed=r(t.useOfficialSpeed,!1),this.texture=t.texture&&""!=t.texture?t.texture:null,this.hitsound=t.hitsound&&""!=t.hitsound?t.hitsound:null,this.judgeline=t.judgeline,this.sprite=void 0,!this.judgeline)throw new Error("Note must have a judgeline");this.reset()}reset(){this.isScored=!1,this.isScoreAnimated=!1,this.isHolding=!1,this.lastHoldTime=NaN,this.score=0,this.scoreTime=0,this.sprite&&(this.sprite.alpha=this.basicAlpha)}createSprite(t,e,i=!0,s=!1){if(this.sprite)return this.sprite;switch(this.type){case 1:this.sprite=new Us(this.texture&&""!=this.texture?e[this.texture]:t["tap"+(this.isMulti&&i?"HL":"")]);break;case 2:this.sprite=new Us(this.texture&&""!=this.texture?e[this.texture]:t["drag"+(this.isMulti&&i?"HL":"")]);break;case 3:if(this.texture&&""!=this.texture)this.sprite=new Us(e[this.texture]),this.sprite.anchor.set(.5,1),this.sprite.height=this.holdLength;else{this.sprite=new Ls;let e=new Us(t["holdHead"+(this.isMulti&&i?"HL":"")]),s=new Us(t["holdBody"+(this.isMulti&&i?"HL":"")]),r=new Us(t.holdEnd);e.anchor.set(.5),s.anchor.set(.5,1),r.anchor.set(.5,1),s.height=this.holdLength,e.position.set(0,e.height/2),s.position.set(0,0),r.position.set(0,-s.height),this.sprite.addChild(e),this.sprite.addChild(s),this.sprite.addChild(r)}break;case 4:this.sprite=new Us(this.texture&&""!=this.texture?e[this.texture]:t["flick"+(this.isMulti&&i?"HL":"")]);break;default:throw new Error("Unsupported note type: "+this.type)}if(3!==this.type&&this.sprite.anchor.set(.5),this.isAbove||(this.sprite.angle=180),this.sprite.alpha=this.basicAlpha,this.sprite.visible=!1,this.sprite.outScreen=!0,this.hitsound&&(this.hitsound=e[this.hitsound],this.hitsound.load()),s){let t=new Ls,e=new gr(this.judgeline.id+(this.isAbove?"+":"-")+this.id,{fontSize:48,fill:59135}),i=(new ha).beginFill(59135).drawRect(-22,-22,44,44).endFill();e.anchor.set(.5),e.position.set(0,-36-e.height/2),e.angle=this.isAbove?0:180,t.addChild(e),t.addChild(i),this.debugSprite=t}return this.sprite}calcTime(t,e){let i=e.height*this.yOffset,s=i*(this.isAbove?-1:1),r=e.widthPercent*this.positionX,n=(this.floorPosition-this.judgeline.floorPosition)*(3===this.type&&this.useOfficialSpeed?1:this.speed)*e.noteSpeed+i,a=n*(this.isAbove?-1:1),o=a*this.judgeline.sinr*-1,h=a*this.judgeline.cosr,l=3===this.type?(this.useOfficialSpeed?this.holdTimeLength-t:this.endPosition-this.judgeline.floorPosition)*this.speed*e.noteSpeed:n,c=3===this.type?l*(this.isAbove?-1:1):a;if(!isNaN(this.judgeline.inclineSinr)&&3!==this.type){let t=1-this.judgeline.inclineSinr*n/360;this.sprite.scale.set(t*this.sprite.baseScale*this.xScale,t*this.sprite.baseScale),r*=t}if(r*=this.judgeline.calcNoteControl(n,"x",1),3===this.type&&(this.time<=t&&this.holdTimeLength>t?(o=h=0,this.sprite.children[0].visible=!1,this.sprite.children[1].height=l/e.noteScale,this.sprite.children[2].position.y=-1*this.sprite.children[1].height):this.sprite.children[0].visible=!0),this.sprite.judgelineX=r*this.judgeline.cosr+this.judgeline.sprite.position.x,this.sprite.judgelineY=r*this.judgeline.sinr+this.judgeline.sprite.position.y,o+=this.sprite.judgelineX,h+=this.sprite.judgelineY,this.sprite.judgelineX+=s*this.judgeline.sinr*-1,this.sprite.judgelineY+=s*this.judgeline.cosr,this.sprite.outScreen=!function(t,e){let i=t.startX<=t.endX?t.startX:t.endX,s=t.startX<=t.endX?t.endX:t.startX,r=t.startY<=t.endY?t.startY:t.endY,n=t.startY<=t.endY?t.endY:t.startY;return i>=e.startX&&r>=e.startY&&s<=e.endX&&n<=e.endY||s>=e.startX&&n>=e.startY&&i<=e.endX&&r<=e.endY}({startX:o,endX:r*this.judgeline.cosr-c*this.judgeline.sinr+this.judgeline.sprite.position.x,startY:h,endY:c*this.judgeline.cosr+r*this.judgeline.sinr+this.judgeline.sprite.position.y},e),this.sprite.visible=!this.sprite.outScreen,this.debugSprite&&(this.debugSprite.visible=!this.sprite.outScreen),this.sprite.position.x=o,this.sprite.position.y=h,this.sprite.angle=this.judgeline.sprite.angle+(this.isAbove?0:180),!this.sprite.outScreen){let e=this.judgeline.calcNoteControl(n,"scale",1);this.sprite.alpha=this.isScoreAnimated&&3!==this.type?0:this.basicAlpha*this.judgeline.calcNoteControl(n,"alpha",1),this.sprite.scale.set(this.sprite.baseScale*this.xScale*e,this.sprite.baseScale*e),this.sprite.visible=this.sprite.alpha>0,3!==this.type&&this.time>t&&n<0&&this.judgeline.isCover&&(this.sprite.visible=!1),3!==this.type&&this.isFake&&this.time<=t&&(this.sprite.visible=!1),3===this.type&&(this.time>t&&n<0&&this.judgeline.isCover||this.holdTimeLength<=t)&&(this.sprite.visible=!1),!isNaN(this.visibleTime)&&this.time-t>this.visibleTime&&(this.sprite.visible=!1),this.judgeline.alpha<0&&(this.judgeline.alpha>=-1?this.sprite.visible=!1:this.judgeline.alpha>=-2&&(this.originY>0?this.sprite.visible=!1:this.originY<0&&(this.sprite.visible=!0))),this.debugSprite&&(this.debugSprite.position=this.sprite.position,this.debugSprite.angle=this.sprite.angle,this.debugSprite.alpha=.2+(this.sprite.visible?.8*this.sprite.alpha:0),this.time>t&&(this.sprite.visible?this.sprite.alpha=this.basicAlpha:(this.sprite.visible=!0,this.sprite.alpha=.2)))}}}function Oo(t,e){return t/e*1.875}const Fo=[t=>t,t=>Math.sin(t*Math.PI/2),t=>1-Math.cos(t*Math.PI/2),t=>1-(t-1)**2,t=>t**2,t=>(1-Math.cos(t*Math.PI))/2,t=>((t*=2)<1?t**2:-((t-2)**2-2))/2,t=>1+(t-1)**3,t=>t**3,t=>1-(t-1)**4,t=>t**4,t=>((t*=2)<1?t**3:(t-2)**3+2)/2,t=>((t*=2)<1?t**4:-((t-2)**4-2))/2,t=>1+(t-1)**5,t=>t**5,t=>1-2**(-10*t),t=>2**(10*(t-1)),t=>Math.sqrt(1-(t-1)**2),t=>1-Math.sqrt(1-t**2),t=>(2.70158*t-1)*(t-1)**2+1,t=>(2.70158*t-1.70158)*t**2,t=>((t*=2)<1?1-Math.sqrt(1-t**2):Math.sqrt(1-(t-2)**2)+1)/2,t=>t<.5?(14.379638*t-5.189819)*t**2:(14.379638*t-9.189819)*(t-1)**2+1,t=>1-2**(-10*t)*Math.cos(t*Math.PI/.15),t=>2**(10*(t-1))*Math.cos((t-1)*Math.PI/.15),t=>((t*=11)<4?t**2:t<8?(t-6)**2+12:t<10?(t-9)**2+15:(t-10.5)**2+15.75)/16,t=>1-Fo[25](1-t),t=>(t*=2)<1?Fo[25](t)/2:Fo[26](t-1)/2+.5,t=>t<.5?2**(20*t-11)*Math.sin((160*t+1)*Math.PI/18):1-2**(9-20*t)*Math.sin((160*t+1)*Math.PI/18)];function Uo(t){return Math.floor(8*t)}function Go(t,e){let i=t.slice(),s=e.slice();return s.forEach((t=>{if(t.visibleBeat)for(let e=0,s=i.length;e<s;e++){let s=i[e];if(!(s.startBeat>t.visibleBeat)){t.visibleTime=t.visibleBeat*s.beatTime;break}}})),s}const zo=.125,jo=[t=>t,t=>Math.sin(t*Math.PI/2),t=>1-Math.cos(t*Math.PI/2),t=>1-(1-t)*(1-t),t=>t*t,t=>-(Math.cos(Math.PI*t)-1)/2,t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,t=>1-Math.pow(1-t,3),t=>t*t*t,t=>1-Math.pow(1-t,4),t=>t*t*t*t,t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,t=>1-Math.pow(1-t,5),t=>t*t*t*t*t,t=>1===t?1:1-Math.pow(2,-10*t),t=>0===t?0:Math.pow(2,10*t-10),t=>Math.sqrt(1-Math.pow(t-1,2)),t=>1-Math.sqrt(1-Math.pow(t,2)),t=>1+2.70158*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),t=>2.70158*t*t*t-1.70158*t*t,t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,t=>t<.5?Math.pow(2*t,2)*(7.18982*t-2.59491)/2:(Math.pow(2*t-2,2)*(3.59491*(2*t-2)+2.59491)+2)/2,t=>0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*(2*Math.PI/3))+1,t=>0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*(2*Math.PI/3)),t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,t=>1-jo[25](1-t),t=>t<.5?(1-jo[25](1-2*t))/2:(1+jo[25](2*t-1))/2];function Ho(t,e="alpha",i=1){if(!t||!(t instanceof Array)||t.length<=0)return[];if(2==t.length&&0==t[0].x&&t[1].x>=1e4&&t[0][e]==i&&t[1][e]==i)return[];let s=t.slice().sort(((t,e)=>e.x-t.x)),r=[];for(let t=0;t<s.length;t++){const i=s[t],a=s[t+1];r=[...r,...n(i,a,e)]}return r=function(t){let e=[];for(const i of t)e.length>0&&e[e.length-1].value==i.value||e.push(i);return e.slice()}(r),r[0].y<1e4&&r.unshift({y:9999999,value:r[0].value}),r;function n(t,e=null,i="alpha"){let s=[],r=t.x-(e?e.x:0),n=t[i]-(e?e[i]:t[i]),a=jo[t.easing-1],o=t.x;if(t[i]==(e?e[i]:t[i]))return[{y:t.x,value:t[i]}];for(;o>(e?e.x:0);){let e=(t.x-o)/r,h=parseFloat((t[i]-n*a(e)).toFixed(2));s.length>0&&parseFloat(s[s.length-1].value.toFixed(2))==h?s[s.length-1].y=o:s.push({y:o,value:h}),o-=2}return s[s.length-1].value!=(e?e[i]:t[i])&&s.push({y:e?e.x:0,value:e?e[i]:t[i]}),s}}function Yo(t){let e=[],i=t.endTime-t.startTime;if(t.start!=t.end)for(let s=0,r=Math.ceil(i/zo);s<r;s++){let i=t.startTime+s*zo,r=t.startTime+(s+1)*zo<=t.endTime?t.startTime+(s+1)*zo:t.endTime;e.push({startTime:i,endTime:r,value:Do.valueCalculator(t,jo,r)})}else e.push({startTime:t.startTime,endTime:t.endTime,value:t.start});return e}function Xo(t,e,i=0,s=1){if(i==s)return i;if(t.startTime>e)throw new Error("currentTime must bigger than startTime");if(t.endTime<e)throw new Error("currentTime must smaller than endTime");let r=(e-t.startTime)/(t.endTime-t.startTime),a=1-r,o=jo[t.easingType-1]?jo[t.easingType-1]:jo[0],h=o(n(t.easingLeft,0,0,1)*a+n(t.easingRight,1,0,1)*r),l=o(n(t.easingLeft,0,0,1));return h=(h-l)/(o(n(t.easingRight,1,0,1))-l),i*(1-h)+s*h}class Wo{constructor(t={}){this.judgelines=[],this.notes=[],this.bpmList=[],this.offset=n(t.offset,0),this.isLineTextureReaded=!1,this.music=t.music?t.music:null,this.bg=t.bg?t.bg:null,this.info={name:t.name,artist:t.artist,author:t.author,bgAuthor:t.bgAuthor,difficult:t.difficult},this.sprites={},this.noteJudgeCallback=null,this.holdBetween=.15}static from(t,e={},i=[]){let s,r=e;if("object"==typeof t?isNaN(Number(t.formatVersion))?t.META&&!isNaN(Number(t.META.RPEVersion))&&(s=function(t){let e=[],i={},s=function(t){let e=JSON.parse(JSON.stringify(t));return e.META.RPEVersion<=100&&e.judgeLineList.forEach((t=>{t.bpmfactor=1,t.father=-1,t.zOrder=0,t.eventLayers.forEach((t=>{for(const e in t)t[e].forEach((t=>{t.easingLeft=0,t.easingRight=1}))}))})),e.META.RPEVersion,e.META.RPEVersion,e.META.RPEVersion>113&&console.warn("Unsupported chart version: "+e.META.RPEVersion+", some features may not supported"),e}(t),r=new Wo({name:s.META.name,artist:s.META.composer,author:s.META.charter,difficult:s.META.level,offset:s.META.offset/1e3});{let t=.5,e=0,i=0;s.BPMList.forEach(((r,n)=>{r.endTime=s.BPMList[n+1]?s.BPMList[n+1].startTime:[1e4,0,1],r.startBeat=r.startTime[0]+r.startTime[1]/r.startTime[2],r.endBeat=r.endTime[0]+r.endTime[1]/r.endTime[2],i+=t*(r.startBeat-e),r.startTime=i,r.endTime=t*(r.endBeat-e),e+=r.startBeat-e,t=60/r.bpm,r.beatTime=60/r.bpm})),s.BPMList.sort(((t,e)=>e.startBeat-t.startBeat))}return s.judgeLineList.forEach(((t,n)=>{let a=new Mo({id:n,texture:"line.png"!=t.Texture?t.Texture:null,parentLine:t.father>=0?t.father:null,zIndex:t.zOrder,isCover:1==t.isCover});if(t.attachUI&&""!=t.attachUI)console.warn("Line "+n+" is using 'attachUI' feature, ignored this line.\nPlease note that all notes on this line will also be ignored.");else{if(t.eventLayers.forEach((t=>{let e=new Bo;for(const i in t)t[i]=Do.calculateEventsBeat(t[i]?t[i]:[]),"speedEvents"!=i?t[i].forEach((t=>{Do.calculateEventEase(t,jo).forEach((t=>{switch(i){case"moveXEvents":e.moveX.push(t);break;case"moveYEvents":e.moveY.push(t);break;case"alphaEvents":e.alpha.push(t);break;case"rotateEvents":e.rotate.push(t);break;default:console.warn("Unsupported event name '"+i+"', ignoring")}}))})):t.speedEvents.forEach((t=>{Yo(t).forEach((t=>{e.speed.push(t)}))}));e.sort();for(const t in e)e[t]instanceof Array&&(e[t]=Do.calculateRealTime(s.BPMList,e[t]));e.speed.forEach((t=>{t.value=t.value/4.5})),e.moveX.forEach((t=>{t.start=t.start/1350,t.end=t.end/1350})),e.moveY.forEach((t=>{t.start=t.start/900,t.end=t.end/900})),e.alpha.forEach((t=>{t.start=t.start/255,t.end=t.end/255,t.start=t.start>1?1:t.start,t.end=t.end>1?1:t.end,t.start=t.start<-1?-1:t.start,t.end=t.end<-1?-1:t.end})),e.rotate.forEach((t=>{t.start=Math.PI/180*t.start,t.end=Math.PI/180*t.end})),e.sort(),a.eventLayers.push(e)})),t.extended&&(t.extended.textEvents&&t.extended.textEvents.length>0&&(a.isText=!0,Do.calculateEventsBeat(t.extended.textEvents).forEach((t=>{(function(t){let e=t.endTime-t.startTime,i=[];if(!t)return[];if(t.start!=t.end)if(""==t.start){let s=[],r=-1;for(let n=0,a=Math.ceil(e/zo);n<a;n++){let e=t.startTime+n*zo,a=t.startTime+(n+1)*zo<=t.endTime?t.startTime+(n+1)*zo:t.endTime,o=Math.floor(Xo(t,a,0,t.end.length-1));if(r+1<o)for(let e=r+1;e<o;e++)s.push(t.end[e]);else r+1>o&&(s.length=o);t.end[o]&&s.push(t.end[o]),i.push({startTime:e,endTime:a,value:s.join("")}),r=o}}else i.push({startTime:t.startTime,endTime:t.endTime,value:t.start}),i.push({startTime:t.endTime,endTime:NaN,value:t.end});else i.push({startTime:t.startTime,endTime:t.endTime,value:t.start});return i})(t).forEach((t=>{a.extendEvent.text.push(t)}))})),a.extendEvent.text.forEach(((t,e)=>{isNaN(t.endTime)&&(t.endTime=a.extendEvent.text[e+1]?a.extendEvent.text[e+1].startTime:100)})),a.extendEvent.text=Do.calculateRealTime(s.BPMList,a.extendEvent.text)),t.extended.scaleXEvents&&t.extended.scaleXEvents.length>0&&(Do.calculateEventsBeat(t.extended.scaleXEvents).forEach((t=>{Do.calculateEventEase(t,jo).forEach((t=>{a.extendEvent.scaleX.push(t)}))})),a.extendEvent.scaleX=Do.calculateRealTime(s.BPMList,a.extendEvent.scaleX)),t.extended.scaleYEvents&&t.extended.scaleYEvents.length>0&&(Do.calculateEventsBeat(t.extended.scaleYEvents).forEach((t=>{Do.calculateEventEase(t,jo).forEach((t=>{a.extendEvent.scaleY.push(t)}))})),a.extendEvent.scaleY=Do.calculateRealTime(s.BPMList,a.extendEvent.scaleY)),t.extended.colorEvents&&t.extended.colorEvents.length>0&&(Do.calculateEventsBeat(t.extended.colorEvents).forEach((t=>{(function(t){let e=t.endTime-t.startTime,i=[];if(!t)return[];if(t.start[0]!=t.end[0]||t.start[1]!=t.end[1]||t.start[2]!=t.end[2])for(let s=0,r=Math.ceil(e/zo);s<r;s++){let e=t.startTime+s*zo,r=t.startTime+(s+1)*zo<=t.endTime?t.startTime+(s+1)*zo:t.endTime;i.push({startTime:e,endTime:r,value:Ot([Math.round(Xo(t,r,t.start[0],t.end[0]))/255,Math.round(Xo(t,r,t.start[1],t.end[1]))/255,Math.round(Xo(t,r,t.start[2],t.end[2]))/255])})}else i.push({startTime:t.startTime,endTime:t.endTime,value:Ot([t.start[0]/255,t.start[1]/255,t.start[2]/255])});return i})(t).forEach((t=>{a.extendEvent.color.push(t)}))})),a.extendEvent.color=Do.calculateRealTime(s.BPMList,a.extendEvent.color)),t.extended.inclineEvents&&t.extended.inclineEvents.length>0)){let e=Do.calculateEventsBeat(t.extended.inclineEvents);1==e.length&&0==e[0].startTime&&1==e[0].endTime&&0==e[0].start&&0==e[0].end||(e.forEach((t=>{Do.calculateEventEase(t,jo).forEach((t=>{t.start=Math.PI/180*t.start,t.end=Math.PI/180*t.end,a.extendEvent.incline.push(t)}))})),a.extendEvent.incline=Do.calculateRealTime(s.BPMList,a.extendEvent.incline))}a.noteControls.alpha=Ho(t.alphaControl,"alpha",1),a.noteControls.scale=Ho(t.sizeControl,"size",1),a.noteControls.x=Ho(t.posControl,"pos",1),a.sortEvent(),a.calcFloorPosition(),t.notes=Do.calculateEventsBeat(t.notes?t.notes:[]),t.notes.sort(((t,e)=>t.startTime-e.startTime)),t.notes.forEach(((t,s)=>{i[t.startTime]=i[t.startTime]?i[t.startTime]+1:1,t.id=s,t.judgeline=a,e.push(t)})),r.judgelines.push(a)}})),e.forEach((t=>{i[t.startTime]>1&&(t.isMulti=!0)})),e=Do.calculateRealTime(s.BPMList,e),e.forEach((t=>{let e=t.judgeline.getFloorPosition(t.startTime);if(t.floorPosition=e?e.floorPosition+e.value*(t.startTime-e.startTime):0,2==t.type){let e=t.judgeline.getFloorPosition(t.endTime);t.holdLength=(e?e.floorPosition+e.value*(t.endTime-e.startTime):0)-t.floorPosition}else t.holdLength=0;r.notes.push(new Lo({id:t.id,type:1==t.type?1:2==t.type?3:3==t.type?4:4==t.type?2:1,time:t.startTime,holdTime:t.endTime-t.startTime,speed:t.speed,floorPosition:t.floorPosition,holdLength:t.holdLength,positionX:t.positionX/75.375,basicAlpha:t.alpha/255,visibleTime:t.visibleTime<999999?t.visibleTime:NaN,yOffset:t.yOffset/900,xScale:t.size,isAbove:1==t.above,isMulti:t.isMulti,isFake:1==t.isFake,judgeline:t.judgeline}))})),r.judgelines.sort(((t,e)=>t.id-e.id)),r.notes.sort(((t,e)=>t.time-e.time)),r.judgelines.forEach(((t,e,i)=>{if(t.parentLine&&t.parentLine>0){let e=t.parentLine;t.parentLine=null;for(const s of i)if(s.id==e){t.parentLine=s;break}}else t.parentLine=null})),r.bpmList=Do.calculateHoldBetween(s.BPMList),r}(t),r=s.info):s=function(t){let e=new Wo,i=function(t){let e=JSON.parse(JSON.stringify(t));switch(e.formatVersion){case 1:e.formatVersion=3;for(const t of e.judgeLineList){let e=0;for(const i of t.speedEvents)i.startTime<0&&(i.startTime=0),i.floorPosition=e,e+=(i.endTime-i.startTime)*i.value/t.bpm*1.875;for(const e of t.judgeLineDisappearEvents)e.start2=0,e.end2=0;for(const e of t.judgeLineMoveEvents)e.start2=e.start%1e3/520,e.end2=e.end%1e3/520,e.start=parseInt(e.start/1e3)/880,e.end=parseInt(e.end/1e3)/880;for(const e of t.judgeLineRotateEvents)e.start2=0,e.end2=0}case 3:break;default:throw new Error("Unsupported chart version: "+e.formatVersion)}return e}(t),s=[],r={},n=[];return e.offset=i.offset,i.judgeLineList.forEach(((t,i)=>{let n=new Mo({id:i}),a=new Bo,o=[];t.speedEvents.forEach((e=>{a.speed.push({startTime:Oo(e.startTime,t.bpm),endTime:Oo(e.endTime,t.bpm),value:e.value})})),t.judgeLineMoveEvents.forEach((e=>{a.moveX.push({startTime:Oo(e.startTime,t.bpm),endTime:Oo(e.endTime,t.bpm),start:e.start-.5,end:e.end-.5}),a.moveY.push({startTime:Oo(e.startTime,t.bpm),endTime:Oo(e.endTime,t.bpm),start:e.start2-.5,end:e.end2-.5})})),t.judgeLineRotateEvents.forEach((e=>{a.rotate.push({startTime:Oo(e.startTime,t.bpm),endTime:Oo(e.endTime,t.bpm),start:-Math.PI/180*e.start,end:-Math.PI/180*e.end})})),t.judgeLineDisappearEvents.forEach((e=>{a.alpha.push({startTime:Oo(e.startTime,t.bpm),endTime:Oo(e.endTime,t.bpm),start:e.start,end:e.end})})),n.eventLayers.push(a),n.sortEvent(),n.eventLayers[0].moveX=Do.arrangeSameValueEvent(n.eventLayers[0].moveX),n.eventLayers[0].moveY=Do.arrangeSameValueEvent(n.eventLayers[0].moveY),n.eventLayers[0].rotate=Do.arrangeSameValueEvent(n.eventLayers[0].rotate),n.eventLayers[0].alpha=Do.arrangeSameValueEvent(n.eventLayers[0].alpha),n.calcFloorPosition(),t.notesAbove.forEach(((e,i)=>{e.judgeline=n,e.id=i,e.bpm=t.bpm,e.isAbove=!0,o.push(e)})),t.notesBelow.forEach(((e,i)=>{e.judgeline=n,e.id=i,e.bpm=t.bpm,e.isAbove=!1,o.push(e)})),o.sort(((t,e)=>t.time-e.time)),o.forEach(((t,e)=>{r[t.time]=r[t.time]?r[t.time]+1:1,t.id=e})),s.push(...o),e.judgelines.push(n)})),s.sort(((t,e)=>t.time-e.time)),s.forEach((t=>{r[t.time]>1&&(t.isMulti=!0),e.notes.push(function(t){t.time=Oo(t.time,t.bpm),t.holdTime=Oo(t.holdTime,t.bpm),t.holdEndTime=t.time+t.holdTime;{let e=t.judgeline.getFloorPosition(t.time);t.floorPosition=e?e.floorPosition+e.value*(t.time-e.startTime):0,3==t.type?(t.judgeline.getFloorPosition(t.holdEndTime),t.holdLength=t.holdTime*t.speed):t.holdLength=0}return new Lo({id:t.id,lineId:t.lineId,type:t.type,time:t.time,holdTime:t.holdTime,holdLength:t.holdLength,positionX:t.positionX,floorPosition:t.floorPosition,speed:t.speed,isAbove:t.isAbove,isMulti:t.isMulti,useOfficialSpeed:!0,judgeline:t.judgeline})}(t))})),e.notes.sort(((t,e)=>t.time-e.time)),s.sort(((t,e)=>t.time-e.time)),s.forEach((t=>{n.length<=0?n.push({startTime:t.time,endTime:t.time,bpm:t.bpm,holdBetween:(-1.2891*t.bpm+396.71)/1e3}):(n[n.length-1].endTime=t.time,n[n.length-1].bpm!=t.bpm&&n.push({startTime:t.time,endTime:t.time,bpm:t.bpm,holdBetween:(-1.2891*t.bpm+396.71)/1e3}))})),n.sort(((t,e)=>t.startTime-e.startTime)),n.length>0?(n[0].startTime=-999,n[n.length-1].endTime=1e4):n.push({startTime:-999,endTime:1e4,bpm:120,holdBetween:.242018}),e.bpmList=n.slice(),e}(t):"string"==typeof t&&(s=function(t){let e=t.split(/\r\n|\n\r/),i=new Wo,s={bpm:[],judgelines:[],_judgelines:{},notes:[],notesPerLine:{},sameTimeNoteCount:{},pushNote:function(t){this.sameTimeNoteCount[Uo(t.startTime)]=this.sameTimeNoteCount[Uo(t.startTime)]?this.sameTimeNoteCount[Uo(t.startTime)]+1:1,this.notesPerLine[t.lineId]||(this.notesPerLine[t.lineId]=[]),this.notesPerLine[t.lineId].push(t),this.notes.push(t)},pushEventToLine:function(t,e,i){if(isNaN(t)||t<0)return void console.warn("Invalid line id: "+t+", ignored");if(this._judgelines[t]||(this._judgelines[t]=new Mo({id:t})),this._judgelines[t].eventLayers.length<1&&this._judgelines[t].eventLayers.push(new Bo),!this._judgelines[t].eventLayers[0][e])throw new Error("No such event type: "+e);let s=this._judgelines[t].eventLayers[0][e],r=s[s.length-1];r&&r.startTime==i.startTime&&(isNaN(r.endTime)&&isNaN(i.endTime)||!isNaN(r.endTime)&&!isNaN(i.endTime)&&r.endTime==i.endTime)?(r.endTime=i.endTime,isNaN(parseFloat(i.value))?(r.start=i.start,r.end=i.end):r.value=i.value):s.push(i)}};if(isNaN(e[0]))return null;i.offset=parseFloat((parseFloat(e.shift())/1e3).toFixed(4))-.175,e.forEach(((t,e)=>{if(!t)return;if(""==t)return;if(""==t.replace(/\s/g,""))return;let i=t.split(" ");for(let t=1;t<i.length;t++)i[t]=parseFloat(i[t]);switch(i[0]){case"bp":s.bpm.push({startBeat:i[1]||0,bpm:i[2]||120});break;case"n1":s.pushNote({type:1,lineId:isNaN(i[1])?-1:i[1],startTime:i[2]||0,positionX:i[3]||0,isAbove:1==i[4],isFake:1==i[5]});break;case"n2":s.pushNote({type:3,lineId:isNaN(i[1])?-1:i[1],startTime:i[2]||0,endTime:i[3]||i[2]||0,positionX:i[4]||0,isAbove:1==i[5],isFake:1==i[6]});break;case"n3":s.pushNote({type:4,lineId:isNaN(i[1])?-1:i[1],startTime:i[2]||0,positionX:i[3]||0,isAbove:1==i[4],isFake:1==i[5]});break;case"n4":s.pushNote({type:2,lineId:isNaN(i[1])?-1:i[1],startTime:i[2]||0,positionX:i[3]||0,isAbove:1==i[4],isFake:1==i[5]});break;case"#":s.notes[s.notes.length-1].speed=isNaN(i[1])?1:i[1];break;case"&":s.notes[s.notes.length-1].xScale=isNaN(i[1])?1:i[1];break;case"cv":s.pushEventToLine(i[1],"speed",{startTime:i[2]||0,endTime:NaN,value:isNaN(i[3])?1:i[3]/7});break;case"cm":s.pushEventToLine(i[1],"moveX",{startTime:i[2]||0,endTime:i[3]||i[2]||0,start:NaN,end:i[4]/2048-.5||0,easingType:i[6]||1}),s.pushEventToLine(i[1],"moveY",{startTime:i[2]||0,endTime:i[3]||i[2]||0,start:NaN,end:i[5]/1400-.5||0,easingType:i[6]||1});break;case"cp":s.pushEventToLine(i[1],"moveX",{startTime:i[2]||0,endTime:NaN,start:i[3]/2048-.5||0,end:i[3]/2048-.5||0,easingType:1}),s.pushEventToLine(i[1],"moveY",{startTime:i[2]||0,endTime:NaN,start:i[4]/1400-.5||0,end:i[4]/1400-.5||0,easingType:1});break;case"cr":s.pushEventToLine(i[1],"rotate",{startTime:i[2]||0,endTime:i[3]||i[2]||0,start:NaN,end:i[4]||0,easingType:i[5]||1});break;case"cd":s.pushEventToLine(i[1],"rotate",{startTime:i[2]||0,endTime:NaN,start:i[3]||0,end:i[3]||0,easingType:1});break;case"cf":s.pushEventToLine(i[1],"alpha",{startTime:i[2]||0,endTime:i[3]||i[2]||0,start:NaN,end:i[4]||0,easingType:1});break;case"ca":s.pushEventToLine(i[1],"alpha",{startTime:i[2]||0,endTime:NaN,start:i[3]||0,end:i[3]||0,easingType:1});break;default:console.warn("Unsupported command: "+i[0]+", ignoring.\nAt line "+(e+2)+":\n"+i.join(" "))}})),s.bpm.length<=0&&s.bpm.push({startBeat:0,endBeat:1e4,bpm:120}),s.bpm.sort(((t,e)=>t.startBeat-e.startBeat));{let t=.5,e=0,i=0;s.bpm.forEach(((r,n)=>{r.endBeat=s.bpm[n+1]?s.bpm[n+1].startBeat:1e4,i+=t*(r.startBeat-e),r.startTime=i,r.endTime=t*(r.endBeat-e),e+=r.startBeat-e,t=60/r.bpm,r.beatTime=60/r.bpm}))}s.bpm.sort(((t,e)=>e.startBeat-t.startBeat));for(const t in s.notesPerLine)s.notesPerLine[t].sort(((t,e)=>t.startTime-e.startTime));for(const t in s._judgelines){let e=s._judgelines[t];e.sortEvent(),e.eventLayers[0].alpha.forEach(((t,e,i)=>{isNaN(t.endTime)&&(t.endTime=e<i.length-1?i[e+1].startTime:1e5),isNaN(t.start)&&(t.start=e>0?i[e-1].end:0)})),e.eventLayers[0].moveX.forEach(((t,e,i)=>{isNaN(t.endTime)&&(t.endTime=e<i.length-1?i[e+1].startTime:1e5),isNaN(t.start)&&(t.start=e>0?i[e-1].end:0)})),e.eventLayers[0].moveY.forEach(((t,e,i)=>{isNaN(t.endTime)&&(t.endTime=e<i.length-1?i[e+1].startTime:1e5),isNaN(t.start)&&(t.start=e>0?i[e-1].end:0)})),e.eventLayers[0].rotate.forEach(((t,e,i)=>{isNaN(t.endTime)&&(t.endTime=e<i.length-1?i[e+1].startTime:1e5),isNaN(t.start)&&(t.start=e>0?i[e-1].end/(Math.PI/180):0),t.start=t.start*(Math.PI/180),t.end=t.end*(Math.PI/180)})),e.eventLayers[0].speed.forEach(((t,e,i)=>{isNaN(t.endTime)&&(t.endTime=e<i.length-1?i[e+1].startTime:1e5)})),e.eventLayers[0].alpha.forEach((e=>{let i=!0;if(-1==e.start)e.start=-255;else if(-2==e.start)e.start=-510;else if(e.start<-100&&e.start>=-1e3){for(let r=0,n=Math.ceil((e.endTime-e.startTime)/Do.CalcBetweenTime);r<n;r++){let n=e.startTime+r*Do.CalcBetweenTime>=e.endTime?e.endTime:e.startTime+r*Do.CalcBetweenTime,a=Do.valueCalculator(e,Fo,n),o=-1*(a+100)/10;if(a>=-100)break;for(const e of s.notesPerLine[t])if(!(e.startTime<n)){if(e.startTime>n)break;e.visibleBeat=o,i=!1}}e.start=i?-255:0}-1==e.end?e.end=-255:-2==e.end?e.end=-510:e.end<-100&&(e.end=i?-255:0),e.start=e.start/255,e.end=e.end/255}));for(const t in e.eventLayers[0]){if("speed"==t||!(e.eventLayers[0][t]instanceof Array))continue;let i=[];e.eventLayers[0][t].forEach((t=>{Do.calculateEventEase(t,Fo).forEach((t=>{i.push(t)}))})),e.eventLayers[0][t]=i}for(const t in e.eventLayers[0])e.eventLayers[0][t]instanceof Array&&(e.eventLayers[0][t]=Do.calculateRealTime(s.bpm,e.eventLayers[0][t]));e.sortEvent(),e.calcFloorPosition()}for(const t in s.notesPerLine){let e=s.notesPerLine[t];e.forEach((t=>{s.sameTimeNoteCount[Uo(t.startTime)]>1&&(t.isMulti=!0)})),e=Go(s.bpm,e),e=Do.calculateRealTime(s.bpm,e),e.sort(((t,e)=>t.startTime-e.startTime)),e.forEach(((t,e)=>{let r=s._judgelines[t.lineId];if(r){{let e=r.getFloorPosition(t.startTime);if(t.floorPosition=e?e.floorPosition+e.value*(t.startTime-e.startTime):0,3==t.type){let e=r.getFloorPosition(t.endTime);t.holdLength=(e?e.floorPosition+e.value*(t.endTime-e.startTime):0)-t.floorPosition}else t.holdLength=0}i.notes.push(new Lo({id:e,type:t.type,time:t.startTime,holdTime:t.endTime-t.startTime,speed:t.speed,isAbove:t.isAbove,isMulti:t.isMulti,isFake:t.isFake,positionX:9*t.positionX/1024,floorPosition:t.floorPosition,holdLength:t.holdLength,xScale:t.xScale,visibleTime:t.visibleTime,judgeline:r}))}else console.warn("Judgeline "+t.lineId+" doesn't exist, ignoring.")}))}for(const t in s._judgelines)i.judgelines.push(s._judgelines[t]);return i.judgelines.sort(((t,e)=>t.id-e.id)),i.notes.sort(((t,e)=>t.time-e.time)),i.bpmList=Do.calculateHoldBetween(s.bpm),i}(t)),!s)throw new Error("Unsupported chart format");return s.info={name:r.name,artist:r.artist,author:r.author,bgAuthor:r.bgAuthor,difficult:r.difficult},s.judgelines.forEach((t=>{t.eventLayers.forEach((t=>{t.moveX=$o(t.moveX),t.moveY=$o(t.moveY),t.rotate=$o(t.rotate),t.alpha=$o(t.alpha)}));for(const e in t.extendEvent)t.extendEvent[e]="color"!==e&&"text"!==e?$o(t.extendEvent[e]):Vo(t.extendEvent[e]);t.sortEvent()})),s.readLineTextureInfo(i),s}readLineTextureInfo(t=[]){if(this.isLineTextureReaded)return;if(t.length<=0)return;let e=!1;t.forEach((t=>{this.judgelines[t.LineId]&&(this.judgelines[t.LineId].texture=t.Image,this.judgelines[t.LineId].useOfficialScale=!0,this.judgelines[t.LineId].scaleX=isNaN(t.Horz)?1:parseFloat(t.Horz),this.judgelines[t.LineId].scaleY=isNaN(t.Vert)?1:parseFloat(t.Vert),this.judgelines[t.LineId].extendEvent.scaleX.push({startTime:-999,endTime:1e3,start:this.judgelines[t.LineId].scaleX,end:this.judgelines[t.LineId].scaleX}),this.judgelines[t.LineId].extendEvent.scaleY.push({startTime:-999,endTime:1e3,start:this.judgelines[t.LineId].scaleY,end:this.judgelines[t.LineId].scaleY}),e=!0)})),e&&(this.isLineTextureReaded=!0)}createSprites(t,e,i,s={},r=1,n=.5,a=!0,o=!1){let h=[];if(this.bg){this.sprites.bg=new Us(this.bg);let e=new ha;e.beginFill(0),e.drawRect(0,0,this.sprites.bg.texture.width,this.sprites.bg.texture.height),e.endFill(),e.position.x=-this.sprites.bg.width/2,e.position.y=-this.sprites.bg.height/2,e.alpha=n,this.sprites.bg.addChild(e),this.sprites.bg.anchor.set(.5),this.sprites.bg.cover=e,t.addChild(this.sprites.bg)}this.judgelines.forEach(((r,n)=>{if(r.createSprite(i,s,o),r.sprite.position.x=e.width/2,r.sprite.position.y=e.height/2,r.sprite.zIndex=10+n,isNaN(r.zIndex)||h.push(r),t.addChild(r.sprite),r.debugSprite&&(r.debugSprite.zIndex=999+r.sprite.zIndex,t.addChild(r.debugSprite)),r.texture&&r.useOfficialScale){let t=r.extendEvent.scaleY[0].start;r.extendEvent.scaleY[0].start=r.extendEvent.scaleY[0].end=1080/r.sprite.texture.height*(t*(t<0?-1:1)),r.extendEvent.scaleX[0].start=r.extendEvent.scaleX[0].end=r.extendEvent.scaleY[0].start*r.extendEvent.scaleX[0].start,r.useOfficialScale=!1}})),h.sort(((t,e)=>t.zIndex-e.zIndex)),h.forEach(((t,e)=>{t.sprite.zIndex=10+this.judgelines.length+e,t.debugSprite&&(t.debugSprite.zIndex=999+t.sprite.zIndex)})),this.notes.forEach(((e,r)=>{e.createSprite(i,s,a,o),e.sprite.zIndex=10+(this.judgelines.length+h.length)+(3===e.type?r:r+10),t.addChild(e.sprite),e.debugSprite&&(e.debugSprite.zIndex=999+e.sprite.zIndex,t.addChild(e.debugSprite))})),this.sprites.info={},this.sprites.info.songName=new gr((this.info.name||"Untitled")+(100!==Math.round(100*r)?" (x"+r.toFixed(2)+")":""),{fontFamily:"A-OTF Shin Go Pr6N H",fill:16777215}),this.sprites.info.songName.anchor.set(0,1),this.sprites.info.songName.zIndex=99999,t.addChild(this.sprites.info.songName),this.sprites.info.songDiff=new gr(this.info.difficult||"SP Lv.?",{fontFamily:"MiSans",fill:16777215}),this.sprites.info.songDiff.anchor.set(0,1),this.sprites.info.songDiff.zIndex=99999,t.addChild(this.sprites.info.songDiff)}resizeSprites(t,e){if(this.renderSize=t,this.sprites.bg){let t=this.renderSize.width/this.sprites.bg.texture.width,e=this.renderSize.height/this.sprites.bg.texture.height,i=t>e?t:e;this.sprites.bg.scale.set(i),this.sprites.bg.position.set(this.renderSize.width/2,this.renderSize.height/2)}this.judgelines&&this.judgelines.length>0&&this.judgelines.forEach((t=>{t.sprite&&(t.isText?(t.sprite.style.fontSize=68*this.renderSize.heightPercent,t.baseScaleX=t.baseScaleY=1):t.texture?t.baseScaleX=t.baseScaleY=this.renderSize.heightPercent:(t.baseScaleX=4e3/t.sprite.texture.width*(this.renderSize.width/1350),t.baseScaleY=18.75*this.renderSize.lineScale*.008/t.sprite.texture.height),t.sprite.scale.set(t.scaleX*t.baseScaleX,t.scaleY*t.baseScaleY),t.sprite.position.x=t.x*this.renderSize.width,t.sprite.position.y=t.y*this.renderSize.height,e&&(t.sprite.alpha=0),t.debugSprite&&t.debugSprite.scale.set(this.renderSize.heightPercent))})),this.notes&&this.notes.length>0&&this.notes.forEach((t=>{if(3===t.type){let e=t.holdLength*(t.useOfficialSpeed?1:t.speed)*this.renderSize.noteSpeed/this.renderSize.noteScale;t.sprite.children[1].height=e,t.sprite.children[2].position.y=-e}t.sprite.baseScale=this.renderSize.noteScale,t.sprite.scale.set(this.renderSize.noteScale*t.xScale,this.renderSize.noteScale),e&&(t.sprite.alpha=0),t.debugSprite&&t.debugSprite.scale.set(this.renderSize.heightPercent)})),this.sprites.info.songName.style.fontSize=27*t.heightPercent,this.sprites.info.songName.position.x=57*t.heightPercent,this.sprites.info.songName.position.y=t.height-66*t.heightPercent,this.sprites.info.songDiff.style.fontSize=20*t.heightPercent,this.sprites.info.songDiff.position.x=57*t.heightPercent,this.sprites.info.songDiff.position.y=t.height-42*t.heightPercent}calcTime(t){for(const e of this.bpmList)if(!(e.endTime<t)){if(e.startTime>t)break;this.holdBetween=e.holdBetween}for(const e of this.judgelines)e.calcTime(t,this.renderSize);for(const e of this.notes)e.calcTime(t,this.renderSize),this.noteJudgeCallback&&this.noteJudgeCallback(t,e)}reset(){this.holdBetween=this.bpmList[0].holdBetween,this.judgelines.forEach((t=>{t.reset()})),this.notes.forEach((t=>{t.reset()}))}destroySprites(){this.judgelines.forEach((t=>{t.sprite&&(t.reset(),t.sprite.destroy(),t.sprite=void 0,t.debugSprite&&(t.debugSprite.destroy(!0),t.debugSprite=void 0))})),this.notes.forEach((t=>{t.sprite&&(t.reset(),t.sprite.destroy(),t.sprite=void 0,t.debugSprite&&(t.debugSprite.destroy(!0),t.debugSprite=void 0))})),this.sprites.bg&&(this.sprites.bg.destroy(),this.sprites.bg=void 0),this.sprites.info.songName.destroy(),this.sprites.info.songName=void 0,this.sprites.info.songDiff.destroy(),this.sprites.info.songDiff=void 0,this.sprites.info=void 0}get totalNotes(){return this.notes.length}get totalRealNotes(){let t=0;return this.notes.forEach((e=>{e.isFake||t++})),t}get totalFakeNotes(){let t=0;return this.notes.forEach((e=>{e.isFake&&t++})),t}}function $o(t){let e=t.slice(),i=[],s=[{startTime:-99,endTime:0,start:e[0]?e[0].start:0,end:e[0]?e[0].start:0}];if(t.length<=0)return[];e.push({startTime:0,endTime:1e3,start:e[e.length-1]?e[e.length-1].end:0,end:e[e.length-1]?e[e.length-1].end:0});for(let t of e){let e=s[s.length-1];if(t.endTime<t.startTime){let e=t.endTime,i=t.startTime;t.startTime=e,t.endTime=i}e.endTime<t.startTime?s.push({startTime:e.endTime,endTime:t.startTime,start:e.end,end:e.end},t):e.endTime==t.startTime?s.push(t):e.endTime>t.startTime&&e.endTime<t.endTime&&s.push({startTime:e.endTime,endTime:t.endTime,start:t.start+(t.end-t.start)*((e.endTime-t.startTime)/(t.endTime-t.startTime))+(e.end-t.start),end:t.end})}i=[s.shift()];for(let t of s){let e=i[i.length-1],s=e.endTime-e.startTime,r=t.endTime-t.startTime;t.startTime==t.endTime||(e.end==t.start&&(e.end-e.start)*r==(t.end-t.start)*s?(i[i.length-1].endTime=t.endTime,i[i.length-1].end=t.end):i.push(t))}return s.slice()}function Vo(t){let e=t.slice(),i=[e.shift()];if(t.length<=0)return[];for(let t of e){let e=i[i.length-1];if(t.endTime<t.startTime){let e=t.endTime,i=t.startTime;t.startTime=e,t.endTime=i}e.value==t.value?e.endTime=t.endTime:e.endTime<t.startTime||e.endTime>t.startTime?(e.endTime=t.startTime,i.push(t)):i.push(t)}return i.slice()}var qo=i(347),Zo=i.n(qo),Ko=i(733),Jo=i.n(Ko),Qo=i(766);function th(t){return th="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},th(t)}var eh=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],ih=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function sh(t,e,i,s,r,n){if(!(isNaN(n)||n<1)){n|=0;var a=function(t,e,i,s,r){if("string"==typeof t&&(t=document.getElementById(t)),!t||"object"!==th(t)||!("getContext"in t))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var n=t.getContext("2d");try{return n.getImageData(e,i,s,r)}catch(t){throw new Error("unable to access image data: "+t)}}(t,e,i,s,r);a=function(t,e,i,s,r,n){for(var a,o=t.data,h=2*n+1,l=s-1,c=r-1,u=n+1,d=u*(u+1)/2,p=new rh,f=p,m=1;m<h;m++)f=f.next=new rh,m===u&&(a=f);f.next=p;for(var _,g,v=null,y=null,x=eh[n],b=ih[n],T=0,E=0,w=0;w<r;w++){var S=o[E],A=o[E+1],C=o[E+2],R=u*S,I=u*A,P=u*C,k=d*S,D=d*A,M=d*C;f=p;for(var B=0;B<u;B++)f.r=S,f.g=A,f.b=C,f=f.next;for(var N=0,L=0,O=0,F=1;F<u;F++)_=E+((l<F?l:F)<<2),k+=(f.r=S=o[_])*(g=u-F),D+=(f.g=A=o[_+1])*g,M+=(f.b=C=o[_+2])*g,N+=S,L+=A,O+=C,f=f.next;v=p,y=a;for(var U=0;U<s;U++)o[E]=k*x>>b,o[E+1]=D*x>>b,o[E+2]=M*x>>b,k-=R,D-=I,M-=P,R-=v.r,I-=v.g,P-=v.b,_=T+((_=U+n+1)<l?_:l)<<2,k+=N+=v.r=o[_],D+=L+=v.g=o[_+1],M+=O+=v.b=o[_+2],v=v.next,R+=S=y.r,I+=A=y.g,P+=C=y.b,N-=S,L-=A,O-=C,y=y.next,E+=4;T+=s}for(var G=0;G<s;G++){var z=o[E=G<<2],j=o[E+1],H=o[E+2],Y=u*z,X=u*j,W=u*H,$=d*z,V=d*j,q=d*H;f=p;for(var Z=0;Z<u;Z++)f.r=z,f.g=j,f.b=H,f=f.next;for(var K=0,J=0,Q=0,tt=1,et=s;tt<=n;tt++)E=et+G<<2,$+=(f.r=z=o[E])*(g=u-tt),V+=(f.g=j=o[E+1])*g,q+=(f.b=H=o[E+2])*g,K+=z,J+=j,Q+=H,f=f.next,tt<c&&(et+=s);E=G,v=p,y=a;for(var it=0;it<r;it++)o[_=E<<2]=$*x>>b,o[_+1]=V*x>>b,o[_+2]=q*x>>b,$-=Y,V-=X,q-=W,Y-=v.r,X-=v.g,W-=v.b,_=G+((_=it+u)<c?_:c)*s<<2,$+=K+=v.r=o[_],V+=J+=v.g=o[_+1],q+=Q+=v.b=o[_+2],v=v.next,Y+=z=y.r,X+=j=y.g,W+=H=y.b,K-=z,J-=j,Q-=H,y=y.next,E+=s}return t}(a,0,0,s,r,n),t.getContext("2d").putImageData(a,e,i)}}var rh=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null},nh=i(343),ah=i(844),oh=i(321);const hh=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/];class lh{static __initStatic(){this.id="InboundFilters"}__init(){this.name=lh.id}constructor(t={}){this._options=t,lh.prototype.__init.call(this)}setupOnce(t,e){const i=t=>{const i=e();if(i){const e=i.getIntegration(lh);if(e){const s=i.getClient(),r=s?s.getOptions():{},n=function(t={},e={}){return{allowUrls:[...t.allowUrls||[],...e.allowUrls||[]],denyUrls:[...t.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...t.ignoreErrors||[],...e.ignoreErrors||[],...hh],ignoreInternal:void 0===t.ignoreInternal||t.ignoreInternal}}(e._options,r);return function(t,e){return e.ignoreInternal&&function(t){try{return"SentryError"===t.exception.values[0].type}catch(t){}return!1}(t)?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${(0,ah.jH)(t)}`),!0):function(t,e){return!(!e||!e.length)&&function(t){if(t.message)return[t.message];if(t.exception)try{const{type:e="",value:i=""}=t.exception.values&&t.exception.values[0]||{};return[`${i}`,`${e}: ${i}`]}catch(e){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error(`Cannot extract message for event ${(0,ah.jH)(t)}`),[]}return[]}(t).some((t=>(0,oh.U0)(t,e)))}(t,e.ignoreErrors)?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${(0,ah.jH)(t)}`),!0):function(t,e){if(!e||!e.length)return!1;const i=ch(t);return!!i&&(0,oh.U0)(i,e)}(t,e.denyUrls)?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${(0,ah.jH)(t)}.\nUrl: ${ch(t)}`),!0):!function(t,e){if(!e||!e.length)return!0;const i=ch(t);return!i||(0,oh.U0)(i,e)}(t,e.allowUrls)&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${(0,ah.jH)(t)}.\nUrl: ${ch(t)}`),!0)}(t,n)?null:t}}return t};i.id=this.name,t(i)}}function ch(t){try{let e;try{e=t.exception.values[0].stacktrace.frames}catch(t){}return e?function(t=[]){for(let e=t.length-1;e>=0;e--){const i=t[e];if(i&&"<anonymous>"!==i.filename&&"[native code]"!==i.filename)return i.filename||null}return null}(e):null}catch(e){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error(`Cannot extract url for event ${(0,ah.jH)(t)}`),null}}lh.__initStatic();var uh=i(535);let dh;class ph{constructor(){ph.prototype.__init.call(this)}static __initStatic(){this.id="FunctionToString"}__init(){this.name=ph.id}setupOnce(){dh=Function.prototype.toString,Function.prototype.toString=function(...t){const e=(0,uh.HK)(this)||this;return dh.apply(e,t)}}}ph.__initStatic();var fh=i(659),mh=i(350);const _h=[];function gh(t){const e=t.defaultIntegrations||[],i=t.integrations;let s;e.forEach((t=>{t.isDefaultInstance=!0})),s=Array.isArray(i)?[...e,...i]:"function"==typeof i?(0,ah.lE)(i(e)):e;const r=function(t){const e={};return t.forEach((t=>{const{name:i}=t,s=e[i];s&&!s.isDefaultInstance&&t.isDefaultInstance||(e[i]=t)})),Object.values(e)}(s),n=r.findIndex((t=>"Debug"===t.name));if(-1!==n){const[t]=r.splice(n,1);r.push(t)}return r}var vh=i(360),yh=i(823),xh=i(732);function bh(t){let e,i=t[0],s=1;for(;s<t.length;){const r=t[s],n=t[s+1];if(s+=2,("optionalAccess"===r||"optionalCall"===r)&&null==i)return;"access"===r||"optionalAccess"===r?(e=i,i=n(i)):"call"!==r&&"optionalCall"!==r||(i=n(((...t)=>i.call(e,...t))),e=void 0)}return i}class Th extends Error{constructor(t,e="warn"){super(t),this.message=t,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=e}}const Eh=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function wh(t,e=!1){const{host:i,path:s,pass:r,port:n,projectId:a,protocol:o,publicKey:h}=t;return`${o}://${h}${e&&r?`:${r}`:""}@${i}${n?`:${n}`:""}/${s?`${s}/`:s}${a}`}function Sh(t){return{protocol:t.protocol,publicKey:t.publicKey||"",pass:t.pass||"",host:t.host,port:t.port||"",path:t.path||"",projectId:t.projectId}}var Ah=i(597),Ch=i(893);function Rh(t,e=1/0,i=1/0){try{return Ph("",t,e,i)}catch(t){return{ERROR:`**non-serializable** (${t})`}}}function Ih(t,e=3,i=102400){const s=Rh(t,e);return r=s,function(t){return~-encodeURI(t).split(/%..|./).length}(JSON.stringify(r))>i?Ih(t,e-1,i):s;var r}function Ph(t,e,s=1/0,r=1/0,n=function(){const t="function"==typeof WeakSet,e=t?new WeakSet:[];return[function(i){if(t)return!!e.has(i)||(e.add(i),!1);for(let t=0;t<e.length;t++)if(e[t]===i)return!0;return e.push(i),!1},function(i){if(t)e.delete(i);else for(let t=0;t<e.length;t++)if(e[t]===i){e.splice(t,1);break}}]}()){const[a,o]=n;if(null===e||["number","boolean","string"].includes(typeof e)&&!(0,Ah.i2)(e))return e;const h=function(t,e){try{return"domain"===t&&e&&"object"==typeof e&&e._events?"[Domain]":"domainEmitter"===t?"[DomainEmitter]":void 0!==i.g&&e===i.g?"[Global]":"undefined"!=typeof window&&e===window?"[Window]":"undefined"!=typeof document&&e===document?"[Document]":(0,Ah.Cy)(e)?"[SyntheticEvent]":"number"==typeof e&&e!=e?"[NaN]":void 0===e?"[undefined]":"function"==typeof e?`[Function: ${(0,vh.$P)(e)}]`:"symbol"==typeof e?`[${String(e)}]`:"bigint"==typeof e?`[BigInt: ${String(e)}]`:`[object ${Object.getPrototypeOf(e).constructor.name}]`}catch(t){return`**non-serializable** (${t})`}}(t,e);if(!h.startsWith("[object "))return h;if(e.__sentry_skip_normalization__)return e;if(0===s)return h.replace("object ","");if(a(e))return"[Circular ~]";const l=e;if(l&&"function"==typeof l.toJSON)try{return Ph("",l.toJSON(),s-1,r,n)}catch(t){}const c=Array.isArray(e)?[]:{};let u=0;const d=(0,uh.Sh)(e);for(const t in d){if(!Object.prototype.hasOwnProperty.call(d,t))continue;if(u>=r){c[t]="[MaxProperties ~]";break}const e=d[t];c[t]=Ph(t,e,s-1,r,n),u++}return o(e),c}function kh(t,e=[]){return[t,e]}function Dh(t,e){const[i,s]=t;return[i,[...s,e]]}function Mh(t,e){t[1].forEach((t=>{const i=t[0].type;e(t,i)}))}function Bh(t,e){return(e||new TextEncoder).encode(t)}function Nh(t,e){const[i,s]=t;let r=JSON.stringify(i);function n(t){"string"==typeof r?r="string"==typeof t?r+t:[Bh(r,e),t]:r.push("string"==typeof t?Bh(t,e):t)}for(const t of s){const[e,i]=t;if(n(`\n${JSON.stringify(e)}\n`),"string"==typeof i||i instanceof Uint8Array)n(i);else{let t;try{t=JSON.stringify(i)}catch(e){t=JSON.stringify(Rh(i))}n(t)}}return"string"==typeof r?r:function(t){const e=t.reduce(((t,e)=>t+e.length),0),i=new Uint8Array(e);let s=0;for(const e of t)i.set(e,s),s+=e.length;return i}(r)}function Lh(t,e){const i="string"==typeof t.data?Bh(t.data,e):t.data;return[(0,uh.Jr)({type:"attachment",length:i.length,filename:t.filename,content_type:t.contentType,attachment_type:t.attachmentType}),i]}const Oh={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default"};function Fh(t){return Oh[t]}var Uh=i(170);function Gh(t,e={}){const i="string"==typeof e?e:e.tunnel,s="string"!=typeof e&&e._metadata?e._metadata.sdk:void 0;return i||`${function(t){return`${function(t){const e=t.protocol?`${t.protocol}:`:"",i=t.port?`:${t.port}`:"";return`${e}//${t.host}${i}${t.path?`/${t.path}`:""}/api/`}(t)}${t.projectId}/envelope/`}(t)}?${function(t,e){return(0,uh._j)({sentry_key:t.publicKey,sentry_version:"7",...e&&{sentry_client:`${e.name}/${e.version}`}})}(t,s)}`}function zh(t){if(!t||!t.sdk)return;const{name:e,version:i}=t.sdk;return{name:e,version:i}}var jh=i(15);const Hh="Not capturing exception because it's already been captured.";class Yh{__init(){this._integrations={}}__init2(){this._integrationsInitialized=!1}__init3(){this._numProcessing=0}__init4(){this._outcomes={}}constructor(t){if(Yh.prototype.__init.call(this),Yh.prototype.__init2.call(this),Yh.prototype.__init3.call(this),Yh.prototype.__init4.call(this),this._options=t,t.dsn){this._dsn=function(t){const e="string"==typeof t?function(t){const e=Eh.exec(t);if(!e)throw new Th(`Invalid Sentry Dsn: ${t}`);const[i,s,r="",n,a="",o]=e.slice(1);let h="",l=o;const c=l.split("/");if(c.length>1&&(h=c.slice(0,-1).join("/"),l=c.pop()),l){const t=l.match(/^\d+/);t&&(l=t[0])}return Sh({host:n,pass:r,path:h,projectId:l,port:a,protocol:i,publicKey:s})}(t):Sh(t);return function(t){if("undefined"!=typeof __SENTRY_DEBUG__&&!__SENTRY_DEBUG__)return;const{port:e,projectId:i,protocol:s}=t;if(["protocol","publicKey","host","projectId"].forEach((e=>{if(!t[e])throw new Th(`Invalid Sentry Dsn: ${e} missing`)})),!i.match(/^\d+$/))throw new Th(`Invalid Sentry Dsn: Invalid projectId ${i}`);if(!function(t){return"http"===t||"https"===t}(s))throw new Th(`Invalid Sentry Dsn: Invalid protocol ${s}`);if(e&&isNaN(parseInt(e,10)))throw new Th(`Invalid Sentry Dsn: Invalid port ${e}`)}(e),e}(t.dsn);const e=Gh(this._dsn,t);this._transport=t.transport({recordDroppedEvent:this.recordDroppedEvent.bind(this),...t.transportOptions,url:e})}else("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("No DSN provided, client will not do anything.")}captureException(t,e,i){if((0,ah.YO)(t))return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(Hh));let s;return this._process(this.eventFromException(t,e).then((t=>this._captureEvent(t,e,i))).then((t=>{s=t}))),s}captureMessage(t,e,i,s){let r;const n=(0,Ah.pt)(t)?this.eventFromMessage(String(t),e,i):this.eventFromException(t,i);return this._process(n.then((t=>this._captureEvent(t,i,s))).then((t=>{r=t}))),r}captureEvent(t,e,i){if(e&&e.originalException&&(0,ah.YO)(e.originalException))return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(Hh));let s;return this._process(this._captureEvent(t,e,i).then((t=>{s=t}))),s}captureSession(t){this._isEnabled()?"string"!=typeof t.release?("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("Discarded session because of missing or non-string release"):(this.sendSession(t),(0,jh.CT)(t,{init:!1})):("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("SDK not enabled, will not capture session.")}getDsn(){return this._dsn}getOptions(){return this._options}getTransport(){return this._transport}flush(t){const e=this._transport;return e?this._isClientDoneProcessing(t).then((i=>e.flush(t).then((t=>i&&t)))):(0,Ch.WD)(!0)}close(t){return this.flush(t).then((t=>(this.getOptions().enabled=!1,t)))}setupIntegrations(){this._isEnabled()&&!this._integrationsInitialized&&(this._integrations=function(t){const e={};return t.forEach((t=>{e[t.name]=t,-1===_h.indexOf(t.name)&&(t.setupOnce(mh.c,fh.Gd),_h.push(t.name),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`Integration installed: ${t.name}`))})),e}(this._options.integrations),this._integrationsInitialized=!0)}getIntegrationById(t){return this._integrations[t]}getIntegration(t){try{return this._integrations[t.id]||null}catch(e){return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Cannot retrieve integration ${t.id} from the current Client`),null}}sendEvent(t,e={}){if(this._dsn){let i=function(t,e,i,s){const r=zh(i),n=t.type||"event";!function(t,e){e&&(t.sdk=t.sdk||{},t.sdk.name=t.sdk.name||e.name,t.sdk.version=t.sdk.version||e.version,t.sdk.integrations=[...t.sdk.integrations||[],...e.integrations||[]],t.sdk.packages=[...t.sdk.packages||[],...e.packages||[]])}(t,i&&i.sdk);const a=function(t,e,i,s){const r=t.sdkProcessingMetadata&&t.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:t.event_id,sent_at:(new Date).toISOString(),...e&&{sdk:e},...!!i&&{dsn:wh(s)},..."transaction"===t.type&&r&&{trace:(0,uh.Jr)({...r})}}}(t,r,s,e);return delete t.sdkProcessingMetadata,kh(a,[[{type:n},t]])}(t,this._dsn,this._options._metadata,this._options.tunnel);for(const t of e.attachments||[])i=Dh(i,Lh(t,this._options.transportOptions&&this._options.transportOptions.textEncoder));this._sendEnvelope(i)}}sendSession(t){if(this._dsn){const e=function(t,e,i,s){const r=zh(i);return kh({sent_at:(new Date).toISOString(),...r&&{sdk:r},...!!s&&{dsn:wh(e)}},["aggregates"in t?[{type:"sessions"},t]:[{type:"session"},t]])}(t,this._dsn,this._options._metadata,this._options.tunnel);this._sendEnvelope(e)}}recordDroppedEvent(t,e,i){if(this._options.sendClientReports){const i=`${t}:${e}`;("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`Adding outcome: "${i}"`),this._outcomes[i]=this._outcomes[i]+1||1}}_updateSessionFromEvent(t,e){let i=!1,s=!1;const r=e.exception&&e.exception.values;if(r){s=!0;for(const t of r){const e=t.mechanism;if(e&&!1===e.handled){i=!0;break}}}const n="ok"===t.status;(n&&0===t.errors||n&&i)&&((0,jh.CT)(t,{...i&&{status:"crashed"},errors:t.errors||Number(s||i)}),this.captureSession(t))}_isClientDoneProcessing(t){return new Ch.cW((e=>{let i=0;const s=setInterval((()=>{0==this._numProcessing?(clearInterval(s),e(!0)):(i+=1,t&&i>=t&&(clearInterval(s),e(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._dsn}_prepareEvent(t,e,i){const{normalizeDepth:s=3,normalizeMaxBreadth:r=1e3}=this.getOptions(),n={...t,event_id:t.event_id||e.event_id||(0,ah.DM)(),timestamp:t.timestamp||(0,Uh.yW)()};this._applyClientOptions(n),this._applyIntegrationsMetadata(n);let a=i;e.captureContext&&(a=mh.s.clone(a).update(e.captureContext));let o=(0,Ch.WD)(n);if(a&&a.getAttachments){const t=[...e.attachments||[],...a.getAttachments()];t.length&&(e.attachments=t),o=a.applyToEvent(n,e)}return o.then((t=>"number"==typeof s&&s>0?this._normalizeEvent(t,s,r):t))}_normalizeEvent(t,e,i){if(!t)return null;const s={...t,...t.breadcrumbs&&{breadcrumbs:t.breadcrumbs.map((t=>({...t,...t.data&&{data:Rh(t.data,e,i)}})))},...t.user&&{user:Rh(t.user,e,i)},...t.contexts&&{contexts:Rh(t.contexts,e,i)},...t.extra&&{extra:Rh(t.extra,e,i)}};return t.contexts&&t.contexts.trace&&s.contexts&&(s.contexts.trace=t.contexts.trace,t.contexts.trace.data&&(s.contexts.trace.data=Rh(t.contexts.trace.data,e,i))),t.spans&&(s.spans=t.spans.map((t=>(t.data&&(t.data=Rh(t.data,e,i)),t)))),s}_applyClientOptions(t){const e=this.getOptions(),{environment:i,release:s,dist:r,maxValueLength:n=250}=e;"environment"in t||(t.environment="environment"in e?i:"production"),void 0===t.release&&void 0!==s&&(t.release=s),void 0===t.dist&&void 0!==r&&(t.dist=r),t.message&&(t.message=(0,oh.$G)(t.message,n));const a=t.exception&&t.exception.values&&t.exception.values[0];a&&a.value&&(a.value=(0,oh.$G)(a.value,n));const o=t.request;o&&o.url&&(o.url=(0,oh.$G)(o.url,n))}_applyIntegrationsMetadata(t){const e=Object.keys(this._integrations);e.length>0&&(t.sdk=t.sdk||{},t.sdk.integrations=[...t.sdk.integrations||[],...e])}_captureEvent(t,e={},i){return this._processEvent(t,e,i).then((t=>t.event_id),(t=>{if("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__){const e=t;"log"===e.logLevel?nh.kg.log(e.message):nh.kg.warn(e)}}))}_processEvent(t,e,i){const s=this.getOptions(),{sampleRate:r}=s;if(!this._isEnabled())return(0,Ch.$2)(new Th("SDK not enabled, will not capture event.","log"));const n="transaction"===t.type,a=n?"beforeSendTransaction":"beforeSend",o=s[a];return!n&&"number"==typeof r&&Math.random()>r?(this.recordDroppedEvent("sample_rate","error",t),(0,Ch.$2)(new Th(`Discarding event because it's not included in the random sample (sampling rate = ${r})`,"log"))):this._prepareEvent(t,e,i).then((i=>{if(null===i)throw this.recordDroppedEvent("event_processor",t.type||"error",t),new Th("An event processor returned `null`, will not send event.","log");return e.data&&!0===e.data.__sentry__||!o?i:function(t,e){const i=`\`${e}\` must return \`null\` or a valid event.`;if((0,Ah.J8)(t))return t.then((t=>{if(!(0,Ah.PO)(t)&&null!==t)throw new Th(i);return t}),(t=>{throw new Th(`\`${e}\` rejected with ${t}`)}));if(!(0,Ah.PO)(t)&&null!==t)throw new Th(i);return t}(o(i,e),a)})).then((s=>{if(null===s)throw this.recordDroppedEvent("before_send",t.type||"error",t),new Th(`\`${a}\` returned \`null\`, will not send event.`,"log");const r=i&&i.getSession();!n&&r&&this._updateSessionFromEvent(r,s);const o=s.transaction_info;if(n&&o&&s.transaction!==t.transaction){const t="custom";s.transaction_info={...o,source:t,changes:[...o.changes,{source:t,timestamp:s.timestamp,propagations:o.propagations}]}}return this.sendEvent(s,e),s})).then(null,(t=>{if(t instanceof Th)throw t;throw this.captureException(t,{data:{__sentry__:!0},originalException:t}),new Th(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${t}`)}))}_process(t){this._numProcessing++,t.then((t=>(this._numProcessing--,t)),(t=>(this._numProcessing--,t)))}_sendEnvelope(t){this._transport&&this._dsn?this._transport.send(t).then(null,(t=>{("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error("Error while sending event:",t)})):("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error("Transport disabled")}_clearOutcomes(){const t=this._outcomes;return this._outcomes={},Object.keys(t).map((e=>{const[i,s]=e.split(":");return{reason:i,category:s,quantity:t[e]}}))}}const Xh="7.23.0";function Wh(t,e){const i=Vh(t,e),s={type:e&&e.name,value:Zh(e)};return i.length&&(s.stacktrace={frames:i}),void 0===s.type&&""===s.value&&(s.value="Unrecoverable error caught"),s}function $h(t,e){return{exception:{values:[Wh(t,e)]}}}function Vh(t,e){const i=e.stacktrace||e.stack||"",s=function(t){if(t){if("number"==typeof t.framesToPop)return t.framesToPop;if(qh.test(t.message))return 1}return 0}(e);try{return t(i,s)}catch(t){}return[]}const qh=/Minified React error #\d+;/i;function Zh(t){const e=t&&t.message;return e?e.error&&"string"==typeof e.error.message?e.error.message:e:"No error message"}function Kh(t,e,i,s,r){let n;if((0,Ah.VW)(e)&&e.error)return $h(t,e.error);if((0,Ah.TX)(e)||(0,Ah.fm)(e)){const r=e;if("stack"in e)n=$h(t,e);else{const e=r.name||((0,Ah.TX)(r)?"DOMError":"DOMException"),a=r.message?`${e}: ${r.message}`:e;n=Jh(t,a,i,s),(0,ah.Db)(n,a)}return"code"in r&&(n.tags={...n.tags,"DOMException.code":`${r.code}`}),n}return(0,Ah.VZ)(e)?$h(t,e):(0,Ah.PO)(e)||(0,Ah.cO)(e)?(n=function(t,e,i,s){const r=(0,fh.Gd)().getClient(),n=r&&r.getOptions().normalizeDepth,a={exception:{values:[{type:(0,Ah.cO)(e)?e.constructor.name:s?"UnhandledRejection":"Error",value:`Non-Error ${s?"promise rejection":"exception"} captured with keys: ${(0,uh.zf)(e)}`}]},extra:{__serialized__:Ih(e,n)}};if(i){const e=Vh(t,i);e.length&&(a.exception.values[0].stacktrace={frames:e})}return a}(t,e,i,r),(0,ah.EG)(n,{synthetic:!0}),n):(n=Jh(t,e,i,s),(0,ah.Db)(n,`${e}`,void 0),(0,ah.EG)(n,{synthetic:!0}),n)}function Jh(t,e,i,s){const r={message:e};if(s&&i){const s=Vh(t,i);s.length&&(r.exception={values:[{value:e,stacktrace:{frames:s}}]})}return r}function Qh(t,e){return(0,fh.Gd)().captureException(t,{captureContext:e})}function tl(t){(0,fh.Gd)().withScope(t)}var el=i(235);const il=el.n2;let sl=0;function rl(){return sl>0}function nl(){sl++,setTimeout((()=>{sl--}))}function al(t,e={},i){if("function"!=typeof t)return t;try{const e=t.__sentry_wrapped__;if(e)return e;if((0,uh.HK)(t))return t}catch(e){return t}const s=function(){const s=Array.prototype.slice.call(arguments);try{i&&"function"==typeof i&&i.apply(this,arguments);const r=s.map((t=>al(t,e)));return t.apply(this,r)}catch(t){throw nl(),tl((i=>{i.addEventProcessor((t=>(e.mechanism&&((0,ah.Db)(t,void 0,void 0),(0,ah.EG)(t,e.mechanism)),t.extra={...t.extra,arguments:s},t))),Qh(t)})),t}};try{for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(s[e]=t[e])}catch(t){}(0,uh.$Q)(s,t),(0,uh.xp)(t,"__sentry_wrapped__",s);try{Object.getOwnPropertyDescriptor(s,"name").configurable&&Object.defineProperty(s,"name",{get:()=>t.name})}catch(t){}return s}var ol=i(464);const hl=["fatal","error","warning","log","info","debug"];function ll(t){if(!t)return{};const e=t.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const i=e[6]||"",s=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],relative:e[5]+i+s}}const cl="Breadcrumbs";class ul{static __initStatic(){this.id=cl}__init(){this.name=ul.id}constructor(t){ul.prototype.__init.call(this),this.options={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...t}}setupOnce(){var t;this.options.console&&(0,xh.o)("console",dl),this.options.dom&&(0,xh.o)("dom",(t=this.options.dom,function(e){let i,s="object"==typeof t?t.serializeAttribute:void 0;"string"==typeof s&&(s=[s]);try{i=e.event.target?(0,ol.Rt)(e.event.target,s):(0,ol.Rt)(e.event,s)}catch(t){i="<unknown>"}0!==i.length&&(0,fh.Gd)().addBreadcrumb({category:`ui.${e.name}`,message:i},{event:e.event,name:e.name,global:e.global})})),this.options.xhr&&(0,xh.o)("xhr",pl),this.options.fetch&&(0,xh.o)("fetch",fl),this.options.history&&(0,xh.o)("history",ml)}addSentryBreadcrumb(t){this.options.sentry&&(0,fh.Gd)().addBreadcrumb({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:(0,ah.jH)(t)},{event:t})}}function dl(t){for(let e=0;e<t.args.length;e++)if("ref=Ref<"===t.args[e]){t.args[e+1]="viewRef";break}const e={category:"console",data:{arguments:t.args,logger:"console"},level:(i=t.level,"warn"===i?"warning":hl.includes(i)?i:"log"),message:(0,oh.nK)(t.args," ")};var i;if("assert"===t.level){if(!1!==t.args[0])return;e.message=`Assertion failed: ${(0,oh.nK)(t.args.slice(1)," ")||"console.assert"}`,e.data.arguments=t.args.slice(1)}(0,fh.Gd)().addBreadcrumb(e,{input:t.args,level:t.level})}function pl(t){if(t.endTimestamp){if(t.xhr.__sentry_own_request__)return;const{method:e,url:i,status_code:s,body:r}=t.xhr.__sentry_xhr__||{};(0,fh.Gd)().addBreadcrumb({category:"xhr",data:{method:e,url:i,status_code:s},type:"http"},{xhr:t.xhr,input:r})}}function fl(t){t.endTimestamp&&(t.fetchData.url.match(/sentry_key/)&&"POST"===t.fetchData.method||(t.error?(0,fh.Gd)().addBreadcrumb({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args}):(0,fh.Gd)().addBreadcrumb({category:"fetch",data:{...t.fetchData,status_code:t.response.status},type:"http"},{input:t.args,response:t.response})))}function ml(t){let e=t.from,i=t.to;const s=ll(il.location.href);let r=ll(e);const n=ll(i);r.path||(r=s),s.protocol===n.protocol&&s.host===n.host&&(i=n.relative),s.protocol===r.protocol&&s.host===r.host&&(e=r.relative),(0,fh.Gd)().addBreadcrumb({category:"navigation",data:{from:e,to:i}})}ul.__initStatic();class _l extends Yh{constructor(t){t._metadata=t._metadata||{},t._metadata.sdk=t._metadata.sdk||{name:"sentry.javascript.browser",packages:[{name:"npm:@sentry/browser",version:Xh}],version:Xh},super(t),t.sendClientReports&&il.document&&il.document.addEventListener("visibilitychange",(()=>{"hidden"===il.document.visibilityState&&this._flushOutcomes()}))}eventFromException(t,e){return function(t,e,i,s){const r=Kh(t,e,i&&i.syntheticException||void 0,s);return(0,ah.EG)(r),r.level="error",i&&i.event_id&&(r.event_id=i.event_id),(0,Ch.WD)(r)}(this._options.stackParser,t,e,this._options.attachStacktrace)}eventFromMessage(t,e="info",i){return function(t,e,i="info",s,r){const n=Jh(t,e,s&&s.syntheticException||void 0,r);return n.level=i,s&&s.event_id&&(n.event_id=s.event_id),(0,Ch.WD)(n)}(this._options.stackParser,t,e,i,this._options.attachStacktrace)}sendEvent(t,e){bh([this.getIntegrationById(cl),"optionalAccess",t=>t.addSentryBreadcrumb,"optionalCall",e=>e(t)]),super.sendEvent(t,e)}_prepareEvent(t,e,i){return t.platform=t.platform||"javascript",super._prepareEvent(t,e,i)}_flushOutcomes(){const t=this._clearOutcomes();if(0===t.length)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("No outcomes to send"));if(!this._dsn)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("No dsn provided, will not send outcomes"));("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("Sending outcomes:",t);const e=Gh(this._dsn,this._options),i=(s=t,kh((r=this._options.tunnel&&wh(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:(0,Uh.yW)(),discarded_events:s}]]));var s,r;try{"[object Navigator]"===Object.prototype.toString.call(il&&il.navigator)&&"function"==typeof il.navigator.sendBeacon&&!this._options.transportOptions?il.navigator.sendBeacon.bind(il.navigator)(e,Nh(i)):this._sendEnvelope(i)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error(t)}}}const gl="?";function vl(t,e,i,s){const r={filename:t,function:e,in_app:!0};return void 0!==i&&(r.lineno=i),void 0!==s&&(r.colno=s),r}const yl=/^\s*at (?:(.*\).*?|.*?) ?\((?:address at )?)?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,xl=/\((\S*)(?::(\d+))(?::(\d+))\)/,bl=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:file|https?|blob|chrome|webpack|resource|moz-extension|safari-extension|safari-web-extension|capacitor)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Tl=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,El=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,wl=[[30,t=>{const e=yl.exec(t);if(e){if(e[2]&&0===e[2].indexOf("eval")){const t=xl.exec(e[2]);t&&(e[2]=t[1],e[3]=t[2],e[4]=t[3])}const[t,i]=Al(e[1]||gl,e[2]);return vl(i,t,e[3]?+e[3]:void 0,e[4]?+e[4]:void 0)}}],[50,t=>{const e=bl.exec(t);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const t=Tl.exec(e[3]);t&&(e[1]=e[1]||"eval",e[3]=t[1],e[4]=t[2],e[5]="")}let t=e[3],i=e[1]||gl;return[i,t]=Al(i,t),vl(t,i,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}],[40,t=>{const e=El.exec(t);return e?vl(e[2],e[1]||gl,+e[3],e[4]?+e[4]:void 0):void 0}]],Sl=(0,vh.pE)(...wl),Al=(t,e)=>{const i=-1!==t.indexOf("safari-extension"),s=-1!==t.indexOf("safari-web-extension");return i||s?[-1!==t.indexOf("@")?t.split("@")[0]:gl,i?`safari-extension:${e}`:`safari-web-extension:${e}`]:[t,e]},Cl=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];class Rl{static __initStatic(){this.id="TryCatch"}__init(){this.name=Rl.id}constructor(t){Rl.prototype.__init.call(this),this._options={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...t}}setupOnce(){this._options.setTimeout&&(0,uh.hl)(il,"setTimeout",Il),this._options.setInterval&&(0,uh.hl)(il,"setInterval",Il),this._options.requestAnimationFrame&&(0,uh.hl)(il,"requestAnimationFrame",Pl),this._options.XMLHttpRequest&&"XMLHttpRequest"in il&&(0,uh.hl)(XMLHttpRequest.prototype,"send",kl);const t=this._options.eventTarget;t&&(Array.isArray(t)?t:Cl).forEach(Dl)}}function Il(t){return function(...e){const i=e[0];return e[0]=al(i,{mechanism:{data:{function:(0,vh.$P)(t)},handled:!0,type:"instrument"}}),t.apply(this,e)}}function Pl(t){return function(e){return t.apply(this,[al(e,{mechanism:{data:{function:"requestAnimationFrame",handler:(0,vh.$P)(t)},handled:!0,type:"instrument"}})])}}function kl(t){return function(...e){const i=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((t=>{t in i&&"function"==typeof i[t]&&(0,uh.hl)(i,t,(function(e){const i={mechanism:{data:{function:t,handler:(0,vh.$P)(e)},handled:!0,type:"instrument"}},s=(0,uh.HK)(e);return s&&(i.mechanism.data.handler=(0,vh.$P)(s)),al(e,i)}))})),t.apply(this,e)}}function Dl(t){const e=il,i=e[t]&&e[t].prototype;i&&i.hasOwnProperty&&i.hasOwnProperty("addEventListener")&&((0,uh.hl)(i,"addEventListener",(function(e){return function(i,s,r){try{"function"==typeof s.handleEvent&&(s.handleEvent=al(s.handleEvent,{mechanism:{data:{function:"handleEvent",handler:(0,vh.$P)(s),target:t},handled:!0,type:"instrument"}}))}catch(t){}return e.apply(this,[i,al(s,{mechanism:{data:{function:"addEventListener",handler:(0,vh.$P)(s),target:t},handled:!0,type:"instrument"}}),r])}})),(0,uh.hl)(i,"removeEventListener",(function(t){return function(e,i,s){const r=i;try{const i=r&&r.__sentry_wrapped__;i&&t.call(this,e,i,s)}catch(t){}return t.call(this,e,r,s)}})))}Rl.__initStatic();class Ml{static __initStatic(){this.id="GlobalHandlers"}__init(){this.name=Ml.id}__init2(){this._installFunc={onerror:Bl,onunhandledrejection:Nl}}constructor(t){Ml.prototype.__init.call(this),Ml.prototype.__init2.call(this),this._options={onerror:!0,onunhandledrejection:!0,...t}}setupOnce(){Error.stackTraceLimit=50;const t=this._options;for(const i in t){const s=this._installFunc[i];s&&t[i]&&(e=i,("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`Global Handler attached: ${e}`),s(),this._installFunc[i]=void 0)}var e}}function Bl(){(0,xh.o)("error",(t=>{const[e,i,s]=Fl();if(!e.getIntegration(Ml))return;const{msg:r,url:n,line:a,column:o,error:h}=t;if(rl()||h&&h.__sentry_own_request__)return;const l=void 0===h&&(0,Ah.HD)(r)?function(t,e,i,s){let r=(0,Ah.VW)(t)?t.message:t,n="Error";const a=r.match(/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/i);return a&&(n=a[1],r=a[2]),Ll({exception:{values:[{type:n,value:r}]}},e,i,s)}(r,n,a,o):Ll(Kh(i,h||r,void 0,s,!1),n,a,o);l.level="error",Ol(e,h,l,"onerror")}))}function Nl(){(0,xh.o)("unhandledrejection",(t=>{const[e,i,s]=Fl();if(!e.getIntegration(Ml))return;let r=t;try{"reason"in t?r=t.reason:"detail"in t&&"reason"in t.detail&&(r=t.detail.reason)}catch(t){}if(rl()||r&&r.__sentry_own_request__)return!0;const n=(0,Ah.pt)(r)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(r)}`}]}}:Kh(i,r,void 0,s,!0);n.level="error",Ol(e,r,n,"onunhandledrejection")}))}function Ll(t,e,i,s){const r=t.exception=t.exception||{},n=r.values=r.values||[],a=n[0]=n[0]||{},o=a.stacktrace=a.stacktrace||{},h=o.frames=o.frames||[],l=isNaN(parseInt(s,10))?void 0:s,c=isNaN(parseInt(i,10))?void 0:i,u=(0,Ah.HD)(e)&&e.length>0?e:(0,ol.l4)();return 0===h.length&&h.push({colno:l,filename:u,function:"?",in_app:!0,lineno:c}),t}function Ol(t,e,i,s){(0,ah.EG)(i,{handled:!1,type:s}),t.captureEvent(i,{originalException:e})}function Fl(){const t=(0,fh.Gd)(),e=t.getClient(),i=e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1};return[t,i.stackParser,i.attachStacktrace]}Ml.__initStatic();class Ul{static __initStatic(){this.id="LinkedErrors"}__init(){this.name=Ul.id}constructor(t={}){Ul.prototype.__init.call(this),this._key=t.key||"cause",this._limit=t.limit||5}setupOnce(){const t=(0,fh.Gd)().getClient();t&&(0,mh.c)(((e,i)=>{const s=(0,fh.Gd)().getIntegration(Ul);return s?function(t,e,i,s,r){if(!(s.exception&&s.exception.values&&r&&(0,Ah.V9)(r.originalException,Error)))return s;const n=Gl(t,i,r.originalException,e);return s.exception.values=[...n,...s.exception.values],s}(t.getOptions().stackParser,s._key,s._limit,e,i):e}))}}function Gl(t,e,i,s,r=[]){if(!(0,Ah.V9)(i[s],Error)||r.length+1>=e)return r;const n=Wh(t,i[s]);return Gl(t,e,i[s],s,[n,...r])}Ul.__initStatic();class zl{constructor(){zl.prototype.__init.call(this)}static __initStatic(){this.id="Dedupe"}__init(){this.name=zl.id}setupOnce(t,e){const i=t=>{const i=e().getIntegration(zl);if(i){try{if(function(t,e){return!!e&&(!!function(t,e){const i=t.message,s=e.message;return!(!i&&!s)&&(!(i&&!s||!i&&s)&&(i===s&&(!!Hl(t,e)&&!!jl(t,e))))}(t,e)||!!function(t,e){const i=Yl(e),s=Yl(t);return!(!i||!s)&&(i.type===s.type&&i.value===s.value&&(!!Hl(t,e)&&!!jl(t,e)))}(t,e))}(t,i._previousEvent))return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){return i._previousEvent=t}return i._previousEvent=t}return t};i.id=this.name,t(i)}}function jl(t,e){let i=Xl(t),s=Xl(e);if(!i&&!s)return!0;if(i&&!s||!i&&s)return!1;if(s.length!==i.length)return!1;for(let t=0;t<s.length;t++){const e=s[t],r=i[t];if(e.filename!==r.filename||e.lineno!==r.lineno||e.colno!==r.colno||e.function!==r.function)return!1}return!0}function Hl(t,e){let i=t.fingerprint,s=e.fingerprint;if(!i&&!s)return!0;if(i&&!s||!i&&s)return!1;try{return!(i.join("")!==s.join(""))}catch(t){return!1}}function Yl(t){return t.exception&&t.exception.values&&t.exception.values[0]}function Xl(t){const e=t.exception;if(e)try{return e.values[0].stacktrace.frames}catch(t){return}}zl.__initStatic();class Wl{constructor(){Wl.prototype.__init.call(this)}static __initStatic(){this.id="HttpContext"}__init(){this.name=Wl.id}setupOnce(){(0,mh.c)((t=>{if((0,fh.Gd)().getIntegration(Wl)){if(!il.navigator&&!il.location&&!il.document)return t;const e=t.request&&t.request.url||il.location&&il.location.href,{referrer:i}=il.document||{},{userAgent:s}=il.navigator||{},r={...e&&{url:e},headers:{...t.request&&t.request.headers,...i&&{Referer:i},...s&&{"User-Agent":s}}};return{...t,request:r}}return t}))}}function $l(t,e,i=function(t){const e=[];function i(t){return e.splice(e.indexOf(t),1)[0]}return{$:e,add:function(s){if(!(void 0===t||e.length<t))return(0,Ch.$2)(new Th("Not adding Promise because buffer limit was reached."));const r=s();return-1===e.indexOf(r)&&e.push(r),r.then((()=>i(r))).then(null,(()=>i(r).then(null,(()=>{})))),r},drain:function(t){return new Ch.cW(((i,s)=>{let r=e.length;if(!r)return i(!0);const n=setTimeout((()=>{t&&t>0&&i(!1)}),t);e.forEach((t=>{(0,Ch.WD)(t).then((()=>{--r||(clearTimeout(n),i(!0))}),s)}))}))}}}(t.bufferSize||30)){let s={};return{send:function(r){const n=[];if(Mh(r,((e,i)=>{const r=Fh(i);if(function(t,e,i=Date.now()){return function(t,e){return t[e]||t.all||0}(t,e)>i}(s,r)){const s=Vl(e,i);t.recordDroppedEvent("ratelimit_backoff",r,s)}else n.push(e)})),0===n.length)return(0,Ch.WD)();const a=kh(r[0],n),o=e=>{Mh(a,((i,s)=>{const r=Vl(i,s);t.recordDroppedEvent(e,Fh(s),r)}))};return i.add((()=>e({body:Nh(a,t.textEncoder)}).then((t=>{void 0!==t.statusCode&&(t.statusCode<200||t.statusCode>=300)&&("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Sentry responded with status code ${t.statusCode} to sent event.`),s=function(t,{statusCode:e,headers:i},s=Date.now()){const r={...t},n=i&&i["x-sentry-rate-limits"],a=i&&i["retry-after"];if(n)for(const t of n.trim().split(",")){const[e,i]=t.split(":",2),n=parseInt(e,10),a=1e3*(isNaN(n)?60:n);if(i)for(const t of i.split(";"))r[t]=s+a;else r.all=s+a}else a?r.all=s+function(t,e=Date.now()){const i=parseInt(`${t}`,10);if(!isNaN(i))return 1e3*i;const s=Date.parse(`${t}`);return isNaN(s)?6e4:s-e}(a,s):429===e&&(r.all=s+6e4);return r}(s,t)}),(t=>{("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error("Failed while sending event:",t),o("network_error")})))).then((t=>t),(t=>{if(t instanceof Th)return("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.error("Skipped sending event because buffer is full."),o("queue_overflow"),(0,Ch.WD)();throw t}))},flush:t=>i.drain(t)}}function Vl(t,e){if("event"===e||"transaction"===e)return Array.isArray(t)?t[1]:void 0}let ql;function Zl(t,e=function(){if(ql)return ql;if((0,yh.Du)(il.fetch))return ql=il.fetch.bind(il);const t=il.document;let e=il.fetch;if(t&&"function"==typeof t.createElement)try{const i=t.createElement("iframe");i.hidden=!0,t.head.appendChild(i);const s=i.contentWindow;s&&s.fetch&&(e=s.fetch),t.head.removeChild(i)}catch(t){("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",t)}return ql=e.bind(il)}()){return $l(t,(function(i){const s={body:i.body,method:"POST",referrerPolicy:"origin",headers:t.headers,keepalive:i.body.length<=65536,...t.fetchOptions};try{return e(t.url,s).then((t=>({statusCode:t.status,headers:{"x-sentry-rate-limits":t.headers.get("X-Sentry-Rate-Limits"),"retry-after":t.headers.get("Retry-After")}})))}catch(t){return ql=void 0,(0,Ch.$2)(t)}}))}function Kl(t){return $l(t,(function(e){return new Ch.cW(((i,s)=>{const r=new XMLHttpRequest;r.onerror=s,r.onreadystatechange=()=>{4===r.readyState&&i({statusCode:r.status,headers:{"x-sentry-rate-limits":r.getResponseHeader("X-Sentry-Rate-Limits"),"retry-after":r.getResponseHeader("Retry-After")}})},r.open("POST",t.url);for(const e in t.headers)Object.prototype.hasOwnProperty.call(t.headers,e)&&r.setRequestHeader(e,t.headers[e]);r.send(e.body)}))}))}Wl.__initStatic();const Jl=[new lh,new ph,new Rl,new ul,new Ml,new Ul,new zl,new Wl];function Ql(t){t.startSession({ignoreDuration:!0}),t.captureSession()}var tc=i(790);const ec=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$"),ic="baggage",sc=/^sentry-/;function rc(t){return function(t){if(0!==Object.keys(t).length)return Object.entries(t).reduce(((t,[e,i],s)=>{const r=`${encodeURIComponent(e)}=${encodeURIComponent(i)}`,n=0===s?r:`${t},${r}`;return n.length>8192?(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`Not adding key: ${e} with val: ${i} to baggage header due to exceeding baggage size limits.`),t):n}),"")}(Object.entries(t).reduce(((t,[e,i])=>(i&&(t[`sentry-${e}`]=i),t)),{}))}function nc(t){return t.split(",").map((t=>t.split("=").map((t=>decodeURIComponent(t.trim()))))).reduce(((t,[e,i])=>(t[e]=i,t)),{})}var ac=i(458),oc=i(233);const hc=el.n2;var lc=i(375);const cc=(t,e,i)=>{let s,r;return n=>{e.value>=0&&(n||i)&&(r=e.value-(s||0),(r||void 0===s)&&(s=e.value,e.delta=r,t(e)))}},uc=()=>hc.__WEB_VITALS_POLYFILL__?hc.performance&&(performance.getEntriesByType&&performance.getEntriesByType("navigation")[0]||(()=>{const t=hc.performance.timing,e=hc.performance.navigation.type,i={entryType:"navigation",startTime:0,type:2==e?"back_forward":1===e?"reload":"navigate"};for(const e in t)"navigationStart"!==e&&"toJSON"!==e&&(i[e]=Math.max(t[e]-t.navigationStart,0));return i})()):hc.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],dc=()=>{const t=uc();return t&&t.activationStart||0},pc=(t,e)=>{const i=uc();let s="navigate";return i&&(s=hc.document.prerendering||dc()>0?"prerender":i.type.replace(/_/g,"-")),{name:t,value:void 0===e?-1:e,rating:"good",delta:0,entries:[],id:`v3-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:s}},fc=(t,e,i)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(t)){const s=new PerformanceObserver((t=>{e(t.getEntries())}));return s.observe(Object.assign({type:t,buffered:!0},i||{})),s}}catch(t){}},mc=(t,e)=>{const i=s=>{"pagehide"!==s.type&&"hidden"!==hc.document.visibilityState||(t(s),e&&(removeEventListener("visibilitychange",i,!0),removeEventListener("pagehide",i,!0)))};addEventListener("visibilitychange",i,!0),addEventListener("pagehide",i,!0)};let _c=-1;const gc=()=>(_c<0&&(_c="hidden"!==hc.document.visibilityState||hc.document.prerendering?1/0:0,mc((({timeStamp:t})=>{_c=t}),!0)),{get firstHiddenTime(){return _c}}),vc={};function yc(t){return"number"==typeof t&&isFinite(t)}function xc(t,{startTimestamp:e,...i}){return e&&t.startTimestamp>e&&(t.startTimestamp=e),t.startChild({startTimestamp:e,...i})}function bc(){return hc&&hc.addEventListener&&hc.performance}let Tc,Ec,wc=0,Sc={};function Ac(t,e,i,s,r,n){const a=n?e[n]:e[`${i}End`],o=e[`${i}Start`];o&&a&&xc(t,{op:"browser",description:(0,lc.h)(r,(()=>i)),startTimestamp:s+(0,oc.XL)(o),endTimestamp:s+(0,oc.XL)(a)})}const Cc=["localhost",/^\//],Rc={traceFetch:!0,traceXHR:!0,tracingOrigins:Cc,tracePropagationTargets:Cc};const Ic={idleTimeout:ac.nT,finalTimeout:ac.mg,heartbeatInterval:ac.hd,markBackgroundTransactions:!0,routingInstrumentation:function(t,e=!0,i=!0){if(!hc||!hc.location)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("Could not initialize routing instrumentation due to invalid location"));let s,r=hc.location.href;e&&(s=t({name:hc.location.pathname,op:"pageload",metadata:{source:"url"}})),i&&(0,xh.o)("history",(({to:e,from:i})=>{void 0===i&&r&&-1!==r.indexOf(e)?r=void 0:i!==e&&(r=void 0,s&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`[Tracing] Finishing current transaction with op: ${s.op}`),s.finish()),s=t({name:hc.location.pathname,op:"navigation",metadata:{source:"url"}}))}))},startTransactionOnLocationChange:!0,startTransactionOnPageLoad:!0,_experiments:{enableLongTask:!0},...Rc};class Pc{__init(){this.name="BrowserTracing"}constructor(t){Pc.prototype.__init.call(this),this.options={...Ic,...t},t&&!t.tracePropagationTargets&&t.tracingOrigins&&(this.options.tracePropagationTargets=t.tracingOrigins);const{_metricOptions:e}=this.options;(function(t=!1){const e=bc();e&&Uh.Z1&&(e.mark&&hc.performance.mark("sentry-tracing-init"),((t,e={})=>{const i=pc("CLS",0);let s,r=0,n=[];const a=t=>{t.forEach((t=>{if(!t.hadRecentInput){const e=n[0],a=n[n.length-1];r&&0!==n.length&&t.startTime-a.startTime<1e3&&t.startTime-e.startTime<5e3?(r+=t.value,n.push(t)):(r=t.value,n=[t]),r>i.value&&(i.value=r,i.entries=n,s&&s())}}))},o=fc("layout-shift",a);o&&(s=cc(t,i,e.reportAllChanges),mc((()=>{a(o.takeRecords()),s(!0)})))})((t=>{const e=t.entries.pop();e&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding CLS"),Sc.cls={value:t.value,unit:""},Ec=e)})),function(t){((t,e={})=>{const i=gc(),s=pc("LCP");let r;const n=t=>{const e=t[t.length-1];if(e){const t=Math.max(e.startTime-dc(),0);t<i.firstHiddenTime&&(s.value=t,s.entries=[e],r())}},a=fc("largest-contentful-paint",n);if(a){r=cc(t,s,e.reportAllChanges);const i=()=>{vc[s.id]||(n(a.takeRecords()),a.disconnect(),vc[s.id]=!0,r(!0))};["keydown","click"].forEach((t=>{addEventListener(t,i,{once:!0,capture:!0})})),mc(i,!0)}})((t=>{const e=t.entries.pop();e&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding LCP"),Sc.lcp={value:t.value,unit:"millisecond"},Tc=e)}),{reportAllChanges:t})}(t),((t,e={})=>{const i=gc(),s=pc("FID");let r;const n=t=>{t.startTime<i.firstHiddenTime&&(s.value=t.processingStart-t.startTime,s.entries.push(t),r(!0))},a=t=>{t.forEach(n)},o=fc("first-input",a);r=cc(t,s,e.reportAllChanges),o&&mc((()=>{a(o.takeRecords()),o.disconnect()}),!0)})((t=>{const e=t.entries.pop();if(!e)return;const i=(0,oc.XL)(Uh.Z1),s=(0,oc.XL)(e.startTime);("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding FID"),Sc.fid={value:t.value,unit:"millisecond"},Sc["mark.fid"]={value:i+s,unit:"second"}})))})(e&&e._reportAllChanges),bh([this,"access",t=>t.options,"access",t=>t._experiments,"optionalAccess",t=>t.enableLongTask])&&fc("longtask",(t=>{for(const e of t){const t=(0,oc.x1)();if(!t)return;const i=(0,oc.XL)(Uh.Z1+e.startTime),s=(0,oc.XL)(e.duration);t.startChild({description:"Main UI thread blocked",op:"ui.long-task",startTimestamp:i,endTimestamp:i+s})}}))}setupOnce(t,e){this._getCurrentHub=e;const{routingInstrumentation:i,startTransactionOnLocationChange:s,startTransactionOnPageLoad:r,markBackgroundTransactions:n,traceFetch:a,traceXHR:o,tracePropagationTargets:h,shouldCreateSpanForRequest:l}=this.options;i((t=>this._createRouteTransaction(t)),r,s),n&&(hc&&hc.document?hc.document.addEventListener("visibilitychange",(()=>{const t=(0,oc.x1)();if(hc.document.hidden&&t){const e="cancelled";("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${t.op}`),t.status||t.setStatus(e),t.setTag("visibilitychange","document.hidden"),t.finish()}})):("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("[Tracing] Could not set up background tab detection due to lack of global document")),function(t){const{traceFetch:e,traceXHR:i,tracePropagationTargets:s,tracingOrigins:r,shouldCreateSpanForRequest:n}={traceFetch:Rc.traceFetch,traceXHR:Rc.traceXHR,...t},a="function"==typeof n?n:t=>!0,o=t=>function(t,e){return(0,oh.U0)(t,e||Cc)}(t,s||r),h={};e&&(0,xh.o)("fetch",(t=>{!function(t,e,i,s){if(!(0,oc.zu)()||!t.fetchData||!e(t.fetchData.url))return;if(t.endTimestamp){const e=t.fetchData.__span;if(!e)return;const i=s[e];return void(i&&(t.response?i.setHttpStatus(t.response.status):t.error&&i.setStatus("internal_error"),i.finish(),delete s[e]))}const r=(0,oc.x1)();if(r){const e=r.startChild({data:{...t.fetchData,type:"fetch"},description:`${t.fetchData.method} ${t.fetchData.url}`,op:"http.client"});t.fetchData.__span=e.spanId,s[e.spanId]=e;const n=t.args[0];t.args[1]=t.args[1]||{};const a=t.args[1];i(t.fetchData.url)&&(a.headers=function(t,e,i,s){const r=rc(e),n=i.toTraceparent(),a="undefined"!=typeof Request&&(0,Ah.V9)(t,Request)?t.headers:s.headers;if(a){if("undefined"!=typeof Headers&&(0,Ah.V9)(a,Headers)){const t=new Headers(a);return t.append("sentry-trace",n),r&&t.append(ic,r),t}if(Array.isArray(a)){const t=[...a,["sentry-trace",n]];return r&&t.push([ic,r]),t}{const t="baggage"in a?a.baggage:void 0,e=[];return Array.isArray(t)?e.push(...t):t&&e.push(t),r&&e.push(r),{...a,"sentry-trace":n,baggage:e.length>0?e.join(","):void 0}}}return{"sentry-trace":n,baggage:r}}(n,r.getDynamicSamplingContext(),e,a),r.metadata.propagations++)}}(t,a,o,h)})),i&&(0,xh.o)("xhr",(t=>{!function(t,e,i,s){if(!(0,oc.zu)()||t.xhr&&t.xhr.__sentry_own_request__||!(t.xhr&&t.xhr.__sentry_xhr__&&e(t.xhr.__sentry_xhr__.url)))return;const r=t.xhr.__sentry_xhr__;if(t.endTimestamp){const e=t.xhr.__sentry_xhr_span_id__;if(!e)return;const i=s[e];return void(i&&(i.setHttpStatus(r.status_code),i.finish(),delete s[e]))}const n=(0,oc.x1)();if(n){const e=n.startChild({data:{...r.data,type:"xhr",method:r.method,url:r.url},description:`${r.method} ${r.url}`,op:"http.client"});if(t.xhr.__sentry_xhr_span_id__=e.spanId,s[t.xhr.__sentry_xhr_span_id__]=e,t.xhr.setRequestHeader&&i(t.xhr.__sentry_xhr__.url))try{t.xhr.setRequestHeader("sentry-trace",e.toTraceparent());const i=rc(n.getDynamicSamplingContext());i&&t.xhr.setRequestHeader(ic,i),n.metadata.propagations++}catch(t){}}}(t,a,o,h)}))}({traceFetch:a,traceXHR:o,tracePropagationTargets:h,shouldCreateSpanForRequest:l})}_createRouteTransaction(t){if(!this._getCurrentHub)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn(`[Tracing] Did not create ${t.op} transaction because _getCurrentHub is invalid.`));const{beforeNavigate:e,idleTimeout:i,finalTimeout:s,heartbeatInterval:r}=this.options,n="pageload"===t.op,a=n?kc("sentry-trace"):null,o=n?kc("baggage"):null,h=a?function(t){const e=t.match(ec);if(!t||!e)return;let i;return"1"===e[3]?i=!0:"0"===e[3]&&(i=!1),{traceId:e[1],parentSampled:i,parentSpanId:e[2]}}(a):void 0,l=o?function(t){if(!(0,Ah.HD)(t)&&!Array.isArray(t))return;let e={};if(Array.isArray(t))e=t.reduce(((t,e)=>({...t,...nc(e)})),{});else{if(!t)return;e=nc(t)}const i=Object.entries(e).reduce(((t,[e,i])=>(e.match(sc)&&(t[e.slice("sentry-".length)]=i),t)),{});return Object.keys(i).length>0?i:void 0}(o):void 0,c={...t,...h,metadata:{...t.metadata,dynamicSamplingContext:h&&!l?{}:l},trimEnd:!0},u="function"==typeof e?e(c):c,d=void 0===u?{...c,sampled:!1}:u;d.metadata=d.name!==c.name?{...d.metadata,source:"custom"}:d.metadata,!1===d.sampled&&("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`[Tracing] Will not send ${d.op} transaction because of beforeNavigate.`),("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`[Tracing] Starting ${d.op} transaction on scope`);const p=this._getCurrentHub(),{location:f}=hc,m=(0,tc.lb)(p,d,i,s,!0,{location:f},r);return m.registerBeforeFinishCallback((t=>{!function(t){const e=bc();if(!e||!hc.performance.getEntries||!Uh.Z1)return;("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Tracing] Adding & adjusting spans using Performance API");const i=(0,oc.XL)(Uh.Z1),s=e.getEntries();let r,n;if(s.slice(wc).forEach((e=>{const s=(0,oc.XL)(e.startTime),a=(0,oc.XL)(e.duration);if(!("navigation"===t.op&&i+s<t.startTimestamp))switch(e.entryType){case"navigation":!function(t,e,i){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((s=>{Ac(t,e,s,i)})),Ac(t,e,"secureConnection",i,"TLS/SSL","connectEnd"),Ac(t,e,"fetch",i,"cache","domainLookupStart"),Ac(t,e,"domainLookup",i,"DNS"),function(t,e,i){xc(t,{op:"browser",description:"request",startTimestamp:i+(0,oc.XL)(e.requestStart),endTimestamp:i+(0,oc.XL)(e.responseEnd)}),xc(t,{op:"browser",description:"response",startTimestamp:i+(0,oc.XL)(e.responseStart),endTimestamp:i+(0,oc.XL)(e.responseEnd)})}(t,e,i)}(t,e,i),r=i+(0,oc.XL)(e.responseStart),n=i+(0,oc.XL)(e.requestStart);break;case"mark":case"paint":case"measure":{!function(t,e,i,s,r){const n=r+i,a=n+s;xc(t,{description:e.name,endTimestamp:a,op:e.entryType,startTimestamp:n})}(t,e,s,a,i);const r=gc(),n=e.startTime<r.firstHiddenTime;"first-paint"===e.name&&n&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding FP"),Sc.fp={value:e.startTime,unit:"millisecond"}),"first-contentful-paint"===e.name&&n&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding FCP"),Sc.fcp={value:e.startTime,unit:"millisecond"});break}case"resource":{const r=e.name.replace(hc.location.origin,"");!function(t,e,i,s,r,n){if("xmlhttprequest"===e.initiatorType||"fetch"===e.initiatorType)return;const a={};"transferSize"in e&&(a["Transfer Size"]=e.transferSize),"encodedBodySize"in e&&(a["Encoded Body Size"]=e.encodedBodySize),"decodedBodySize"in e&&(a["Decoded Body Size"]=e.decodedBodySize);const o=n+s;xc(t,{description:i,endTimestamp:o+r,op:e.initiatorType?`resource.${e.initiatorType}`:"resource.other",startTimestamp:o,data:a})}(t,e,r,s,a,i);break}}})),wc=Math.max(s.length-1,0),function(t){const e=hc.navigator;if(!e)return;const i=e.connection;i&&(i.effectiveType&&t.setTag("effectiveConnectionType",i.effectiveType),i.type&&t.setTag("connectionType",i.type),yc(i.rtt)&&(Sc["connection.rtt"]={value:i.rtt,unit:"millisecond"})),yc(e.deviceMemory)&&t.setTag("deviceMemory",`${e.deviceMemory} GB`),yc(e.hardwareConcurrency)&&t.setTag("hardwareConcurrency",String(e.hardwareConcurrency))}(t),"pageload"===t.op){"number"==typeof r&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding TTFB"),Sc.ttfb={value:1e3*(r-t.startTimestamp),unit:"millisecond"},"number"==typeof n&&n<=r&&(Sc["ttfb.requestTime"]={value:1e3*(r-n),unit:"millisecond"})),["fcp","fp","lcp"].forEach((e=>{if(!Sc[e]||i>=t.startTimestamp)return;const s=Sc[e].value,r=i+(0,oc.XL)(s),n=Math.abs(1e3*(r-t.startTimestamp)),a=n-s;("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log(`[Measurements] Normalized ${e} from ${s} to ${n} (${a})`),Sc[e].value=n}));const e=Sc["mark.fid"];e&&Sc.fid&&(xc(t,{description:"first input delay",endTimestamp:e.value+(0,oc.XL)(Sc.fid.value),op:"ui.action",startTimestamp:e.value}),delete Sc["mark.fid"]),"fcp"in Sc||delete Sc.cls,Object.keys(Sc).forEach((e=>{t.setMeasurement(e,Sc[e].value,Sc[e].unit)})),function(t){Tc&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding LCP Data"),Tc.element&&t.setTag("lcp.element",(0,ol.Rt)(Tc.element)),Tc.id&&t.setTag("lcp.id",Tc.id),Tc.url&&t.setTag("lcp.url",Tc.url.trim().slice(0,200)),t.setTag("lcp.size",Tc.size)),Ec&&Ec.sources&&(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.log("[Measurements] Adding CLS Data"),Ec.sources.forEach(((e,i)=>t.setTag(`cls.source.${i+1}`,(0,ol.Rt)(e.node)))))}(t)}Tc=void 0,Ec=void 0,Sc={}}(t)})),m}}function kc(t){const e=(0,ol.qT)(`meta[name=${t}]`);return e?e.getAttribute("content"):null}("undefined"==typeof __SENTRY_TRACING__||__SENTRY_TRACING__)&&(0,tc.ro)(),"{{CURRENT_HASH}}"!=GITHUB_CURRENT_GIT_HASH&&function(t={}){void 0===t.defaultIntegrations&&(t.defaultIntegrations=Jl),void 0===t.release&&("string"==typeof __SENTRY_RELEASE__&&(t.release=__SENTRY_RELEASE__),il.SENTRY_RELEASE&&il.SENTRY_RELEASE.id&&(t.release=il.SENTRY_RELEASE.id)),void 0===t.autoSessionTracking&&(t.autoSessionTracking=!0),void 0===t.sendClientReports&&(t.sendClientReports=!0);const e={...t,stackParser:(0,vh.Sq)(t.stackParser||Sl),integrations:gh(t),transport:t.transport||((0,yh.Ak)()?Zl:Kl)};!function(t,e){!0===e.debug&&("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__?nh.kg.enable():console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle."));const i=(0,fh.Gd)(),s=i.getScope();s&&s.update(e.initialScope);const r=new t(e);i.bindClient(r)}(_l,e),t.autoSessionTracking&&function(){if(void 0===il.document)return void(("undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__)&&nh.kg.warn("Session tracking in non-browser environment with @sentry/browser is not supported."));const t=(0,fh.Gd)();t.captureSession&&(Ql(t),(0,xh.o)("history",(({from:t,to:e})=>{void 0!==t&&t!==e&&Ql((0,fh.Gd)())})))}()}({dsn:"https://c0f2c5052bd740c3b734b74c7dd6d350@o4504077358792704.ingest.sentry.io/4504077363183616",integrations:[new Pc],tracesSampleRate:1,maxBreadcrumbs:50,debug:"{{CURRENT_HASH}}"==GITHUB_CURRENT_GIT_HASH,release:"{{CURRENT_HASH}}"!=GITHUB_CURRENT_GIT_HASH,beforeSend:(t,e)=>{let i=e.originalException;return Bc.errorWindow.content.innerText=i.stack?i.stack:i.message?i.message:i,Bc.errorWindow.window.style.display="block",t}});const Dc=t=>document.querySelector(t),Mc={MiSans:new(Zo())("MiSans"),"A-OTF Shin Go Pr6N H":new(Zo())("A-OTF Shin Go Pr6N H")},Bc={fileSelect:document.querySelector("div.file-select"),chartPackFile:document.querySelector("input#file-chart-pack"),chartPackFileReadProgress:document.querySelector("div#file-read-progress"),file:{chart:document.querySelector("select#file-chart"),music:document.querySelector("select#file-music"),bg:document.querySelector("select#file-bg")},settings:{multiNoteHL:document.querySelector("input#settings-multi-note-hl"),showAPStatus:document.querySelector("input#settings-show-ap-status"),showInputPoint:document.querySelector("input#settings-show-input-point"),noteScale:document.querySelector("input#settings-note-scale"),bgDim:document.querySelector("input#settings-bg-dim"),bgBlur:document.querySelector("input#settings-bg-blur"),offset:document.querySelector("input#settings-audio-offset"),testInputDelay:document.querySelector("button#settings-test-input-delay"),speed:document.querySelector("input#settings-audio-speed"),hitsound:document.querySelector("input#settings-hitsound"),hitsoundVolume:document.querySelector("input#settings-hitsound-volume"),challengeMode:document.querySelector("input#settings-challenge-mode"),autoPlay:document.querySelector("input#settings-autoplay"),forceCanvas:document.querySelector("input#settings-force-canvas"),antiAlias:document.querySelector("input#settings-anti-alias"),lowResolution:document.querySelector("input#settings-low-resolution"),debug:document.querySelector("input#settings-debug")},startBtn:document.querySelector("button#start"),loadingStatus:document.querySelector("div#loading-status"),fullscreenBtn:document.querySelector("button#fullscreen"),playResult:{container:document.querySelector("div.play-result"),scoreBar:document.querySelector("div.play-result .info-bar.score"),accBar:document.querySelector("div.play-result .info-bar.acc-bar")},errorWindow:{window:document.querySelector("div.error-window"),closeBtn:document.querySelector("div.error-window button.close"),content:document.querySelector("div.error-window code.content")}},Nc={charts:{},musics:{},images:{},infos:[],lines:[],all:{}},Lc={chart:null,music:null,bg:null},Oc={textures:{},sounds:{}},Fc={toggle(t,e=!1){if(this.element){if(!e){if(document.exitFullscreen)return document.exitFullscreen();if(document.cancelFullScreen)return document.cancelFullScreen();if(document.webkitCancelFullScreen)return document.webkitCancelFullScreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.msExitFullscreen)return document.msExitFullscreen()}return this.element==t&&(t.style.position="relative",t.style.top="unset",t.style.left="unset",t.style.zIndex="unset",document.body.style.overflow="auto",document.inDocumentFullscreenElement=null,i.g.functions.resizeCanvas&&i.g.functions.resizeCanvas(),!0)}if(!e){if(t instanceof HTMLElement||(t=document.body),t.requestFullscreen)return t.requestFullscreen();if(t.webkitRequestFullscreen)return t.webkitRequestFullscreen();if(t.mozRequestFullScreen)return t.mozRequestFullScreen();if(t.msRequestFullscreen)return t.msRequestFullscreen()}return t!=document.body&&(t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.zIndex="5050",document.body.style.overflow="hidden",document.inDocumentFullscreenElement=t,i.g.functions.resizeCanvas&&i.g.functions.resizeCanvas(),!0)},check(t){return t instanceof HTMLElement||(t=document.body),this.element==t},get element(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.inDocumentFullscreenElement},get enabled(){return!!(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)},get type(){return document.inDocumentFullscreenElement?2:document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?1:0}};function Uc(t){let e=[],i=[];return t.split(/\r\n|\n\r/).forEach(((t,s)=>{t.split(",").forEach(((t,r)=>{s<=0?e.push(/([A-Za-z0-9]+)/.exec(t)[1]):(i[s-1]||(i[s-1]={}),i[s-1][e[r]]=t)}))})),i}function Gc(t){let e=(t+"").split(/\r\n|\n\r/),i=/^([a-zA-Z]+):\s(.+)$/,s={};for(const t of e){let e=i.exec(t);if(!e||e.length<3)continue;let r=e[1],n=e[2];switch(r){case"Name":s.Name=n;break;case"Level":s.Level=n;break;case"Charter":s.Designer=n;break;case"Chart":s.Chart=n;break;case"Song":s.Music=n;break;case"Picture":s.Image=n;break;default:s[r]=n}}return s}function zc(){let t=document.documentElement.clientHeight/9*16<document.documentElement.clientWidth?document.documentElement.clientHeight/9*16:document.documentElement.clientWidth;document.body.style.setProperty("--height-percent",document.documentElement.clientHeight/1080),document.body.style.setProperty("--width-offset",(document.documentElement.clientWidth-t)/2+"px")}window.qs=Dc,window.doms=Bc,window.files=Nc,window.assets=Oc,window.currentFile=Lc,window.fullscreen=Fc,Bc.chartPackFile.addEventListener("input",(async function(){if(this.files.length<=0)return;let t=[...this.files];for(let r=0;r<t.length;r++){if(!t[r])continue;let n=t[r],a=n.name.split("."),o=a[a.length-1];if(n.format=o,Bc.chartPackFileReadProgress.innerText="Loading files: "+n.name+" ...("+(r+1)+"/"+t.length+")","info.csv"===n.name)try{let t=Uc(await e(n));Nc.infos.push(...t),Nc.all[n.name]=t}catch(t){}else if("line.csv"===n.name)try{let t=Uc(await e(n));Nc.lines.push(...t),Nc.all[n.name]=t}catch(t){}else if("Settings.txt"===n.name||"info.txt"===n.name)try{let t=Gc(await e(n));Nc.infos.push(t),Nc.all[n.name]=t}catch(t){}else await new Promise((()=>{throw new Error("Just make a promise, plz ignore me")})).catch((async()=>{let e=await Jo().loadAsync(n,{createFolders:!1});for(const i in e.files){if(e.files[i].dir)continue;let s=e.files[i],r=new File([await s.async("blob")],i,{type:"",lastModified:s.date});t.push(r)}})).catch((async()=>{let t=await createImageBitmap(n),e=await Fe.from(t);Fe.addToCache(e,n.name),Nc.images[n.name]=e,Nc.all[n.name]=e,Bc.file.bg.appendChild(s(n))})).catch((async()=>{let t=await i(n);Nc.musics[n.name]=t,Nc.all[n.name]=t,Bc.file.music.appendChild(s(n))})).catch((async()=>{let t,i=await e(n);try{t=JSON.parse(i)}catch(e){t=i}t=Wo.from(t),Nc.charts[n.name]=t,Nc.all[n.name]=t,Bc.file.chart.appendChild(s(n))})).catch((t=>{console.error(t),console.error("Unsupported file: "+n.name)}))}function e(t){return new Promise(((e,i)=>{let s=new FileReader;s.onloadend=()=>{e(s.result)},s.onerror=t=>{i(t)},s.readAsText(t)}))}function i(t){return new Promise((async(e,i)=>{let s=await function(t){return new Promise(((e,i)=>{let s=new FileReader;s.onloadend=()=>{e(s.result)},s.onerror=t=>{i(t)},s.readAsDataURL(t)}))}(t),r=new Qo.Howl({src:s,format:t.format,preload:!0,autoPlay:!1,loop:!1,onload:()=>{e(r)},onloaderror:(t,e)=>{i(t,e)}});r.load()}))}function s(t){let e=document.createElement("option");return e.innerText=e.value=t.name,e}Bc.file.chart.childNodes.length>=1&&Bc.file.music.childNodes.length>=1&&(Bc.file.chart.dispatchEvent(new Event("input")),Bc.startBtn.disabled=!1),Bc.chartPackFileReadProgress.innerText="All done!"})),Bc.file.chart.addEventListener("input",(function(){if(Lc.chart=Nc.charts[this.value],Nc.infos&&Nc.infos.length>0)for(const t of Nc.infos)if(t.Chart===this.value){Lc.music=Nc.musics[t.Music],Lc.bg=Nc.images[t.Image],Bc.file.music.value=t.Music,Bc.file.bg.value=t.Image;break}Bc.file.music.dispatchEvent(new Event("input")),Bc.file.bg.dispatchEvent(new Event("input"))})),Bc.file.music.addEventListener("input",(function(){Lc.music=Nc.musics[this.value]})),Bc.file.bg.addEventListener("input",(function(){Lc.bg=Nc.images[this.value]})),Bc.startBtn.addEventListener("click",(async()=>{if(Lc.chart)if(Lc.music){if(Lc.chart.music=Lc.music,Lc.bg){let t=await Fe.from(await function(t,e=10){let i,s=document.createElement("canvas"),r=s.getContext("2d");return i=t.baseTexture?t.baseTexture.resource.source:t,s.width=i.width,s.height=i.height,r.drawImage(i,0,0),sh(s,0,0,i.width,i.height,e),new Promise(((t,e)=>{createImageBitmap(s).then((e=>t(e))).catch((t=>e(t)))}))}(Lc.bg,Bc.settings.bgBlur.value));Fe.addToCache(t,Bc.file.bg.value+"_blured"),Lc.chart.bg=t}if(Nc.infos&&Nc.infos.length>0)for(const t of Nc.infos)if(t.Chart===Bc.file.chart.value){Lc.chart.info.name=t.Name,Lc.chart.info.artist=t.Composer,Lc.chart.info.author=t.Designer,Lc.chart.info.bgAuthor=t.Illustrator,Lc.chart.info.difficult=t.Level;break}if(Nc.lines&&Nc.lines.length>0){let t=[];for(const e of Nc.lines)e.Chart===Bc.file.chart.value&&t.push(e);Lc.chart.readLineTextureInfo(t)}window._game=new Ro({chart:Lc.chart,assets:Oc,zipFiles:Nc.all,render:{resizeTo:document.documentElement,resolution:Bc.settings.lowResolution.checked?1:window.devicePixelRatio,antialias:Bc.settings.antiAlias.checked,forceCanvas:Bc.settings.forceCanvas.checked},settings:{multiNoteHL:Bc.settings.multiNoteHL.checked,showAPStatus:Bc.settings.showAPStatus.checked,showInputPoint:Bc.settings.showInputPoint.checked,bgDim:Bc.settings.bgDim.value,noteScale:1e4-Bc.settings.noteScale.value,audioOffset:Bc.settings.offset.value/1e3,speed:Bc.settings.speed.value,hitsound:Bc.settings.hitsound.checked,hitsoundVolume:Bc.settings.hitsoundVolume.value,challengeMode:Bc.settings.challengeMode.checked,autoPlay:Bc.settings.autoPlay.checked,debug:Bc.settings.debug.checked},watermark:"github/MisaLiu/phi-chart-render "+GITHUB_CURRENT_GIT_HASH}),document.body.appendChild(_game.render.view),_game.render.view.classList.add("canvas-game"),_game.on("start",(()=>console.log("Game started!"))),_game.on("pause",(()=>{console.log("Game paused!"),Dc(".game-paused").style.display="block"})),_game.on("end",(t=>{console.log("Game ended!"),function(t){let e=t.chart,i=t.judgement;Dc(".play-result .song-info .title").innerHTML=e.info.name||"Untitled",Dc(".play-result .song-info .subtitle.artist").innerHTML=e.info.artist||"Unknown",Dc(".play-result .song-info .subtitle.diff").innerHTML=e.info.difficult||"SP Lv.?",t._settings.challengeMode&&(Dc(".play-result .song-info .subtitle.diff").innerHTML+=" (challenge)"),1!==Number(t._settings.speed.toFixed(2))&&(Dc(".play-result .song-info .subtitle.diff").innerHTML+=" (x"+t._settings.speed.toFixed(2)+")"),6==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="φ":5==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="V":4==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="S":3==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="A":2==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="B":1==i.score.judgeLevel?Dc(".play-result .judge-icon").innerText="C":Dc(".play-result .judge-icon").innerText="False",2==i.score.APType?Dc(".play-result .extra-info").innerText="All Perfect":1==i.score.APType?Dc(".play-result .extra-info").innerText="Full Combo":Dc(".play-result .extra-info").innerText="",i.score._autoPlay&&(Dc(".play-result .extra-info").innerText="Auto Play"),Dc(".play-result .info-bar.score .score").innerText=function(t){let e=t+"";for(;e.length<7;)e="0"+e;return e}(i.score.score.toFixed(0)),Dc(".play-result .info-bar.score .acc").innerText="Accuracy "+(100*i.score.acc).toFixed(2)+"%",Dc(".play-result .info-bar.detail .detail-single .value.perfect").innerText=i.score.perfect,Dc(".play-result .info-bar.detail .detail-single .value.good").innerText=i.score.good,Dc(".play-result .info-bar.detail .detail-single .value.bad").innerText=i.score.bad,Dc(".play-result .info-bar.detail .detail-single .value.miss").innerText=i.score.miss,Dc(".play-result .info-bar.detail .max-combo").innerText="Max Combo "+i.score.maxCombo;{Dc(".play-result .info-bar.acc-bar .judge-histogram").innerHTML="";let e=(t._settings.challengeMode?90:180)/1e3,i=0,s={};t.chart.notes.forEach((t=>{t.isFake||isNaN(t.scoreTime)||(s[Math.ceil(t.scoreTime/e*50)]=s[Math.ceil(t.scoreTime/e*50)]?s[Math.ceil(t.scoreTime/e*50)]+1:1)}));for(const t in s)s[t]>i&&(i=s[t]);for(const e in s){let r=document.createElement("div");r.style.opacity=s[e]/i,r.style.setProperty("--pos",Number(e)+50+"%"),t._settings.challengeMode?r.style.background=-40/180*100<=e&&e<=40/180*100?"#FFECA0":-75/180*100<=e&&e<=75/180*100?"#B4E1FF":"#6c4343":r.style.background=-80/360*100<=e&&e<=80/360*100?"#FFECA0":-160/360*100<=e&&e<=160/360*100?"#B4E1FF":"#6c4343",Dc(".play-result .info-bar.acc-bar .judge-histogram").appendChild(r)}let r=document.createElement("div");r.className="center",Dc(".play-result .info-bar.acc-bar .judge-histogram").appendChild(r)}Oc.sounds.result.music.stop(),Oc.sounds.result.music.play(),Dc(".play-result").classList.add("show")}(t)})),_game.createSprites(),_game.start(),Bc.fileSelect.style.display="none"}else alert("No music selected.");else alert("No chart selected.")})),Bc.errorWindow.closeBtn.addEventListener("click",(()=>{Bc.errorWindow.window.style.display="none"})),window.addEventListener("resize",(()=>{zc()})),window.addEventListener("load",(async()=>{for(const t in Mc)try{Bc.loadingStatus.innerText="Loading font "+t+" ...",await Mc[t].load(null,3e4)}catch(t){console.error(t)}function t(t){return new Promise(((e,i)=>{let s=new XMLHttpRequest;s.responseType="blob",s.onreadystatechange=()=>{4===s.readyState&&200===s.status&&e(s.response)},s.onerror=t=>{i(t)},s.open("GET",t),s.send()}))}function e(t){return new Promise(((e,i)=>{let s=new FileReader;s.onloadend=()=>{e(s.result)},s.onerror=t=>{i(t)},s.readAsDataURL(t)}))}function i(t,e={}){return new Promise(((i,s)=>{let r=new Qo.Howl({src:t,preload:!0,autoplay:!1,loop:!1,...e,onload:()=>{i(r)},onloaderror:(t,e)=>{s(t,e)}});r.load()}))}document.body.classList.add("font-loaded"),await(async(e=[])=>{for(const i of e){Bc.loadingStatus.innerText="Loading asset "+i.name+" ...";try{let e=await t(i.url),s=await createImageBitmap(e),r=await Fe.from(s);if(Fe.addToCache(r,i.name),Oc.textures[i.name]=r,"clickRaw"==i.name){let t=[];for(let e=0;e<Math.floor(Oc.textures[i.name].height/Oc.textures[i.name].width);e++){let s=new tt(0,e*Oc.textures[i.name].width,Oc.textures[i.name].width,Oc.textures[i.name].width),r=new Fe(Oc.textures[i.name].baseTexture,s);Fe.addToCache(r,i.name+(e+0)),r.defaultAnchor.set(.5),t.push(r)}Oc.textures[i.name]=t}}catch(t){console.error("Failed getting resource: "+i.name,t)}}})([{name:"tap",url:"./assets/Tap.png"},{name:"tapHL",url:"./assets/TapHL.png"},{name:"drag",url:"./assets/Drag.png"},{name:"dragHL",url:"./assets/DragHL.png"},{name:"flick",url:"./assets/Flick.png"},{name:"flickHL",url:"./assets/FlickHL.png"},{name:"holdHead",url:"./assets/HoldHead.png"},{name:"holdHeadHL",url:"./assets/HoldHeadHL.png"},{name:"holdBody",url:"./assets/Hold.png"},{name:"holdBodyHL",url:"./assets/HoldHL.png"},{name:"holdEnd",url:"./assets/HoldEnd.png"},{name:"judgeline",url:"./assets/JudgeLine.png"},{name:"clickRaw",url:"./assets/clickRaw128.png"},{name:"pauseButton",url:"./assets/pauseButton.png"}]),await(async(s=[])=>{for(const r of s){Bc.loadingStatus.innerText="Loading hitsound "+r.name+" ...";try{let s=await t(r.url),n=await e(s),a=await i(n);Oc.sounds||(Oc.sounds={}),Oc.sounds[r.name]=a}catch(t){console.error("Failed getting resource: "+r.name,t)}}})([{name:"tap",url:"./assets/sounds/Hitsound-Tap.ogg"},{name:"drag",url:"./assets/sounds/Hitsound-Drag.ogg"},{name:"flick",url:"./assets/sounds/Hitsound-Flick.ogg"}]),await(async(s=[],r={})=>{for(const n of s){Bc.loadingStatus.innerText="Loading result music "+n.name+" ...";try{let s=await t(n.url),a=await e(s),o=await i(a,r);Oc.sounds.result||(Oc.sounds.result={}),Oc.sounds.result[n.name]=o}catch(t){console.error("Failed getting resource: "+n.name,t)}}})([{name:"music",url:"./assets/sounds/result.ogg"}],{loop:!0}),Bc.loadingStatus.innerText="All done!",Bc.chartPackFileReadProgress.innerText="No chart pack file selected",Bc.chartPackFile.disabled=!1,zc(),Dt()||(Bc.settings.forceCanvas.checked=!0,Bc.settings.forceCanvas.disabled=!0),Bc.settings.testInputDelay.testTimes=0,Bc.settings.testInputDelay.testDelays=0,Bc.settings.testInputDelay.addEventListener("touchstart",(t=>{Bc.settings.testInputDelay.testTimes+=1,Bc.settings.testInputDelay.testDelays+=(performance?performance.now():Date.now())-t.timeStamp,Bc.settings.testInputDelay.innerText="Tap on this button to test input delay..."+Math.round(Bc.settings.testInputDelay.testDelays/Bc.settings.testInputDelay.testTimes*1e3)/1e3+"ms"})),Bc.playResult.scoreBar.addEventListener("click",(()=>Bc.playResult.accBar.classList.toggle("show")))})),window.pauseGame=function(){_game&&(_game.pause(),_game._isPaused?Dc(".game-paused").style.display="block":(console.log("Game unpaused!"),Dc(".game-paused").style.display="none"))},window.restartGame=function(){if(_game){_game.restart();for(const t in Oc.sounds.result)Oc.sounds.result[t].stop();Dc(".game-paused").style.display="none",Dc(".play-result").classList.remove("show"),Bc.playResult.accBar.classList.remove("show")}},window.exitGame=function(){if(_game){_game.destroy(!0),_game=void 0;for(const t in Oc.sounds.result)Oc.sounds.result[t].stop();Dc(".game-paused").style.display="none",Dc(".play-result").classList.remove("show"),Bc.playResult.accBar.classList.remove("show"),Bc.fileSelect.style.display="block"}}})()})();
//# sourceMappingURL=script.js.map